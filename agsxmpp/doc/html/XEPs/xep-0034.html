<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0034: SASL Integration</title><link rel="stylesheet" type="text/css" href="/xmpp.css" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><meta name="DC.Title" content="SASL Integration" /><meta name="DC.Creator" content="Robert Norris" /><meta name="DC.Creator" content="Jeremie Miller" /><meta name="DC.Creator" content="Peter Saint-Andre" /><meta name="DC.Description" content="NOTE WELL: this specification was retracted on 2003-11-05 since the topic is addressed definitively in XMPP Core. Please refer to XMPP Core for further information." /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2003-11-05" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0034" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright (c) 1999 - 2008 by the XMPP Standards Foundation (XSF)." /></head><body><h1>XEP-0034: SASL Integration</h1><p>NOTE WELL: this specification was retracted on 2003-11-05 since the topic is addressed definitively in XMPP Core. Please refer to XMPP Core for further information.</p><hr /><p style="color:red">WARNING: This document has been retracted by the author(s). Implementation of the protocol described herein is not recommended. Developers desiring similar functionality should implement the protocol that supersedes this one (if any).</p><hr /><h2>Document Information</h2><p class="indent">
            Series: <a href="http://www.xmpp.org/extensions/">XEP</a><br />
            Number: 0034<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status: 
            <a href="http://www.xmpp.org/extensions/xep-0001.html#states-Retracted">Retracted</a><br />
            Type:
            <a href="http://www.xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br />
            Version: 1.1<br />
            Last Updated: 2003-11-05<br />
                Approving Body: <a href="http://www.xmpp.org/council/">XMPP Council</a><br />
                Dependencies: None<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: N/A<br />
              Wiki Page: &lt;<a href="http://wiki.jabber.org/index.php/SASL Integration (XEP-0034)">http://wiki.jabber.org/index.php/SASL Integration (XEP-0034)</a>&gt;
            </p><hr /><h2>Author Information</h2><div class="indent"><h3>Robert Norris</h3><p class="indent">
        Email:
        <a href="mailto:rob@cataclysm.cx">rob@cataclysm.cx</a><br />
        JabberID: 
        <a href="xmpp:rob@cataclysm.cx">rob@cataclysm.cx</a><br /></p><h3>Jeremie Miller</h3><p class="indent">
        Email:
        <a href="mailto:jeremie@jabber.org">jeremie@jabber.org</a><br />
        JabberID: 
        <a href="xmpp:jer@jabber.org">jer@jabber.org</a><br /></p><h3>Peter Saint-Andre</h3><p class="indent">
        Email:
        <a href="mailto:stpeter@jabber.org">stpeter@jabber.org</a><br />
        JabberID: 
        <a href="xmpp:stpeter@jabber.org">stpeter@jabber.org</a><br /></p></div><hr /><h2>Legal Notices</h2><div class="indent"><h3>Copyright</h3>This XMPP Extension Protocol is copyright (c) 1999 - 2008 by the XMPP Standards Foundation (XSF).<h3>Permissions</h3>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h3>Disclaimer of Warranty</h3><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. In no event shall the XMPP Standards Foundation or the authors of this Specification be liable for any claim, damages, or other liability, whether in an action of contract, tort, or otherwise, arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification. ##</span><h3>Limitation of Liability</h3>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising out of the use or inability to use the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h3>IPR Conformance</h3>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which may be found at &lt;<a href="http://www.xmpp.org/extensions/ipr-policy.shtml">http://www.xmpp.org/extensions/ipr-policy.shtml</a>&gt; or obtained by writing to XSF, P.O. Box 1641, Denver, CO 80201 USA).</div><hr /><h2>Discussion Venue</h2><p class="indent">The preferred venue for discussion of this document is the Standards discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">http://mail.jabber.org/mailman/listinfo/standards</a>&gt;.</p><p class="indent">Errata may be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><h2>Relation to XMPP</h2><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><h2>Conformance Terms</h2><p class="indent">The following keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#sect-id2252619">Introduction</a><br />2.  <a href="#sect-id2252640">Protocol</a><br />   
      2.1.  <a href="#sect-id2252694">Overview</a><br />   
      2.2.  <a href="#sect-id2251410">Stream initialization</a><br />   
      2.3.  <a href="#sect-id2251455">Mechanism selection and handshake</a><br />   
      2.4.  <a href="#sect-id2251560">Success, failure and client abort</a><br />   
      2.5.  <a href="#sect-id2261085">Session start</a><br />3.  <a href="#sect-id2261141">Support for existing authentication methods</a><br />   
      3.1.  <a href="#sect-id2261158">Legacy client-to-server authentication support</a><br />   
      3.2.  <a href="#sect-id2261205">Dialback support for server-to-server authentication</a><br /><a href="#notes">Notes</a><br /><a href="#revs">Revision History</a></p></div><hr /><h2>1.
       <a name="sect-id2252619" id="sect-id2252619">Introduction</a></h2>
  <p class="" style="">The Simple Authentication and Security Layer (SASL) (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc4422">RFC 4422</a></span>  [<a href="#nt-id2252655">2</a>]) provides a generalized method for adding authentication support to connection-based protocols. This document describes a generic XML namespace profile for SASL, that conforms to section 4 of RFC 4422, "Profiling requirements".</p>
  
  <p class="" style="">This profile may be used for both client-to-server and server-to-server connections. For client connections, the service name used is "jabber-client". For server connections, the service name used is "jabber-server". Both these names are registered in the IANA service registry.</p>

  <p class="" style="">The reader is expected to have read and understood the SASL specification before reading this document.</p>
<h2>2.
       <a name="sect-id2252640" id="sect-id2252640">Protocol</a></h2>

  <div class="indent"><h3>2.1 <a name="sect-id2252694" id="sect-id2252694">Overview</a></h3>
    <p class="" style="">In these examples, "client" refers to the remote entity that initiated the connection, either a Jabber client or a Jabber server. "Server" refers to the server that the remote entity is attempting to connect and authenticate to.</p>

    <p class="" style="">The steps involved for a SASL negotiation are as follows:</p>

    <ol start="" class="" style="">
      <li class="" style="">Client requests SASL authentication</li>
      <li class="" style="">Server responds with list of available SASL authentication mechanisms</li>
      <li class="" style="">Client selects mechanism</li>
      <li class="" style="">Server sends a challenge</li>
      <li class="" style="">Client responds to challenge</li>
      <li class="" style="">Server sends more challenges, client sends more responses</li>
    </ol>

    <p class="" style="">This series of challenge/response pairs continues until one of three things happens:</p>

    <ol start="" class="" style="">
      <li class="" style="">Client aborts the handshake.</li>
      <li class="" style="">Server reports failure.</li>
      <li class="" style="">Server reports success.</li>
    </ol>

    <p class="" style="">After authentication has completed, the client sends a packet to begin the session.</p>
    
    <p class="" style="">The namespace identifier for this protocol is http://www.iana.org/assignments/sasl-mechanisms.</p>

    <p class="" style="">The following examples show the dialogue between a client [C] and a server [S].</p>

    <p class="" style="">
    </p>
  </div>

  <div class="indent"><h3>2.2 <a name="sect-id2251410" id="sect-id2251410">Stream initialization</a></h3>
    <p class="" style="">The client begins by requesting SASL authentication as part of the normal Jabber stream negotiation.  [<a href="#nt-id2251424">3</a>] The server responds by sending the available authentication mechanisms to the client along with the stream information:</p>

    <p class="caption"><a name="example-1" id="example-1"></a>Example 1. Stream initialization</p><div class="indent"><pre>
C: &lt;stream:stream xmlns='jabber:client'
                  xmlns:stream='http://etherx.jabber.org/streams'
                  xmlns:sasl='http://www.iana.org/assignments/sasl-mechanisms'
                  to='jabber.org'&gt;
S: &lt;stream:stream xmlns='jabber:client'
                  xmlns:stream='http://etherx.jabber.org/streams'
                  xmlns:sasl='http://www.iana.org/assignments/sasl-mechanisms'
                  id='12345678'&gt;
   &lt;sasl:mechanisms&gt;
     &lt;sasl:mechanism&gt;PLAIN&lt;/sasl:mechanism&gt;
     &lt;sasl:mechanism&gt;DIGEST-MD5&lt;/sasl:mechanism&gt;
     &lt;sasl:mechanism&gt;EXTERNAL&lt;/sasl:mechanism&gt;
   &lt;sasl:mechanisms&gt;
    </pre></div>
  </div>

  <div class="indent"><h3>2.3 <a name="sect-id2251455" id="sect-id2251455">Mechanism selection and handshake</a></h3>
    <p class="" style="">Next, the client selects an authentication mechanism:</p>

    <p class="caption"><a name="example-2" id="example-2"></a>Example 2. Plaintext mechanism selection</p><div class="indent"><pre>
C: &lt;sasl:auth mechanism='PLAIN'/&gt;
    </pre></div>

    <p class="" style="">The server responds with a mechanism-specific challenge, which the client must respond to. More than one challenge/response pair can take place; this is mechanism-specific.</p>

    <p class="" style="">Challenges and responses are Base64 [<a href="#nt-id2251495">4</a>] encoded.</p>

    <p class="caption"><a name="example-3" id="example-3"></a>Example 3. Plaintext handshake</p><div class="indent"><pre>
S: &lt;sasl:challenge/&gt;
C: &lt;sasl:response&gt;cm9iAHNlY3JldA==&lt;/sasl:response&gt;
    </pre></div>

    <p class="caption"><a name="example-4" id="example-4"></a>Example 4. Digest handshake</p><div class="indent"><pre>
S: &lt;sasl:challenge&gt;
     cmVhbG09ImNhdGFjbHlzbS5jeCIsbm9uY2U9Ik9BNk1HOXRFUUdtMmhoIi
     xxb3A9ImF1dGgiLGNoYXJzZXQ9dXRmLTgsYWxnb3JpdGhtPW1kNS1zZXNz
   &lt;/sasl:challenge&gt;
C: &lt;sasl:response&gt;
     dXNlcm5hbWU9InJvYiIscmVhbG09ImNhdGFjbHlzbS5jeCIsbm9uY2U9Ik
     9BNk1HOXRFUUdtMmhoIixjbm9uY2U9Ik9BNk1IWGg2VnFUclJrIixuYz0w
     MDAwMDAwMSxxb3A9YXV0aCxkaWdlc3QtdXJpPSJqYWJiZXIvY2F0YWNseX
     NtLmN4IixyZXNwb25zZT1kMzg4ZGFkOTBkNGJiZDc2MGExNTIzMjFmMjE0
     M2FmNyxjaGFyc2V0PXV0Zi04
   &lt;/sasl:response&gt;
S: &lt;sasl:challenge&gt;
     cnNwYXV0aD1lYTQwZjYwMzM1YzQyN2I1NTI3Yjg0ZGJhYmNkZmZmZA==
   &lt;/sasl:challenge&gt;
C: &lt;sasl:response/&gt;
    </pre></div>

    <p class="" style="">For mechanisms that require the client to send data first (ie the first challenge from the server is empty), the client may optionally send its first response as part of the mechanism selection:</p>

    <p class="caption"><a name="example-5" id="example-5"></a>Example 5. Plaintext mechanism selection; client sends data first</p><div class="indent"><pre>
C: &lt;sasl:auth mechanism='PLAIN'&gt;cm9iAHNlY3JldA==&lt;/sasl:auth&gt;
    </pre></div>
  </div>

  <div class="indent"><h3>2.4 <a name="sect-id2251560" id="sect-id2251560">Success, failure and client abort</a></h3>
    <p class="" style="">The handshake continues until authentication completes successfully, authentication fails, or the client aborts the handshake:</p>

    <p class="caption"><a name="example-6" id="example-6"></a>Example 6. Authentication success</p><div class="indent"><pre>
S: &lt;sasl:success/&gt;
    </pre></div>

    <p class="caption"><a name="example-7" id="example-7"></a>Example 7. Authentication failure</p><div class="indent"><pre>
S: &lt;sasl:failure/&gt;
    </pre></div>

    <p class="caption"><a name="example-8" id="example-8"></a>Example 8. Client abort</p><div class="indent"><pre>
C: &lt;sasl:abort/&gt;
    </pre></div>

    <p class="" style="">Optionally, the server or client may send an informative message along with the success, failure or abort command:</p>

    <p class="caption"><a name="example-9" id="example-9"></a>Example 9. Authentication failure; optional informative message</p><div class="indent"><pre>
S: &lt;sasl:failure&gt;Plaintext authentication failed (Incorrect username or password)&lt;/sasl:failure&gt;
    </pre></div>

    <p class="" style="">Following a failure or client abort, the client may start a new handshake. Following a successful authentication, any further attempts by the client to begin a new authentication handshake will automatically result in the server sending a failure.</p>
  </div>

  <div class="indent"><h3>2.5 <a name="sect-id2261085" id="sect-id2261085">Session start</a></h3>
    <p class="" style="">Note: that this section only applies to client-to-server connections.</p>

    <p class="" style="">Following successful authentication, the client must send a standard IQ set packet in the jabber:iq:auth namespace to start a session. The client must supply a username and resource for the session along with this packet.</p>

    <p class="caption"><a name="example-10" id="example-10"></a>Example 10. Session start after successful authentication</p><div class="indent"><pre>
C: &lt;iq id="a1" type="get"&gt;
     &lt;query xmlns="jabber:iq:auth"&gt;
       &lt;username&gt;rob&lt;/username&gt;
     &lt;/query&gt;
   &lt;/iq&gt;
S: &lt;iq id="a1" type="result"&gt;
     &lt;query xmlns="jabber:iq:auth"&gt;
       &lt;username&gt;rob&lt;/username&gt;
       &lt;resource/&gt;
     &lt;/query&gt;
   &lt;/iq&gt;
C: &lt;iq id="a2" type="set"&gt;
     &lt;query xmlns="jabber:iq:auth"&gt;
       &lt;username&gt;rob&lt;/username&gt;
       &lt;resource&gt;laptop&lt;/resource&gt;
     &lt;/query&gt;
   &lt;/iq&gt;
S: &lt;iq id="a2" type="result"&gt;
     &lt;query xmlns="jabber:iq:auth"/&gt;
   &lt;/iq&gt;
    </pre></div>

    <p class="" style="">If the client attempts to start a session before authenticating, or the username given in the jabber:iq:auth packet does not match the username given in the authentication credentials (when the SASL mechanism supports it), the server will return a 401 (Unauthorized) error packet.</p>
  </div>
<h2>3.
       <a name="sect-id2261141" id="sect-id2261141">Support for existing authentication methods</a></h2>
  <p class="" style="">Traditionally, Jabber servers have supported two authentication models - jabber:iq:auth for client-to-server authentication, and dialback for server-to-server authentication.</p>

  <div class="indent"><h3>3.1 <a name="sect-id2261158" id="sect-id2261158">Legacy client-to-server authentication support</a></h3>
    <p class="" style="">Until SASL authentication is in widespread use, clients and servers may support both SASL and the legacy jabber:iq:auth authentication system for client-to-server connections. Note that neither the client nor the server are required to support legacy authentication; it is simply a courtesy to users until the majority of clients and servers support SASL authentication.</p>

    <p class="" style="">If a client connects and does not request the use of SASL (that is, the SASL profile namespace identifier does not appear in the stream initializer response), then the server should disable SASL for this connection; that is, it should not add the SASL profile namespace identifier to the stream initialization response, nor should it offer any SASL mechanisms.</p>

    <p class="" style="">If a client connects to a server that does not support SASL (identified by the lack of the SASL profile namespace identifier in the stream initializer response, even though the client requested it), the client may choose to fall back to use legacy authentication.</p>
  </div>

  <div class="indent"><h3>3.2 <a name="sect-id2261205" id="sect-id2261205">Dialback support for server-to-server authentication</a></h3>
    <p class="" style="">SASL authentication for server-to-server connections is not intended to replace dialback, as there are uses for both. Dialback is useful in an uncontrolled environment, such as the global Internet, where it is necessary to verify the identity of the remote server. SASL authentication has uses in a more controlled environment, where the administrator wishes to restrict access to a certain number of known remote servers.</p>

    <p class="" style="">To this end, the use of dialback is not deprecated. If a remote server connects and requests the use of dialback (by specifying the "jabber:server:dialback" namespace, the the local server shall not offer SASL authentication. Similarly, if the remote server connects and requests the use of SASL authentication, then the local server shall not offer dialback. In the event that the remote server requests both, the local server should terminate the stream immediately and close the connection. If the remote server requests neither, then the local server may choose to support the pre-dialback server-to-server stream, but it is recommended that the local server terminate the stream and close the connection.</p>
  </div>
<hr /><h2><a name="notes" id="notes"></a>Notes</h2><div class="indent"><p><a name="nt-id2252743" id="nt-id2252743">1</a>. RFC 3920: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://tools.ietf.org/html/rfc3920">http://tools.ietf.org/html/rfc3920</a>&gt;.</p><p><a name="nt-id2252655" id="nt-id2252655">2</a>. RFC 4422: Simple Authentication and Security Layer (SASL) &lt;<a href="http://tools.ietf.org/html/rfc4422">http://tools.ietf.org/html/rfc4422</a>&gt;.</p><p><a name="nt-id2251424" id="nt-id2251424">3</a>. In the case of the remote entity being a server, the default namespace in the stream header will be "jabber:server".</p><p><a name="nt-id2251495" id="nt-id2251495">4</a>. <a href="http://www.ietf.org/rfc/rfc2045.txt">RFC 2045</a>, section 6.8.</p></div><hr /><h2><a name="revs" id="revs"></a>Revision History</h2><div class="indent"><h4>Version 1.1 (2003-11-05)</h4><div class="indent">The status of this specification has been changed to Retracted since it has been superseded by <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3920">XMPP Core</a></span>  [<a href="#nt-id2252743">1</a>]. (psa)
    </div><h4>Version 1.0 (2002-08-13)</h4><div class="indent">Changed status to Draft. (psa)
    </div><h4>Version 0.3 (2002-07-26)</h4><div class="indent">Reworked for server-to-server SASL; added jabber:iq:auth get (as in xmpp-im). (rn)
    </div><h4>Version 0.2 (2002-06-05)</h4><div class="indent">Fleshed out. (rn)
    </div><h4>Version 0.1 (2002-06-03)</h4><div class="indent">Initial version based on Jer's notes. (psa)
    </div></div><hr /><p>END</p></body></html>
