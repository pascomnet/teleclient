<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0150: Use of Entity Tags in XMPP Extensions</title><link rel="stylesheet" type="text/css" href="/xmpp.css" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><meta name="DC.Title" content="Use of Entity Tags in XMPP Extensions" /><meta name="DC.Creator" content="Joe Hildebrand" /><meta name="DC.Creator" content="Peter Saint-Andre" /><meta name="DC.Description" content="This document defines best practices for the use of Entity Tags in XMPP extensions." /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2005-08-09" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0150" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright (c) 1999 - 2008 by the XMPP Standards Foundation (XSF)." /></head><body><h1>XEP-0150: Use of Entity Tags in XMPP Extensions</h1><p>This document defines best practices for the use of Entity Tags in XMPP extensions.</p><hr /><p style="color:red">WARNING: Consideration of this document has been Deferred by the XMPP Standards Foundation. Implementation of the protocol described herein is not recommended.</p><hr /><h2>Document Information</h2><p class="indent">
            Series: <a href="http://www.xmpp.org/extensions/">XEP</a><br />
            Number: 0150<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status: 
            <a href="http://www.xmpp.org/extensions/xep-0001.html#states-Deferred">Deferred</a><br />
            Type:
            <a href="http://www.xmpp.org/extensions/xep-0001.html#types-Informational">Informational</a><br />
            Version: 0.2<br />
            Last Updated: 2005-08-09<br />
                Approving Body: <a href="http://www.xmpp.org/council/">XMPP Council</a><br />Dependencies: XMPP Core, RFC 2616, XEP-0131<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: N/A<br />
              Wiki Page: &lt;<a href="http://wiki.jabber.org/index.php/Use of Entity Tags in XMPP Extensions (XEP-0150)">http://wiki.jabber.org/index.php/Use of Entity Tags in XMPP Extensions (XEP-0150)</a>&gt;
            </p><hr /><h2>Author Information</h2><div class="indent"><h3>Joe Hildebrand</h3><p class="indent">
        Email:
        <a href="mailto:jhildebrand@jabber.com">jhildebrand@jabber.com</a><br />
        JabberID: 
        <a href="xmpp:hildjj@jabber.org">hildjj@jabber.org</a><br /></p><h3>Peter Saint-Andre</h3><p class="indent">
        JabberID: 
        <a href="xmpp:stpeter@jabber.org">stpeter@jabber.org</a><br />
        URI: 
        <a href="https://stpeter.im/">https://stpeter.im/</a><br /></p></div><hr /><h2>Legal Notices</h2><div class="indent"><h3>Copyright</h3>This XMPP Extension Protocol is copyright (c) 1999 - 2008 by the XMPP Standards Foundation (XSF).<h3>Permissions</h3>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h3>Disclaimer of Warranty</h3><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. In no event shall the XMPP Standards Foundation or the authors of this Specification be liable for any claim, damages, or other liability, whether in an action of contract, tort, or otherwise, arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification. ##</span><h3>Limitation of Liability</h3>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising out of the use or inability to use the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h3>IPR Conformance</h3>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which may be found at &lt;<a href="http://www.xmpp.org/extensions/ipr-policy.shtml">http://www.xmpp.org/extensions/ipr-policy.shtml</a>&gt; or obtained by writing to XSF, P.O. Box 1641, Denver, CO 80201 USA).</div><hr /><h2>Discussion Venue</h2><p class="indent">The preferred venue for discussion of this document is the Standards discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">http://mail.jabber.org/mailman/listinfo/standards</a>&gt;.</p><p class="indent">Given that this XMPP Extension Protocol normatively references IETF technologies, discussion on the XSF-IETF list may also be appropriate (see &lt;<a href="http://mail.jabber.org/mailman/listinfo/jsf-ietf">http://mail.jabber.org/mailman/listinfo/jsf-ietf</a>&gt; for details).</p><p class="indent">Errata may be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><h2>Relation to XMPP</h2><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><h2>Conformance Terms</h2><p class="indent">The following keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#intro">Introduction</a><br />2.  <a href="#reqs">Requirements</a><br />3.  <a href="#approach">Concepts and Approach</a><br />4.  <a href="#usecases">Use Cases</a><br />   
      4.1.  <a href="#roster">Caching and Retrieving Rosters</a><br />   
      4.2.  <a href="#privacy">Caching and Retrieving Privacy Lists</a><br />   
      4.3.  <a href="#disco">Discovering Support</a><br />5.  <a href="#security">Security Considerations</a><br />6.  <a href="#iana">IANA Considerations</a><br />7.  <a href="#registrar">XMPP Registrar Considerations</a><br />8.  <a href="#schema">XML Schema</a><br />9.  <a href="#issues">Open Issues</a><br /><a href="#notes">Notes</a><br /><a href="#revs">Revision History</a></p></div><hr /><h2>1.
       <a name="intro" id="intro">Introduction</a></h2>
  <p class="" style="">When an XMPP instant messaging client connects to its server, it typically retrieves a great deal of information, such as a user's roster, privacy lists, and service discovery information. However, this information may not have changed since the client last retrieved the data. In order to improve client start-up time or conserve bandwidth in certain environments, it would be desirable if the client could cache the information and retrieve it only if it has changed.</p>
  <p class="" style="">Such a mechanism exists as part of <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc2616">RFC 2616</a></span>  [<a href="#nt-id2252647">1</a>] in the form of the Entity Tags, which are included in the ETag and If-None-Match headers used for HTTP caching. Since <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0131.html">Stanza Headers and Internet Metadata</a></span>  [<a href="#nt-id2252674">2</a>] enables an XMPP entity to communicate any HTTP header, it should be possible to re-use existing Entity Tag semantics for caching information sent over an XMPP network. This document defines best practices for such functionality, which could be used between any two XMPP entities that support SHIM headers (though it is envisioned to be most useful for clients that retrieve information from servers and services).</p>
<h2>2.
       <a name="reqs" id="reqs">Requirements</a></h2>
  <p class="" style="">This document addresses the following requirements:</p>
  <ol start="" class="" style="">
    <li class="" style="">Enable caching of information sent over an XMPP network (i.e., retrieval of information only if it has changed since it was last retrieved).</li>
    <li class="" style="">Re-use existing HTTP Entity Tag semantics.</li>
  </ol>
<h2>3.
       <a name="approach" id="approach">Concepts and Approach</a></h2>
  <p class="" style="">In HTTP, an "entity" is the information transferred as the payload of a request or response, and an "Entity Tag" is an opaque string that uniquely identifies that payload. For example, when an HTTP server sends an entity in an HTTP response, it can include an ETag header that identifies the payload as cacheable, and the client can cache that entity; in future requests, the client can include the same value in an If-None-Match header and the server will either return an HTTP 304 ("Not Modified") error if the entity has not changed or return the entity in the HTTP response if it has changed. (Note: For information about the semantics of Entity Tags, the ETag header, and the If-None-Match header, refer to Sections 3.11, 14.19, and 14.26 respectively of <span class="ref">RFC 2616</span>.)</p>
  <p class="" style="">The basic concept behind XMPP Entity Tag use is semantically equivalent to the use in HTTP (although we use the term "data object" to refer to the payload); this is made possible by a straightforward application of SHIM headers as specified in <span class="ref">XEP-0131</span>. In the context of an IQ request-response interaction, the responding entity will include an ETag SHIM header in its IQ response (indicating that the data object can be cached), the requesting entity will include that identical value in an If-None-Match SHIM header when it queries the server for the same data object, and the responding entity will return either an IQ result with the changed data object or an IQ error indicating that the data object has not changed.</p>
  <p class="" style="">Here is an example of such a request-response flow (the example is that of roster retrieval):</p>
  <p class="caption"><a name="example-1" id="example-1"></a>Example 1. Client Requests Roster</p><div class="indent"><pre>
&lt;iq type='get' 
    from='juliet@capulet.com/balcony'
    id='roster1'&gt;
 &lt;query xmlns='jabber:iq:roster'/&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption"><a name="example-2" id="example-2"></a>Example 2. Server Returns Roster Including ETag Header</p><div class="indent"><pre>
&lt;iq type='result' 
    to='juliet@capulet.com/balcony'
    id='roster1'&gt;
 &lt;query xmlns='jabber:iq:roster'&gt;
    &lt;item jid='romeo@montague.net' name='Romeo'&gt;
      &lt;group&gt;Friends&lt;/group&gt;
    &lt;/item&gt;
    &lt;item jid='nurse@capulet.com' name='Nurse'&gt;
      &lt;group&gt;Servants&lt;/group&gt;
    &lt;/item&gt;
    &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
      &lt;header name='ETag'&gt;some-long-opaque-string&lt;/header&gt;
    &lt;/headers&gt;
 &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption"><a name="example-3" id="example-3"></a>Example 3. Client Requests Roster Including If-None-Match Header</p><div class="indent"><pre>
&lt;iq type='get' 
    from='juliet@capulet.com/balcony'
    id='roster2'&gt;
 &lt;query xmlns='jabber:iq:roster'&gt;
    &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
      &lt;header name='If-None-Match'&gt;some-long-opaque-string&lt;/header&gt;
    &lt;/headers&gt;
 &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">If the responding entity does not understand the If-None-Match header or does not handle Entity Tags for the namespace in the request, it MUST ignore the header and return whatever information it would have returned if the header had not been present.</p>
  <p class="" style="">If the responding entity determines that the requested information has not changed since it was last retrieved by the requesting entity, then it MUST return a &lt;not-modified/&gt; error corresponding to the HTTP 304 error returned by HTTP entities that support the ETag header:</p>
  <p class="caption"><a name="example-4" id="example-4"></a>Example 4. Responding Entity Returns Not Modified Error</p><div class="indent"><pre>
&lt;iq type='error' 
    to='juliet@capulet.com/balcony'
    id='roster2'&gt;
 &lt;query xmlns='jabber:iq:roster'&gt;
    &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
      &lt;header name='If-None-Match'&gt;some-long-opaque-string&lt;/header&gt;
    &lt;/headers&gt;
 &lt;/query&gt;
  &lt;error code='304' type='modify'&gt;
    &lt;not-modified xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">Note: The &lt;not-modified/&gt; error condition is not specified as a stanza error condition in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3920">RFC 3920</a></span>  [<a href="#nt-id2251413">3</a>] and an error code of 304 was not included in the older Jabber error codes (see <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0086.html">Error Condition Mappings</a></span>  [<a href="#nt-id2251440">4</a>]). However, the &lt;not-modified/&gt; error condition is included in <span class="ref" style=""><a href="http://tools.ietf.org/html/draft-saintandre-rfc3920bis">rfc3920bis</a></span>  [<a href="#nt-id2251463">5</a>].</p>
  <p class="" style="">Note: In HTTP, an Entity Tag may be either "strong" or "weak" (see Section 13.3.3 of <span class="ref">RFC 2616</span>); Entity Tags as used in XMPP extensions MUST be considered strong rather than weak.</p>
  <p class="" style="">Note: The ETag and If-None-Match headers SHOULD be used only in &lt;iq/&gt; stanzas, although they MAY be used in &lt;message/&gt; stanza interactions if IQ request-response semantics are not appropriate, for example in <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0072.html">SOAP over XMPP</a></span>  [<a href="#nt-id2251518">6</a>] and in certain applications that use <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0004.html">Data Forms</a></span>  [<a href="#nt-id2251544">7</a>].</p>
<h2>4.
       <a name="usecases" id="usecases">Use Cases</a></h2>
  <div class="indent"><h3>4.1 <a name="roster" id="roster">Caching and Retrieving Rosters</a></h3>
    <p class="" style="">As specified in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3921">RFC 3921</a></span>  [<a href="#nt-id2261057">8</a>], an XMPP instant messaging client will typically store its "roster" (contact list) on the server so that any connecting client for that account can retrieve the roster at will. Since <span class="ref">RFC 3921</span> defines no upper limit on the number of items allowed in the roster, it is possible for a roster to become quite large (e.g., there are known cases of rosters with more than 1,000 items). Therefore a server may support Entity Tag functionality with regard to roster management. The process is as follows.</p>
    <p class="" style="">First, the client requests its roster:</p>
    <p class="caption"><a name="example-5" id="example-5"></a>Example 5. Client Requests Roster</p><div class="indent"><pre>
&lt;iq type='get' 
    from='juliet@capulet.com/balcony'
    id='roster1'&gt;
 &lt;query xmlns='jabber:iq:roster'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the server supports Entity Tag functionality for rosters, it SHOULD include an ETag SHIM header in its response (although it MAY decide not to include the header if the roster is deemed to be not worth caching because it is so small):</p>
    <p class="caption"><a name="example-6" id="example-6"></a>Example 6. Server Returns Roster Including ETag Header</p><div class="indent"><pre>
&lt;iq type='result' 
    to='juliet@capulet.com/balcony'
    id='roster1'&gt;
 &lt;query xmlns='jabber:iq:roster'&gt;
    &lt;item jid='romeo@montague.net' name='Romeo'&gt;
      &lt;group&gt;Friends&lt;/group&gt;
    &lt;/item&gt;
    &lt;item jid='nurse@capulet.com' name='Nurse'&gt;
      &lt;group&gt;Servants&lt;/group&gt;
    &lt;/item&gt;
    &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
      &lt;header name='ETag'&gt;some-long-opaque-string&lt;/header&gt;
    &lt;/headers&gt;
 &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The client would then cache that roster and associate the included Entity Tag with that cached copy. In order to subsequently retrieve the roster, the client would include the last known Entity Tag value with the request in an If-None-Match SHIM header:</p>
    <p class="caption"><a name="example-7" id="example-7"></a>Example 7. Client Requests Roster, Including If-None-Match Header</p><div class="indent"><pre>
&lt;iq type='get' 
    from='juliet@capulet.com/balcony'
    id='roster2'&gt;
 &lt;query xmlns='jabber:iq:roster'&gt;
    &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
      &lt;header name='If-None-Match'&gt;some-long-opaque-string&lt;/header&gt;
    &lt;/headers&gt;
 &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the roster did not change since the client last retrieved the roster and the server supports Entity Tags for the 'jabber:iq:roster' namespace, the server MUST return a &lt;not-modified/&gt; error:</p>
    <p class="caption"><a name="example-8" id="example-8"></a>Example 8. Server Returns Not Modified Error</p><div class="indent"><pre>
&lt;iq type='error' 
    to='juliet@capulet.com/balcony'
    id='roster2'&gt;
 &lt;query xmlns='jabber:iq:roster'&gt;
    &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
      &lt;header name='ETag'&gt;some-long-opaque-string&lt;/header&gt;
    &lt;/headers&gt;
 &lt;/query&gt;
  &lt;error code='304' type='modify'&gt;
    &lt;not-modified xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the roster has changed, the provided Entity Tag value is not valid, or the server does not support Entity Tags, it MUST return the roster as if the If-None-Match header was not included:</p>
    <p class="caption"><a name="example-9" id="example-9"></a>Example 9. Server Returns Roster</p><div class="indent"><pre>
&lt;iq type='result' 
    to='juliet@capulet.com/balcony'
    id='roster2'&gt;
 &lt;query xmlns='jabber:iq:roster'&gt;
    &lt;item jid='romeo@montague.net' name='Romeo'&gt;
      &lt;group&gt;Friends&lt;/group&gt;
    &lt;/item&gt;
    &lt;item jid='nurse@capulet.com' name='Nurse'&gt;
      &lt;group&gt;Servants&lt;/group&gt;
    &lt;/item&gt;
    &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
      &lt;header name='ETag'&gt;some-new-opaque-string&lt;/header&gt;
    &lt;/headers&gt;
 &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
  <div class="indent"><h3>4.2 <a name="privacy" id="privacy">Caching and Retrieving Privacy Lists</a></h3>
    <p class="" style="">The payloads exchanged in the <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0016.html">Server-Based Privacy Rules</a></span>  [<a href="#nt-id2261217">9</a>] protocol can also be quite large. Therefore a server might want to support Entity Tags in the context of privacy list management. The process is as follows.</p>
    <p class="" style="">First, a client requests its privacy lists:</p>
    <p class="caption"><a name="example-10" id="example-10"></a>Example 10. Client Requests Privacy List</p><div class="indent"><pre>
&lt;iq type='get' 
    from='romeo@montague.net/orchard' 
    id='getlist1'&gt;
  &lt;query xmlns='jabber:iq:privacy'&gt;
    &lt;list name='special'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The server returns the list and includes an Entity Tag in an ETag SHIM header.</p>
    <p class="caption"><a name="example-11" id="example-11"></a>Example 11. Server Returns Privacy List Including ETag Header</p><div class="indent"><pre>
&lt;iq type='result' 
    to='romeo@example.net/orchard'
    id='getlist1'&gt;
  &lt;query xmlns='jabber:iq:privacy'&gt;
    &lt;list name='special'&gt;
      &lt;item type='jid'
            value='juliet@example.com'
            action='allow'
            order='6'/&gt;
      &lt;item type='jid'
            value='benvolio@example.org'
            action='allow'
            order='7'/&gt;
      &lt;item type='jid'
            value='mercutio@example.org'
            action='allow'
            order='42'/&gt;
      &lt;item action='deny' order='666'/&gt;
    &lt;/list&gt;
    &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
      &lt;header name='ETag'&gt;some-long-opaque-string&lt;/header&gt;
    &lt;/headers&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Later, the client requests the same privacy list again and includes the provided Entity Tag in an If-None-Match SHIM header:</p>
    <p class="caption"><a name="example-12" id="example-12"></a>Example 12. Client Requests Privacy List Including If-None-Match Header</p><div class="indent"><pre>
&lt;iq type='get' 
    from='romeo@montague.net/orchard' 
    id='getlist2'&gt;
  &lt;query xmlns='jabber:iq:privacy'&gt;
    &lt;list name='special'/&gt;
    &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
      &lt;header name='If-None-Match'&gt;some-long-opaque-string&lt;/header&gt;
    &lt;/headers&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the privacy list did not change since the client last retrieved it and the server supports Entity Tags for the 'jabber:iq:privacy' namespace, the server MUST return a &lt;not-modified/&gt; error:</p>
    <p class="caption"><a name="example-13" id="example-13"></a>Example 13. Server Returns Not Modified Error</p><div class="indent"><pre>
&lt;iq type='error' 
    to='romeo@example.net/orchard'
    id='getlist2'&gt;
 &lt;query xmlns='jabber:iq:privacy'&gt;
    &lt;list name='special'/&gt;
    &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
      &lt;header name='ETag'&gt;some-long-opaque-string&lt;/header&gt;
    &lt;/headers&gt;
 &lt;/query&gt;
  &lt;error code='304' type='modify'&gt;
    &lt;not-modified xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">If the privacy list has changed, the provided Entity Tag value is not valid, or the server does not support Entity Tags, it MUST return the privacy list as if the If-None-Match header was not included:</p>
    <p class="caption"><a name="example-14" id="example-14"></a>Example 14. Server Returns Privacy List</p><div class="indent"><pre>
&lt;iq type='result' 
    to='romeo@example.net/orchard'
    id='getlist2'&gt;
  &lt;query xmlns='jabber:iq:privacy'&gt;
    &lt;list name='special'&gt;
      &lt;item type='jid'
            value='juliet@example.com'
            action='allow'
            order='6'/&gt;
      &lt;item type='jid'
            value='benvolio@example.org'
            action='allow'
            order='7'/&gt;
      &lt;item type='jid'
            value='mercutio@example.org'
            action='allow'
            order='42'/&gt;
      &lt;item action='deny' order='666'/&gt;
    &lt;/list&gt;
    &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
      &lt;header name='ETag'&gt;some-new-opaque-string&lt;/header&gt;
    &lt;/headers&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
  <div class="indent"><h3>4.3 <a name="disco" id="disco">Discovering Support</a></h3>
    <p class="" style=""><span class="ref">XEP-0131</span> specifies how support for a particular SHIM header can be explicitly determined using <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0030.html">Service Discovery</a></span>  [<a href="#nt-id2261384">10</a>]. To review, the protocol flow between a client and a server is as follows:</p>
    <p class="caption"><a name="example-15" id="example-15"></a>Example 15. Client Queries Server Regarding SHIM Header Support</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.com/balcony'
    to='capulet.com'
    id='header1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://jabber.org/protocol/shim'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption"><a name="example-16" id="example-16"></a>Example 16. Server Communicates Supported SHIM Headers</p><div class="indent"><pre>
&lt;iq from='capulet.com'
    to='juliet@capulet.com/balcony'
    id='header1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://jabber.org/protocol/shim'&gt;
    ...
    &lt;feature var='http://jabber.org/protocol/shim#ETag'/&gt;
    &lt;feature var='http://jabber.org/protocol/shim#If-None-Match'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The client now knows that the server supports the ETag and If-None-Match SHIM headers and can proceed accordingly.</p>
    <p class="" style="">Note: If an XMPP entity supports Entity Tags as specified herein, it MUST at a minimum support both the ETag and If-None-Match SHIM headers.</p>
    <p class="" style="">Note: Even if an entity supports the ETag and If-None-Match SHIM headers, it is not required to support Entity Tag functionality for all namespaces. For example, a server could support Entity Tags only for rosters and privacy lists but not for the 'jabber:iq:last' or 'jabber:iq:version' namespaces. Similarly, a <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0045.html">Multi-User Chat</a></span>  [<a href="#nt-id2261459">11</a>] service could support Entity Tags only for room lists (retrieved via a "disco#items" request) but not for other requests. As noted, if an entity does not support Entity Tags for a given namespace or request, it SHOULD proceed as if the ETag or If-None-Match SHIM header had not been included in the request.</p>
    <p class="" style="">Optionally, an entity MAY communicate the namespaces for which it supports Entity Tag functionality by listing those namespaces in its response to a "disco#info" request sent to a node of "http://jabber.org/protocol/shim#ETag":</p>
    <p class="caption"><a name="example-17" id="example-17"></a>Example 17. Client Queries Server Regarding Supported Entity Tag Namespaces</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.com/balcony'
    to='capulet.com'
    id='header1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://jabber.org/protocol/shim#ETag'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption"><a name="example-18" id="example-18"></a>Example 18. Server Communicates Supported Entity Tag Namespaces</p><div class="indent"><pre>
&lt;iq from='capulet.com'
    to='juliet@capulet.com/balcony'
    id='header1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='http://jabber.org/protocol/shim#ETag'&gt;
    ...
    &lt;feature var='jabber:iq:roster'/&gt;
    &lt;feature var='jabber:iq:privacy'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Alternatively, as shown above and as used in HTTP, the requesting entity MAY implicitly discover that Entity Tag functionality is supported with regard to a given response entity type if the responding entity includes an ETag SHIM header in its response.</p>
  </div>
<h2>5.
       <a name="security" id="security">Security Considerations</a></h2>
  <p class="" style="">If a malicious entity gains access to a user's credentials or is able to masquerade as another entity on the network (e.g., as a man in the middle), it could force retrieval of information before it has changed. However, such access would compromise communications in a more serious fashion and corruption of the Entity Tags functionality is insignificant in comparison.</p>
<h2>6.
       <a name="iana" id="iana">IANA Considerations</a></h2>
  <p class="" style="">This proposal requires no interaction with the <span class="ref" style=""><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-id2261608">12</a>].</p>
<h2>7.
       <a name="registrar" id="registrar">XMPP Registrar Considerations</a></h2>
  <p class="" style="">This proposal requires no interaction with the <span class="ref" style=""><a href="http://www.xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-id2261618">13</a>].</p>
<h2>8.
       <a name="schema" id="schema">XML Schema</a></h2>
  <p class="" style="">This document describes best practices for use of XEP-0131 and therefore does not require a dedicated schema.</p>
<h2>9.
       <a name="issues" id="issues">Open Issues</a></h2>
  <p class="" style="">Is the ETag tied to a bare JID or full JID?</p>
<hr /><h2><a name="notes" id="notes"></a>Notes</h2><div class="indent"><p><a name="nt-id2252647" id="nt-id2252647">1</a>. RFC 2616: Hypertext Transport Protocol -- HTTP/1.1 &lt;<a href="http://tools.ietf.org/html/rfc2616">http://tools.ietf.org/html/rfc2616</a>&gt;.</p><p><a name="nt-id2252674" id="nt-id2252674">2</a>. XEP-0131: Stanza Headers and Internet Metadata &lt;<a href="http://www.xmpp.org/extensions/xep-0131.html">http://www.xmpp.org/extensions/xep-0131.html</a>&gt;.</p><p><a name="nt-id2251413" id="nt-id2251413">3</a>. RFC 3920: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://tools.ietf.org/html/rfc3920">http://tools.ietf.org/html/rfc3920</a>&gt;.</p><p><a name="nt-id2251440" id="nt-id2251440">4</a>. XEP-0086: Error Condition Mappings &lt;<a href="http://www.xmpp.org/extensions/xep-0086.html">http://www.xmpp.org/extensions/xep-0086.html</a>&gt;.</p><p><a name="nt-id2251463" id="nt-id2251463">5</a>. rfc3921bis: proposed revisions to Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://tools.ietf.org/html/draft-saintandre-rfc3920bis">http://tools.ietf.org/html/draft-saintandre-rfc3920bis</a>&gt;. (work in progress)</p><p><a name="nt-id2251518" id="nt-id2251518">6</a>. XEP-0072: SOAP over XMPP &lt;<a href="http://www.xmpp.org/extensions/xep-0072.html">http://www.xmpp.org/extensions/xep-0072.html</a>&gt;.</p><p><a name="nt-id2251544" id="nt-id2251544">7</a>. XEP-0004: Data Forms &lt;<a href="http://www.xmpp.org/extensions/xep-0004.html">http://www.xmpp.org/extensions/xep-0004.html</a>&gt;.</p><p><a name="nt-id2261057" id="nt-id2261057">8</a>. RFC 3921: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://tools.ietf.org/html/rfc3921">http://tools.ietf.org/html/rfc3921</a>&gt;.</p><p><a name="nt-id2261217" id="nt-id2261217">9</a>. XEP-0016: Server-Based Privacy Rules &lt;<a href="http://www.xmpp.org/extensions/xep-0016.html">http://www.xmpp.org/extensions/xep-0016.html</a>&gt;.</p><p><a name="nt-id2261384" id="nt-id2261384">10</a>. XEP-0030: Service Discovery &lt;<a href="http://www.xmpp.org/extensions/xep-0030.html">http://www.xmpp.org/extensions/xep-0030.html</a>&gt;.</p><p><a name="nt-id2261459" id="nt-id2261459">11</a>. XEP-0045: Multi-User Chat &lt;<a href="http://www.xmpp.org/extensions/xep-0045.html">http://www.xmpp.org/extensions/xep-0045.html</a>&gt;.</p><p><a name="nt-id2261608" id="nt-id2261608">12</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p><p><a name="nt-id2261618" id="nt-id2261618">13</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="http://www.xmpp.org/registrar/">http://www.xmpp.org/registrar/</a>&gt;.</p></div><hr /><h2><a name="revs" id="revs"></a>Revision History</h2><div class="indent"><h4>Version 0.2 (2005-08-09)</h4><div class="indent"><p class="" style="">Added security considerations.</p> (psa)
    </div><h4>Version 0.1 (2005-06-02)</h4><div class="indent"><p class="" style="">Initial version.</p> (psa)
    </div><h4>Version 0.0.1 (2005-05-26)</h4><div class="indent"><p class="" style="">First draft.</p> (psa/jjh)
    </div></div><hr /><p>END</p></body></html>
