<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0168: Resource Application Priority</title><link rel="stylesheet" type="text/css" href="/xmpp.css" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><meta name="DC.Title" content="Resource Application Priority" /><meta name="DC.Creator" content="Peter Saint-Andre" /><meta name="DC.Creator" content="Joe Hildebrand" /><meta name="DC.Description" content="This document defines an XMPP protocol extension to indicate the presence priority of XMPP resources for applications other than standard XMPP messaging." /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2007-11-19" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0168" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright (c) 1999 - 2008 by the XMPP Standards Foundation (XSF)." /></head><body><h1>XEP-0168: Resource Application Priority</h1><p>This document defines an XMPP protocol extension to indicate the presence priority of XMPP resources for applications other than standard XMPP messaging.</p><hr /><p style="color:red">WARNING: This Standards-Track document is Experimental. Publication as an XMPP Extension Protocol does not imply approval of this proposal by the XMPP Standards Foundation. Implementation of the protocol described herein is encouraged in exploratory implementations, but production systems should not deploy implementations of this protocol until it advances to a status of Draft.</p><hr /><h2>Document Information</h2><p class="indent">
            Series: <a href="http://www.xmpp.org/extensions/">XEP</a><br />
            Number: 0168<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status: 
            <a href="http://www.xmpp.org/extensions/xep-0001.html#states-Experimental">Experimental</a><br />
            Type:
            <a href="http://www.xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br />
            Version: 0.6<br />
            Last Updated: 2007-11-19<br />
                Approving Body: <a href="http://www.xmpp.org/council/">XMPP Council</a><br />Dependencies: XMPP Core, XMPP IM, XEP-0030<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: TO BE ASSIGNED<br />
              Wiki Page: &lt;<a href="http://wiki.jabber.org/index.php/Resource Application Priority (XEP-0168)">http://wiki.jabber.org/index.php/Resource Application Priority (XEP-0168)</a>&gt;
            </p><hr /><h2>Author Information</h2><div class="indent"><h3>Peter Saint-Andre</h3><p class="indent">
        JabberID: 
        <a href="xmpp:stpeter@jabber.org">stpeter@jabber.org</a><br />
        URI: 
        <a href="https://stpeter.im/">https://stpeter.im/</a><br /></p><h3>Joe Hildebrand</h3><p class="indent">
        Email:
        <a href="mailto:jhildebrand@jabber.com">jhildebrand@jabber.com</a><br />
        JabberID: 
        <a href="xmpp:hildjj@jabber.org">hildjj@jabber.org</a><br /></p></div><hr /><h2>Legal Notices</h2><div class="indent"><h3>Copyright</h3>This XMPP Extension Protocol is copyright (c) 1999 - 2008 by the XMPP Standards Foundation (XSF).<h3>Permissions</h3>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h3>Disclaimer of Warranty</h3><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. In no event shall the XMPP Standards Foundation or the authors of this Specification be liable for any claim, damages, or other liability, whether in an action of contract, tort, or otherwise, arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification. ##</span><h3>Limitation of Liability</h3>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising out of the use or inability to use the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h3>IPR Conformance</h3>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which may be found at &lt;<a href="http://www.xmpp.org/extensions/ipr-policy.shtml">http://www.xmpp.org/extensions/ipr-policy.shtml</a>&gt; or obtained by writing to XSF, P.O. Box 1641, Denver, CO 80201 USA).</div><hr /><h2>Discussion Venue</h2><p class="indent">The preferred venue for discussion of this document is the Standards discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">http://mail.jabber.org/mailman/listinfo/standards</a>&gt;.</p><p class="indent">Errata may be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><h2>Relation to XMPP</h2><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><h2>Conformance Terms</h2><p class="indent">The following keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#intro">Introduction</a><br />2.  <a href="#rap">Application Priority</a><br />   
      2.1.  <a href="#rap-format">Format</a><br />   
      2.2.  <a href="#rap-gen">Generation</a><br />   
      2.3.  <a href="#rap-presence">Presence Transport</a><br />   
      2.4.  <a href="#rap-pubsub">Pubsub Transport</a><br />3.  <a href="#flag">Flagging the Primary Resource</a><br />4.  <a href="#route">RAP-Based Message Routing</a><br />5.  <a href="#disco">Determining Support</a><br />6.  <a href="#security">Security Considerations</a><br />7.  <a href="#iana">IANA Considerations</a><br />8.  <a href="#registrar">XMPP Registrar Considerations</a><br />   
      8.1.  <a href="#ns">Protocol Namespaces</a><br />9.  <a href="#schema">XML Schemas</a><br />   
      9.1.  <a href="#schema-rap">RAP</a><br />   
      9.2.  <a href="#schema-raproute">RAP Routing</a><br /><a href="#notes">Notes</a><br /><a href="#revs">Revision History</a></p></div><hr /><h2>1.
       <a name="intro" id="intro">Introduction</a></h2>
  <p class="" style="">Within the Extensible Messaging and Presence Protocol (XMPP; see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3920">RFC 3920</a></span>  [<a href="#nt-id2251374">1</a>]), presence indicates availability for communication. Specifically, in systems that bundle presence and instant messaging (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3921">RFC 3921</a></span>  [<a href="#nt-id2251574">2</a>]), the &lt;priority/&gt; child of the XMPP &lt;presence/&gt; stanza indicates availability for communications qualified by the "jabber:client" namespace, especially instant messaging. However, a wide variety of entities might provide XMPP presence, including entities that are not primarily focused on IM (e.g., phones) or even entities that do not support XMPP messaging at all.</p>
  <p class="" style="">Consider a scenario in which a contact wants to initiate a voice chat (see <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0167.html">Jingle Audio via RTP</a></span>  [<a href="#nt-id2251567">3</a>]) with a user who has the following three XMPP resources:</p>
  <p class="caption"><a name="table-1" id="table-1"></a>Table 1: Application Presence</p><table border="1" cellpadding="3" cellspacing="0">
  <tr class="body">
    <th colspan="" rowspan="">Resource</th>
    <th colspan="" rowspan="">Messaging Priority</th>
    <th colspan="" rowspan="">Voice Chat Priority</th>
  </tr>
  <tr class="body">
    <td colspan="" rowspan="">desktop</td>
    <td colspan="" rowspan="">10</td>
    <td colspan="" rowspan="">5</td>
  </tr>
  <tr class="body">
    <td colspan="" rowspan="">pda</td>
    <td colspan="" rowspan="">5</td>
    <td colspan="" rowspan="">-1</td>
  </tr>
  <tr class="body">
    <td colspan="" rowspan="">mobile</td>
    <td colspan="" rowspan="">-1</td>
    <td colspan="" rowspan="">10</td>
  </tr>
  </table>
  <p class="" style="">If the contact chooses the resource with which it initiates a voice chat based on the standard XMPP &lt;priority/&gt; element, the resulting behavior could be misleading (i.e., initiating the voice chat with the "desktop" resource rather than the "mobile" resource).</p>
  <p class="" style="">What is needed is a way for the user's clients to indicate that the application priority for the three resources is different from the standard XMPP priority. This document defines such a mechanism via an optional XMPP presence extension.</p>
  <p class="" style="">As extensions to that core use case, this document also defines:</p>
  <ul class="" style="">
    <li class="" style="">A way for an XMPP server to mark which resource it considers to be primary for any given application type, if it has information -- such as communication preferences -- that can help it determine the primary resource.</li>
    <li class="" style="">A way for an XMPP server to use application priority data for more intelligent routing of specially-labelled XMPP &lt;message/&gt; stanzas directed to a user's bare JID (&lt;node@domain.tld&gt;).</li>
  </ul>
<h2>2.
       <a name="rap" id="rap">Application Priority</a></h2>
  <div class="indent"><h3>2.1 <a name="rap-format" id="rap-format">Format</a></h3>
    <p class="" style="">Application priority is encapsulated by a &lt;rap/&gt; element qualified by the 'http://www.xmpp.org/extensions/xep-0168.html#ns' namespace (see <a href="#ns">Protocol Namespaces</a> regarding issuance of one or more permanent namespaces). The attributes of the &lt;rap/&gt; element are as follows.</p>
    <p class="caption"><a name="table-2" id="table-2"></a>Table 2: RAP Attributes</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Attribute</th>
        <th colspan="" rowspan="">Definition</th>
        <th colspan="" rowspan="">Inclusion</th>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">ns</td>
        <td colspan="" rowspan="">The primary namespace of the application type.</td>
        <td colspan="" rowspan="">REQUIRED</td>
      </tr>
      <tr class="body">
        <td colspan="" rowspan="">num</td>
        <td colspan="" rowspan="">The resource's priority for this application type.  [<a href="#nt-id2261191">4</a>]</td>
        <td colspan="" rowspan="">REQUIRED</td>
      </tr>
    </table>
    <p class="" style="">An example follows.</p>
    <p class="caption"><a name="example-1" id="example-1"></a>Example 1. Data format</p><div class="indent"><pre>
&lt;rap xmlns='http://www.xmpp.org/extensions/xep-0168.html#ns' 
     ns='http://www.xmpp.org/extensions/xep-0167#ns' 
     num='5'/&gt;
    </pre></div>
  </div>
  <div class="indent"><h3>2.2 <a name="rap-gen" id="rap-gen">Generation</a></h3>
    <p class="" style="">The following business rules apply to the generation of resource application priority by the client:</p>
    <ol start="1" class="" style="">
      <li class="" style=""><p class="" style="">A client SHOULD include a &lt;rap/&gt; element for each application type for which it wishes to advertise a priority, but SHOULD NOT do so if the priority for that application is the same as the resource's standard XMPP priority.</p></li>
      <li class="" style=""><p class="" style="">A client MUST NOT generate a &lt;rap/&gt; element that has a 'ns' attribute whose value is "jabber:client" or that has no 'ns' attribute (since the default 'ns' is "jabber:client").</p></li>
      <li class="" style=""><p class="" style="">The &lt;rap/&gt; element SHOULD be empty.</p></li>
    </ol>
    <p class="" style="">As explained in the following sections, there are two possible transports for RAP data: standard XMPP presence and the XMPP publish-subscribe extension.</p>
  </div>
  <div class="indent"><h3>2.3 <a name="rap-presence" id="rap-presence">Presence Transport</a></h3>
    <p class="" style="">RAP data MAY be included as extended content within a standard XMPP presence stanza. This is consistent with the rule that presence stanzas must be related to the network availability or communication preferences of the entity that provides presence information.</p>
    <p class="" style="">For the three resources ("desktop", "pda", and "mobile") mentioned above, the presence stanzas received by a contact would be as follows.</p>
    <p class="caption"><a name="example-2" id="example-2"></a>Example 2. Contact receives presence from user</p><div class="indent"><pre>
&lt;presence from='juliet@capulet.lit/desktop' to='romeo@montague.lit/home'&gt;
  &lt;priority&gt;10&lt;/priority&gt;
  &lt;rap xmlns='http://www.xmpp.org/extensions/xep-0168.html#ns' 
       ns='http://www.xmpp.org/extensions/xep-0167#ns' 
       num='5'/&gt;
&lt;/presence&gt;

&lt;presence from='juliet@capulet.lit/pda' to='romeo@montague.lit/home'&gt;
  &lt;priority&gt;5&lt;/priority&gt;
  &lt;rap xmlns='http://www.xmpp.org/extensions/xep-0168.html#ns' 
       ns='http://www.xmpp.org/extensions/xep-0167#ns' 
       num='-1'/&gt;
&lt;/presence&gt;

&lt;presence from='juliet@capulet.lit/mobile' to='romeo@montague.lit/home'&gt;
  &lt;priority&gt;-1&lt;/priority&gt;
  &lt;rap xmlns='http://www.xmpp.org/extensions/xep-0168.html#ns' 
       ns='http://www.xmpp.org/extensions/xep-0167#ns' 
       num='10'/&gt;
&lt;/presence&gt;
    </pre></div>
  </div>
  <div class="indent"><h3>2.4 <a name="rap-pubsub" id="rap-pubsub">Pubsub Transport</a></h3>
    <p class="" style="">Alternatively, RAP data MAY be provided via the XMPP <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0060.html">Publish-Subscribe</a></span>  [<a href="#nt-id2261397">5</a>] publish-subscribe extension, specifically the <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0163.html">Personal Eventing via Pubsub</a></span>  [<a href="#nt-id2261422">6</a>] profile thereof.</p>
    <p class="" style="">For the three resources ("desktop", "pda", and "mobile") mentioned above, the pubsub notifications received by a contact would be as follows.</p>
    <p class="caption"><a name="example-3" id="example-3"></a>Example 3. Contact receives pubsub notifications from user</p><div class="indent"><pre>
&lt;message from='juliet@capulet.lit'
         id='rap1'
         to='romeo@montague.lit/orchard'
         type='headline'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='http://www.xmpp.org/extensions/xep-0168.html#ns'&gt;
      &lt;item&gt;
        &lt;rap xmlns='http://www.xmpp.org/extensions/xep-0168.html#ns' 
             ns='http://www.xmpp.org/extensions/xep-0167#ns' 
             num='5'/&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
  &lt;addresses xmlns='http://jabber.org/protocol/address'&gt;
    &lt;address type='replyto' jid='juliet@capulet.lit/desktop'/&gt;
  &lt;/addresses&gt;
&lt;/message&gt;

&lt;message from='juliet@capulet.lit'
         id='rap2'
         to='romeo@montague.lit/orchard'
         type='headline'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='http://www.xmpp.org/extensions/xep-0168.html#ns'&gt;
      &lt;item&gt;
      &lt;rap xmlns='http://www.xmpp.org/extensions/xep-0168.html#ns' 
           ns='http://www.xmpp.org/extensions/xep-0167#ns' 
           num='-1'/&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
  &lt;addresses xmlns='http://jabber.org/protocol/address'&gt;
    &lt;address type='replyto' jid='juliet@capulet.lit/pda'/&gt;
  &lt;/addresses&gt;
&lt;/message&gt;

&lt;message from='juliet@capulet.lit'
         id='rap3'
         to='romeo@montague.lit/orchard'
         type='headline'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='http://www.xmpp.org/extensions/xep-0168.html#ns'&gt;
      &lt;item&gt;
      &lt;rap xmlns='http://www.xmpp.org/extensions/xep-0168.html#ns' 
           ns='http://www.xmpp.org/extensions/xep-0167#ns' 
           num='10'/&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
  &lt;addresses xmlns='http://jabber.org/protocol/address'&gt;
    &lt;address type='replyto' jid='juliet@capulet.lit/mobile'/&gt;
  &lt;/addresses&gt;
&lt;/message&gt;
    </pre></div>
  </div>
<h2>3.
       <a name="flag" id="flag">Flagging the Primary Resource</a></h2>
  <p class="" style="">The user's XMPP server may have special information that enables it to flag a resource as primary for a given application type. For instance, the server may include a communication policy service that enables the user to define (outside the context of any presence priorities) that she would prefer to be called at her desktop computer only between the hours of 9:00 AM and 5:00 PM local time, prefer to be called on her mobile phone at all other times, and so on.</p>
  <p class="" style="">To flag the primary resource related to a specific application type, the server shall add a &lt;primary/&gt; child to the relevant RAP element. Here is an example:</p>
  <p class="caption"><a name="example-4" id="example-4"></a>Example 4. Primary resource flag</p><div class="indent"><pre>
&lt;presence from='juliet@capulet.lit/mobile'&gt;
  &lt;priority&gt;-1&lt;/priority&gt;
  &lt;rap xmlns='http://www.xmpp.org/extensions/xep-0168.html#ns' 
       ns='http://www.xmpp.org/extensions/xep-0167#ns' 
       num='10'&gt;
    &lt;primary/&gt;
  &lt;/rap&gt;
&lt;/presence&gt;
  </pre></div>
  <p class="" style="">The following business rules apply to primary resource flagging by the server:</p>
  <ol start="1" class="" style="">
    <li class="" style=""><p class="" style="">A server MAY add the &lt;primary/&gt; element to RAP data generated by the resource it determines is "most available" for a given application type.</p></li>
    <li class="" style=""><p class="" style="">Because the default 'ns' is "jabber:client", to flag the primary resource for standard XMPP communications the server SHOULD NOT include a 'ns' attribute, SHOULD NOT include a 'num' attribute, and MUST include a &lt;primary/&gt; child.</p></li>
    <li class="" style=""><p class="" style="">An available resource that has specified a negative priority for an application type MUST NOT be flagged as the primary resource for that application type.</p></li>
    <li class="" style=""><p class="" style="">A client SHOULD NOT include the &lt;primary/&gt; element in RAP data that it generates; however, if a client includes &lt;primary/&gt; element, the server SHOULD remove or overwrite the element.</p></li>
    <li class="" style=""><p class="" style="">In response to a presence probe, a server SHOULD send presence from the primary resource first (this enables the receiving client to skip any local "most-available-resource" algorithms it might implement) if the client includes RAP data in presence.</p></li>
    <li class="" style=""><p class="" style="">If the primary resource changes for a given application type and the client includes RAP data in presence, a server MUST broadcast updated presence information (including the &lt;primary/&gt; element) for the new primary resource. If the change in primary resource occurs because of a presence broadcast from the current primary resource, the server MUST push presence from the current primary resource (without the &lt;primary/&gt; element) before pushing presence from the new primary resource (including the &lt;primary/&gt; element).</p></li>
  </ol>
<h2>4.
       <a name="route" id="route">RAP-Based Message Routing</a></h2>
  <p class="" style="">A server MAY use the RAP data provided by a client in determing how to route incoming &lt;message/&gt; stanzas directed to the bare JID (&lt;node@domain.tld&gt;) of a registered account. In order to enable such routing, the sender MUST include an empty &lt;route/&gt; element qualified by the 'http://www.xmpp.org/extensions/xep-0168.html#ns-raproute' namespace (see <a href="#ns">Protocol Namespaces</a> regarding issuance of one or more permanent namespaces) including an 'ns' attribute corresponding to the desired application type.</p>
  <p class="" style="">For example, consider a <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0155.html">Stanza Session Negotiation</a></span>  [<a href="#nt-id2261851">7</a>] request sent from one user (Romeo) to another (Juliet), where the users do not share presence. Romeo wants the request to be delivered to the highest-priority resource for the "http://www.xmpp.org/extensions/xep-0167.html#ns" application type.</p>
  <p class="caption"><a name="example-5" id="example-5"></a>Example 5. User requests session</p><div class="indent"><pre>
&lt;message from='romeo@montague.lit/orchard'
         to='juliet@capulet.lit'
         type='headline'&gt;
  &lt;route xmlns='http://www.xmpp.org/extensions/xep-0168.html#ns-raproute'
         ns='http://www.xmpp.org/extensions/xep-0167.html#ns'/&gt;
  &lt;thread&gt;ffd7076498744578d10edabfe7f4a866&lt;/thread&gt;
  &lt;feature xmlns='http://jabber.org/protocol/feature-neg'&gt;
    &lt;x xmlns='jabber:x:data' type='form'&gt;
      &lt;title&gt;Open chat with Romeo?&lt;/title&gt;
      &lt;field var='FORM_TYPE' type='hidden'&gt;
        &lt;value&gt;urn:xmpp:ssn&lt;/value&gt;
      &lt;/field&gt;
      &lt;field label='Accept this session?' type='boolean' var='accept'&gt;
        &lt;value&gt;true&lt;/value&gt;
        &lt;required/&gt;
      &lt;/field&gt;
      ...
  &lt;/feature&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">If Juliet's server supports RAP routing, it would then deliver the message to whichever of Juliet's resources has the highest priority for the "http://www.xmpp.org/extensions/xep-0167.html#ns" application type.</p>
<h2>5.
       <a name="disco" id="disco">Determining Support</a></h2>
  <p class="" style="">In order to discover whether a server or other entity supports this protocol, an entity MUST use <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0030.html">Service Discovery</a></span>  [<a href="#nt-id2261922">8</a>] or the dynamic profile of service discovery defined in <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0115.html">Entity Capabilities</a></span>  [<a href="#nt-id2261948">9</a>].</p>
  <p class="caption"><a name="example-6" id="example-6"></a>Example 6. Entity queries a server regarding protocol support</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.lit/balcony'
    id='disco1'
    to='capulet.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">If the queried entity supports the functionality specified herein, it MUST return the following features (see <a href="#ns">Protocol Namespaces</a> regarding issuance of one or more permanent namespaces):</p>
  <ul class="" style="">
    <li class="" style="">For RAP, "http://www.xmpp.org/extensions/xep-0168.html#ns"</li>
    <li class="" style="">For RAP routing, "http://www.xmpp.org/extensions/xep-0168.html#ns-route"</li>
  </ul>
  <p class="caption"><a name="example-7" id="example-7"></a>Example 7. Server communicates protocol support for RAP</p><div class="indent"><pre>
&lt;iq from='capulet.lit'
    id='disco1'
    to='juliet@capulet.lit/balcony'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    ...
    &lt;feature var='http://www.xmpp.org/extensions/xep-0168.html#ns'/&gt;
    &lt;feature var='http://www.xmpp.org/extensions/xep-0168.html#ns-route'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
<h2>6.
       <a name="security" id="security">Security Considerations</a></h2>
  <p class="" style="">When the pubsub transport is used, client publishing of resource application priority may result in a presence leak if the node access model is "open". Care should be taken in properly configuring the pubsub node so that unauthorized entities are not able to retrieve information about the user's available resources.</p>
  <p class="" style="">Server flagging of the primary resource is not know to introduce any vulnerabilities or compromises of user privacy.</p>
<h2>7.
       <a name="iana" id="iana">IANA Considerations</a></h2>
  <p class="" style="">This document requires no interaction with the <span class="ref" style=""><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-id2262083">10</a>].</p>
<h2>8.
       <a name="registrar" id="registrar">XMPP Registrar Considerations</a></h2>
  <div class="indent"><h3>8.1 <a name="ns" id="ns">Protocol Namespaces</a></h3>
    <p class="" style="">Until this specification advances to a status of Draft, its associated namespaces shall be:</p>
    <ul class="" style="">
      <li class="" style="">http://www.xmpp.org/extensions/xep-0168.html#ns</li>
      <li class="" style="">http://www.xmpp.org/extensions/xep-0168.html#ns-route</li>
    </ul>
    <p class="" style="">Upon advancement of this specification, the <span class="ref" style=""><a href="http://www.xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-id2262162">11</a>] shall issue permanent namespaces in accordance with the process defined in Section 4 of <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0053.html">XMPP Registrar Function</a></span>  [<a href="#nt-id2262192">12</a>].</p>
    <p class="" style="">The following namespaces are requested, and are thought to be unique per the XMPP Registrar's requirements:</p>
    <ul class="" style="">
      <li class="" style="">urn:xmpp:rap</li>
      <li class="" style="">urn:xmpp:rap:route</li>
    </ul>
  </div>
<h2>9.
       <a name="schema" id="schema">XML Schemas</a></h2>
  <div class="indent"><h3>9.1 <a name="schema-rap" id="schema-rap">RAP</a></h3>
    <p class="caption"></p><div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://www.xmpp.org/extensions/xep-0168.html#ns'
    xmlns='http://www.xmpp.org/extensions/xep-0168.html#ns'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='rap'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name='primary' type='empty' minOccurs='0' maxOccurs='1'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='ns' type='xs:string' default='jabber:client'/&gt;
      &lt;xs:attribute name='num' type='xs:byte'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
&lt;/xs:schema&gt;

    </pre></div>
  </div>
  <div class="indent"><h3>9.2 <a name="schema-raproute" id="schema-raproute">RAP Routing</a></h3>
    <p class="caption"></p><div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://www.xmpp.org/extensions/xep-0168.html#ns-route'
    xmlns='http://www.xmpp.org/extensions/xep-0168.html#ns-route'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='route'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='ns' type='xs:string' default='jabber:client'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
&lt;/xs:schema&gt;

    </pre></div>
  </div>
<hr /><h2><a name="notes" id="notes"></a>Notes</h2><div class="indent"><p><a name="nt-id2251374" id="nt-id2251374">1</a>. RFC 3920: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://tools.ietf.org/html/rfc3920">http://tools.ietf.org/html/rfc3920</a>&gt;.</p><p><a name="nt-id2251574" id="nt-id2251574">2</a>. RFC 3921: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://tools.ietf.org/html/rfc3921">http://tools.ietf.org/html/rfc3921</a>&gt;.</p><p><a name="nt-id2251567" id="nt-id2251567">3</a>. XEP-0167: Jingle Audio via RTP &lt;<a href="http://www.xmpp.org/extensions/xep-0167.html">http://www.xmpp.org/extensions/xep-0167.html</a>&gt;.</p><p><a name="nt-id2261191" id="nt-id2261191">4</a>. This protocol uses a 'num' attribute rather than a 'priority' attribute to reduce confusion with standard XMPP presence.)</p><p><a name="nt-id2261397" id="nt-id2261397">5</a>. XEP-0060: Publish-Subscribe &lt;<a href="http://www.xmpp.org/extensions/xep-0060.html">http://www.xmpp.org/extensions/xep-0060.html</a>&gt;.</p><p><a name="nt-id2261422" id="nt-id2261422">6</a>. XEP-0163: Personal Eventing via Pubsub &lt;<a href="http://www.xmpp.org/extensions/xep-0163.html">http://www.xmpp.org/extensions/xep-0163.html</a>&gt;.</p><p><a name="nt-id2261851" id="nt-id2261851">7</a>. XEP-0155: Stanza Session Negotiation &lt;<a href="http://www.xmpp.org/extensions/xep-0155.html">http://www.xmpp.org/extensions/xep-0155.html</a>&gt;.</p><p><a name="nt-id2261922" id="nt-id2261922">8</a>. XEP-0030: Service Discovery &lt;<a href="http://www.xmpp.org/extensions/xep-0030.html">http://www.xmpp.org/extensions/xep-0030.html</a>&gt;.</p><p><a name="nt-id2261948" id="nt-id2261948">9</a>. XEP-0115: Entity Capabilities &lt;<a href="http://www.xmpp.org/extensions/xep-0115.html">http://www.xmpp.org/extensions/xep-0115.html</a>&gt;.</p><p><a name="nt-id2262083" id="nt-id2262083">10</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p><p><a name="nt-id2262162" id="nt-id2262162">11</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="http://www.xmpp.org/registrar/">http://www.xmpp.org/registrar/</a>&gt;.</p><p><a name="nt-id2262192" id="nt-id2262192">12</a>. XEP-0053: XMPP Registrar Function &lt;<a href="http://www.xmpp.org/extensions/xep-0053.html">http://www.xmpp.org/extensions/xep-0053.html</a>&gt;.</p></div><hr /><h2><a name="revs" id="revs"></a>Revision History</h2><div class="indent"><h4>Version 0.6 (2007-11-19)</h4><div class="indent"><p class="" style="">Documented optional pubsub transport for RAP data.</p> (psa)
    </div><h4>Version 0.5 (2007-11-15)</h4><div class="indent"><p class="" style="">Editorial review and consistency check.</p> (psa)
    </div><h4>Version 0.4 (2007-06-06)</h4><div class="indent"><p class="" style="">Added section on RAP-based routing of messages sent to bare JIDs; removed RAP request protocol; changed app attribute to ns attribute; removed the application types registry since it is unnecessary if the ns attribute specifies the XML namespace of the data most closely associated with the application type; updated namespaces to conform to XMPP Registrar processes.</p> (psa)
    </div><h4>Version 0.3 (2006-09-17)</h4><div class="indent"><p class="" style="">Changed im application type to messaging; added jingle-video.</p> (psa)
    </div><h4>Version 0.2 (2005-12-19)</h4><div class="indent"><p class="" style="">Clarified structure of, and added schema for, RAP request namespace.</p> (psa)
    </div><h4>Version 0.1 (2005-12-15)</h4><div class="indent"><p class="" style="">Initial published version.</p> (psa)
    </div><h4>Version 0.0.6 (2005-11-29)</h4><div class="indent"><p class="" style="">Document cleanup.</p> (psa)
    </div><h4>Version 0.0.5 (2005-11-17)</h4><div class="indent"><p class="" style="">Added support for RAP requests via IQ.</p> (psa)
    </div><h4>Version 0.0.4 (2005-10-27)</h4><div class="indent"><p class="" style="">Defined registry of application types; clarified business rules; corrected schema.</p> (psa/jjh)
    </div><h4>Version 0.0.3 (2005-10-24)</h4><div class="indent"><p class="" style="">Broadened previous resource flagging proposal to include priority for applications other than messaging.</p> (psa/jjh)
    </div><h4>Version 0.0.2 (2005-09-26)</h4><div class="indent"><p class="" style="">Added more business rules and examples; defined service discovery guidelines.</p> (psa/jjh)
    </div><h4>Version 0.0.1 (2005-09-23)</h4><div class="indent"><p class="" style="">First draft.</p> (psa/jjh)
    </div></div><hr /><p>END</p></body></html>
