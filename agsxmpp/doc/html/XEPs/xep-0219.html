<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0219: Hop Check</title><link rel="stylesheet" type="text/css" href="/xmpp.css" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><meta name="DC.Title" content="Hop Check" /><meta name="DC.Creator" content="Peter Saint-Andre" /><meta name="DC.Description" content="This document defines an XMPP protocol extension that enables an entity to check the security of client-to-server and server-to-server hops between it and another entity." /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2007-10-30" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0219" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright (c) 1999 - 2008 by the XMPP Standards Foundation (XSF)." /></head><body><h1>XEP-0219: Hop Check</h1><p>This document defines an XMPP protocol extension that enables an entity to check the security of client-to-server and server-to-server hops between it and another entity.</p><hr /><p style="color:red">WARNING: This Standards-Track document is Experimental. Publication as an XMPP Extension Protocol does not imply approval of this proposal by the XMPP Standards Foundation. Implementation of the protocol described herein is encouraged in exploratory implementations, but production systems should not deploy implementations of this protocol until it advances to a status of Draft.</p><hr /><h2>Document Information</h2><p class="indent">
            Series: <a href="http://www.xmpp.org/extensions/">XEP</a><br />
            Number: 0219<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status: 
            <a href="http://www.xmpp.org/extensions/xep-0001.html#states-Experimental">Experimental</a><br />
            Type:
            <a href="http://www.xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br />
            Version: 0.2<br />
            Last Updated: 2007-10-30<br />
                Approving Body: <a href="http://www.xmpp.org/council/">XMPP Council</a><br />Dependencies: XMPP Core<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: TO BE ASSIGNED<br />
              Wiki Page: &lt;<a href="http://wiki.jabber.org/index.php/Hop Check (XEP-0219)">http://wiki.jabber.org/index.php/Hop Check (XEP-0219)</a>&gt;
            </p><hr /><h2>Author Information</h2><div class="indent"><h3>Peter Saint-Andre</h3><p class="indent">
        JabberID: 
        <a href="xmpp:stpeter@jabber.org">stpeter@jabber.org</a><br />
        URI: 
        <a href="https://stpeter.im/">https://stpeter.im/</a><br /></p></div><hr /><h2>Legal Notices</h2><div class="indent"><h3>Copyright</h3>This XMPP Extension Protocol is copyright (c) 1999 - 2008 by the XMPP Standards Foundation (XSF).<h3>Permissions</h3>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h3>Disclaimer of Warranty</h3><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. In no event shall the XMPP Standards Foundation or the authors of this Specification be liable for any claim, damages, or other liability, whether in an action of contract, tort, or otherwise, arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification. ##</span><h3>Limitation of Liability</h3>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising out of the use or inability to use the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h3>IPR Conformance</h3>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which may be found at &lt;<a href="http://www.xmpp.org/extensions/ipr-policy.shtml">http://www.xmpp.org/extensions/ipr-policy.shtml</a>&gt; or obtained by writing to XSF, P.O. Box 1641, Denver, CO 80201 USA).</div><hr /><h2>Discussion Venue</h2><p class="indent">The preferred venue for discussion of this document is the Standards discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">http://mail.jabber.org/mailman/listinfo/standards</a>&gt;.</p><p class="indent">Errata may be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><h2>Relation to XMPP</h2><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><h2>Conformance Terms</h2><p class="indent">The following keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#intro">Introduction</a><br />   
      1.1.  <a href="#motivation">Motivation</a><br />   
      1.2.  <a href="#approach">Approach</a><br />   
      1.3.  <a href="#howitworks">How It Works</a><br />2.  <a href="#protocol">Protocol</a><br />   
      2.1.  <a href="#protocol-request">Request</a><br />   
      2.2.  <a href="#protocol-errors">Errors</a><br />   
      2.3.  <a href="#protocol-response">Response</a><br />3.  <a href="#disco">Discovering Support</a><br />4.  <a href="#security">Security Considerations</a><br />   
      4.1.  <a href="#security-trust">Server Trust</a><br />   
      4.2.  <a href="#security-cleartext">Cleartext</a><br />5.  <a href="#iana">IANA Considerations</a><br />6.  <a href="#registrar">XMPP Registrar Considerations</a><br />   
      6.1.  <a href="#ns">Protocol Namespaces</a><br />7.  <a href="#schema">XML Schema</a><br /><a href="#notes">Notes</a><br /><a href="#revs">Revision History</a></p></div><hr /><h2>1.
       <a name="intro" id="intro">Introduction</a></h2>
  <div class="indent"><h3>1.1 <a name="motivation" id="motivation">Motivation</a></h3>
    <p class="" style="">When two XMPP users communicate, one or both of them may want to know the status of the XMPP communications path (i.e., of all the hops) between them. While the primary motivation is to determine if all the hops are secured via Transport Layer Security (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc4346">RFC 4346</a></span>  [<a href="#nt-id2252683">1</a>]) as specified for XMPP in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3920">RFC 3920</a></span>  [<a href="#nt-id2252712">2</a>], more general information about the communications path may also be of interest.</p>
    <p class="" style="">This document describes a protocol for discovering such information, similar in spirit to the traceroute protocol specified in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc1393">RFC 1393</a></span>  [<a href="#nt-id2252745">3</a>] but specific to XMPP.</p>
  </div>
  <div class="indent"><h3>1.2 <a name="approach" id="approach">Approach</a></h3>
    <p class="" style="">As a user, I may want to know three things:</p>
    <ol start="" class="" style="">
      <li class="" style="">If my connection to my server is encrypted.</li>
      <li class="" style="">If my server's connection to my contact's server is encrypted.</li>
      <li class="" style="">If my contact's connection to their server is encrypted.</li>
    </ol>
    <p class="" style="">If the answer to all three of these questions is "yes" and I have some level of trust in my XMPP server (see <a href="#security">Security Considerations</a>) then I have some assurance that communications between me and my contact will not be subject to interception by the likes of "Eve" (a passive attacker who can eavesdrop on messages) and "Mallory" (an active attacker who can maliciously modify messages in transit).</p>
    <p class="" style="">Note: By "encrypted" is meant channel encryption with Transport Layer Security (or, for client-to-server connections, legacy SSL) using something other than the null cipher. This protocol does not include more sophisticated information about the connection, such as the cipher suite used, the SASL authentication mechanism used (if any), the certificate identity (if any), the trusted roots involved in certificate authenticate, etc.</p>
    <p class="" style="">The answer to the first question is straightforward, since my client knows if its connection to my server is encrypted (as well as the certificates involved).</p>
    <p class="" style="">If I trust my server, I can ask it to report on the security of its connection to my contact's server. (Note: Because server-to-server connections are unidirectional and it is possible for the connection in one direction to be encrypted but for the connection in the opposite direction to be unencrypted, my server MUST NOT report the connection to my contact's server as encrypted unless the connection is encrypted in both directions.)</p>
    <p class="" style="">If the server-to-server connection is encrypted and my server trusts that connection, my server can ask my contact's server to report on the security of my contact's connection.</p>
    <p class="" style="">By feeling my way along the hops in this manner, I can learn if all three hops are encrypted and therefore can have some assurance that the entire communications path is encrypted.</p>
  </div>
  <div class="indent"><h3>1.3 <a name="howitworks" id="howitworks">How It Works</a></h3>
    <p class="" style="">Because XMPP has a decentralized architecture, there may be multiple hops along the communications path. Consider two users Juliet at capulet.lit and Romeo at montague.lit.  [<a href="#nt-id2251420">4</a>] There is one hop from Juliet's client to the capulet.lit server, one hop from the capulet.lit server to the montague.lit server, and one hop from the montague.lit server to Romeo's client.  [<a href="#nt-id2251429">5</a>]</p>
    <p class="" style="">We assume that Juliet's connection to capulet.lit is encrypted and that she has some trust in her server. If she wants to check the security of the path between her and Romeo, she should would send the following request:</p>
    <p class="caption"><a name="example-1" id="example-1"></a>Example 1. Hop check request</p><div class="indent"><pre>
&lt;iq type='get'
    from='juliet@capulet.lit/balcony'
    to='capulet.lit'
    id='check1'&gt;
  &lt;hopcheck xmlns='http://www.xmpp.org/extensions/xep-0219.html#ns' 
            to='romeo@montague.lit/orchard'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Naturally, capulet.lit knows about the security of Juliet's connection to capulet.lit and about the security of its connection to montague.lit. But it does not know about the security of Romeo's connection to montague.net; therefore on behalf of Juliet it needs to ask montague.lit about that hop before returning an answer to Juliet:</p>
    <p class="caption"><a name="example-2" id="example-2"></a>Example 2. Intermediate hop check request</p><div class="indent"><pre>
&lt;iq type='get'
    from='capulet.lit'
    to='montague.lit'
    id='check2'&gt;
  &lt;hopcheck xmlns='http://www.xmpp.org/extensions/xep-0219.html#ns' 
            for='juliet@capulet.lit/balcony'
            to='romeo@montague.lit/orchard'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The montague.lit server would then report to capulet.lit regarding the hops from juliet@capulet.lit to romeo@montague.lit/orchard:</p>
    <p class="caption"><a name="example-3" id="example-3"></a>Example 3. Intermediate hop check result</p><div class="indent"><pre>
&lt;iq type='result'
    from='montague.lit'
    to='juliet@capulet.lit'
    id='check2'&gt;
  &lt;hopcheck xmlns='http://www.xmpp.org/extensions/xep-0219.html#ns' 
            for='juliet@capulet.lit/balcony'
            to='romeo@montague.lit/orchard'&gt;
    &lt;hop from='capulet.lit' 
         to='montague.lit' 
         ip='192.0.2.1' 
         delay='7.178' 
         auth='EXTERNAL' 
         encrypted='1'/&gt;
    &lt;hop from='montague.lit' 
         to='romeo@montague.lit/orchard' 
         delay='15.734' 
         auth='PLAIN' 
         encrypted='1'/&gt;
  &lt;/hopcheck&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The capulet.lit server would then report to Juliet regarding the security of all the hops:</p>
    <p class="caption"><a name="example-4" id="example-4"></a>Example 4. Hop check result</p><div class="indent"><pre>
&lt;iq type='result'
    from='capulet.lit'
    to='juliet@capulet.lit/balcony'
    id='check1'&gt;
  &lt;hopcheck xmlns='http://www.xmpp.org/extensions/xep-0219.html#ns' 
            from='juliet@capulet.lit/balcony'
            to='romeo@montague.lit/orchard'&gt;
    &lt;hop from='juliet@capulet.lit/balcony' 
         to='capulet.lit' 
         auth='DIGEST-MD5' 
         encrypted='true'/&gt;
    &lt;hop from='capulet.lit' 
         to='montague.lit' 
         ip='192.0.2.1' 
         delay='11.602' 
         auth='EXTERNAL' 
         encrypted='true'/&gt;
    &lt;hop from='montague.lit' 
         to='romeo@montague.lit/orchard' 
         delay='15.734' 
         auth='PLAIN' 
         encrypted='1'/&gt;
  &lt;/hopcheck&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The foregoing shows only the "happy path"; many alternate flows and error conditions are possible, as described in the <a href="#protocol">Protocol</a> section of this document.</p>
  </div>
<h2>2.
       <a name="protocol" id="protocol">Protocol</a></h2>
  <div class="indent"><h3>2.1 <a name="protocol-request" id="protocol-request">Request</a></h3>
    <p class="" style="">In order for an entity to check the communications path between itself and a target entity, the entity shall generate a hopcheck request of the following form:</p>
    <p class="caption"></p><div class="indent"><pre>
&lt;iq type='get'
    from='sender'
    to='respondent'
    id='foo'&gt;
  &lt;hopcheck xmlns='http://www.xmpp.org/extensions/xep-0219.html#ns' 
            [for='original-sender']
            to='target'/&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The sender MUST set the respondent to be the entity that the sender believes is the entity at the other end of the next hop in the communications path. (For a connected resource, this is the server to which the client is connected; for a server, this is the server corresponding to the domain portion of the JID in the triggering request received from a connected resource or other local entity.)</p>
    <p class="" style="">If the sender is a server but it is making the request on behalf of a connected resource, it MUST include the 'for' attribute and set it to the 'from' address of the triggering request.</p>
  </div>
  <div class="indent"><h3>2.2 <a name="protocol-errors" id="protocol-errors">Errors</a></h3>
    <p class="" style="">The following error cases are defined:</p>
    <ul class="" style="">
      <li class="" style="">If the respondent does not support the hopcheck namespace, it MUST return a &lt;service-unavailable/&gt; error.</li>
      <li class="" style="">If the &lt;hopcheck/&gt; element does not include a 'to' attribute, the respondent MUST return a &lt;bad-request/&gt; error.</li>
      <li class="" style="">If the 'to' or 'for' attribute of the &lt;hopcheck/&gt; element contains a JID that is malformed, the respondent MUST return a &lt;jid-malformed/&gt; error.</li>
      <li class="" style="">If the respondent is a server and the sender is a full JID (&lt;node@domain.tld/resource&gt;), the server MUST verify that the JID is a connected resource of the server (per <span class="ref">RFC 3920</span>); if it is not, then the respondent MUST return a &lt;forbidden/&gt; error.</li>
      <li class="" style="">If both the sender and the respondent are servers and the domain identifier of the &lt;hopcheck/&gt; element's 'to' attribute does not match a validated domain of the respondent, the respondent MUST return a &lt;item-not-found/&gt; error.</li>
      <li class="" style="">If both the sender and the respondent are servers, the JID of the &lt;hopcheck/&gt; element's 'to' is a connected resource of the respondent server, and the JID of the &lt;hopcheck/&gt; element's 'for' is not authorized to know the presence of the target (either via presence subscription or temporary presence sharing via directed presence as defined in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3921">RFC 3921</a></span>  [<a href="#nt-id2261329">6</a>]), then the respondent MUST return a &lt;forbidden/&gt; error.</li>
    </ul>
  </div>
  <div class="indent"><h3>2.3 <a name="protocol-response" id="protocol-response">Response</a></h3>
    <p class="" style="">If an error does not occur, the response shall be of the following form:</p>
    <p class="caption"></p><div class="indent"><pre>
&lt;iq type='result'
    from='respondent'
    to='sender'
    id='foo'&gt;
  &lt;hopcheck xmlns='http://www.xmpp.org/extensions/xep-0219.html#ns' 
            [for='original-sender']
            to='target'&gt;
    &lt;hop auth='some-defined-value'
         [delay='float']
         from='sender-or-respondent' 
         [ip='some-IP-address']
         encrypted='boolean'
         to='respondent-or-target'/&gt;
  &lt;/hopcheck&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">The 'delay' attribute is OPTIONAL. If included, it represents the time in milliseconds that it took for the respondent to receive a reply from the target or intermediate respondent.</p>
    <p class="" style="">The 'ip' attribute is OPTIONAL. If included, it represents the IPv4 or IPv6 address of the target or intermediate respondent.</p>
    <p class="" style="">The 'encrypted' attribute is REQUIRED. It is a boolean  [<a href="#nt-id2261392">7</a>] that represents whether the hop in question is encrypted via Transport Layer Security (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc4346">RFC 4346</a></span>  [<a href="#nt-id2261412">8</a>]) or at a legacy SSL port.</p>
    <p class="" style="">The 'auth' attribute is REQUIRED. It represents whether and how the hop in question is authenticated, in particular via one of the following means:</p>
    <ul class="" style="">
      <li class="" style="">A Simple Authentication and Security Layer mechanism (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc4422">RFC 4422</a></span>  [<a href="#nt-id2261470">9</a>] for the specification and <span class="ref" style=""><a href="http://www.iana.org/assignments/sasl-mechanisms">IANA SASL Mechanisms Registry</a></span>  [<a href="#nt-id2261500">10</a>] for a list of registered SASL mechanisms; the names for standardized, non-obsolete mechanisms are used as values of the 'auth' attribute).</li>
      <li class="" style="">The legacy <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0078.html">Non-SASL Authentication</a></span>  [<a href="#nt-id2261536">11</a>] protocol using the "plaintext" or "digest" method.</li>
      <li class="" style="">The server dialback protocol ("dialback") as specified in <span class="ref">RFC 3920</span>.</li>
    </ul>
  </div>
<h2>3.
       <a name="disco" id="disco">Discovering Support</a></h2>
  <p class="" style="">If an entity supports the Hop Check protocol, it MUST report that by including a service discovery feature of "http://www.xmpp.org/extensions/xep-0219.html#ns" (see <a href="#ns">Protocol Namespaces</a> regarding issuance of one or more permanent namespaces) in response to a <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0030.html">Service Discovery</a></span>  [<a href="#nt-id2261600">12</a>] information request:</p>
  <p class="caption"><a name="example-5" id="example-5"></a>Example 5. Service Discovery information request</p><div class="indent"><pre>
&lt;iq type='get'
    from='juliet@capulet.lit/balcony'
    from='capulet.lit'
    id='disco1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption"><a name="example-6" id="example-6"></a>Example 6. Service Discovery information response</p><div class="indent"><pre>
&lt;iq type='result'
    from='capulet.lit'
    to='juliet@capulet.lit/balcony'
    id='disco1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    ...
    &lt;feature var='http://www.xmpp.org/extensions/xep-0219.html#ns'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
  </pre></div>
<h2>4.
       <a name="security" id="security">Security Considerations</a></h2>
  <div class="indent"><h3>4.1 <a name="security-trust" id="security-trust">Server Trust</a></h3>
    <p class="" style="">Trust levels vary. The administrator of a server may have complete trust in the server they run. A user of a friend's server may have significant trust in the server. A user of a server in a military environment may have no choice of server and may trust that their superiors are doing the right thing. And so on. While the trust that a user places in a server may or may not be warranted, this document uses the level of trust that exists to bootstrap greater trust in the entire communications path.</p> 
  </div>
  <div class="indent"><h3>4.2 <a name="security-cleartext" id="security-cleartext">Cleartext</a></h3>
    <p class="" style="">Even if all the hops are encrypted, the traffic may still be available in cleartext to a representative of an Internet Service Provider ("Isaac"), a representative of the justice system ("Justin"), or a malicious attacker ("Mallory") that has gained access to any of the servers along the communications path. The protocol described herein is decidedly NOT a substitute for end-to-end encryption technologies such as <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0116.html">Encrypted Session Negotiation</a></span>  [<a href="#nt-id2261690">13</a>].</p>
  </div>
<h2>5.
       <a name="iana" id="iana">IANA Considerations</a></h2>
  <p class="" style="">This document requires no interaction with the <span class="ref" style=""><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-id2261736">14</a>].</p> 
<h2>6.
       <a name="registrar" id="registrar">XMPP Registrar Considerations</a></h2>
  <div class="indent"><h3>6.1 <a name="ns" id="ns">Protocol Namespaces</a></h3>
    <p class="" style="">Until this specification advances to a status of Draft, its associated namespace shall be "http://www.xmpp.org/extensions/xep-0219.html#ns"; upon advancement of this specification, the <span class="ref" style=""><a href="http://www.xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-id2261784">15</a>] shall issue a permanent namespace in accordance with the process defined in Section 4 of <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0053.html">XMPP Registrar Function</a></span>  [<a href="#nt-id2261807">16</a>].</p>
  </div>
<h2>7.
       <a name="schema" id="schema">XML Schema</a></h2>
  <p class="caption"></p><div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://www.xmpp.org/extensions/xep-0219.html#ns'
    xmlns='http://www.xmpp.org/extensions/xep-0219.html#ns'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='hopcheck'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence minOccurs='0' maxOccurs='unbounded'&gt;
        &lt;xs:element ref='hop'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='for' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='to' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='hop'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='auth' use='required'&gt;
            &lt;xs:simpleType&gt;
              &lt;xs:restriction base='xs:NCName'&gt;
                &lt;xs:enumeration value='ANONYMOUS'/&gt;
                &lt;xs:enumeration value='CRAM-MD5'/&gt;
                &lt;xs:enumeration value='DIGEST-MD5'/&gt;
                &lt;xs:enumeration value='EXTERNAL'/&gt;
                &lt;xs:enumeration value='GSSAPI'/&gt;
                &lt;xs:enumeration value='KERBEROS_V4'/&gt;
                &lt;xs:enumeration value='OTP'/&gt;
                &lt;xs:enumeration value='PLAIN'/&gt;
                &lt;xs:enumeration value='SECURID'/&gt;
                &lt;xs:enumeration value='dialback'/&gt;
                &lt;xs:enumeration value='digest'/&gt;
                &lt;xs:enumeration value='plaintext'/&gt;
              &lt;/xs:restriction&gt;
            &lt;/xs:simpleType&gt;
          &lt;/xs:attribute&gt;
          &lt;xs:attribute name='delay' type='xs:double' use='optional'/&gt;
          &lt;xs:attribute name='encrypted' type='xs:boolean' use='required'/&gt;
          &lt;xs:attribute name='from' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='ip' type='xs:string' use='optional'/&gt;
          &lt;xs:attribute name='to' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
  </pre></div>
<hr /><h2><a name="notes" id="notes"></a>Notes</h2><div class="indent"><p><a name="nt-id2252683" id="nt-id2252683">1</a>. RFC 4346: The Transport Layer Security (TLS) Protocol Version 1.1 &lt;<a href="http://tools.ietf.org/html/rfc4346">http://tools.ietf.org/html/rfc4346</a>&gt;.</p><p><a name="nt-id2252712" id="nt-id2252712">2</a>. RFC 3920: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://tools.ietf.org/html/rfc3920">http://tools.ietf.org/html/rfc3920</a>&gt;.</p><p><a name="nt-id2252745" id="nt-id2252745">3</a>. RFC 1393: Traceroute Using an IP Option &lt;<a href="http://tools.ietf.org/html/rfc1393">http://tools.ietf.org/html/rfc1393</a>&gt;.</p><p><a name="nt-id2251420" id="nt-id2251420">4</a>. This specification uses the example of two clients, but the protocol can be used to check hops between any two XMPP entities.</p><p><a name="nt-id2251429" id="nt-id2251429">5</a>. If both capulet.lit and montague.lit are virtual hosts of the same server, it is possible that there are only two hops in this situation rather than three. Moreover, in certain circumstances (e.g., if one of the clients connects to a third-party HTTP connection manager) it is possible for there to be more than three hops. However, this document assumes a standard XMPP architecture.</p><p><a name="nt-id2261329" id="nt-id2261329">6</a>. RFC 3921: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://tools.ietf.org/html/rfc3921">http://tools.ietf.org/html/rfc3921</a>&gt;.</p><p><a name="nt-id2261392" id="nt-id2261392">7</a>. In accordance with Section 3.2.2.1 of <span class="ref">XML Schema Part 2: Datatypes</span>, the allowable lexical representations for the xs:boolean datatype are the strings "0" and "false" for the concept 'false' and the strings "1" and "true" for the concept 'true'; implementations MUST support both styles of lexical representation.</p><p><a name="nt-id2261412" id="nt-id2261412">8</a>. RFC 4346: The Transport Layer Security (TLS) Protocol Version 1.1 &lt;<a href="http://tools.ietf.org/html/rfc4346">http://tools.ietf.org/html/rfc4346</a>&gt;.</p><p><a name="nt-id2261470" id="nt-id2261470">9</a>. RFC 4422: Simple Authentication and Security Layer (SASL) &lt;<a href="http://tools.ietf.org/html/rfc4422">http://tools.ietf.org/html/rfc4422</a>&gt;.</p><p><a name="nt-id2261500" id="nt-id2261500">10</a>. IANA registry of mechanisms used in the Simple Authentication and Security Layer protocol &lt;<a href="http://www.iana.org/assignments/sasl-mechanisms">http://www.iana.org/assignments/sasl-mechanisms</a>&gt;.</p><p><a name="nt-id2261536" id="nt-id2261536">11</a>. XEP-0078: Non-SASL Authentication &lt;<a href="http://www.xmpp.org/extensions/xep-0078.html">http://www.xmpp.org/extensions/xep-0078.html</a>&gt;.</p><p><a name="nt-id2261600" id="nt-id2261600">12</a>. XEP-0030: Service Discovery &lt;<a href="http://www.xmpp.org/extensions/xep-0030.html">http://www.xmpp.org/extensions/xep-0030.html</a>&gt;.</p><p><a name="nt-id2261690" id="nt-id2261690">13</a>. XEP-0116: Encrypted Session Negotiation &lt;<a href="http://www.xmpp.org/extensions/xep-0116.html">http://www.xmpp.org/extensions/xep-0116.html</a>&gt;.</p><p><a name="nt-id2261736" id="nt-id2261736">14</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p><p><a name="nt-id2261784" id="nt-id2261784">15</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="http://www.xmpp.org/registrar/">http://www.xmpp.org/registrar/</a>&gt;.</p><p><a name="nt-id2261807" id="nt-id2261807">16</a>. XEP-0053: XMPP Registrar Function &lt;<a href="http://www.xmpp.org/extensions/xep-0053.html">http://www.xmpp.org/extensions/xep-0053.html</a>&gt;.</p></div><hr /><h2><a name="revs" id="revs"></a>Revision History</h2><div class="indent"><h4>Version 0.2 (2007-10-30)</h4><div class="indent"><p class="" style="">Clarified meaning of encrypted; specified rules for reporting of server-to-server connections.</p> (psa)
    </div><h4>Version 0.1 (2007-05-30)</h4><div class="indent"><p class="" style="">Initial published version.</p> (psa)
    </div><h4>Version 0.0.4 (2007-05-16)</h4><div class="indent"><p class="" style="">Split secure attribute into encrypted (for TLS/SSL) and auth.</p> (psa)
    </div><h4>Version 0.0.3 (2007-05-11)</h4><div class="indent"><p class="" style="">Specified protocol.</p> (psa)
    </div><h4>Version 0.0.2 (2007-05-02)</h4><div class="indent"><p class="" style="">Added more detailed security considerations; broadened applicability to be more similar to traceroute; changed name of status attribute to secure and its type to boolean; added delay attribute; defined XML schema.</p> (psa)
    </div><h4>Version 0.0.1 (2007-05-01)</h4><div class="indent"><p class="" style="">First draft.</p> (psa)
    </div></div><hr /><p>END</p></body></html>
