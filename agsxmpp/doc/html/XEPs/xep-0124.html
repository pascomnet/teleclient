<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0124: Bidirectional-streams Over Synchronous HTTP (BOSH)</title><link rel="stylesheet" type="text/css" href="/xmpp.css" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><meta name="DC.Title" content="Bidirectional-streams Over Synchronous HTTP (BOSH)" /><meta name="DC.Creator" content="Ian Paterson" /><meta name="DC.Creator" content="Dave Smith" /><meta name="DC.Creator" content="Peter Saint-Andre" /><meta name="DC.Description" content="This specification defines a transport protocol that emulates a bidirectional stream between two entities (such as a client and a server) by efficiently using multiple synchronous HTTP request/response pairs without requiring the use of polling or asynchronous chunking." /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2007-02-21" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0124" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright (c) 1999 - 2008 by the XMPP Standards Foundation (XSF)." /></head><body><h1>XEP-0124: Bidirectional-streams Over Synchronous HTTP (BOSH)</h1><p>This specification defines a transport protocol that emulates a bidirectional stream between two entities (such as a client and a server) by efficiently using multiple synchronous HTTP request/response pairs without requiring the use of polling or asynchronous chunking.</p><hr /><p style="color:green">NOTICE: The protocol defined herein is a Draft Standard of the XMPP Standards Foundation. Implementations are encouraged and the protocol is appropriate for deployment in production systems, but some changes to the protocol are possible before it becomes a Final Standard.</p><hr /><h2>Document Information</h2><p class="indent">
            Series: <a href="http://www.xmpp.org/extensions/">XEP</a><br />
            Number: 0124<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status: 
            <a href="http://www.xmpp.org/extensions/xep-0001.html#states-Draft">Draft</a><br />
            Type:
            <a href="http://www.xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br />
            Version: 1.6<br />
            Last Updated: 2007-02-21<br />
                Approving Body: <a href="http://www.xmpp.org/council/">XMPP Council</a><br />Dependencies: RFC 1945, RFC 2616, RFC 3174<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: bosh<br />
        Schema: &lt;<a href="http://www.xmpp.org/schemas/httpbind.xsd">http://www.xmpp.org/schemas/httpbind.xsd</a>&gt;<br />
              Wiki Page: &lt;<a href="http://wiki.jabber.org/index.php/Bidirectional-streams Over Synchronous HTTP (BOSH) (XEP-0124)">http://wiki.jabber.org/index.php/Bidirectional-streams Over Synchronous HTTP (BOSH) (XEP-0124)</a>&gt;
            </p><hr /><h2>Author Information</h2><div class="indent"><h3>Ian Paterson</h3><p class="indent">
        Email:
        <a href="mailto:ian.paterson@clientside.co.uk">ian.paterson@clientside.co.uk</a><br />
        JabberID: 
        <a href="xmpp:ian@zoofy.com">ian@zoofy.com</a><br /></p><h3>Dave Smith</h3><p class="indent">
        Email:
        <a href="mailto:dizzyd@jabber.org">dizzyd@jabber.org</a><br />
        JabberID: 
        <a href="xmpp:dizzyd@jabber.org">dizzyd@jabber.org</a><br /></p><h3>Peter Saint-Andre</h3><p class="indent">
        JabberID: 
        <a href="xmpp:stpeter@jabber.org">stpeter@jabber.org</a><br />
        URI: 
        <a href="https://stpeter.im/">https://stpeter.im/</a><br /></p></div><hr /><h2>Legal Notices</h2><div class="indent"><h3>Copyright</h3>This XMPP Extension Protocol is copyright (c) 1999 - 2008 by the XMPP Standards Foundation (XSF).<h3>Permissions</h3>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h3>Disclaimer of Warranty</h3><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. In no event shall the XMPP Standards Foundation or the authors of this Specification be liable for any claim, damages, or other liability, whether in an action of contract, tort, or otherwise, arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification. ##</span><h3>Limitation of Liability</h3>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising out of the use or inability to use the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h3>IPR Conformance</h3>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which may be found at &lt;<a href="http://www.xmpp.org/extensions/ipr-policy.shtml">http://www.xmpp.org/extensions/ipr-policy.shtml</a>&gt; or obtained by writing to XSF, P.O. Box 1641, Denver, CO 80201 USA).</div><hr /><h2>Discussion Venue</h2><p class="indent">The preferred venue for discussion of this document is the Standards discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">http://mail.jabber.org/mailman/listinfo/standards</a>&gt;.</p><p class="indent">Given that this XMPP Extension Protocol normatively references IETF technologies, discussion on the XSF-IETF list may also be appropriate (see &lt;<a href="http://mail.jabber.org/mailman/listinfo/jsf-ietf">http://mail.jabber.org/mailman/listinfo/jsf-ietf</a>&gt; for details).</p><p class="indent">Errata may be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><h2>Relation to XMPP</h2><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><h2>Conformance Terms</h2><p class="indent">The following keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#intro">Introduction</a><br />2.  <a href="#reqs">Requirements</a><br />3.  <a href="#arch">Architectural Assumptions</a><br />4.  <a href="#technique">The BOSH Technique</a><br />5.  <a href="#overview">HTTP Overview</a><br />6.  <a href="#wrapper">&lt;body/&gt; Wrapper Element</a><br />7.  <a href="#session">Initiating a BOSH Session</a><br />   
      7.1.  <a href="#session-request">Session Creation Request</a><br />   
      7.2.  <a href="#session-create">Session Creation Response</a><br />8.  <a href="#stanzas">Sending and Receiving XML Stanzas</a><br />9.  <a href="#ack">Acknowledgements</a><br />   
      9.1.  <a href="#ack-request">Request Acknowledgements</a><br />   
      9.2.  <a href="#ack-response">Response Acknowledgements</a><br />10.  <a href="#inactive">Inactivity</a><br />11.  <a href="#overactive">Overactivity</a><br />12.  <a href="#poll">Polling Sessions</a><br />13.  <a href="#terminate">Terminating the HTTP Session</a><br />14.  <a href="#rids">Request IDs</a><br />   
      14.1.  <a href="#rids-syntax">Generation</a><br />   
      14.2.  <a href="#rids-order">In-Order Message Forwarding</a><br />   
      14.3.  <a href="#rids-broken">Broken Connections</a><br />15.  <a href="#keys">Protecting Insecure Sessions</a><br />   
      15.1.  <a href="#keys-applic">Applicability</a><br />   
      15.2.  <a href="#keys-intro">Introduction</a><br />   
      15.3.  <a href="#keys-generate">Generating the Key Sequence</a><br />   
      15.4.  <a href="#keys-use">Use of Keys</a><br />   
      15.5.  <a href="#keys-switch">Switching to Another Key Sequence</a><br />16.  <a href="#multi">Multiple Streams</a><br />   
      16.1.  <a href="#multi-intro">Introduction</a><br />   
      16.2.  <a href="#multi-discover">Discovery</a><br />   
      16.3.  <a href="#multi-add">Adding Streams To A Session</a><br />   
      16.4.  <a href="#multi-transmit">Transmitting Stanzas</a><br />   
      16.5.  <a href="#multi-close">Closing a Stream</a><br />   
      16.6.  <a href="#multi-error">Error Conditions</a><br />17.  <a href="#errorstatus">Error and Status Codes</a><br />   
      17.1.  <a href="#errorstatus-http">HTTP Conditions</a><br />   
      17.2.  <a href="#errorstatus-terminal">Terminal Binding Conditions</a><br />   
      17.3.  <a href="#errorstatus-recover">Recoverable Binding Conditions</a><br />   
      17.4.  <a href="#errorstatus-stanza">XML Stanza Conditions</a><br />18.  <a href="#script">Alternative Script Syntax</a><br />   
      18.1.  <a href="#script-intro">Introduction</a><br />   
      18.2.  <a href="#script-request">Changes to the Request Syntax</a><br />   
      18.3.  <a href="#script-response">Changes to the Response Syntax</a><br />19.  <a href="#security">Security Considerations</a><br />   
      19.1.  <a href="#security-crypt">Encryption</a><br />   
      19.2.  <a href="#security-sidrid">Unpredictable SID and RID</a><br />   
      19.3.  <a href="#security-script">Script Syntax</a><br />20.  <a href="#iana">IANA Considerations</a><br />21.  <a href="#registrar">XMPP Registrar Considerations</a><br />   
      21.1.  <a href="#registrar-ns">Protocol Namespaces</a><br />22.  <a href="#schema">XML Schema</a><br /><a href="#notes">Notes</a><br /><a href="#revs">Revision History</a></p></div><hr /><h2>1.
       <a name="intro" id="intro">Introduction</a></h2>
    <p class="" style="">Certain applications often find that arbitrary TCP connections (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc0793">RFC 793</a></span>  [<a href="#nt-id2251554">1</a>]) cannot be established (e.g., applications that are restricted either by their runtime environments or by firewalls permitting only Web browsing). BOSH, the protocol described in this document, may be used as a "drop-in" alternative to a bidirectional TCP connection. It is a mature, fully-featured protocol that has been in use for many years with many open source and commercial implementations. It overcomes common communication constraints by employing fully-compliant "cookie-free"  [<a href="#nt-id2251572">2</a>] HTTP 1.0 or HTTP 1.1 as a transport (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc1945">RFC 1945</a></span>  [<a href="#nt-id2261083">4</a>] and <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc2616">RFC 2616</a></span>  [<a href="#nt-id2261108">5</a>]).</p>
    <p class="" style="">BOSH can transport any data efficiently and with minimal latency in both directions. For applications that require both "push" and "pull" communications, BOSH is significantly more bandwidth-efficient and responsive than most other bidirectional HTTP-based transport protocols (e.g. <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0025.html">Jabber HTTP Polling</a></span>  [<a href="#nt-id2261141">6</a>]) and techniques now commonly known as AJAX.</p>
    <p class="" style="">BOSH achieves this efficiency and low-latency by avoiding polling without resorting to chunked HTTP responses (i.e. without using the technique which is now commonly known as "Comet"). The protocol employs multiple synchronous HTTP request/response pairs. This technique allows it to pass through even those proxies that buffer partial HTTP responses before forwarding the full responses only once they are available.</p>
    <p class="" style="">Note: Although the XML being transported in the examples herein is XMPP (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3920">RFC 3920</a></span>  [<a href="#nt-id2261186">7</a>]), this transport is not part of XMPP. In fact, from its conception the intention of the primary author was that it could be used to implement any bidirectional XML stream transporting a mixture of elements qualified by namespaces defined by different protocols (e.g., both XMPP and JSON). This mix is necessary since some connection managers may not support <a href="#multi">Multiple Streams</a> and constrained clients often have no access to HTTP Pipelining (which limits them to one BOSH session at a time). BOSH connection managers are generally not required to understand anything about the XML content that they transport beyond perhaps ensuring that each XML stanza is qualified by the correct namespace. <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0206.html">XMPP Over BOSH</a></span>  [<a href="#nt-id2261226">8</a>] documents some XMPP-specific extensions of this protocol that were formerly included in this document.</p>
    <p class="" style="">Note: This document inherits terminology regarding the Hypertext Transport Protocol from <span class="ref">RFC 1945</span> and <span class="ref">RFC 2616</span>.</p>
  <h2>2.
       <a name="reqs" id="reqs">Requirements</a></h2>
    <p class="" style="">The following design requirements reflect the need to offer performance as close as possible to a standard TCP connection.</p>
    <ol start="" class="" style="">
      <li class="" style="">Compatible with constrained runtime environments** (e.g., mobile and browser-based clients).</li>
      <li class="" style="">Enable browser-based clients to make bidirectional cross-domain connections.*</li>
      <li class="" style="">Compatible with proxies that buffer partial HTTP responses.*</li>
      <li class="" style="">Efficient through proxies that limit the duration of HTTP responses.*</li>
      <li class="" style="">Fully-compatible with HTTP/1.0.*</li>
      <li class="" style="">Compatible with restricted network connections (e.g., firewalls, proxies, and gateways).</li>
      <li class="" style="">Fault tolerant (e.g., session recovers after an underlying TCP connection breaks at any stage during an HTTP request).</li>
      <li class="" style="">Extensible.</li>
      <li class="" style="">Consume significantly less bandwidth than polling-based protocols.</li>
      <li class="" style="">Significantly more responsive (lower latency) than polling-based protocols.</li>
      <li class="" style="">Support for polling (for clients that are limited to a single HTTP connection at a time).</li>
      <li class="" style="">In-order delivery of data.</li>
      <li class="" style="">Guard against unauthorized users interjecting HTTP requests into a session.</li>
      <li class="" style="">Protect against denial of service attacks.</li>
      <li class="" style="">Multiplexing of data streams</li>
    </ol>
    <p class="" style="">*Not possible to fulfill these requirements with the Comet technique.</p>
    <p class="" style="">**Compatibility with constrained runtime environments implies the following restrictions:</p>
    <ol start="" class="" style="">
      <li class="" style="">Clients should not be required to have programmatic access to the headers of each HTTP request and response (e.g., cookies or status codes).</li>
      <li class="" style="">The body of each HTTP request and response may be parsable XML with a single root element.</li>
      <li class="" style="">Clients should be able to specify the Content-Type of the HTTP responses they receive.</li>
    </ol>
  <h2>3.
       <a name="arch" id="arch">Architectural Assumptions</a></h2>
    <p class="" style="">This document assumes that most implementations will utilize a specialized "connection manager" to handle HTTP connections rather than the usual TCP connections. Effectively, such a connection manager will be a specialized HTTP server that translates between the HTTP requests and responses defined herein and the data streams (or API) implemented by the server or servers with which it communicates, thus enabling an HTTP client to connect to a server. We can illustrate this graphically as follows:</p>
    <p class="caption"></p><div class="indent"><pre>
    Server
      |
      |  [unwrapped data streams]
      |
Connection Manager
      |
      |  [HTTP + &lt;body/&gt; wrapper]
      |
  HTTP Client
    </pre></div>
    <p class="" style="">BOSH addresses communications between an HTTP client and the connection manager only. It does not address communications between the connection manager and the server, since such communications are implementation-specific (e.g., the server may natively support this HTTP binding, in which case the connection manager will be a logical entity rather than a physical entity; alternatively the connection manager may be an independant translating proxy such that the server may believe it is talking directly to the client over TCP; or the connection manager and the server may use a component protocol or an API defined by the server implementation).</p>
    <p class="" style="">Furthermore, no aspect of this protocol limits its use to client-to-server communications. It could be used for server-to-server or component-to-server communications as well. However, this document focuses exclusively on use of the transport by clients that cannot maintain arbitrary persistent TCP connections with a server. We assume that servers and components are under no such restrictions and thus would use TCP.</p>
  <h2>4.
       <a name="technique" id="technique">The BOSH Technique</a></h2>
    <p class="" style="">Since HTTP is a synchronous request/response protocol, the traditional solution to emulating a bidirectional-stream over HTTP involved the client intermittently polling the connection manager to discover if it has any data queued for delivery to the client. This naive approach wastes a lot of network bandwidth by polling when no data is available. It also reduces the responsiveness of the application since the data spends time queued waiting until the connection manager receives the next poll (HTTP request) from the client. This results in an inevitable trade-off between responsiveness and bandwidth, since increasing the polling frequency will decrease latency but simultaneously increase bandwidth consumption (or vice versa if polling frequency is decreased).</p>
    <p class="" style="">The technique employed by this protocol achieves both low latency and low bandwidth consumption by encouraging the connection manager not to respond to a request until it actually has data to send to the client. As soon as the client receives a response from the connection manager it sends another request, thereby ensuring that the connection manager is (almost) always holding a request that it can use to "push" data to the client.</p>
    <p class="" style="">If the client needs to send some data to the connection manager then it simply sends a second request containing the data. Unfortunately most constrained clients do not support HTTP Pipelining (concurrent requests over a single connection), so the client typically needs to send the data over a second HTTP connection. The connection manager always responds to the request it has been holding on the first connection as soon as it receives a new request from the client - even if it has no data to send the client. It does that to make sure the client can send more data immediately if necessary. (The client SHOULD NOT open more than two HTTP connections to the connection manager at the same time,  [<a href="#nt-id2261582">9</a>] so it would otherwise have to wait until the connection manager responds to one of the requests.)</p>
    <p class="" style="">BOSH works reliably even if network conditions force every HTTP request to be made over a different TCP connection. However, if as is usually the case, the client is able to use HTTP/1.1, then (assuming reliable network conditions) all requests during a session will pass over the same two persistent TCP connections. Almost all of the time (see below) the client is able to push data on one of the connections, while the connection manager is able to "push" data on the other (so latency is as low as a standard TCP connection). It's interesting to note that the roles of the two connections typically switch whenever the client sends data to the connection manager.</p>
    <p class="" style="">If there is no traffic in either direction for an agreed amount of time (typically a couple of minutes), then the connection manager responds to the client with no data, and that response immediately triggers a fresh client request. The connection manager does that to ensure that if a network connection is broken then both parties will realise within a reasonable amount of time. This exchange is similar to the "keep-alive" or "ping" that is common practice over most persistent TCP connections. Since the BOSH technique involves no polling, bandwidth consumption is not significantly greater than a standard TCP connection.  [<a href="#nt-id2261630">10</a>]</p>
    <p class="" style="">Most of the time data can be pushed immediately. However, if one of the endpoints has just pushed some data then it will usually have to wait for a network round trip until it is able to push again. If HTTP Pipelining is available to the client then multiple concurrent requests are possible. So the client can always push data immediately. It can also ensure the connection manager is always holding enough requests such that even during bursts of activity it will never have to wait before pushing data. Furthermore, if the pool of requests being held by the connection manager is large enough, then the client will not be under pressure to send a new empty request immediately after receiving data from the connection manager. It can instead wait until it needs to send data. So, if over time the traffic to and from the client is balanced, bandwidth consumption will be about the same as if a standard TCP connection was being used.</p>
    <p class="" style="">Each block of data pushed by the connection manager is a complete HTTP response. So, unlike the Comet technique, the BOSH technique works through intermediate proxies that buffer partial HTTP responses. It is also fully compliant with HTTP/1.0 - which does not provide for chunked transfer encoding. Also unlike Comet, Web clients can use BOSH to make cross-domain connections.</p>
  <h2>5.
       <a name="overview" id="overview">HTTP Overview</a></h2>
    <p class="" style="">All information is encoded in the body of standard HTTP POST requests and responses. Each HTTP body contains a single &lt;body/&gt; wrapper which encapsulates the XML elements being transferred (see <a href="#wrapper">&lt;body/&gt; Wrapper Element</a>).</p>
    <p class="" style="">Clients SHOULD send all HTTP requests over a single persistent HTTP/1.1 connection using HTTP Pipelining. However, a client MAY deliver its POST requests in any way permited by <span class="ref">RFC 1945</span> or <span class="ref">RFC 2616</span>. For example, constrained clients can be expected to open more than one persistent connection instead of using Pipelining, or in some cases to open a new HTTP/1.0 connection to send each request. However, clients and connection managers SHOULD NOT use Chunked Transfer Coding, since intermediaries may buffer each partial HTTP request or response and only forward the full request or reponse once it is available.</p>
    <p class="" style="">Clients MAY include an HTTP Accept-Encoding header in any request. If the connection manager receives a request with an Accept-Encoding header, it MAY include an HTTP Content-Encoding header in the response (indicating one of the encodings specified in the request) and compress the response body accordingly.</p>
    <p class="" style="">Requests and responses MAY include HTTP headers not specified herein. The receiver SHOULD ignore any such headers.</p>
    <p class="" style="">Each BOSH session MAY share the HTTP connection(s) it uses with other HTTP traffic, including other BOSH sessions and HTTP requests and responses completely unrelated to this protocol (e.g., web page downloads). However, the responses to requests that are not part of the session sent over the same connection using HTTP pipelining (or queued to be sent over the same connection) may be delayed if they were sent while a request that is part of the session is being held (since the connection manager MUST send its responses in the same order that the requests were received, and the connection manager typically delays its responses).</p>
    <p class="" style="">The HTTP Content-Type header of all client requests SHOULD be "text/xml; charset=utf-8". However, clients MAY specify another value if they are constrained to do so (e.g., "application/x-www-form-urlencoded" or "text/plain"). The client and connection manager SHOULD ignore all HTTP Content-Type headers they receive.</p>
  <h2>6.
       <a name="wrapper" id="wrapper">&lt;body/&gt; Wrapper Element</a></h2>
    <p class="" style="">The body of each HTTP request and response contains a single &lt;body/&gt; wrapper element qualified by the 'http://jabber.org/protocol/httpbind' namespace. The content of the wrapper is the data being transfered. The &lt;body/&gt; element and it's content together MUST conform to the specifications set out in <span class="ref" style=""><a href="http://www.w3.org/TR/REC-xml/">XML 1.0</a></span>  [<a href="#nt-id2261821">11</a>]. They SHOULD also conform to <span class="ref" style=""><a href="http://www.w3.org/TR/REC-xml-names/">Namespaces in XML</a></span>  [<a href="#nt-id2261846">12</a>]. The content MUST NOT contain any of the following (all defined in <span class="ref">XML 1.0</span>):</p>
    <ul class="" style="">
      <li class="" style=""><p class="" style="">Partial XML elements</p></li>
      <li class="" style=""><p class="" style="">XML comments</p></li>
      <li class="" style=""><p class="" style="">XML processing instructions</p></li>
      <li class="" style=""><p class="" style="">Internal or external DTD subsets</p></li>
      <li class="" style=""><p class="" style="">Internal or external entity references (with the exception of predefined entities)</p></li>
      <li class="" style=""><p class="" style="">Character data or attribute values containing unescaped characters that map to the predefined entities (such characters MUST be escaped)</p></li>
    </ul>
    <p class="" style="">The &lt;body/&gt; wrapper MUST NOT contain any XML character data, although its child elements MAY contain character data. The &lt;body/&gt; wrapper MUST contain zero or more complete XML immediate child elements (called "stanzas" in this document, e.g., XMPP stanzas, or elements containing XML character data that represents objects using the JSON data interchange format - see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc4627">RFC 4627</a></span>  [<a href="#nt-id2261986">13</a>]). Each &lt;body/&gt; wrapper MAY contain stanzas qualified under a wide variety of different namespaces.</p>
    <p class="" style="">The &lt;body/&gt; element of every client request MUST possess a sequential request ID encapsulated via the 'rid' attribute; For details, refer to the <a href="#rids">Request IDs</a> section of this document.</p>
  <h2>7.
       <a name="session" id="session">Initiating a BOSH Session</a></h2>
    <div class="indent"><h3>7.1 <a name="session-request" id="session-request">Session Creation Request</a></h3>
      <p class="" style="">The first request from the client to the connection manager requests a new session.</p>
      <p class="" style="">The &lt;body/&gt; element of the first request SHOULD possess the following attributes (they SHOULD NOT be included in any other requests except as specified in <a href="#multi-add">Adding Streams To A Session</a>):</p>
      <ul class="" style="">
        <li class="" style=""><span class="strong">'to'</span> -- This attribute specifies the target domain of the first stream.</li>
        <li class="" style=""><span class="strong">'xml:lang'</span> -- This attribute (as defined in Section 2.12 of <span class="ref" style=""><a href="http://www.w3.org/TR/REC-xml/">XML 1.0</a></span>  [<a href="#nt-id2262082">14</a>]) specifies the default language of any human-readable XML character data sent or received during the session.</li>
        <li class="" style=""><span class="strong">'ver'</span> -- This attribute specifies the highest version of the BOSH protocol that the client supports. The numbering scheme is "&lt;major&gt;.&lt;minor&gt;" (where the minor number MAY be incremented higher than a single digit, so it MUST be treated as a separate integer). Note: The 'ver' attribute should not be confused with the version of any protocol being transported.</li>
        <li class="" style=""><span class="strong">'wait'</span> -- This attribute specifies the longest time (in seconds) that the connection manager is allowed to wait before responding to any request during the session. This enables the client to limit the delay before it discovers any network failure, and to prevent its HTTP/TCP connection from expiring due to inactivity.</li>
        <li class="" style=""><span class="strong">'hold'</span> -- This attribute specifies the maximum number of requests the connection manager is allowed to keep waiting at any one time during the session. If the client is not able to use HTTP Pipelining then this SHOULD be set to "1".</li>
      </ul>
      <p class="" style="">Note: Clients that only support <a href="#poll">Polling Sessions</a> MAY prevent the connection manager from waiting by setting 'wait' or 'hold' to "0". However, polling is NOT RECOMMENDED since the associated increase in bandwidth consumption and the decrease in responsiveness are both typically one or two orders of magnitude!</p>
      <p class="" style="">A connection manager MAY be configured to enable sessions with more than one server in different domains. When requesting a session with such a 'proxy' connection manager, a client SHOULD include a <span class="strong">'route'</span> attribute that specifies the protocol, hostname, and port of the server with which it wants to communicate, formatted as "proto:host:port" (e.g., "xmpp:jabber.org:9999").  [<a href="#nt-id2262188">15</a>] A connection manager that is configured to work only with a single server (or only with a defined list of domains and the associated list of hostnames and ports that are serving those domains) MAY ignore the 'route' attribute. (Note that the 'to' attribute specifies the domain being served, not the hostame of the machine that is serving the domain.)</p>
      <p class="" style="">A client MAY include a <span class="strong">'from'</span> attribute to enable the connection manager to forward its identity to the server.</p>
      <p class="" style="">A client MAY include an <span class="strong">'ack'</span> attribute (set to "1") to indicate that it will be using acknowledgements throughout the session and that the absence of an 'ack' attribute in any request is meaningful (see <a href="#ack">Acknowledgements</a>).</p>
      <p class="" style="">A client MAY include a <span class="strong">'secure'</span> attribute to specify that communications between the connection manager and the server must be "secure". (Note: The 'secure' attribute is of type xs:boolean (see <span class="ref" style=""><a href="http://www.w3.org/TR/xmlschema-2/">XML Schema Part 2</a></span>  [<a href="#nt-id2262285">16</a>]) and the default value is "false".  [<a href="#nt-id2262295">17</a>]) If a connection manager receives a session request with the 'secure' attribute set to "true" or "1", then it MUST respond to the client with a  <a href="#errorstatus-terminal">remote-connection-failed</a> error as soon as it determines that it cannot communicate in a secure way with the server. A connection manager SHOULD consider communications with the server to be "secure" if they are encrypted using SSL or TLS with verified certificates, or if it is running on the same physical machine as the server. A connection manager MAY consider communications over a "private" network to be secure, even without SSL or TLS; however, a network SHOULD be considered "private" only if the administrator of the connection manager is sure that unknown individuals or processes do not have access to the network (i.e., individuals or processes who do not have access to either the connection manager or the server). The connection manager SHOULD try to establish a secure connection with the server even if the client does not specifically require it.</p>
      <p class="" style="">Some clients are constrained to only accept HTTP responses with specific Content-Types (e.g., "text/html"). The &lt;body/&gt; element of the first request MAY possess a <span class="strong">'content'</span> attribute. This specifies the value of the HTTP Content-Type header that MUST appear in all the connection manager's responses during the session. If the client request does not possess a 'content' attribute, then the HTTP Content-Type header of responses MUST be "text/xml; charset=utf-8".</p>
      <p class="caption"><a name="example-1" id="example-1"></a>Example 1. Requesting a BOSH session</p><div class="indent"><pre>
POST /webclient HTTP/1.1
Host: httpcm.jabber.org
Accept-Encoding: gzip, deflate
Content-Type: text/xml; charset=utf-8
Content-Length: 104

&lt;body content='text/xml; charset=utf-8'
      hold='1'
      rid='1573741820'
      to='jabber.org'
      route='xmpp:jabber.org:9999'
      secure='true'
      ver='1.6'
      wait='60'
      ack='1'
      xml:lang='en'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
      <p class="" style="">Note: All requests after the first one MUST include a valid 'sid' attribute (provided by the connection manager in the <a href="#session-create">Session Creation Response</a>). The initialization request is unique in that the &lt;body/&gt; element MUST NOT possess a 'sid' attribute.</p>
    </div>
    <div class="indent"><h3>7.2 <a name="session-create" id="session-create">Session Creation Response</a></h3>
      <p class="" style="">After receiving a new session request, the connection manager MUST generate an opaque, unpredictable session identifier (or SID). The SID MUST be unique within the context of the connection manager application. The &lt;body/&gt; element of the connection manager's response to the client's session creation request MUST possess the following attributes (they SHOULD NOT be included in any other responses):</p>
      <ul class="" style="">
        <li class="" style=""><span class="strong">'sid'</span> -- This attribute specifies the SID</li>
        <li class="" style=""><span class="strong">'wait'</span> -- This is the longest time (in seconds) that it will wait before responding to any request during the session. The time MUST be less than or equal to the value specified in the session request.</li>
      </ul>
      <p class="" style="">The &lt;body/&gt; element SHOULD also include the following attributes (they SHOULD NOT be included in any other responses):</p>
      <ul class="" style="">
        <li class="" style=""><span class="strong">'ver'</span> -- This attribute specifies the highest version of the BOSH protocol that the connection manager supports, or the version specified by the client in its request, whichever is lower.</li>
        <li class="" style=""><span class="strong">'polling'</span> -- This attribute specifies the shortest allowable polling interval (in seconds). This enables the client to not send empty request elements more often than desired (see <a href="#poll">Polling Sessions</a> and <a href="#overactive">Overactivity</a>).</li>
        <li class="" style=""><span class="strong">'inactivity'</span> -- This attribute specifies the longest allowable inactivity period (in seconds). This enables the client to ensure that the periods with no requests pending are never too long (see <a href="#poll">Polling Sessions</a> and <a href="#inactive">Inactivity</a>).</li>
        <li class="" style=""><span class="strong">'requests'</span> -- This attribute enables the connection manager to limit the number of simultaneous requests the client makes (see <a href="#overactive">Overactivity</a> and <a href="#poll">Polling Sessions</a>). The RECOMMENDED values are either "2" or one more than the value of the 'hold' attribute specified in the session request.</li>
        <li class="" style=""><span class="strong">'hold'</span> -- This attribute informs the client about the maximum number of requests the connection manager may keep waiting at any one time during the session. This value MUST NOT be greater than the value specified by the client in the session request.</li>
      </ul>
      <p class="" style="">The connection manager MAY include an <span class="strong">'accept'</span> attribute in the session creation response element, to specify the content encodings it can decompress. After receiving a session creation response with an 'accept' attribute, clients MAY include an HTTP Content-Encoding header in subsequent requests (indicating one of the encodings specified in the 'accept' attribute) and compress the bodies of the requests accordingly.</p>
      <p class="" style="">A connection manager MAY include an <span class="strong">'ack'</span> attribute (set to the value of the 'rid' attribute of the session creation request) to indicate that it will be using acknowledgements throughout the session and that the absence of an 'ack' attribute in any response is meaningful (see <a href="#ack">Acknowledgements</a>).</p>
      <p class="" style="">If the connection manager supports session pausing (see <a href="#inactive">Inactivity</a>) then it SHOULD advertise that to the client by including a <span class="strong">'maxpause'</span> attribute in the session creation response element. The value of the attribute indicates the maximum length of a temporary session pause (in seconds) that a client MAY request.</p>
      <p class="" style="">For both requests and responses, the &lt;body/&gt; element and its content SHOULD be UTF-8 encoded. If the HTTP Content-Type header of a request/response specifies a character encoding other than UTF-8, then the connection manager MAY convert between UTF-8 and the other character encoding. However, even in this case, it is OPTIONAL for the connection manager to convert between encodings. The connection manager MAY inform the client which encodings it can convert by setting the optional <span class="strong">'charsets'</span> attribute in the session creation response element to a space-separated list of encodings.  [<a href="#nt-id2262793">18</a>]</p>
      <p class="" style="">As soon as the connection manager has established a connection to the server and discovered its identity, it MAY forward the identity to the client by including a <span class="strong">'from'</span> attribute in a response, either in its session creation response, or (if it has not received the identity from the server by that time) in any subsequent response to the client. If it established a secure connection to the server (as defined in <a href="#session">Initiating a BOSH Session</a>), then in the same response the connection manager SHOULD also include the <span class="strong">'secure'</span> attribute set to "true" or "1".</p>
      <p class="caption"><a name="example-2" id="example-2"></a>Example 2. Session creation response</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 128

&lt;body wait='60'
      inactivity='30'
      polling='5'
      requests='2'
      hold='1'
      ack='1573741820'
      accept='deflate,gzip'
      maxpause='120'
      sid='SomeSID'
      charsets='ISO_8859-1 ISO-2022-JP'
      ver='1.6'
      from='jabber.org'
      secure='true'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>


      <p class="caption"><a name="example-3" id="example-3"></a>Example 3. Subsequent response with 'from' and 'secure' attributes</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 128

&lt;body from='jabber.org'
      secure='true'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
    </div>
  <h2>8.
       <a name="stanzas" id="stanzas">Sending and Receiving XML Stanzas</a></h2>
    <p class="" style="">After the client has successfully completed all required preconditions, it can send and receive XML stanzas via the HTTP binding.</p>
    <p class="caption"><a name="example-4" id="example-4"></a>Example 4. Transmitting stanzas</p><div class="indent"><pre>
POST /webclient HTTP/1.1
Host: httpcm.jabber.org
Accept-Encoding: gzip, deflate
Content-Type: text/xml; charset=utf-8
Content-Length: 188

&lt;body rid='1249243562'
      sid='SomeSID'
      xmlns='http://jabber.org/protocol/httpbind'&gt;
  &lt;message to='contact@example.com'
           xmlns='jabber:client'&gt;
    &lt;body&gt;I said "Hi!"&lt;/body&gt;
  &lt;/message&gt;
  &lt;message to='friend@example.com'
           xmlns='jabber:client'&gt;
    &lt;body&gt;I said "Hi!"&lt;/body&gt;
  &lt;/message&gt;
&lt;/body&gt;</pre></div>
    <p class="" style="">Upon receipt of a request, the connection manager SHOULD forward the content of the &lt;body/&gt; element to the server as soon as possible. In any case it MUST forward the content from different requests in the order specified by their 'rid' attributes.</p>
    <p class="" style="">The connection manager MUST also return an HTTP 200 OK response with a &lt;body/&gt; element to the client. Note: This does not indicate that the stanzas have been successfully delivered to the server.</p>
    <p class="" style="">It is RECOMMENDED that the connection manager not return an HTTP result until a stanza has arrived from the server for delivery to the client. However, the connection manager SHOULD NOT wait longer than the time specified by the client in the 'wait' attribute of its <a href="#session-request">Session Creation Request</a>, and it SHOULD NOT keep more HTTP requests waiting at a time than the number specified in the 'hold' attribute of the session creation request. In any case it MUST respond to requests in the order specified by their 'rid' attributes.</p>
    <p class="" style="">If there are no stanzas waiting or ready to be delivered within the waiting period, then the connection manager SHOULD include an empty &lt;body/&gt; element in the HTTP result:</p>
    <p class="caption"><a name="example-5" id="example-5"></a>Example 5. Empty response</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 64

&lt;body xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
    <p class="" style="">If the connection manager has received one or more stanzas from the server for delivery to the client, then it SHOULD return the stanzas in the body of its response as soon as possible after receiving them from the server. The example below includes stanzas qualified by different namespaces:</p>
    <p class="caption"><a name="example-6" id="example-6"></a>Example 6. Response with queued stanza</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 185

&lt;body xmlns='http://jabber.org/protocol/httpbind'
      xmlns:json='http://json.org/'&gt;
  &lt;message from='contact@example.com'
           to='user@example.com'
           xmlns='jabber:client'&gt;
    &lt;body&gt;Hi yourself!&lt;/body&gt;
  &lt;/message&gt;
  &lt;message from='friend@example.com'
           to='user@example.com'
           xmlns='jabber:client'&gt;
    &lt;body&gt;Hi yourself!&lt;/body&gt;
  &lt;/message&gt;
  &lt;json:json&gt;
  [
    {
      "precision": "zip",
      "Latitude":  37.7668,
      "Longitude": -122.3959,
      "Address":   "",
      "City":      "SAN FRANCISCO",
      "State":     "CA",
      "Zip":       "94107",
      "Country":   "US"
    },
    {
      "precision": "zip",
      "Latitude":  37.371991,
      "Longitude": -122.026020,
      "Address":   "",
      "City":      "SUNNYVALE",
      "State":     "CA",
      "Zip":       "94085",
      "Country":   "US"
    }
  ]
  &lt;/json:json&gt;
&lt;/body&gt;</pre></div>
    <p class="" style="">The client MAY poll the connection manager for incoming stanzas by sending an empty &lt;body/&gt; element.</p>
    <p class="caption"><a name="example-7" id="example-7"></a>Example 7. Requesting XML Stanzas</p><div class="indent"><pre>
POST /webclient HTTP/1.1
Host: httpcm.jabber.org
Accept-Encoding: gzip, deflate
Content-Type: text/xml; charset=utf-8
Content-Length: 88

&lt;body rid='1249243563'
      sid='SomeSID'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
    <p class="" style="">The connection manager MUST wait and respond in the same way as it does after receiving stanzas from the client.</p>
  <h2>9.
       <a name="ack" id="ack">Acknowledgements</a></h2>
    <div class="indent"><h3>9.1 <a name="ack-request" id="ack-request">Request Acknowledgements</a></h3>
      <p class="" style="">When responding to a request that it has been holding, if the connection manager finds it has already received another request with a higher 'rid' attribute (typically while it was holding the first request), then it MAY acknowledge the reception to the client. The connection manager MAY set the 'ack' attribute of any response to the value of the highest 'rid' attribute it has received where it has also received all requests with lower 'rid' values.</p>
      <p class="caption"><a name="example-8" id="example-8"></a>Example 8. Response with request acknowledgement</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 64

&lt;body ack='1249243564'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
      <p class="" style="">If the connection manager will be including 'ack' attributes on responses during a session then it MUST include an 'ack' attribute in its session creation response, and set the 'ack' attribute of responses throughout the session. Except that, after its session creation response, the connection manager SHOULD NOT include an 'ack' attribute in any response if the value would be the 'rid' of the request being responded to.</p>
      <p class="" style="">If the connection manager is permitted to hold more than one request at a time, then the reception of a lower-than-expected 'ack' value from the connection manager (or the unexpected abscence of an 'ack' attribute) can give the client an early warning that a network failure might have occurred (e.g., if the client believes the connection manager should have received the another request by the time it responded).</p>
    </div>
    <div class="indent"><h3>9.2 <a name="ack-response" id="ack-response">Response Acknowledgements</a></h3>
      <p class="" style="">The client MAY similarly inform the connection manager about the responses it has received by setting the 'ack' attribute of any request to the value of the highest 'rid' of a request for which it has already received a response where it has also received all responses associated with lower 'rid' values. If the client will be including 'ack' attributes on requests during a session then it MUST include an 'ack' attribute (set to '1') in its session creation request, and set the 'ack' attribute of requests throughout the session. Except that, after its session creation request, the client SHOULD NOT include an 'ack' attribute in any request if it has received responses to all its previous requests.</p>
      <p class="caption"><a name="example-9" id="example-9"></a>Example 9. Request with response acknowledgement</p><div class="indent"><pre>
POST /webclient HTTP/1.1
Host: httpcm.jabber.org
Accept-Encoding: gzip, deflate
Content-Type: text/xml; charset=utf-8
Content-Length: 88

&lt;body rid='1249243566'
      sid='SomeSID'
      ack='1249243564'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
      <p class="" style="">After receiving a request with an 'ack' value less than the 'rid' of the last request that it has already responded to, the connection manager MAY inform the client of the situation by sending its next response immediately instead of waiting until it has stanzas to send to the client (e.g., if some time has passed since it responded). In this case it SHOULD include a 'report' attribute set to one greater than the 'ack' attribute it received from the client, and a 'time' attribute set to the number of milliseconds since it sent the response associated with the 'report' attribute.</p>
      <p class="caption"><a name="example-10" id="example-10"></a>Example 10. Response with report</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 64

&lt;body report='1249243565'
      time='852'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
      <p class="" style="">Upon reception of a response with 'report' and 'time' attributes, if the client has still not received the response associated with the request identifier (RID) specified by the 'report' attribute, then it MAY choose to resend the request associated with the missing response (see  <a href="#rids-broken">Broken Connections</a>).</p>
    </div>
  <h2>10.
       <a name="inactive" id="inactive">Inactivity</a></h2>
    <p class="" style="">After receiving a response from the connection manager, if none of the client's requests are still being held by the connection manager (and if the session is not a <a href="#poll">Polling Session</a>), the client SHOULD make a new request as soon as possible. In any case, if no requests are being held, the client MUST make a new request before the maximum inactivity period has expired. The length of this period in seconds is specified by the 'inactivity' attribute in the session creation response.</p>
    <p class="" style="">If the connection manager has responded to all the requests it has received within a session and the time since its last response is longer than the maximum inactivity period, then it SHOULD assume the client has been disconnected and terminate the session without informing the client. If the client subsequently makes another request, then the connection manager SHOULD respond as if the session does not exist.</p>
    <p class="" style="">If the connection manager did not specify a maximum inactivity period in the session creation response, then it SHOULD allow the client to be inactive for as long as it chooses.</p>
    <p class="" style="">If the session is not a polling session then the connection manager SHOULD specify a relatively short inactivity period to ensure disconnections are discovered as early as possible. The RECOMMENDED time would be a little more than the number of seconds for a comfortable network round trip between the connection manager and the client under difficult network conditions (since the client can be expected to make a new request immediately - see above).</p>
    <p class="" style="">If a client encounters an exceptional temporary situation during which it will be unable to send requests to the connection manager for a period of time greater than the maximum inactivity period (e.g., while a runtime environment changes from one web page to another), and if the connection manager included a 'maxpause' attribute in its <a href="#session-create">Session Creation Response</a>, then the client MAY request a temporary increase to the maximum inactivity period by including a 'pause' attribute in a request. Note: If the connection manager did not specify a 'maxpause' attribute at the start of the session then the client MUST NOT send a 'pause' attribute during the session.</p>
    <p class="caption"><a name="example-11" id="example-11"></a>Example 11. Requesting a Session Pause</p><div class="indent"><pre>
POST /webclient HTTP/1.1
Host: httpcm.jabber.org
Accept-Encoding: gzip, deflate
Content-Type: text/xml; charset=utf-8
Content-Length: 98

&lt;body rid='1249243564'
      sid='SomeSID'
      pause='60'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
    <p class="" style="">Upon reception of a session pause request, if the requested period is not greater than the maximum permitted time, then the connection manager SHOULD respond immediately to all pending requests (including the pause request) and <span class="em">temporarily</span> increase the maximum inactivity period to the requested time. Note: The response to the pause request MUST NOT contain any stanzas.</p>
    <p class="" style="">Note: If the client simply wants the connection manager to return all the requests it is holding then it MAY set the value of the 'pause' attribute to be the value of the 'inactivity' attribute in the connection manager's session creation response. (If the client believes it is in danger of becoming disconnected indefinitely then it MAY even request a temporary reduction of the maximum inactivity period by specifying a 'pause' value less than the 'inactivity' value, thus enabling the connection manager to discover any subsequent disconnection more quickly.)</p>
    <p class="" style="">The connection manager SHOULD set the maximum inactivity period back to normal upon reception of the next request from the client (assuming the connection manager hasn't already terminated the session).</p>
  <h2>11.
       <a name="overactive" id="overactive">Overactivity</a></h2>
    <p class="" style="">The client SHOULD NOT make more simultaneous requests than specified by the 'requests' attribute in the connection manager's <a href="#session-create">Session Creation Response</a>. However the client MAY make one additional request if it is to <a href="#inactive">pause</a> or <a href="#terminate">terminate</a> a session.</p>
    <p class="" style="">If during any period the client sends a sequence of new requests (i.e. requests with incremented rid attributes, not repeat requests) longer than the number specified by the 'requests' attribute, and if the connection manager has not yet responded to any of the requests, and if the last request did not include either a 'pause' attribute or a 'type' attribute set to "terminate", then the connection manager SHOULD consider that the client is making too many simultaneous requests and terminate the HTTP session and return a 'policy-violation' terminal binding error to the client. Note: This behavior applies to equally to normal and polling sessions.</p>
    <p class="caption"><a name="example-12" id="example-12"></a>Example 12. Too many simultaneous requests response</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 68

&lt;body type='terminate'
      condition='policy-violation'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
    <p class="" style="">Note: If the connection manager did not specify a 'requests' attribute in the session creation response, then it MUST allow the client to send as many simultaneous requests as it chooses.</p>
    <p class="" style="">If during any period the client sends a sequence of new requests equal in length to the number specified by the 'requests' attribute, and if the connection manager has not yet responded to any of the requests, and if the last request was empty and did not include either a 'pause' attribute or a 'type' attribute set to "terminate", and if the last two requests arrived within a period shorter than the number of seconds specified by the 'polling' attribute in the session creation response, then the connection manager SHOULD consider that the client is making requests more frequently than it was permitted and terminate the HTTP session and return a 'policy-violation' terminal binding error to the client. Note: the behavior for <a href="#poll">Polling Sessions</a> is slightly different.</p>
    <p class="caption"><a name="example-13" id="example-13"></a>Example 13. Too frequent requests response</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 68

&lt;body type='terminate'
      condition='policy-violation'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
    <p class="" style="">Note: If the connection manager did not specify a 'polling' attribute in the session creation response, then it MUST allow the client to send requests as frequently as it chooses.</p>
  <h2>12.
       <a name="poll" id="poll">Polling Sessions</a></h2>
    <p class="" style="">It may not be possible for a constrained client to either use HTTP Pipelining or open more than one HTTP connection with the connection manager at a time. In this case the client SHOULD inform the connection manager by setting the values of the 'wait' and/or 'hold' attributes in its session creation request to "0", and then "poll" the connection manager at regular intervals throughout the session for stanzas it may have received from the server. Note: Even if the client does not request a polling session then the connection manager MAY require a client to use polling by setting the 'requests' attribute (which specifies the number of simultaneous requests the client may make) of its <a href="#session-create">Session Creation Response</a> to "1", however this is NOT RECOMMENDED.</p>
    <p class="" style="">If a session will use polling the connection manager SHOULD specify a higher than normal value for the 'inactivity' attribute (see <a href="#inactive">Inactivity</a>) in its session creation response. The increase SHOULD be greater than the value it specifies for the 'polling' attribute.</p>
    <p class="" style="">If the client sends two consecutive empty new requests (i.e. requests with incremented rid attributes, not repeat requests) within a period shorter than the number of seconds specified by the 'polling' attribute (the shortest allowable polling interval) in the session creation response, and if the connection manager's response to the first request contained no stanzas, then upon reception of the second request the connection manager SHOULD terminate the HTTP session and return a 'policy-violation' terminal binding error to the client.</p>
    <p class="caption"><a name="example-14" id="example-14"></a>Example 14. Too frequent polling response</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 68

&lt;body type='terminate'
      condition='policy-violation'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
    <p class="" style="">Note: If the connection manager did not specify a 'polling' attribute in the session creation response, then it MUST allow the client to poll as frequently as it chooses.</p>
  <h2>13.
       <a name="terminate" id="terminate">Terminating the HTTP Session</a></h2>
    <p class="" style="">At any time, the client MAY gracefully terminate the session by sending a &lt;body/&gt; element with a 'type' attribute set to "terminate". The termination request MAY include one or more stanzas that the connection manager MUST forward to the server to ensure graceful logoff.</p>
    <p class="caption"><a name="example-15" id="example-15"></a>Example 15. Session termination by client</p><div class="indent"><pre>
POST /webclient HTTP/1.1
Host: httpcm.jabber.org
Accept-Encoding: gzip, deflate
Content-Type: text/xml; charset=utf-8
Content-Length: 153

&lt;body rid='1249243565'
      sid='SomeSID'
      type='terminate'
      xmlns='http://jabber.org/protocol/httpbind'&gt;
  &lt;presence type='unavailable'
            xmlns='jabber:client'/&gt;
&lt;/body&gt;</pre></div>
    <p class="" style="">The connection manager SHOULD return to the client an HTTP 200 OK response with an empty &lt;body/&gt; element.</p>
      <p class="caption"><a name="example-16" id="example-16"></a>Example 16. Recoverable error</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 72

&lt;body type='terminate'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
    <p class="" style="">Upon receiving the response, the client MUST consider the HTTP session to have been terminated.</p>
  <h2>14.
       <a name="rids" id="rids">Request IDs</a></h2>
    <div class="indent"><h3>14.1 <a name="rids-syntax" id="rids-syntax">Generation</a></h3>
      <p class="" style="">The client MUST generate a large, random, positive integer for the initial 'rid' (see <a href="#security">Security Considerations</a>, this also prevents non-compliant proxies from caching <a href="#script">Script Syntax</a> responses) and then increment that value by one for each subsequent request. The client MUST take care to choose an initial 'rid' that will never be incremented above 9007199254740991  [<a href="#nt-id2263773">20</a>] within the session. In practice, a session would have to be extraordinarily long (or involve the exchange of an extraordinary number of packets) to exceed the defined limit.</p>
    </div>
    <div class="indent"><h3>14.2 <a name="rids-order" id="rids-order">In-Order Message Forwarding</a></h3>
      <p class="" style="">When a client makes simultaneous requests, the connection manager may receive them out of order. The connection manager MUST forward the stanzas to the server and respond to the client requests in the order specified by the 'rid' attributes. The client MUST process responses received from the connection manager in the order the requests were made.</p>
      <p class="" style="">The connection manager SHOULD expect the 'rid' attribute to be within a window of values greater than the 'rid' of the previous request. The size of the window is equal to the maximum number of simultaneous requests allowed by the connection manager. If it receives a request with a 'rid' greater than the values in the window, then the connection manager MUST terminate the session with an error:</p>
      <p class="caption"><a name="example-17" id="example-17"></a>Example 17. Unexpected rid error</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 68

&lt;body type='terminate'
      condition='item-not-found'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
    </div>
    <div class="indent"><h3>14.3 <a name="rids-broken" id="rids-broken">Broken Connections</a></h3>
      <p class="" style="">Unreliable network communications or client constraints can result in broken connections. The connection manager SHOULD remember the 'rid' and the associated HTTP response body of the client's most recent requests which were not session pause requests (see <a href="#inactive">Inactivity</a>) and which did not result in an HTTP or binding error. The number of responses to non-pause requests kept in the buffer SHOULD be either the same as the maximum number of simultaneous requests allowed by the connection manager or, if <a href="#ack">Acknowledgements</a> are being used, the number of responses that have not yet been acknowledged.</p>
      <p class="" style="">If the network connection is broken or closed before the client receives a response to a request from the connection manager, then the client MAY resend an exact copy of the original request. Whenever the connection manager receives a request with a 'rid' that it has already received, it SHOULD return an HTTP 200 (OK) response that includes the buffered copy of the original XML response to the client (i.e., a &lt;body/&gt; wrapper possessing appropriate attributes and optionally containing one or more XML stanzas or other allowable XML elements). If the original response is not available (e.g., it is no longer in the buffer), then the connection manager MUST return an 'item-not-found' terminal binding error:</p>
      <p class="caption"><a name="example-18" id="example-18"></a>Example 18. Response not in buffer error</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 68

&lt;body type='terminate'
      condition='item-not-found'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
      <p class="" style="">Note: The error is the same whether the 'rid' is too large or too small. This makes it more difficult for an attacker to discover an acceptable value.</p>
    </div>
  <h2>15.
       <a name="keys" id="keys">Protecting Insecure Sessions</a></h2>
    <div class="indent"><h3>15.1 <a name="keys-applic" id="keys-applic">Applicability</a></h3>
      <p class="" style="">The OPTIONAL key sequencing mechanism described here MAY be used if the client's session with the connection manager is not secure. The session should be considered secure only if all client requests are made via SSL (or TLS) HTTP connections and the connection manager generates an unpredictable session ID. If the session is secure, it is not necessary to use this key sequencing mechanism.</p>
      <p class="" style="">Even if the session is not secure, the unpredictable session and request IDs specified in the preceding sections of this document already provide a level of protection similar to that provided by a connection bound to a single pair of persistent TCP/IP connections, and thus provide sufficient protection against a 'blind' attacker. However, in some circumstances, the key sequencing mechanism defined below helps to protect against a more determined and knowledgeable attacker.</p>
      <p class="" style="">It is important to recognize that the key sequencing mechanism defined below helps to protect only against an attacker who is able to view the contents of all requests or responses in an insecure session but who is not able to alter the contents of those requests (in this case, the mechanism prevents the attacker from interjecting HTTP requests into the session, e.g., termination requests or responses). However, the key sequencing mechanism does not provide any protection when the attacker is able to alter the contents of insecure requests or responses.</p>
    </div>
    <div class="indent"><h3>15.2 <a name="keys-intro" id="keys-intro">Introduction</a></h3>
      <p class="" style="">The HTTP requests of each session MAY be spread across a series of different socket connections. This would enable an unauthorized user that obtains the session ID and request ID of a session and then use their own socket connection to interject &lt;body/&gt; request elements into the session and receive the corresponding responses.</p>
      <p class="" style="">The key sequencing mechanism below protects against such attacks by enabling a connection manager to detect &lt;body/&gt; request elements interjected by a third party.</p>
    </div>
    <div class="indent"><h3>15.3 <a name="keys-generate" id="keys-generate">Generating the Key Sequence</a></h3>
      <p class="" style="">Prior to requesting a new session, the client MUST select an unpredictable counter ("n") and an unpredictable value ("seed"). The client then processes the "seed" through a cryptographic hash and converts the resulting 160 bits to a hexadecimal string K(1). It does this "n" times to arrive at the initial key K(n). The hashing algorithm MUST be SHA-1 as defined in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3174">RFC 3174</a></span>  [<a href="#nt-id2264074">21</a>].</p>
      <p class="caption"><a name="example-19" id="example-19"></a>Example 19. Creating the key sequence</p><div class="indent"><pre>
        K(1) = hex(SHA-1(seed))
        K(2) = hex(SHA-1(K(1)))
        ...
        K(n) = hex(SHA-1(K(n-1)))
      </pre></div>
    </div>
    <div class="indent"><h3>15.4 <a name="keys-use" id="keys-use">Use of Keys</a></h3>
      <p class="" style="">The client MUST set the 'newkey' attribute of the first request in the session to the value K(n).</p>
      <p class="caption"><a name="example-20" id="example-20"></a>Example 20. Session Request with Initial Key</p><div class="indent"><pre>
POST /webclient HTTP/1.1
Host: httpcm.jabber.org
Accept-Encoding: gzip, deflate
Content-Type: text/xml; charset=utf-8
Content-Length: 104

&lt;body content='text/xml; charset=utf-8'
      hold='1'
      rid='1573741820'
      to='jabber.org'
      wait='60'
      xml:lang='en'
      newkey='ca393b51b682f61f98e7877d61146407f3d0a770'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
    <p class="" style="">The client MUST set the 'key' attribute of all subsequent requests to the value of the next key in the generated sequence (decrementing from K(n-1) towards K(1) with each request sent).</p>
    <p class="caption"><a name="example-21" id="example-21"></a>Example 21. Request with Key</p><div class="indent"><pre>
POST /webclient HTTP/1.1
Host: httpcm.jabber.org
Accept-Encoding: gzip, deflate
Content-Type: text/xml; charset=utf-8
Content-Length: 88

&lt;body rid='1573741821'
      sid='SomeSID'
      key='bfb06a6f113cd6fd3838ab9d300fdb4fe3da2f7d'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
      <p class="" style="">The connection manager MAY verify the key by calculating the SHA-1 hash of the key and comparing it to the 'newkey' attribute of the previous request (or the 'key' attribute if the 'newkey' attribute was not set). If the values do not match (or if it receives a request without a 'key' attribute and the 'newkey' or 'key' attribute of the previous request was set), then the connection manager MUST NOT process the element, MUST terminate the session, and MUST return an 'item-not-found' terminal binding error.</p>
      <p class="caption"><a name="example-22" id="example-22"></a>Example 22. Invalid Key Sequence Error</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 68

&lt;body type='terminate'
      condition='item-not-found'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
    </div>
    <div class="indent"><h3>15.5 <a name="keys-switch" id="keys-switch">Switching to Another Key Sequence</a></h3>
      <p class="" style="">A client SHOULD choose a high value for "n" when generating the key sequence. However, if the session lasts long enough that the client arrives at the last key in the sequence K(1) then the client MUST switch to a new key sequence.</p>
      <p class="" style="">The client MUST:</p>
      <ol start="" class="" style="">
        <li class="" style="">Choose new values for "seed" and "n".</li>
        <li class="" style="">Generate a new key sequence using the algorithm defined above.</li>
        <li class="" style="">Set the 'key' attribute of the request to the next value in the old sequence (i.e. K(1), the last value).</li>
        <li class="" style="">Set the 'newkey' attribute of the request to the value K(n) from the new sequence.</li>
      </ol>
      <p class="caption"><a name="example-23" id="example-23"></a>Example 23. New Key Sequence</p><div class="indent"><pre>
POST /webclient HTTP/1.1
Host: httpcm.jabber.org
Accept-Encoding: gzip, deflate
Content-Type: text/xml; charset=utf-8
Content-Length: 188

&lt;body rid='1573741822'
      sid='SomeSID'
      key='6f825e81f4532b2c5fa2d12457d8a1f22e8f838e'
      newkey='113f58a37245ec9637266cf2fb6e48bfeaf7964e'
      xmlns='http://jabber.org/protocol/httpbind'&gt;
  &lt;message to='contact@example.com'
           xmlns='jabber:client'&gt;
    &lt;body&gt;I said "Hi!"&lt;/body&gt;
  &lt;/message&gt;
&lt;/body&gt;</pre></div>
    </div>
  <h2>16.
       <a name="multi" id="multi">Multiple Streams</a></h2>
    <div class="indent"><h3>16.1 <a name="multi-intro" id="multi-intro">Introduction</a></h3>
      <p class="" style="">The OPTIONAL feature described in this section enables multiple XML streams to be contained within a single HTTP session. This feature is essential in runtime environments that prevent HTTP Pipelining, thereby constraining the number of simultaneous HTTP requests a client may make to each connection manager, since clients running in such environments need multi-stream sessions if they are to connect using more than one account at the same time. This feature also reduces network traffic for any client that needs to establish parallel streams over HTTP.</p>
    </div>
    <div class="indent"><h3>16.2 <a name="multi-discover" id="multi-discover">Discovery</a></h3>
      <p class="" style="">If a connection manager supports the multi-streams feature, it MUST include a 'stream' attribute in its <a href="#session-create">Session Creation Response</a>. If a client does not receive the 'stream' attribute then it MUST assume that the connection manager does not support the feature.  [<a href="#nt-id2264325">22</a>]</p>
      <p class="" style="">The 'stream' attribute identifies the first stream to be opened for the session. The value of each 'stream' attribute MUST be an opaque and unpredictable name that is unique within the context of the connection manager application.</p>
      <p class="caption"><a name="example-24" id="example-24"></a>Example 24. Session creation response with stream name</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 128

&lt;body wait='60'
      inactivity='30'
      polling='5'
      requests='2'
      hold='1'
      accept='deflate,gzip'
      stream='firstStreamName'
      maxpause='120'
      sid='SomeSID'
      charsets='ISO_8859-1 ISO-2022-JP'
      ver='1.6'
      from='jabber.org'
      secure='true'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
    </div>
    <div class="indent"><h3>16.3 <a name="multi-add" id="multi-add">Adding Streams To A Session</a></h3>
      <p class="" style="">If the connection manager included a 'stream' attribute in its session creation response then the client MAY ask it to open another stream at any time by sending it an empty &lt;body/&gt; element with a 'to' attribute. The request MUST include valid 'sid' and 'rid'  [<a href="#nt-id2264383">23</a>] attributes, it SHOULD also include an 'xml:lang' attribute. The request MAY include 'route', 'from' and 'secure' attributes (see <a href="#session-request">Session Creation Request</a>), but it SHOULD NOT include 'ver', 'content', 'hold' or 'wait' attributes (since a new session is not being created).</p>
      <p class="caption"><a name="example-25" id="example-25"></a>Example 25. Requesting another stream</p><div class="indent"><pre>
POST /webclient HTTP/1.1
Host: httpcm.jabber.org
Accept-Encoding: gzip, deflate
Content-Type: text/xml; charset=utf-8
Content-Length: 104

&lt;body sid='SomeSID'
      rid='1573741820'
      to='jabber.org'
      route='xmpp:jabber.org:9999'
      secure='true'
      xml:lang='en'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
      <p class="" style="">If the connection manager did not indicate its support for multiple streams at the start of the session then it MUST ignore the extra attributes and treat the request as a normal empty request for stanzas (see <a href="#stanzas">Sending and Receiving XML Stanzas</a>).  [<a href="#nt-id2264433">24</a>] Otherwise it MUST open a new stream with the specified server (see <a href="#session-create">Session Creation Response</a>), generate a new stream name and respond to the client with the name. The response MAY also include 'from' and 'secure' attributes, but it SHOULD NOT include 'sid', 'requests', 'polling', 'hold', 'inactivity', 'maxpause', 'accept', 'charsets', 'ver' or 'wait' attributes.</p>
      <p class="caption"><a name="example-26" id="example-26"></a>Example 26. Add stream response</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 128

&lt;body stream='secondStreamName'
      from='jabber.org'
      secure='true'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
      <p class="" style="">Note: If the response did not include either 'from' or 'secure' attributes then they MAY be sent in a subsequent response instead (see <a href="#session-create">Session Creation Response</a>). In that case the 'stream' attribute MUST also be specified.</p>
    </div>
    <div class="indent"><h3>16.4 <a name="multi-transmit" id="multi-transmit">Transmitting Stanzas</a></h3>
      <p class="" style="">If more than one stream has been opened within a session, then all non-empty &lt;body/&gt; elements sent by the connection manager MUST include a 'stream' attribute that specifies which stream <span class="em">all</span> the stanzas it contains belong to. The client SHOULD include a 'stream' attribute for the same purpose. The client MAY omit the 'stream' attribute if it wants the connection manager to broadcast the stanzas over all open streams. Note: A &lt;body/&gt; element MUST NOT contain different stanzas for different streams.</p>
      <p class="" style="">If a stream name does not correspond to one of the session's open streams, then the receiving connection manager SHOULD return an 'item-not-found' terminal binding error, or the receiving client SHOULD terminate the session. However, if the receiving entity has only just closed the stream (and the sender may not have been aware of that when it sent the stanzas), then it MAY instead simply silently ignore any stanzas the &lt;body/&gt; element contains.</p>
      <p class="" style="">Note: Empty &lt;body/&gt; elements that do not include a 'from' or 'secure' attribute SHOULD NOT include a 'stream' attribute (since nothing is being transmitted for any stream). If such a &lt;body/&gt; element does include a 'stream' attribute then the receiving entity SHOULD ignore the attribute.</p>
    <p class="caption"><a name="example-27" id="example-27"></a>Example 27. Client sends stanza with a stream name</p><div class="indent"><pre>
POST /webclient HTTP/1.1
Host: httpcm.jabber.org
Accept-Encoding: gzip, deflate
Content-Type: text/xml; charset=utf-8
Content-Length: 188

&lt;body rid='1249243562'
      sid='SomeSID'
      stream='secondStreamName'
      xmlns='http://jabber.org/protocol/httpbind'&gt;
  &lt;message to='contact@example.com'
           xmlns='jabber:client'&gt;
    &lt;body&gt;I said "Hi!"&lt;/body&gt;
  &lt;/message&gt;
&lt;/body&gt;</pre></div>
      <p class="" style="">Note: The value of the 'stream' attribute of the response MAY be different to the corresponding request.  [<a href="#nt-id2264581">25</a>]</p>
    <p class="caption"><a name="example-28" id="example-28"></a>Example 28. Connection manager responds with a different stream name</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 185

&lt;body stream='firstStreamName'
      xmlns='http://jabber.org/protocol/httpbind'&gt;
  &lt;message from='contact@example.com'
           to='user@example.com'
           xmlns='jabber:client'&gt;
    &lt;body&gt;Hi yourself!&lt;/body&gt;
  &lt;/message&gt;
&lt;/body&gt;</pre></div>
      <p class="" style="">If no stream name is specified by the connection manager then the client MUST assume the stanzas are associated with the first stream (even if the first stream has been closed).</p>
      <p class="" style="">If no stream name is specified by the client then the connection manager MUST broadcast the stanzas over all open streams.  [<a href="#nt-id2264623">26</a>]</p>
    <p class="caption"><a name="example-29" id="example-29"></a>Example 29. Client asks for a stanza to be broadcast</p><div class="indent"><pre>
POST /webclient HTTP/1.1
Host: httpcm.jabber.org
Accept-Encoding: gzip, deflate
Content-Type: text/xml; charset=utf-8
Content-Length: 188

&lt;body rid='1249243562'
      sid='SomeSID'
      xmlns='http://jabber.org/protocol/httpbind'&gt;
  &lt;presence xmlns='jabber:client'&gt;
    &lt;show&gt;away&lt;/show&gt;
  &lt;/presence&gt;
&lt;/body&gt;</pre></div>
    </div>
    <div class="indent"><h3>16.5 <a name="multi-close" id="multi-close">Closing a Stream</a></h3>
      <p class="" style="">If more than one stream is open within a session, the client MAY close one open stream at any time using the procedure described in the section <a href="#terminate">Terminating the HTTP Session</a> above, taking care to specify the stream name with a 'stream' attribute. If the client closes the last stream the connection manager MUST terminate the session. If the client does not specify a stream name then the connection manager MUST close all open streams (sending any stanzas the terminate request contains to all streams), and terminate the session.</p>
      <p class="caption"><a name="example-30" id="example-30"></a>Example 30. Client closes one stream</p><div class="indent"><pre>
POST /webclient HTTP/1.1
Host: httpcm.jabber.org
Accept-Encoding: gzip, deflate
Content-Type: text/xml; charset=utf-8
Content-Length: 153

&lt;body rid='1249243564'
      sid='SomeSID'
      stream='secondStreamName'
      type='terminate'
      xmlns='http://jabber.org/protocol/httpbind'&gt;
  &lt;presence type='unavailable'
            xmlns='jabber:client'/&gt;
&lt;/body&gt;</pre></div>
    </div>
    <div class="indent"><h3>16.6 <a name="multi-error" id="multi-error">Error Conditions</a></h3>
      <p class="" style="">If more than one stream is open within a session, the connection manager MAY include a 'stream' attribute in a fatal binding error (see <a href="#errorstatus-terminal">Terminal Binding Conditions</a>). If a 'stream' attribute is specified then the stream MUST be closed by both entities but the session SHOULD NOT be terminated.</p>
      <p class="caption"><a name="example-31" id="example-31"></a>Example 31. Fatal stream error</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 68

&lt;body type='terminate'
      condition='remote-connection-failed'
      stream='secondStreamName'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
      <p class="" style="">Note: If the connection manager does not include a 'stream' attribute in a fatal binding error then all the session's open streams MUST be closed by both entities and the session MUST be terminated.</p>
    </div>
  <h2>17.
       <a name="errorstatus" id="errorstatus">Error and Status Codes</a></h2>
    <p class="" style="">There are four types of error and status reporting in HTTP responses:</p>
    <p class="caption"><a name="table-1" id="table-1"></a>Table 1: Error Condition Types</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body"><th colspan="" rowspan="">Condition Type</th><th colspan="" rowspan="">Description</th></tr>
      <tr class="body"><td colspan="" rowspan=""><span class="strong">HTTP Conditions</span> <span class="em">(Deprecated)</span></td><td colspan="" rowspan="">The connection manager responds to an invalid request from a <span class="em">legacy</span> client with a standard HTTP error. These are used for binding syntax errors, possible attacks, etc. Note that constrained clients are unable to differentiate between HTTP errors.</td></tr>
      <tr class="body"><td colspan="" rowspan=""><span class="strong">Terminal Binding Conditions</span></td><td colspan="" rowspan="">These error conditions may be read by constrained clients. They are used for connection manager problems, abstracting stream errors, communication problems between the connection manager and the server, and invalid client requests (binding syntax errors, possible attacks, etc.)</td></tr>
      <tr class="body"><td colspan="" rowspan=""><span class="strong">Recoverable Binding Conditions</span></td><td colspan="" rowspan="">These report communication problems between the connection manager and the client. They do not terminate the session. Clients recover from these errors by resending all the preceding &lt;body/&gt; wrappers that have not received responses.</td></tr>
      <tr class="body"><td colspan="" rowspan=""><span class="strong">Transported Protocol Conditions</span></td><td colspan="" rowspan="">Errors relating to the XML stanzas <span class="em">within</span> &lt;body/&gt; wrappers are, in general, defined in the documentation of the protocol being transported. They do not terminate the session.</td></tr>
    </table>
    <p class="" style="">Full descriptions are provided below.</p>
    <div class="indent"><h3>17.1 <a name="errorstatus-http" id="errorstatus-http">HTTP Conditions</a></h3>
      <p class="" style=""><span class="em">Note: All HTTP codes except 200 have been superseded by Terminal Binding Conditions to allow clients to determine whether the source of errors is the connection manager application or an HTTP intermediary.</span></p>
      <p class="" style="">A legacy client (or connection manager) is a client (or connection manager) that did not include a 'ver' attribute in its session creation request (or response). A legacy client (or connection manager) will interpret (or respond with) HTTP error codes according to the table below. Non-legacy connection managers SHOULD NOT send HTTP error codes unless they are communicating with a legacy client. Upon receiving an HTTP error (400, 403, 404), a legacy client or any client that is communicating with a legacy connection manager MUST consider the HTTP session to be null and void. A non-legacy client that is communicating with a non-legacy connection manager MAY consider that the session is still active.</p>
      <p class="caption"><a name="table-2" id="table-2"></a>Table 2: HTTP Error and Status Codes</p><table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th colspan="" rowspan="">Code</th>
          <th colspan="" rowspan="">Name</th>
          <th colspan="" rowspan="">Superseded by</th>
          <th colspan="" rowspan="">Purpose</th>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">200</td>
          <td colspan="" rowspan="">OK</td>
          <td colspan="" rowspan="">-</td>
          <td colspan="" rowspan="">Response to valid client request.</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">400</td>
          <td colspan="" rowspan="">Bad Request</td>
          <td colspan="" rowspan="">bad-request</td>
          <td colspan="" rowspan="">Inform client that the format of an HTTP header or binding element is unacceptable (e.g., syntax error).</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">403</td>
          <td colspan="" rowspan="">Forbidden</td>
          <td colspan="" rowspan="">policy-violation</td>
          <td colspan="" rowspan="">Inform client that it has broken the session rules (polling too frequently, requesting too frequently, too many simultaneous requests).</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">404</td>
          <td colspan="" rowspan="">Not Found</td>
          <td colspan="" rowspan="">item-not-found</td>
          <td colspan="" rowspan="">Inform client that (1) 'sid' is not valid, (2) 'stream' is not valid, (3) 'rid' is larger than the upper limit of the expected window, (4) connection manager is unable to resend response, (5) 'key' sequence is invalid.</td>
        </tr>
      </table>
      <p class="" style="">No other HTTP error and status codes were defined.</p>
      <p class="" style="">Note: Any connection manager (not only legacy connection managers) MAY indicate that it does not support <a href="#script">Script Syntax</a> by sending an HTTP 404 error code (instead of sending a bad-request error using Scrypt Syntax).</p>
      <p class="caption"><a name="example-32" id="example-32"></a>Example 32. Script Syntax not supported error</p><div class="indent"><pre>
HTTP/1.1 404 Not Found
Content-Length: 0</pre></div>
    </div>
    <div class="indent"><h3>17.2 <a name="errorstatus-terminal" id="errorstatus-terminal">Terminal Binding Conditions</a></h3>
      <p class="" style="">In any response it sends to the client, the connection manager MAY return a fatal error by setting a 'type' attribute of the &lt;body/&gt; element to "terminate". These binding errors imply that the HTTP session is terminated (unless a 'stream' attribute is specified - see <a href="#multi-error">Multiple Stream Error Conditions</a>).</p>
      <p class="" style="">Note: Although many of these conditions are similar to the XMPP stream error conditions specified in <span class="ref">RFC 3920</span>, they should not be confused with XMPP stream errors. In cases where this protocol is being used to transport XMPP, any fatal XMPP stream error conditions experienced between the connection manager and the XMPP server SHOULD only be reported using the "remote-stream-error" condition as described below.</p>
      <p class="caption"><a name="example-33" id="example-33"></a>Example 33. Remote connection failed error</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 68

&lt;body type='terminate'
      condition='remote-connection-failed'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
      <p class="" style="">The following values of the 'condition' attribute are defined:</p>
      <p class="caption"><a name="table-3" id="table-3"></a>Table 3: Terminal Binding Error Conditions</p><table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th colspan="" rowspan="">Condition</th>
          <th colspan="" rowspan="">Purpose</th>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">bad-request*</td>
          <td colspan="" rowspan="">The format of an HTTP header or binding element received from the client is unacceptable (e.g., syntax error), or Script Syntax is not supported.</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">host-gone</td>
          <td colspan="" rowspan="">The target domain specified in the 'to' attribute or the target host or port specified in the 'route' attribute is no longer serviced by the connection manager.</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">host-unknown</td>
          <td colspan="" rowspan="">The target domain specified in the 'to' attribute or the target host or port specified in the 'route' attribute is unknown to the connection manager.</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">improper-addressing</td>
          <td colspan="" rowspan="">The initialization element lacks a 'to' or 'route' attribute (or the attribute has no value) but the connection manager requires one.</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">internal-server-error</td>
          <td colspan="" rowspan="">The connection manager has experienced an internal error that prevents it from servicing the request.</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">item-not-found*</td>
          <td colspan="" rowspan="">(1) 'sid' is not valid, (2) 'stream' is not valid, (3) 'rid' is larger than the upper limit of the expected window, (4) connection manager is unable to resend response, (5) 'key' sequence is invalid</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">other-request</td>
          <td colspan="" rowspan="">Another request being processed at the same time as this request caused the session to terminate.</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">policy-violation*</td>
          <td colspan="" rowspan="">The client has broken the session rules (polling too frequently, requesting too frequently, too many simultaneous requests).</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">remote-connection-failed</td>
          <td colspan="" rowspan="">The connection manager was unable to connect to, or unable to connect securely to, or has lost its connection to, the server.</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">remote-stream-error</td>
          <td colspan="" rowspan="">Encapsulates an error in the protocol being transported.</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">see-other-uri</td>
          <td colspan="" rowspan="">The connection manager does not operate at this URI (e.g., the connection manager accepts only SSL or TLS connections at some https: URI rather than the http: URI requested by the client). The client may try POSTing to the URI in the content of the &lt;uri/&gt; child element.</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">system-shutdown</td>
          <td colspan="" rowspan="">The connection manager is being shut down. All active HTTP sessions are being terminated. No new sessions can be created.</td>
        </tr>
        <tr class="body">
          <td colspan="" rowspan="">undefined-condition</td>
          <td colspan="" rowspan="">The error is not one of those defined herein; the connection manager SHOULD include application-specific information in the content of the &lt;body/&gt; wrapper.</td>
        </tr>
      </table>
      <p class="" style="">* If the client did not include a 'ver' attribute in its session creation request then the connection manager SHOULD send a <span class="em">deprecated</span> <a href="#errorstatus-http">HTTP Error Condition</a> instead of this terminal binding condition. If the connection manager did not include a 'ver' attribute in its session creation response then the client SHOULD expect it to send a <span class="em">deprecated</span> HTTP Error Condition instead of this terminal binding condition.</p>
      <p class="" style="">The following is an example of a "see-other-uri" condition:</p>
      <p class="caption"><a name="example-34" id="example-34"></a>Example 34. See other URI error</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 68

&lt;body condition='see-other-uri'
      type='terminate'
      xmlns='http://jabber.org/protocol/httpbind'&gt;
  &lt;uri&gt;https://secure.jabber.org/xmppcm&lt;/uri&gt;
&lt;/body&gt;</pre></div>
      <p class="" style="">The following is an example including a "remote-stream-error" condition:</p>
      <p class="caption"><a name="example-35" id="example-35"></a>Example 35. Remote error</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 68

&lt;body condition='remote-stream-error'
      type='terminate'
      xmlns='http://jabber.org/protocol/httpbind'
      xmlns:stream='http://etherx.jabber.org/streams'&gt;
  &lt;message from='contact@example.com'
           to='user@example.com'
           xmlns='jabber:client'&gt;
    &lt;body&gt;Hi yourself!&lt;/body&gt;
  &lt;/message&gt;
  &lt;stream:error&gt;
    &lt;xml-not-well-formed xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
    &lt;text xmlns='urn:ietf:params:xml:ns:xmpp-streams'
          xml:lang='en'&gt;
      Some special application diagnostic information!
    &lt;/text&gt;
    &lt;escape-your-data xmlns='application-ns'/&gt;
  &lt;/stream:error&gt;
&lt;/body&gt;</pre></div>
      <p class="" style="">Naturally, the client MAY report binding errors to the connection manager as well, although this is unlikely.</p>
    </div>
    <div class="indent"><h3>17.3 <a name="errorstatus-recover" id="errorstatus-recover">Recoverable Binding Conditions</a></h3>
      <p class="" style="">In any response it sends to the client, the connection manager MAY return a recoverable error by setting a 'type' attribute of the &lt;body/&gt; element to "error". These errors do not imply that the HTTP session is terminated.</p>
      <p class="" style="">If it decides to recover from the error, then the client MUST repeat the HTTP request and all the preceding HTTP requests that have not received responses. The content of these requests MUST be identical to the &lt;body/&gt; elements of the original requests. This allows the connection manager to recover a session after the previous request was lost due to a communication failure.</p>
      <p class="caption"><a name="example-36" id="example-36"></a>Example 36. Recoverable error</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Content-Length: 68

&lt;body type='error'
      xmlns='http://jabber.org/protocol/httpbind'/&gt;</pre></div>
    </div>
    <div class="indent"><h3>17.4 <a name="errorstatus-stanza" id="errorstatus-stanza">XML Stanza Conditions</a></h3>
      <p class="" style="">Application-level error conditions described in the documentation of the protocol being transported are routed to the client through the connection manager. They are transparent to the connection manager, and therefore out of scope for the transport binding defined herein.</p>
    </div>
  <h2>18.
       <a name="script" id="script">Alternative Script Syntax</a></h2>
    <div class="indent"><h3>18.1 <a name="script-intro" id="script-intro">Introduction</a></h3>
      <p class="" style="">The cross domain security restrictions of some runtime environments permit clients to access pure XML text only if it was received from a specific server (e.g., the hostname a Web client was downloaded from). Astonishingly the same environments typically permit clients to receive and execute scripts from any server!  [<a href="#nt-id2265747">27</a>] The <a href="#security">Security Considerations</a> section below describes the significant risks of deploying Script Syntax.</p>
      <p class="" style="">To enable domain-restricted clients to use BOSH with any connection manager, this section proposes an <span class="em">optional</span> alternative to the standard "BOSH Pure Syntax" seen in the other sections of this document. The "BOSH Script Syntax" defined here essentially inserts each &lt;body/&gt; element sent by the client into an HTTP GET header instead of into the body of a POST request. Each &lt;body/&gt; element sent by the connection manager is wrapped inside an <span class="ref" style=""><a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">ECMAScript (JavaScript)</a></span>  [<a href="#nt-id2265850">28</a>] string and function call. No changes to the &lt;body/&gt; element or to any other aspects of the protocol are required.</p>
      <p class="" style="">If, and only if, a client is <span class="em">unable</span> to use the Pure Syntax, then it MAY send a session request to a BOSH connection manager using Script Syntax instead. If the connection manager supports Script Syntax then it MUST send its <a href="#session-create">Session Creation Response</a> using Script Syntax, and all subsequent client requests and connection manager responses within the session MUST be sent using Script Syntax. If the connection manager does not support the "BOSH Script" syntax then it SHOULD return either an 'item-not-found' terminal binding error (in Script Syntax) or an HTTP 404 (Not Found) error in response to the client's session request:</p>
      <p class="" style="">Note: The line break in the body of the HTTP response in the following example is included only to improve readability. In practice there MUST be no line breaks.</p>
      <p class="caption"><a name="example-37" id="example-37"></a>Example 37. Script Syntax not supported binding error</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/javascript; charset=utf-8
Cache-Control: no-store
Cache-Control: no-cache
Pragma: no-cache
Content-Length: 212

_BOSH_("&lt;body type='terminate' condition='item-not-found'
        xmlns='http://jabber.org/protocol/httpbind'/&gt;")</pre></div>
      <p class="caption"><a name="example-38" id="example-38"></a>Example 38. Script Syntax not supported HTTP error</p><div class="indent"><pre>
HTTP/1.1 404 Not Found
Content-Length: 0</pre></div>
    </div>
    <div class="indent"><h3>18.2 <a name="script-request" id="script-request">Changes to the Request Syntax</a></h3>
      <p class="" style="">Clients MUST make the following changes to convert their requests to Script Syntax:</p>
      <ol start="" class="" style="">
        <li class="" style=""><p class="" style="">Certain octets within the UTF-8 encoded &lt;body/&gt; element SHOULD be replaced according to the rules for escaping octets within URIs defined by <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3986">RFC 3986</a></span>  [<a href="#nt-id2265946">29</a>]. Therefore all octets except those representing 7-bit alphanumeric characters or the characters -._~!$&amp;'()*+,;=:@/? should be substituted with a character triplet, consisting of the percent character "%" followed by the two hexadecimal digits that represent the value of the octet.</p></li>
        <li class="" style=""><p class="" style="">A '?' character and the URI-encoded &lt;body/&gt; element MUST be appended to the URI at which the connection manager is operating within its server.</p></li>
        <li class="" style=""><p class="" style="">The resulting URI MUST be sent to the connection manager within an HTTP GET request.</p></li>
        <li class="" style=""><p class="" style="">Include extra HTTP headers to prevent request/response caching or storage by any intermediary.</p></li>
      </ol>
      <p class="" style="">Note: All whitespace between "GET " and " HTTP/1.1" in the HTTP GET header lines in the following two examples is included only to improve readability. In practice there MUST be no whitespace.</p>
      <p class="caption"><a name="example-39" id="example-39"></a>Example 39. Requesting a BOSH session in Script Syntax</p><div class="indent"><pre>
GET /webclient?%3Cbody%20content='text/xml;%20charset=utf-8'%20
    hold='1'%20rid='1573741820'%20to='jabber.org'%20
    route='xmpp:jabber.org:9999'%20secure='true'%20ver='1.6'%20
    wait='60'%20xml:lang='en'%20
    xmlns='http://jabber.org/protocol/httpbind'/%3E
    HTTP/1.1
Host: httpcm.jabber.org
Accept-Encoding: gzip, deflate
Cache-Control: no-store
Cache-Control: no-cache
Pragma: no-cache
Content-Length: 0</pre></div>
    <p class="caption"><a name="example-40" id="example-40"></a>Example 40. Transmitting stanzas in Script Syntax</p><div class="indent"><pre>
GET /webclient?%3Cbody%20rid='1249243562'%20sid='SomeSID'%20
    xmlns='http://jabber.org/protocol/httpbind'%3E%3C
    message%20to='friend@example.com'%20xmlns='jabber:client'%3E%3C
    body%3EI%20said%20%22Hi!%22%3C/body%3E%3C/message%3E%3C/body%3E
    HTTP/1.1
Host: httpcm.jabber.org
Accept-Encoding: gzip, deflate
Cache-Control: no-store
Cache-Control: no-cache
Pragma: no-cache
Content-Length: 0</pre></div>
      <p class="" style="">Although <span class="ref">RFC 2616</span> does not limit the length of HTTP URIs, the runtime environment of the client might restrict the length of the URI that it can include in each GET request.  [<a href="#nt-id2266059">30</a>] In these cases the client MUST reduce the content of the &lt;body/&gt; element accordingly and send the remaining content in subsequent HTTP GET requests wrapped in new &lt;body/&gt; elements (with incremented 'rid' attributes). This is possible since, unlike Pure Syntax, with Script Syntax the connection manager MUST treat the string of characters between the opening and closing &lt;body&gt; tags of each request as part of an octet stream instead of as a set of complete XML stanzas. The content of any one &lt;body/&gt; element MUST NOT be parsed in isolation from the rest of the stream.</p>
    </div>
    <div class="indent"><h3>18.3 <a name="script-response" id="script-response">Changes to the Response Syntax</a></h3>
      <p class="" style="">Connection managers MUST make the following changes to convert their responses to Script Syntax:</p>
      <ol start="" class="" style="">
        <li class="" style=""><p class="" style="">Certain characters within the &lt;body/&gt; element MUST be replaced according to the rules for escaping characters within strings defined by <span class="ref">ECMAScript</span>. The necessary substitutions are summarised in the table below.</p>
          <p class="caption"><a name="table-4" id="table-4"></a>Table 4: Character Substitutions</p><table border="1" cellpadding="3" cellspacing="0">
            <tr class="body"><th colspan="" rowspan="">Character</th><th colspan="" rowspan="">Unicode Code Point Value</th><th colspan="" rowspan="">Escape sequence</th></tr>
            <tr class="body"><td colspan="" rowspan="">"</td><td colspan="" rowspan="">U+0022</td><td colspan="" rowspan="">\"</td></tr>
            <tr class="body"><td colspan="" rowspan="">Line Feed (New Line)</td><td colspan="" rowspan="">U+000A</td><td colspan="" rowspan="">\n</td></tr>
            <tr class="body"><td colspan="" rowspan="">Carriage Return</td><td colspan="" rowspan="">U+000D</td><td colspan="" rowspan="">\r</td></tr>
            <tr class="body"><td colspan="" rowspan="">Line Separator</td><td colspan="" rowspan="">U+2028</td><td colspan="" rowspan="">\u2028</td></tr>
            <tr class="body"><td colspan="" rowspan="">Paragraph Separator</td><td colspan="" rowspan="">U+2029</td><td colspan="" rowspan="">\u2029</td></tr>
            <tr class="body"><td colspan="" rowspan="">\</td><td colspan="" rowspan="">U+005C</td><td colspan="" rowspan="">\\</td></tr>
          </table>
          <p class="" style="">Each Unicode format-control character (i.e., the characters in category "Cf" in the Unicode Character Database, e.g., LEFT-TO-RIGHT MARK or RIGHT-TO-LEFT MARK) MUST also be substituted by its Unicode escape sequence (e.g. \u200e or \u200f).</p></li>
        <li class="" style=""><p class="" style="">The following eight characters MUST be prepended to the &lt;body/&gt; element: <p class="caption"></p><div class="indent"><pre>_BOSH_("</pre></div></p></li>
        <li class="" style=""><p class="" style="">The following two characters MUST be appended to the &lt;body/&gt; element: <p class="caption"></p><div class="indent"><pre>")</pre></div></p></li>
        <li class="" style=""><p class="" style="">If the client request does not possess a 'content' attribute, then the HTTP Content-Type header of responses MUST be either "text/javascript; charset=utf-8" or "application/x-javascript; charset=utf-8".</p></li>
        <li class="" style=""><p class="" style="">Include extra HTTP headers to prevent caching or storage by any intermediary.</p></li>
      </ol>
      <p class="" style="">Note: All line breaks in the bodies of the HTTP responses in the following two examples are included only to improve readability. In practice there MUST be no line breaks.</p>
      <p class="caption"><a name="example-41" id="example-41"></a>Example 41. Session creation response in Script Syntax</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/javascript; charset=utf-8
Cache-Control: no-store
Cache-Control: no-cache
Pragma: no-cache
Content-Length: 233

_BOSH_("&lt;body wait='60' inactivity='30' polling='5' requests='2' hold='1'
        ack='1573741820' accept='deflate,gzip' maxpause='120' sid='SomeSID'
        charsets='ISO_8859-1 ISO-2022-JP' ver='1.6' from='jabber.org'
        secure='true' xmlns='http://jabber.org/protocol/httpbind'/&gt;")
    </pre></div>
    <p class="caption"><a name="example-42" id="example-42"></a>Example 42. Receiving stanzas in Script Syntax</p><div class="indent"><pre>
HTTP/1.1 200 OK
Content-Type: text/javascript; charset=utf-8
Cache-Control: no-store
Cache-Control: no-cache
Pragma: no-cache
Content-Length: 212

_BOSH_("&lt;body rid='1249243562' sid='SomeSID'
        xmlns='http://jabber.org/protocol/httpbind'&gt;\n
        &lt;message to='contact@example.com' xmlns='jabber:client'&gt;\n
        &lt;body&gt;I said \"Hi!\"&lt;/body&gt;\n&lt;/message&gt;\n&lt;/body&gt;")
      </pre></div>
      <p class="" style="">Note: As with Pure Syntax, each &lt;body/&gt; element sent to the client MUST encapsulate zero or more complete XML stanzas.</p>
    </div>
  <h2>19.
       <a name="security" id="security">Security Considerations</a></h2>
    <div class="indent"><h3>19.1 <a name="security-crypt" id="security-crypt">Encryption</a></h3>
      <p class="" style="">All communications SHOULD occur over encrypted HTTP connections. Negotiation of encryption between the client and the connection manager SHOULD occur at the transport layer or the HTTP layer, not the application layer; such negotiation SHOULD follow the HTTP/SSL protocol defined in <span class="ref" style=""><a href="http://wp.netscape.com/eng/ssl3/draft302.txt">SSL</a></span>  [<a href="#nt-id2266506">31</a>], it MAY follow the HTTP/TLS protocol defined in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc2818">RFC 2818</a></span>  [<a href="#nt-id2266532">32</a>] or the TLS Within HTTP protocol defined in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc2817">RFC 2817</a></span>  [<a href="#nt-id2266557">33</a>].</p>
      <p class="" style="">If the HTTP connection used to send the initial session request is encrypted, then all the other HTTP connections used within the session MUST also be encrypted. Furthermore, if authentication certificates are exchanged when establishing the encrypted connection that is used to send the initial session request, then the client and/or connection manager SHOULD ensure that the same authentication certificates are employed for all subsequent connections used by the session. Once such a 'secure session' has been established:</p>
      <ul class="" style="">
        <li class="" style="">If the connection manager refuses to establish an encrypted connection or offers a different certificate, then the client SHOULD close the connection and terminate the session without sending any more requests.</li>
        <li class="" style="">If the client sends a wrapper element that is part of a 'secure session' over a connection that either is not encrypted or uses a different certificate then the connection manager SHOULD simply close the connection. The connection manager SHOULD NOT terminate the session since that would facilitate denial of service attacks.</li>
      </ul>
      <p class="" style="">In cases where the connection manager acts as a 'translating proxy' independent of the server, it creates another security vulnerability in addition to those on the servers. It is RECOMMENDED that clients ensure the security of stanzas sent through the connection manager (and servers) in both directions by encrypting them end-to-end (e.g., by establishing <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0116.html">Encrypted Session Negotiation</a></span>  [<a href="#nt-id2266638">34</a>]).</p>
    </div>
    <div class="indent"><h3>19.2 <a name="security-sidrid" id="security-sidrid">Unpredictable SID and RID</a></h3>
      <p class="" style="">The session identifier (SID) and initial request identifier (RID) are security-critical and therefore MUST be both unpredictable and nonrepeating (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc1750">RFC 1750</a></span>  [<a href="#nt-id2266691">35</a>] for recommendations regarding randomness of SIDs and initial RIDs for security purposes).</p>
    </div>
    <div class="indent"><h3>19.3 <a name="security-script" id="security-script">Script Syntax</a></h3>
      <p class="" style="">To avoid the storage of private communications by third parties, when using the alternative <a href="#script">Script Syntax</a> connection managers MUST (and clients SHOULD) include all the appropriate HTTP/1.0 and/or HTTP/1.1 headers necessary to ensure as far as possible that no request or response will ever be cached or stored by any intermediary.</p>
      <p class="" style="">The alternative Script Syntax returns code for the client to execute. This code is typically executed immediately without any validation and with the same rights as the code of the client itself. This vulnerability could be exploited to steal passwords and private keys, or to fabricate messages sent from and received by the client, or to forward or modify priviledged information on the servers to which the client has access, or to interfere with any aspect of the client's functionality - limited only by the extent of the runtime environment ("sandbox"), by the extent that naive users may be tricked into doing things outside that environment, and by the attacker's fertile imagination. Therefore, although the client could use Script Syntax with any connection manager on the network, in practice it MUST take care to employ it only with connection managers that the client's user trusts (as much as the server from which the client was downloaded). To prevent a-man-in-the-middle from manipulating the code clients SHOULD only use Script Syntax over encrypted connections (see above). If the client was downloaded over an encrypted connection then it MUST NOT use Script Syntax over connections that are not encrypted.</p>
    </div>
  <h2>20.
       <a name="iana" id="iana">IANA Considerations</a></h2>
    <p class="" style="">This document requires no interaction with the <span class="ref" style=""><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-id2266781">36</a>].</p>
  <h2>21.
       <a name="registrar" id="registrar">XMPP Registrar Considerations</a></h2>
    <div class="indent"><h3>21.1 <a name="registrar-ns" id="registrar-ns">Protocol Namespaces</a></h3>
      <p class="" style="">The <span class="ref" style=""><a href="http://www.xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-id2266835">37</a>] includes 'http://jabber.org/protocol/httpbind' in its registry of protocol namespaces.</p>
    </div>
  <h2>22.
       <a name="schema" id="schema">XML Schema</a></h2>
    <p class="caption"></p><div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    xmlns:stream='http://etherx.jabber.org/streams'
    targetNamespace='http://jabber.org/protocol/httpbind'
    xmlns='http://jabber.org/protocol/httpbind'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      XEP-0124: http://www.xmpp.org/extensions/xep-0124.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name='body'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice&gt;
        &lt;xs:any namespace='##any'
                minOccurs='0'
                maxOccurs='unbounded'
                processContents='lax'/&gt;
      &lt;/xs:choice&gt;
      &lt;xs:attribute name='accept' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='ack' type='xs:positiveInteger' use='optional'/&gt;
      &lt;xs:attribute name='authid' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='charsets' type='xs:NMTOKENS' use='optional'/&gt;
      &lt;xs:attribute name='condition' use='optional'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='host-gone'/&gt;
            &lt;xs:enumeration value='host-unknown'/&gt;
            &lt;xs:enumeration value='improper-addressing'/&gt;
            &lt;xs:enumeration value='internal-server-error'/&gt;
            &lt;xs:enumeration value='remote-connection-failed'/&gt;
            &lt;xs:enumeration value='remote-stream-error'/&gt;
            &lt;xs:enumeration value='see-other-uri'/&gt;
            &lt;xs:enumeration value='system-shutdown'/&gt;
            &lt;xs:enumeration value='undefined-condition'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
      &lt;xs:attribute name='content' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='from' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='hold' type='xs:byte' use='optional'/&gt;
      &lt;xs:attribute name='inactivity' type='xs:short' use='optional'/&gt;
      &lt;xs:attribute name='key' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='maxpause' type='xs:short' use='optional'/&gt;
      &lt;xs:attribute name='newkey' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='pause' type='xs:short' use='optional'/&gt;
      &lt;xs:attribute name='polling' type='xs:short' use='optional'/&gt;
      &lt;xs:attribute name='report' type='xs:positiveInteger' use='optional'/&gt;
      &lt;xs:attribute name='requests' type='xs:byte' use='optional'/&gt;
      &lt;xs:attribute name='rid' type='xs:positiveInteger' use='optional'/&gt;
      &lt;xs:attribute name='route' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='secure' type='xs:boolean' use='optional' default='false'/&gt;
      &lt;xs:attribute name='sid' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='stream' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='time' type='xs:short' use='optional'/&gt;
      &lt;xs:attribute name='to' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='type' type='xs:string' use='optional'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='error'/&gt;
            &lt;xs:enumeration value='terminate'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
      &lt;xs:attribute name='ver' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='wait' type='xs:short' use='optional'/&gt;
      &lt;xs:attribute name='xml:lang' type='xs:string' use='optional'/&gt;
      &lt;xs:anyAttribute namespace='##any' processContents='lax'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

&lt;/xs:schema&gt;
    </pre></div>
  <hr /><h2><a name="notes" id="notes"></a>Notes</h2><div class="indent"><p><a name="nt-id2251554" id="nt-id2251554">1</a>. RFC 793: Transmission Control Protocol &lt;<a href="http://tools.ietf.org/html/rfc0793">http://tools.ietf.org/html/rfc0793</a>&gt;.</p><p><a name="nt-id2251572" id="nt-id2251572">2</a>. Enabling communications via <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc2965">RFC 2965</a></span>  [<a href="#nt-id2261057">3</a>] is sub-optimal since several significant computing platforms provide only limited access to underlying HTTP requests/responses; worse, some platforms hide or remove cookie-related headers.</p><p><a name="nt-id2261057" id="nt-id2261057">3</a>. RFC 2965: HTTP State Management Mechanism &lt;<a href="http://tools.ietf.org/html/rfc2965">http://tools.ietf.org/html/rfc2965</a>&gt;.</p><p><a name="nt-id2261083" id="nt-id2261083">4</a>. RFC 1945: Hypertext Transfer Protocol -- HTTP/1.0 &lt;<a href="http://tools.ietf.org/html/rfc1945">http://tools.ietf.org/html/rfc1945</a>&gt;.</p><p><a name="nt-id2261108" id="nt-id2261108">5</a>. RFC 2616: Hypertext Transport Protocol -- HTTP/1.1 &lt;<a href="http://tools.ietf.org/html/rfc2616">http://tools.ietf.org/html/rfc2616</a>&gt;.</p><p><a name="nt-id2261141" id="nt-id2261141">6</a>. XEP-0025: Jabber HTTP Polling &lt;<a href="http://www.xmpp.org/extensions/xep-0025.html">http://www.xmpp.org/extensions/xep-0025.html</a>&gt;.</p><p><a name="nt-id2261186" id="nt-id2261186">7</a>. RFC 3920: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://tools.ietf.org/html/rfc3920">http://tools.ietf.org/html/rfc3920</a>&gt;.</p><p><a name="nt-id2261226" id="nt-id2261226">8</a>. XEP-0206: XMPP Over BOSH &lt;<a href="http://www.xmpp.org/extensions/xep-0206.html">http://www.xmpp.org/extensions/xep-0206.html</a>&gt;.</p><p><a name="nt-id2261582" id="nt-id2261582">9</a>. In order to reduce network congestion, <span class="ref">RFC 2616</span> recommends that clients SHOULD NOT keep more than two HTTP connections to the same HTTP server open at the same time. Clients running in constrained enviroments typically have no choice but to abide by that recommendation.</p><p><a name="nt-id2261630" id="nt-id2261630">10</a>. If there is no traffic other than the "pings" then bandwidth consumption will be double that of a TCP connection (although double nothing is still nothing). If data is sent in large packets then bandwidth consumption will be almost identical.</p><p><a name="nt-id2261821" id="nt-id2261821">11</a>. Extensible Markup Language (XML) 1.0 (Fourth Edition) &lt;<a href="http://www.w3.org/TR/REC-xml/">http://www.w3.org/TR/REC-xml/</a>&gt;.</p><p><a name="nt-id2261846" id="nt-id2261846">12</a>. Namespaces in XML &lt;<a href="http://www.w3.org/TR/REC-xml-names/">http://www.w3.org/TR/REC-xml-names/</a>&gt;.</p><p><a name="nt-id2261986" id="nt-id2261986">13</a>. RFC 4627: The application/json Media Type for JavaScript Object Notation (JSON) &lt;<a href="http://tools.ietf.org/html/rfc4627">http://tools.ietf.org/html/rfc4627</a>&gt;.</p><p><a name="nt-id2262082" id="nt-id2262082">14</a>. Extensible Markup Language (XML) 1.0 (Fourth Edition) &lt;<a href="http://www.w3.org/TR/REC-xml/">http://www.w3.org/TR/REC-xml/</a>&gt;.</p><p><a name="nt-id2262188" id="nt-id2262188">15</a>. Although the syntax of the 'route' attribute bears a superficial resemblance to a URI or IRI, it is not a URI/IRI and MUST NOT be processed in accordance with the rules specified in <span class="ref">RFC 3986</span>, <span class="ref">RFC 3987</span>, or <span class="ref">draft-saintandre-xmpp-iri</span>.</p><p><a name="nt-id2262285" id="nt-id2262285">16</a>. XML Schema Part 2: Datatypes &lt;<a href="http://www.w3.org/TR/xmlschema-2/">http://www.w3.org/TR/xmlschema-2/</a>&gt;.</p><p><a name="nt-id2262295" id="nt-id2262295">17</a>. In accordance with Section 3.2.2.1 of <span class="ref">XML Schema Part 2: Datatypes</span>, the allowable lexical representations for the xs:boolean datatype are the strings "0" and "false" for the concept 'false' and the strings "1" and "true" for the concept 'true'; implementations MUST support both styles of lexical representation.</p><p><a name="nt-id2262793" id="nt-id2262793">18</a>. Each character set name (or character encoding name -- we use the terms interchangeably) SHOULD be of type NMTOKEN, where the names are separated by the white space character #x20, resulting in a tokenized attribute type of NMTOKENS (see Section 3.3.1 of <span class="ref" style=""><a href="http://www.w3.org/TR/REC-xml/">XML 1.0</a></span>  [<a href="#nt-id2262811">19</a>]). Strictly speaking, the Character Sets registry maintained by the Internet Assigned Numbers Authority (see &lt;<a href="http://www.iana.org/assignments/character-sets">http://www.iana.org/assignments/character-sets</a>&gt;) allows a character set name to contain any printable US-ASCII character, which might include characters not allowed by the NMTOKEN construction of XML 1.0; however, the only existing character set name which includes such a character is "NF_Z_62-010_(1973)".</p><p><a name="nt-id2262811" id="nt-id2262811">19</a>. Extensible Markup Language (XML) 1.0 (Fourth Edition) &lt;<a href="http://www.w3.org/TR/REC-xml/">http://www.w3.org/TR/REC-xml/</a>&gt;.</p><p><a name="nt-id2263773" id="nt-id2263773">20</a>. 9007199254740991 is 2<span class="super" style="">53</span>-1. Some weakly typed languages use IEEE Standard 754 Doubles to represent all numbers. These Doubles cannot represent integers above 2<span class="super" style="">53</span> accurately.</p><p><a name="nt-id2264074" id="nt-id2264074">21</a>. RFC 3174: US Secure Hash Algorithm 1 (SHA1) &lt;<a href="http://tools.ietf.org/html/rfc3174">http://tools.ietf.org/html/rfc3174</a>&gt;.</p><p><a name="nt-id2264325" id="nt-id2264325">22</a>. Therefore a client and a connection manager will be compatible even if one or the other offers no support for multi-stream sessions.</p><p><a name="nt-id2264383" id="nt-id2264383">23</a>. The 'rid' attribute is always incremented normally without reference to any 'stream' attribute.</p><p><a name="nt-id2264433" id="nt-id2264433">24</a>. This helps to ensure backwards-compatibility with older implementations.</p><p><a name="nt-id2264581" id="nt-id2264581">25</a>. Each HTTP response MUST belong to the same session as the request that triggered it, but not necessarily to the same stream.</p><p><a name="nt-id2264623" id="nt-id2264623">26</a>. The broadcast stanzas may be of any type.</p><p><a name="nt-id2265747" id="nt-id2265747">27</a>. This security hole is unlikely to be closed by browser vendors since it facilitates online advertising.</p><p><a name="nt-id2265850" id="nt-id2265850">28</a>. Standard ECMA-262: ECMAScript Language Specification 3rd edition &lt;<a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">http://www.ecma-international.org/publications/standards/Ecma-262.htm</a>&gt;.</p><p><a name="nt-id2265946" id="nt-id2265946">29</a>. RFC 3986: Uniform Resource Identifiers (URI): Generic Syntax &lt;<a href="http://tools.ietf.org/html/rfc3986">http://tools.ietf.org/html/rfc3986</a>&gt;.</p><p><a name="nt-id2266059" id="nt-id2266059">30</a>. Internet Explorer versions 4.0 thru 7.0 have a maximum <span class="em">path</span> length of 2048 characters and a maximum URL length of 2083 characters. Other popular browsers appear to have no limit.</p><p><a name="nt-id2266506" id="nt-id2266506">31</a>. SSL V3.0 &lt;<a href="http://wp.netscape.com/eng/ssl3/draft302.txt">http://wp.netscape.com/eng/ssl3/draft302.txt</a>&gt;.</p><p><a name="nt-id2266532" id="nt-id2266532">32</a>. RFC 2818: HTTP Over TLS &lt;<a href="http://tools.ietf.org/html/rfc2818">http://tools.ietf.org/html/rfc2818</a>&gt;.</p><p><a name="nt-id2266557" id="nt-id2266557">33</a>. RFC 2817: Upgrading to TLS Within HTTP/1.1 &lt;<a href="http://tools.ietf.org/html/rfc2817">http://tools.ietf.org/html/rfc2817</a>&gt;.</p><p><a name="nt-id2266638" id="nt-id2266638">34</a>. XEP-0116: Encrypted Session Negotiation &lt;<a href="http://www.xmpp.org/extensions/xep-0116.html">http://www.xmpp.org/extensions/xep-0116.html</a>&gt;.</p><p><a name="nt-id2266691" id="nt-id2266691">35</a>. RFC 1750: Randomness Recommendations for Security &lt;<a href="http://tools.ietf.org/html/rfc1750">http://tools.ietf.org/html/rfc1750</a>&gt;.</p><p><a name="nt-id2266781" id="nt-id2266781">36</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p><p><a name="nt-id2266835" id="nt-id2266835">37</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="http://www.xmpp.org/registrar/">http://www.xmpp.org/registrar/</a>&gt;.</p></div><hr /><h2><a name="revs" id="revs"></a>Revision History</h2><div class="indent"><h4>Version 1.6 (2007-02-21)</h4><div class="indent"><p class="" style="">Multiple clarifications and restructuring without changes to protocol itself; changed title to BOSH; added section that fully explores the technique underlying the protocol; separated XMPP-specific features into new XEP-0206; added optional new Script Syntax and session pauses; added Acknowledgements section; added from and ver attributes; added hold attribute to session creation response; clarified polling too-frequently error; recommended clients use HTTP Pipelining.</p> (ip)
    </div><h4>Version 1.5 (2006-04-28)</h4><div class="indent"><p class="" style="">Added optional Multiple Streams section; added security considerations about encrypted HTTP connections; recommended use of SSL rather than HTTP over TLS; specified that request ID values must not exceed 9007199254740991; corrected datatypes of inactivity, polling, rid, and wait attributes in the schema; added &lt;any/&gt; and &lt;anyAttribute/&gt; elements to schema to optionally support non-XMPP XML elements and attributes; deprecated HTTP error codes in favor of new terminal binding conditions.</p> (ip/psa)
    </div><h4>Version 1.4 (2005-12-14)</h4><div class="indent"><p class="" style="">Modified syntax of route attribute to be proto:host:port rather than XMPP URI/IRI.</p> (psa)
    </div><h4>Version 1.3 (2005-11-02)</h4><div class="indent"><p class="" style="">Corrected stream:features namespace and the Recoverable Binding Conditions section; recommended that connection manager shall return secure attribute to client; recommended end-to-end encryption through proxy connection managers.</p> (ip)
    </div><h4>Version 1.2 (2005-06-16)</h4><div class="indent"><p class="" style="">Specified optional use of route and secure attributes in session request. Minor correction: the stream features element should be included in the response that contains the authid attribute (this is not necessarily the session creation response).</p> (ip)
    </div><h4>Version 1.1 (2005-06-02)</h4><div class="indent"><p class="" style="">Specified optional use of HTTP Accept-Encoding and Content-Encoding headers for compression at HTTP binding level.</p> (ip)
    </div><h4>Version 1.0 (2005-03-03)</h4><div class="indent"><p class="" style="">Per a vote of the Jabber Council, advanced status to Draft.</p> (psa)
    </div><h4>Version 0.10 (2004-11-08)</h4><div class="indent"><p class="" style="">Changed HTTP 401 errors to HTTP 404.</p> (ip)
    </div><h4>Version 0.9 (2004-10-26)</h4><div class="indent"><p class="" style="">Added charset attribute.</p> (ip/psa)
    </div><h4>Version 0.8 (2004-10-26)</h4><div class="indent"><p class="" style="">Specified that wait attribute must be included in the session creation response.</p> (ip)
    </div><h4>Version 0.7 (2004-08-12)</h4><div class="indent"><p class="" style="">Defined appropriate XMPP stanza error conditions.</p> (psa/ip)
    </div><h4>Version 0.6 (2004-07-19)</h4><div class="indent"><p class="" style="">Added xml:lang attribute to the session request; added recoverable binding error conditions.</p> (ip)
    </div><h4>Version 0.5 (2004-05-07)</h4><div class="indent"><p class="" style="">Protocol refactored to enable simultaneous requests (request identifier attribute, wait attribute, hold attribute, requests attribute) and recovery of broken connections; added content attribute; removed all wrapper types except 'terminate'; updated error handling; made key mechanism optional (should use SSL/TLS instead).</p> (ip/psa)
    </div><h4>Version 0.4 (2004-02-23)</h4><div class="indent"><p class="" style="">Fixed typos; removed "resource-constraint" binding error; added HTTP 403 error to table.</p> (psa/ip)
    </div><h4>Version 0.3 (2004-02-19)</h4><div class="indent"><p class="" style="">Added 'authid' attribute to enable communication of XMPP stream ID (used in digest authentication); specified that Content-Types other than "text/xml" are allowed to support older HTTP clients; specified business rule for connection manager queueing of client requests; changed &lt;packet/&gt; to &lt;body/&gt; to support older HTTP clients; changed 'to' attribute on initialization element from MAY to SHOULD; recommended inclusion of unavailable presence in termination element sent from client; described architectural assumptions; specified binding-specific error handling.</p> (psa/ip)
    </div><h4>Version 0.2 (2004-01-13)</h4><div class="indent"><p class="" style="">Added 'to' attribute on the initialization element; specified that 'text/html' is allowable for backwards-compatibility.</p> (dss/psa/ip)
    </div><h4>Version 0.1 (2003-11-06)</h4><div class="indent"><p class="" style="">Initial version.</p> (dss/psa)
    </div></div><hr /><p>END</p></body></html>
