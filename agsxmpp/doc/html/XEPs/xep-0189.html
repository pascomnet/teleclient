<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0189: Public Key Publishing</title><link rel="stylesheet" type="text/css" href="/xmpp.css" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><meta name="DC.Title" content="Public Key Publishing" /><meta name="DC.Creator" content="Ian Paterson" /><meta name="DC.Creator" content="Peter Saint-Andre" /><meta name="DC.Description" content="This document specifies how an entity may publish its public keys over XMPP." /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2007-08-15" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0189" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright (c) 1999 - 2008 by the XMPP Standards Foundation (XSF)." /></head><body><h1>XEP-0189: Public Key Publishing</h1><p>This document specifies how an entity may publish its public keys over XMPP.</p><hr /><p style="color:red">WARNING: This Standards-Track document is Experimental. Publication as an XMPP Extension Protocol does not imply approval of this proposal by the XMPP Standards Foundation. Implementation of the protocol described herein is encouraged in exploratory implementations, but production systems should not deploy implementations of this protocol until it advances to a status of Draft.</p><hr /><h2>Document Information</h2><p class="indent">
            Series: <a href="http://www.xmpp.org/extensions/">XEP</a><br />
            Number: 0189<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status: 
            <a href="http://www.xmpp.org/extensions/xep-0001.html#states-Experimental">Experimental</a><br />
            Type:
            <a href="http://www.xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br />
            Version: 0.6<br />
            Last Updated: 2007-08-15<br />
                Approving Body: <a href="http://www.xmpp.org/council/">XMPP Council</a><br />Dependencies: XMPP Core, XEP-0060, XEP-0163, W3C XML Signature<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: NOT YET ASSIGNED<br />
              Wiki Page: &lt;<a href="http://wiki.jabber.org/index.php/Public Key Publishing (XEP-0189)">http://wiki.jabber.org/index.php/Public Key Publishing (XEP-0189)</a>&gt;
            </p><hr /><h2>Author Information</h2><div class="indent"><h3>Ian Paterson</h3><p class="indent">
        Email:
        <a href="mailto:ian.paterson@clientside.co.uk">ian.paterson@clientside.co.uk</a><br />
        JabberID: 
        <a href="xmpp:ian@zoofy.com">ian@zoofy.com</a><br /></p><h3>Peter Saint-Andre</h3><p class="indent">
        JabberID: 
        <a href="xmpp:stpeter@jabber.org">stpeter@jabber.org</a><br />
        URI: 
        <a href="https://stpeter.im/">https://stpeter.im/</a><br /></p></div><hr /><h2>Legal Notices</h2><div class="indent"><h3>Copyright</h3>This XMPP Extension Protocol is copyright (c) 1999 - 2008 by the XMPP Standards Foundation (XSF).<h3>Permissions</h3>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h3>Disclaimer of Warranty</h3><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. In no event shall the XMPP Standards Foundation or the authors of this Specification be liable for any claim, damages, or other liability, whether in an action of contract, tort, or otherwise, arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification. ##</span><h3>Limitation of Liability</h3>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising out of the use or inability to use the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h3>IPR Conformance</h3>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which may be found at &lt;<a href="http://www.xmpp.org/extensions/ipr-policy.shtml">http://www.xmpp.org/extensions/ipr-policy.shtml</a>&gt; or obtained by writing to XSF, P.O. Box 1641, Denver, CO 80201 USA).</div><hr /><h2>Discussion Venue</h2><p class="indent">The preferred venue for discussion of this document is the Standards discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">http://mail.jabber.org/mailman/listinfo/standards</a>&gt;.</p><p class="indent">Errata may be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><h2>Relation to XMPP</h2><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><h2>Conformance Terms</h2><p class="indent">The following keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#intro">Introduction</a><br />2.  <a href="#usecases-pub">Public Key Publication via PEP</a><br />   
      2.1.  <a href="#usecases-pub-create">Creating the Node</a><br />   
      2.2.  <a href="#usecases-pub-publish">Publishing a Key</a><br />3.  <a href="#usecases-retrieve">Public Key Retrieval via PEP</a><br />4.  <a href="#usecases-request">Requesting Public Keys Directly From Another Entity</a><br />5.  <a href="#usecases-third">Requesting Public Keys Directly From a Third Party</a><br />6.  <a href="#usecases-send">Sending Public Keys Directly To Another Entity</a><br />7.  <a href="#security">Security Considerations</a><br />8.  <a href="#iana">IANA Considerations</a><br />9.  <a href="#registrar">XMPP Registrar Considerations</a><br />   
      9.1.  <a href="#ns">Protocol Namespaces</a><br />10.  <a href="#schema">XML Schema</a><br /><a href="#notes">Notes</a><br /><a href="#revs">Revision History</a></p></div><hr /><h2>1.
       <a name="intro" id="intro">Introduction</a></h2>
  <p class="" style="">This document defines different methods an entity MAY use for publishing its long-term public keys:</p>
  <ul class="" style="">
    <li class="" style="">Publishing public keys to a set of subscribers.</li>
    <li class="" style="">Querying another entity for its public keys.</li>
  </ul>
  <p class="" style="">An entity MAY have multiple public keys with different formats, signatures, algorithms, strengths and expiry dates. Each client used by a user may use different keys.</p>
<h2>2.
       <a name="usecases-pub" id="usecases-pub">Public Key Publication via PEP</a></h2>
  <p class="" style="">An entity SHOULD use <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0163.html">Personal Eventing via Pubsub</a></span>  [<a href="#nt-id2251303">1</a>] to publish its long-term public keys via its own server. Processes for doing so are described in the following sections.</p>
  <div class="indent"><h3>2.1 <a name="usecases-pub-create" id="usecases-pub-create">Creating the Node</a></h3>
    <p class="" style="">If the pubkeys PEP node does not exist already then the entity must create it. The node MUST have a NodeID of "http://www.xmpp.org/extensions/xep-0189.html#ns" (see <a href="#ns">Protocol Namespaces</a> regarding issuance of one or more permanent namespaces).</p>
    <p class="" style="">The node SHOULD be configured as follows (see also <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0222.html">Persisting Objects via Pubsub</a></span>  [<a href="#nt-id2251362">2</a>]):</p>
    <ul class="" style="">
      <li class="" style="">Items published to the node are persistent (this is done by setting the "persistent-items" option to true).</li>
      <li class="" style="">Keys will be pushed to subscribers only when new keys are published, not when subscribers become newly available or when a new subscription is created (this is done by setting the "send_last_published_item" option to "never").</li>
    </ul> 
    <p class="" style="">If the user wants to control access to his/her identity (see <a href="#security">Security Considerations</a>) then the node access model SHOULD be something other than "Open" (this can be done by setting the "access_model" option to a value of "authorize", "presence", "roster", or "whitelist").</p>
    <p class="caption"><a name="example-1" id="example-1"></a>Example 1. Entity Creates Node</p><div class="indent"><pre>
&lt;iq type='set'
    from='juliet@capulet.com/balcony'
    to='pubsub.shakespeare.lit'
    id='create1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;create node='http://www.xmpp.org/extensions/xep-0189.html#ns'/&gt;
    &lt;configure&gt;
      &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#persist_items'&gt;
          &lt;value&gt;1&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#send_last_published_item'&gt;
          &lt;value&gt;never&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#access_model'&gt;
          &lt;value&gt;roster&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#roster_groups_allowed'&gt;
          &lt;value&gt;friends&lt;/value&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/configure&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">Alternatively, if the entity's pubsub service supports both the "auto-create" and "publish-options" features, then the entity MAY create the node by publishing a key and in the first publish including a &lt;publish-options/&gt; element. However, note that not all pubsub services support this feature, since it is optional in <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0060.html">Publish-Subscribe</a></span>  [<a href="#nt-id2251466">3</a>].</p>
    <p class="caption"><a name="example-2" id="example-2"></a>Example 2. Entity Auto-Creates Node and Publishes an RSA Key</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.com/balcony' type='set' id='pub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='http://www.xmpp.org/extensions/xep-0189.html#ns'&gt;
      &lt;item id='julietRSAkey1hash'&gt;
        &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
          &lt;KeyName&gt;julietRSAkey1hash&lt;/KeyName&gt;
          &lt;KeyValue&gt;
            &lt;RSAKeyValue&gt;
              &lt;Modulus&gt;...&lt;/Modulus&gt;
              &lt;Exponent&gt;AQAB&lt;/Exponent&gt;
            &lt;/RSAKeyValue&gt;
          &lt;/KeyValue&gt;
        &lt;/KeyInfo&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
    &lt;configure&gt;
      &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#persist_items'&gt;
          &lt;value&gt;1&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#send_last_published_item'&gt;
          &lt;value&gt;never&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#access_model'&gt;
          &lt;value&gt;roster&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#roster_groups_allowed'&gt;
          &lt;value&gt;friends&lt;/value&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/configure&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
  </div>
  <div class="indent"><h3>2.2 <a name="usecases-pub-publish" id="usecases-pub-publish">Publishing a Key</a></h3>
    <p class="" style="">The entity publishes a key by sending a pubsub publish request to the pubsub service. A previously published key can be updated by re-publishing the key using the same ItemID.</p>
    <p class="" style="">Each public key MUST be wrapped in a &lt;KeyInfo/&gt; element qualified by the 'http://www.w3.org/2000/09/xmldsig#' namespace as specified in <span class="ref" style=""><a href="http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/">XML Signature</a></span>  [<a href="#nt-id2251582">4</a>]. Each &lt;KeyInfo/&gt; element published using PEP MUST contain a &lt;KeyName/&gt; element with a name that is unique for the user; this enables the key to be referenced by other XMPP Extension Protocols (for example, <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0136.html">Message Archiving</a></span>  [<a href="#nt-id2251556">5</a>]). The name MAY be the same as the value of the ItemID. However, if two &lt;KeyInfo/&gt; elements contain the same public key in different formats (for example, an X.509 certificate may contain an RSA key), then the name of the two keys SHOULD be the same.</p>
    <p class="" style="">Before computing the fingerprint or publishing the key, all character data <span class="em">between</span> all elements in the &lt;KeyInfo/&gt; element MUST be removed and the XML MUST be converted to canonical form according to <span class="ref" style=""><a href="http://www.w3.org/TR/xml-c14n">Canonical XML</a></span>  [<a href="#nt-id2261084">6</a>]. (Any whitespace or other character data shown in the examples herein is included only for the purpose of readability.)</p>
    <p class="" style="">The value of the ItemID SHOULD be set to the fingerprint of the public key, e.g., the SHA256 hash (see <span class="ref" style=""><a href="http://csrc.nist.gov/publications/fips/fips180-2/fips180-2withchangenotice.pdf">SHA</a></span>  [<a href="#nt-id2261117">7</a>]) of the key's normalized  &lt;KeyValue/&gt;, &lt;PGPData/&gt; or &lt;X509Data/&gt; element. Therefore subscribers or other interested entities are able to request a single key by specifying its fingerprint (for example, when a subscriber is using the <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0116.html">Encrypted Session Negotiation</a></span>  [<a href="#nt-id2261151">8</a>] protocol).</p>
    <p class="caption"><a name="example-3" id="example-3"></a>Example 3. Entity Publishes a DSA Key to its Server</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.com/balcony' type='set' id='pub2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='http://www.xmpp.org/extensions/xep-0189.html#ns'&gt;
      &lt;item id='julietDSAkey1hash'&gt;
        &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
          &lt;KeyName&gt;julietDSAkey1hash&lt;/KeyName&gt;
          &lt;KeyValue&gt;
            &lt;DSAKeyValue&gt;
              &lt;P&gt;...&lt;/P&gt;
              &lt;Q&gt;...&lt;/Q&gt;
              &lt;G&gt;...&lt;/G&gt;
              &lt;Y&gt;...&lt;/Y&gt;
            &lt;/DSAKeyValue&gt;
          &lt;/KeyValue&gt;
        &lt;/KeyInfo&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption"><a name="example-4" id="example-4"></a>Example 4. Entity Publishes an X.509 Certificate to its Server</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.com/balcony' type='set' id='pub3'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='http://www.xmpp.org/extensions/xep-0189.html#ns'&gt;
      &lt;item id='julietX509cert1hash'&gt;
        &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
          &lt;KeyName&gt;julietX509cert1hash&lt;/KeyName&gt;
          &lt;X509Data&gt;
            &lt;X509IssuerSerial&gt;
              &lt;X509IssuerName&gt;CN=TAMURA Kent, OU=TRL, O=IBM, L=Yamato-shi, ST=Kanagawa, C=JP&lt;/X509IssuerName&gt;
              &lt;X509SerialNumber&gt;12345678&lt;/X509SerialNumber&gt;
            &lt;/X509IssuerSerial&gt;
            &lt;X509SKI&gt;31d97bd7&lt;/X509SKI&gt;
            &lt;X509SubjectName&gt;Subject of Certificate B&lt;/X509SubjectName&gt;
            &lt;X509Certificate&gt;...&lt;/X509Certificate&gt;
            &lt;X509Certificate&gt;...&lt;/X509Certificate&gt;
            &lt;X509Certificate&gt;...&lt;/X509Certificate&gt;
          &lt;/X509Data&gt;
        &lt;/KeyInfo&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="caption"><a name="example-5" id="example-5"></a>Example 5. Entity Publishes a PGP Key to its Server</p><div class="indent"><pre>
&lt;iq from='juliet@capulet.com/balcony' type='set' id='pub4'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='http://www.xmpp.org/extensions/xep-0189.html#ns'&gt;
      &lt;item id='julietPGPkey1hash'&gt;
        &lt;KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#"&gt;
          &lt;KeyName&gt;julietPGPkey1hash&lt;/KeyName&gt;
          &lt;PGPData&gt;
            &lt;PGPKeyId&gt;...&lt;/PGPKeyId&gt;
            &lt;PGPKeyPacket&gt;...&lt;/PGPKeyPacket&gt;
          &lt;/PGPData&gt;
        &lt;/KeyInfo&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
    </pre></div>
    <p class="" style="">After the account owner publishes the key, the pubsub service shall a notification to each subscriber or otherwise authorized and interested entity.</p>
    <p class="caption"><a name="example-6" id="example-6"></a>Example 6. Pubsub Service Sends Notification with Key</p><div class="indent"><pre>
&lt;message to='romeo@montague.net/garden' from='juliet@capulet.com' type='headline'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='http://www.xmpp.org/extensions/xep-0189.html#ns'&gt;
      &lt;item id='julietRSAkey1hash'&gt;
        &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
          &lt;KeyName&gt;julietRSAkey1hash&lt;/KeyName&gt;
          &lt;KeyValue&gt;
            &lt;RSAKeyValue&gt;
              &lt;Modulus&gt;...&lt;/Modulus&gt;
              &lt;Exponent&gt;AQAB&lt;/Exponent&gt;
            &lt;/RSAKeyValue&gt;
          &lt;/KeyValue&gt;
        &lt;/KeyInfo&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
  &lt;addresses xmlns='http://jabber.org/protocol/address'&gt;
    &lt;address type='replyto' jid='juliet@capulet.com/balcony'/&gt;
  &lt;/addresses&gt;
&lt;/message&gt;
    </pre></div>
    <p class="" style="">Note: The stanza containing the event notification (see example above) MAY also include 'replyto' data (as specified by the <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0033.html">Extended Stanza Addressing</a></span>  [<a href="#nt-id2261270">9</a>] protocol) to provide an explicit association between the published data and the <span class="em">resource</span> that published it.</p>
  </div>
<h2>3.
       <a name="usecases-retrieve" id="usecases-retrieve">Public Key Retrieval via PEP</a></h2>
  <p class="caption"><a name="example-7" id="example-7"></a>Example 7. Subscriber Requests Keys from Account</p><div class="indent"><pre>
&lt;iq type='get'
    to='juliet@capulet.com'
    from='romeo@montague.net/garden'
    id='items1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='http://www.xmpp.org/extensions/xep-0189.html#ns'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption"><a name="example-8" id="example-8"></a>Example 8. Entity's Server Returns Keys to Subscriber</p><div class="indent"><pre>
&lt;iq type='result'
    to='romeo@montague.net/garden'
    from='juliet@capulet.com'
    id='items1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='http://www.xmpp.org/extensions/xep-0189.html#ns'&gt;
      &lt;item id='julietRSAkey1hash'&gt;
        &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
          &lt;KeyName&gt;julietRSAkey1hash&lt;/KeyName&gt;
          ...
        &lt;/KeyInfo&gt;
      &lt;/item&gt;
      &lt;item id='julietDSAkey1hash'&gt;
        &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
          &lt;KeyName&gt;julietDSAkey1hash&lt;/KeyName&gt;
          ...
        &lt;/KeyInfo&gt;
      &lt;/item&gt;
      &lt;item id='julietX509cert1hash'&gt;
        &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
          &lt;KeyName&gt;julietX509cert1hash&lt;/KeyName&gt;
          ...
        &lt;/KeyInfo&gt;
      &lt;/item&gt;
      &lt;item id='julietPGPkey1hash'&gt;
        &lt;KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#"&gt;
          &lt;KeyName&gt;julietPGPkey1hash&lt;/KeyName&gt;
          ...
        &lt;/KeyInfo&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption"><a name="example-9" id="example-9"></a>Example 9. Subscriber Requests Specific Key</p><div class="indent"><pre>
&lt;iq type='get'
    to='juliet@capulet.com'
    from='romeo@montague.net/garden'
    id='items2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='http://www.xmpp.org/extensions/xep-0189.html#ns'&gt;
      &lt;item id='julietRSAkey1hash'/&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption"><a name="example-10" id="example-10"></a>Example 10. Entity's Server Returns Key to Subscriber</p><div class="indent"><pre>
&lt;iq type='result'
    to='romeo@montague.net/garden'
    from='juliet@capulet.com'
    id='items2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='http://www.xmpp.org/extensions/xep-0189.html#ns'&gt;
      &lt;item id='julietRSAkey1hash'&gt;
        &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
          &lt;KeyName&gt;julietRSAkey1hash&lt;/KeyName&gt;
          &lt;KeyValue&gt;
            &lt;RSAKeyValue&gt;
              &lt;Modulus&gt;...&lt;/Modulus&gt;
              &lt;Exponent&gt;AQAB&lt;/Exponent&gt;
            &lt;/RSAKeyValue&gt;
          &lt;/KeyValue&gt;
        &lt;/KeyInfo&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
  </pre></div>
<h2>4.
       <a name="usecases-request" id="usecases-request">Requesting Public Keys Directly From Another Entity</a></h2>
  <p class="" style="">If an entity wishes to request the public keys of another entity and it cannot access the keys via <span class="ref">Personal Eventing via Pubsub</span>, then the entity MAY send an &lt;iq/&gt; of type 'get' to the other entity, containing an empty &lt;pubkeys/&gt; element qualified by the 'http://www.xmpp.org/extensions/xep-0189.html#ns' namespace (see <a href="#ns">Protocol Namespaces</a> regarding issuance of one or more permanent namespaces).</p>
  <p class="caption"><a name="example-11" id="example-11"></a>Example 11. Public keys request</p><div class="indent"><pre>
&lt;iq type='get'
    id='keys1'
    to='juliet@capulet.com/balcony'
    from='romeo@montague.net/garden'&gt;
  &lt;pubkeys xmlns='http://www.xmpp.org/extensions/xep-0189.html#ns'/&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">The other entity MUST make a careful access control decision before returning only those public keys for which it holds the corresponding private key (not necessarily the full list of keys being published via <span class="ref">Personal Eventing via Pubsub</span>):</p>
  <p class="caption"><a name="example-12" id="example-12"></a>Example 12. Successful public keys response</p><div class="indent"><pre>
&lt;iq type='result'
    id='keys1'
    to='romeo@montague.net/garden'
    from='juliet@capulet.com/balcony'&gt;
  &lt;pubkeys xmlns='http://www.xmpp.org/extensions/xep-0189.html#ns'&gt;
    &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
      ...
    &lt;/KeyInfo&gt;
    &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
      ...
    &lt;/KeyInfo&gt;
    &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
      ...
    &lt;/KeyInfo&gt;
    &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
      ...
    &lt;/KeyInfo&gt;
  &lt;/pubkeys&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">If the receiving entity decides not to return the public keys, it MUST return an IQ error, which SHOULD be &lt;service-unavailable/&gt; (to avoid divulging presence to unauthorized entities), but MAY be some other appropriate error, such as &lt;forbidden/&gt; or &lt;not-allowed/&gt;:</p>
  <p class="caption"><a name="example-13" id="example-13"></a>Example 13. Access to public keys denied</p><div class="indent"><pre>
&lt;iq type='error'
    id='keys1'
    to='romeo@montague.net/garden'
    from='juliet@capulet.com/balcony'&gt;
  &lt;pubkeys xmlns='http://www.xmpp.org/extensions/xep-0189.html#ns'/&gt;
  &lt;error code='503' type='cancel'&gt;
    &lt;service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="" style="">An entity MAY request one or more specific public keys by specifying their fingerprints (see <a href="#usecases-pub">Public Key Publication via PEP</a>) as the content of &lt;fprint/&gt; child elements:</p>
  <p class="caption"><a name="example-14" id="example-14"></a>Example 14. Specific public keys request</p><div class="indent"><pre>
&lt;iq type='get'
    id='keys2'
    to='juliet@capulet.com/balcony'
    from='romeo@montague.net/garden'&gt;
  &lt;pubkeys xmlns='http://www.xmpp.org/extensions/xep-0189.html#ns'&gt;
    &lt;fprint&gt;julietRSAkey1hash&lt;/fprint&gt;
    &lt;fprint&gt;julietRSAkey2hash&lt;/fprint&gt;
  &lt;/pubkeys&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption"><a name="example-15" id="example-15"></a>Example 15. Successful specific public keys response</p><div class="indent"><pre>
&lt;iq type='result'
    id='keys2'
    to='romeo@montague.net/garden'
    from='juliet@capulet.com/balcony'&gt;
  &lt;pubkeys xmlns='http://www.xmpp.org/extensions/xep-0189.html#ns'&gt;
    &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
      ...
    &lt;/KeyInfo&gt;
    &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
      ...
    &lt;/KeyInfo&gt;
  &lt;/pubkeys&gt;
&lt;/iq&gt;
  </pre></div>
<h2>5.
       <a name="usecases-third" id="usecases-third">Requesting Public Keys Directly From a Third Party</a></h2>
  <p class="" style="">An entity may request the public keys of another entity from a third party using the 'jid' attribute of the &lt;pubkeys/&gt; element to specify the JID that the keys belong to:</p>
  <p class="caption"><a name="example-16" id="example-16"></a>Example 16. Requesting public keys from a third-party</p><div class="indent"><pre>
&lt;iq type='get'
    id='keys3'
    to='juliet@capulet.com/balcony'
    from='romeo@montague.net/garden'&gt;
  &lt;pubkeys xmlns='http://www.xmpp.org/extensions/xep-0189.html#ns' jid='benvolio@capulet.com'/&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption"><a name="example-17" id="example-17"></a>Example 17. Third-party responds with public keys</p><div class="indent"><pre>
&lt;iq type='result'
    id='keys3'
    to='romeo@montague.net/garden'
    from='juliet@capulet.com/balcony'&gt;
  &lt;pubkeys xmlns='http://www.xmpp.org/extensions/xep-0189.html#ns' jid='benvolio@capulet.com'&gt;
    &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
      ...
    &lt;/KeyInfo&gt;
    &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
      ...
    &lt;/KeyInfo&gt;
  &lt;/pubkeys&gt;
&lt;/iq&gt;
  </pre></div>
  <p class="caption"><a name="example-18" id="example-18"></a>Example 18. Third party has no copies of the keys</p><div class="indent"><pre>
&lt;iq type='error'
    id='keys3'
    to='romeo@montague.net/garden'
    from='juliet@capulet.com/balcony'&gt;
  &lt;pubkeys xmlns='http://www.xmpp.org/extensions/xep-0189.html#ns' jid='benvolio@capulet.com'/&gt;
  &lt;error code='404' type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
  </pre></div>
<h2>6.
       <a name="usecases-send" id="usecases-send">Sending Public Keys Directly To Another Entity</a></h2>
  <p class="" style="">If an entity wishes to send public keys to another entity then it MAY include them in a &lt;message/&gt; stanza. The entity MAY use the 'jid' attribute of the &lt;pubkeys/&gt; element to specify the JID that the keys belong to. If no 'jid' attribute is specified then the other entity SHOULD assume the keys belong to the sender of the stanza.</p>
  <p class="caption"><a name="example-19" id="example-19"></a>Example 19. Sending public keys</p><div class="indent"><pre>
&lt;message to='romeo@montague.net/garden'
         from='juliet@capulet.com/balcony'&gt;
  &lt;pubkeys xmlns='http://www.xmpp.org/extensions/xep-0189.html#ns' jid='benvolio@capulet.com'&gt;
    &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
      &lt;KeyValue&gt;
        &lt;RSAKeyValue&gt;
          &lt;Modulus&gt;...&lt;/Modulus&gt;
          &lt;Exponent&gt;AQAB&lt;/Exponent&gt;
        &lt;/RSAKeyValue&gt;
      &lt;/KeyValue&gt;
    &lt;/KeyInfo&gt;
    &lt;KeyInfo xmlns='http://www.w3.org/2000/09/xmldsig#'&gt;
      &lt;KeyValue&gt;
        &lt;RSAKeyValue&gt;
          &lt;Modulus&gt;...&lt;/Modulus&gt;
          &lt;Exponent&gt;AQAB&lt;/Exponent&gt;
        &lt;/RSAKeyValue&gt;
      &lt;/KeyValue&gt;
    &lt;/KeyInfo&gt;
  &lt;/pubkeys&gt;
&lt;/message&gt;
  </pre></div>
<h2>7.
       <a name="security" id="security">Security Considerations</a></h2>
  <p class="" style="">The reliable association between a user or entity and its public keys is beyond the scope of this document. However, each client SHOULD maintain its own secure library of the public keys (or the "fingerprints" of the keys) it associates with other users (not necessarily JIDs).</p>
  <p class="" style="">Whenever public keys are published an identity is typically associated with a JID. Although the public keys are public information, it may be critically important for the user of the JID to keep his identity secret from all but a few specified people. Implementors MUST take great care to ensure that the identity of the user of a JID is never divulged to anyone except the entities who have been permitted by the user to access the public key.</p>
<h2>8.
       <a name="iana" id="iana">IANA Considerations</a></h2>
  <p class="" style="">This document requires no interaction with the <span class="ref" style=""><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-id2251173">10</a>].</p>
<h2>9.
       <a name="registrar" id="registrar">XMPP Registrar Considerations</a></h2>
  <div class="indent"><h3>9.1 <a name="ns" id="ns">Protocol Namespaces</a></h3>
    <p class="" style="">Until this specification advances to a status of Draft, its associated namespace shall be "http://www.xmpp.org/extensions/xep-0189.html#ns"; upon advancement of this specification, the <span class="ref" style=""><a href="http://www.xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-id2251128">11</a>] shall issue a permanent namespace in accordance with the process defined in Section 4 of <span class="ref" style=""><a href="http://www.xmpp.org/extensions/xep-0053.html">XMPP Registrar Function</a></span>  [<a href="#nt-id2261586">12</a>].</p>
  </div>
<h2>10.
       <a name="schema" id="schema">XML Schema</a></h2>
  <p class="caption"></p><div class="indent"><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://www.xmpp.org/extensions/xep-0189.html#ns'
    xmlns='http://www.xmpp.org/extensions/xep-0189.html#ns'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='pubkeys'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
        &lt;xs:element name='fprint' type='xs:string'/&gt;
        &lt;xs:any processContents='lax' namespace='##any'/&gt;
      &lt;/xs:choice&gt;
      &lt;xs:attribute name='jid' type='xs:string' use='optional'/&gt;
      &lt;xs:anyAttribute namespace='##any' processContents='lax'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

&lt;/xs:schema&gt;
  </pre></div>
<hr /><h2><a name="notes" id="notes"></a>Notes</h2><div class="indent"><p><a name="nt-id2251303" id="nt-id2251303">1</a>. XEP-0163: Personal Eventing via Pubsub &lt;<a href="http://www.xmpp.org/extensions/xep-0163.html">http://www.xmpp.org/extensions/xep-0163.html</a>&gt;.</p><p><a name="nt-id2251362" id="nt-id2251362">2</a>. XEP-0222: Persisting Objects via Pubsub &lt;<a href="http://www.xmpp.org/extensions/xep-0222.html">http://www.xmpp.org/extensions/xep-0222.html</a>&gt;.</p><p><a name="nt-id2251466" id="nt-id2251466">3</a>. XEP-0060: Publish-Subscribe &lt;<a href="http://www.xmpp.org/extensions/xep-0060.html">http://www.xmpp.org/extensions/xep-0060.html</a>&gt;.</p><p><a name="nt-id2251582" id="nt-id2251582">4</a>. XML Signature Syntax and Processing &lt;<a href="http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/">http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/</a>&gt;.</p><p><a name="nt-id2251556" id="nt-id2251556">5</a>. XEP-0136: Message Archiving &lt;<a href="http://www.xmpp.org/extensions/xep-0136.html">http://www.xmpp.org/extensions/xep-0136.html</a>&gt;.</p><p><a name="nt-id2261084" id="nt-id2261084">6</a>. Canonical XML 1.0 &lt;<a href="http://www.w3.org/TR/xml-c14n">http://www.w3.org/TR/xml-c14n</a>&gt;.</p><p><a name="nt-id2261117" id="nt-id2261117">7</a>. Secure Hash Standard: Federal Information Processing Standards Publication 180-2  &lt;<a href="http://csrc.nist.gov/publications/fips/fips180-2/fips180-2withchangenotice.pdf">http://csrc.nist.gov/publications/fips/fips180-2/fips186-2withchangenotice.pdf</a>&gt;.</p><p><a name="nt-id2261151" id="nt-id2261151">8</a>. XEP-0116: Encrypted Session Negotiation &lt;<a href="http://www.xmpp.org/extensions/xep-0116.html">http://www.xmpp.org/extensions/xep-0116.html</a>&gt;.</p><p><a name="nt-id2261270" id="nt-id2261270">9</a>. XEP-0033: Extended Stanza Addressing &lt;<a href="http://www.xmpp.org/extensions/xep-0033.html">http://www.xmpp.org/extensions/xep-0033.html</a>&gt;.</p><p><a name="nt-id2251173" id="nt-id2251173">10</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p><p><a name="nt-id2251128" id="nt-id2251128">11</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="http://www.xmpp.org/registrar/">http://www.xmpp.org/registrar/</a>&gt;.</p><p><a name="nt-id2261586" id="nt-id2261586">12</a>. XEP-0053: XMPP Registrar Function &lt;<a href="http://www.xmpp.org/extensions/xep-0053.html">http://www.xmpp.org/extensions/xep-0053.html</a>&gt;.</p></div><hr /><h2><a name="revs" id="revs"></a>Revision History</h2><div class="indent"><h4>Version 0.6 (2007-08-15)</h4><div class="indent"><p class="" style="">More clearly explained node creation and key publication workflows.</p> (psa)
    </div><h4>Version 0.5 (2007-03-05)</h4><div class="indent"><p class="" style="">Merged node creation and first publish examples; recommended the value of each &lt;KeyName/&gt; element and id attribute is set to the key fingerprint; added fprint element and more examples</p> (ip)
    </div><h4>Version 0.4 (2006-11-27)</h4><div class="indent"><p class="" style="">Added jid attribute and send use case; changed namespace</p> (ip)
    </div><h4>Version 0.3 (2006-11-20)</h4><div class="indent"><p class="" style="">Specified that PEP nodes SHOULD be persistent</p> (ip)
    </div><h4>Version 0.2 (2006-09-29)</h4><div class="indent"><p class="" style="">Replaced pubkey and key elements with the KeyInfo element defined in W3C XML Signature</p> (ip)
    </div><h4>Version 0.1 (2006-07-18)</h4><div class="indent"><p class="" style="">Initial version.</p> (ip)
    </div></div><hr /><p>END</p></body></html>
