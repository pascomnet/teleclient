<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0043: Jabber Database Access</title><link rel="stylesheet" type="text/css" href="/xmpp.css" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><meta name="DC.Title" content="Jabber Database Access" /><meta name="DC.Creator" content="Justin Kirby" /><meta name="DC.Description" content="Expose RDBM systems directly to the jabber network" /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2003-10-20" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0043" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright (c) 1999 - 2008 by the XMPP Standards Foundation (XSF)." /></head><body><h1>XEP-0043: Jabber Database Access</h1><p>Expose RDBM systems directly to the jabber network</p><hr /><p style="color:red">WARNING: This document has been retracted by the author(s). Implementation of the protocol described herein is not recommended. Developers desiring similar functionality should implement the protocol that supersedes this one (if any).</p><hr /><h2>Document Information</h2><p class="indent">
            Series: <a href="http://www.xmpp.org/extensions/">XEP</a><br />
            Number: 0043<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status: 
            <a href="http://www.xmpp.org/extensions/xep-0001.html#states-Retracted">Retracted</a><br />
            Type:
            <a href="http://www.xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br />
            Version: 0.2<br />
            Last Updated: 2003-10-20<br />
                Approving Body: <a href="http://www.xmpp.org/council/">XMPP Council</a><br />
                Dependencies: None<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: <br />
              Wiki Page: &lt;<a href="http://wiki.jabber.org/index.php/Jabber Database Access (XEP-0043)">http://wiki.jabber.org/index.php/Jabber Database Access (XEP-0043)</a>&gt;
            </p><hr /><h2>Author Information</h2><div class="indent"><h3>Justin Kirby</h3><p class="indent">
        Email:
        <a href="mailto:justin@openaether.org">justin@openaether.org</a><br />
        JabberID: 
        <a href="xmpp:zion@openaether.org">zion@openaether.org</a><br /></p></div><hr /><h2>Legal Notices</h2><div class="indent"><h3>Copyright</h3>This XMPP Extension Protocol is copyright (c) 1999 - 2008 by the XMPP Standards Foundation (XSF).<h3>Permissions</h3>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h3>Disclaimer of Warranty</h3><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. In no event shall the XMPP Standards Foundation or the authors of this Specification be liable for any claim, damages, or other liability, whether in an action of contract, tort, or otherwise, arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification. ##</span><h3>Limitation of Liability</h3>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising out of the use or inability to use the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h3>IPR Conformance</h3>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which may be found at &lt;<a href="http://www.xmpp.org/extensions/ipr-policy.shtml">http://www.xmpp.org/extensions/ipr-policy.shtml</a>&gt; or obtained by writing to XSF, P.O. Box 1641, Denver, CO 80201 USA).</div><hr /><h2>Discussion Venue</h2><p class="indent">The preferred venue for discussion of this document is the Standards discussion list: &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">http://mail.jabber.org/mailman/listinfo/standards</a>&gt;.</p><p class="indent">Errata may be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><h2>Relation to XMPP</h2><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><h2>Conformance Terms</h2><p class="indent">The following keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#sect-id2260658">Introduction</a><br />2.  <a href="#sect-id2252853">Prerequisites</a><br />   
      2.1.  <a href="#sect-id2252608">Namespace</a><br />   
      2.2.  <a href="#sect-id2252638">Elements</a><br />   
      2.3.  <a href="#sect-id2251383">Data Types</a><br />   
      2.4.  <a href="#sect-id2251531">Assumed Database Setup</a><br />3.  <a href="#sect-id2251574">Usage</a><br />   
      3.1.  <a href="#sect-id2251580">Requesting Schemas</a><br />   
      3.2.  <a href="#sect-id2251100">Manipulating Data</a><br />      
      3.2.1.  <a href="#sect-id2251119">Selects</a><br />      
      3.2.2.  <a href="#sect-id2261418">Constraining Result Sets</a><br />      
      3.2.3.  <a href="#sect-id2261593">Inserts</a><br />      
      3.2.4.  <a href="#sect-id2261684">Updates</a><br />      
      3.2.5.  <a href="#sect-id2261751">Deletes</a><br />   
      3.3.  <a href="#sect-id2261817">Procedures</a><br />   
      3.4.  <a href="#sect-id2261890">Errors</a><br />   
      3.5.  <a href="#sect-id2262117">Optional Features</a><br />      
      3.5.1.  <a href="#sect-id2262142">Embedded SQL</a><br />      
      3.5.2.  <a href="#sect-id2262245">Version Negotiation</a><br />4.  <a href="#sect-id2262409">Limitations</a><br />5.  <a href="#sect-id2262464">Todos</a><br />6.  <a href="#sect-id2262497">Thanks</a><br />7.  <a href="#sect-id2262515">DTD and Schema</a><br />   
      7.1.  <a href="#sect-id2262522">DTD</a><br />   
      7.2.  <a href="#sect-id2262552">Schema</a><br /><a href="#notes">Notes</a><br /><a href="#revs">Revision History</a></p></div><hr /><h2>1.
       <a name="sect-id2260658" id="sect-id2260658">Introduction</a></h2>
    <p class="" style="">Accessing a RDBMS in a generic fashion is a complex and difficult
    task. Consequently, this will not be an attempt to XMLize a generic
    Database API or query language. Instead, it will providing a
    simple mechanism for a JID to read/write data that it has access to 
    and specifying a model for those schemas to use in xml.</p>
  
    <p class="" style="">This document has two aims.</p>

    <ol start="" class="" style="">
      <li class="" style="">Be able to request the available schemas</li>
      <li class="" style="">Perform near SQL-like data manipulation</li>
    </ol>
  
    <p class="" style="">Although designed for use with an RDBMS this document is not
    restricted to such uses. It may be used with any data storage 
    system that can be broken down to a simple table, column/row 
    format. for example comma delimited files.</p>
  <h2>2.
       <a name="sect-id2252853" id="sect-id2252853">Prerequisites</a></h2>
    <p class="" style="">To understand the following sections of this document the reader
    must be aware of the following.</p>

    <div class="indent"><h3>2.1 <a name="sect-id2252608" id="sect-id2252608">Namespace</a></h3>
      <p class="" style="">The current namespace of <a href="">http://openaether.org/projects/jabber_database.html</a> 
      will be used until this becomes a jep. Once officially accepted as
      a jep and approved as final by the council, it will become 
      <a href="">http://www.xmpp.org/extensions/xep-0043.html</a>.</p>
    </div>
    <div class="indent"><h3>2.2 <a name="sect-id2252638" id="sect-id2252638">Elements</a></h3>
      <ul class="" style="">
        <li class="" style="">version - specify the version of the protocol that the client/server supports</li>
        <li class="" style="">database - specify the database/catalog has the following attributes:
          <ul class="" style="">
            <li class="" style="">name - name of the database/catalog</li>
            <li class="" style="">sql - embed native SQL queries directly</li>
            <li class="" style="">table - the element scopes the children into the table. has the following attributes:
              <ul class="" style="">
                <li class="" style="">name - name of the table</li>
                <li class="" style="">permission - what the user can do with the data</li>
                <li class="" style="">col - describes the column. has the following attributes
                  <ul class="" style="">
                    <li class="" style="">name - name of the column</li>
                    <li class="" style="">type - SQL99 datatype of the column</li>
                    <li class="" style="">size - size of the datatype if required</li>
                    <li class="" style="">op - comparison operator, used only if child of where element</li>
                  </ul>
                </li>
                <li class="" style="">where - scopes col elements into a 'sql-like' where clause
                  <ul class="" style="">
                    <li class="" style="">col - see above</li>
                  </ul>
                </li>
              </ul>
            </li>
            <li class="" style="">proc - element scopes the children into a procedure has the following attributes:
              <ul class="" style="">
                <li class="" style="">name - name of the sproc</li>
                <li class="" style="">permission - what the user can do with the data</li>
                <li class="" style="">col - see above</li>
                <li class="" style="">result - indicated return value by running the procedure (restricted to integer)</li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </div>
    <div class="indent"><h3>2.3 <a name="sect-id2251383" id="sect-id2251383">Data Types</a></h3>
      <p class="" style="">There are a limited subset of data types available:</p>
      <ul class="" style="">
        <li class="" style="">bit - a single 'bit', usually used to represent boolean values</li>
        <li class="" style="">tinyint - signed 8bit integer, has a range from   -128  to +127</li>
        <li class="" style="">integer - signed 32bit integer, has a range from -2147483648 to +2147483647</li>
        <li class="" style="">utinyint - unsigned 8bit integer, has a range from 0 to +255</li>
        <li class="" style="">uinteger - usigned 32bit integer, has a range from   0 to +4294967296</li>
        <li class="" style="">float - allowed values are -3.402823466E+38 to
        -1.175494351E-38, 0, and 1.175494351E-38 to 3.402823466E+38 (can NOT be  unsigned)</li>
        <li class="" style="">numeric - unlimited size (some databases constrain this though)</li>
        <li class="" style="">date - resolution is one day. acceptable ranges vary (TODO: constrain minimal range to something)</li>
        <li class="" style="">datetime - a date and time combination (often has range dependencies)</li>
        <li class="" style="">timestamp - a datetime used most often to record events</li>
        <li class="" style="">time - a time in the format HH:MM:SS (TODO: specify valid range)</li>
        <li class="" style="">char - an unsigned byte representing a single character (ASCII)</li>
        <li class="" style="">vchar - a variable width char</li>
        <li class="" style="">text - an extremely large chunk of text</li>
        <li class="" style="">blob - an extremely large chunk of binary data (encode in MIME)</li>
      </ul>
    </div>
    <div class="indent"><h3>2.4 <a name="sect-id2251531" id="sect-id2251531">Assumed Database Setup</a></h3>
      <p class="" style="">All SQL/RDBMS units will be scoped in the xml hierarchy:</p>

      <p class="caption"></p><div class="indent"><pre>
&lt;database&gt;
  &lt;table&gt;
    &lt;col/&gt;
  &lt;/table&gt;
&lt;/database&gt;
      </pre></div>

      <p class="" style="">All examples will assume the existence of the following rdbms setup. A 
      database named 'testdb' with tables created with following SQL
      script:</p>
  
      <p class="caption"></p><div class="indent"><pre>
        create table tbl_one 
        ( 
          a_int int, 
          a_float float, 
          a_char  char(10)  
        )
        create table tbl_two 
        ( 
          a_date datetime, 
      a_numeric numeric(9,3) 
        )
      </pre></div>
    </div>
<h2>3.
       <a name="sect-id2251574" id="sect-id2251574">Usage</a></h2>
  <div class="indent"><h3>3.1 <a name="sect-id2251580" id="sect-id2251580">Requesting Schemas</a></h3>
      <p class="caption"><a name="example-1" id="example-1"></a>Example 1. A simple schema request</p><div class="indent"><pre>
&lt;iq id="001" to="db.host" type="get"&gt;
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
&lt;/iq&gt;
      </pre></div>
  
      <p class="" style="">This is a simple request to discover what tables/procedures
      exist on the database testdb. And what permissions are available 
      to the user. All schema requests will respond within the scope that 
      was asked for. This is to prevent unnecessary data from flooding
      the network. So the response for the above request would look
      something like:</p>                                     
  
      <p class="caption"><a name="example-2" id="example-2"></a>Example 2. Response to a schema request</p><div class="indent"><pre>
&lt;iq id="001" type="result" from="db.host"&gt;
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;table  name="tbl_one" permission="both"/&gt;
      &lt;table  name="tbl_two" permission="read"/&gt;
  &lt;/database&gt;
&lt;/iq&gt;
      </pre></div>
  
      <p class="" style="">The response is scoped to only the 'children' of the request. 
      Since the request was for the testdb database, only the tables 
      within that database were returned in the result. The reason for 
      the limitation is to prevent excessively large packets from filling 
      the network from large schemas.</p>
   
      <p class="" style="">The response indicates that the user has both read and write
      permissions on the table 'tbl_one' and only read permissions on 
      the table 'tbl_two'. Consequently, the user may only perform get 
      requests on 'tbl_two'.</p>
   
      <p class="caption"><a name="example-3" id="example-3"></a>Example 3. Request detailed table schema</p><div class="indent"><pre>
&lt;iq id="002" type="get" to="db.host"&gt; 
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;table  name="tbl_one"/&gt;
  &lt;/database&gt;
&lt;/iq&gt;
      </pre></div>
   
      <p class="" style="">The response would look like:</p>

      <p class="caption"><a name="example-4" id="example-4"></a>Example 4. Response to detailed request</p><div class="indent"><pre>
&lt;iq id="002" type="result" from="db.host"&gt;             
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;table  name="tbl_one"    permission="both"&gt; 
     &lt;col name="a_int" type="int"/&gt;
      &lt;col name="a_float" type="float"/&gt;
      &lt;col name="a_char" type="char" size="10"/&gt;
    &lt;/table&gt;
  &lt;/database&gt;
&lt;/iq&gt; 
      </pre></div>
   
      <p class="" style="">The schema response for tbl_one is quite intuitive. Three
      columns exist, one called a_int of type int (integer), another 
      a_float of type float and  a third called a_char of type char 
      with a size of ten characters.</p>
    

    </div>

    <div class="indent"><h3>3.2 <a name="sect-id2251100" id="sect-id2251100">Manipulating Data</a></h3>
  
      <p class="" style="">Manipulation of data (select, insert, update, delete) will
      definitely not be elegant or easy. SQL allows for some fairly 
      complex queries on any fully  functional RDBMS. Consequently, 
      the data manipulation will be  relatively limited since it is 
      not a goal to translate SQL into xml.</p>
    
      <div class="indent"><h3>3.2.1 <a name="sect-id2251119" id="sect-id2251119">Selects</a></h3>
        <p class="" style="">To indicate a select like query, specify an &lt;iq&gt; of
        type get. The table that the query is to be performed against 
        must be specified. The columns   that are to be returned in 
        the result set must be scoped within  the relative   table. 
        Any attribute on the &lt;col&gt; element besides name will be 
        ignored.  e.g. it is not required nor recommended to specify 
        the data types  or the  sizes while performing a get.</p>
      
        <p class="caption"><a name="example-5" id="example-5"></a>Example 5. Basic select</p><div class="indent"><pre>
&lt;iq id="003" type="get" to="db.host"&gt;
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;table  name="tbl_one"&gt;
      &lt;col name="a_int"/&gt;
      &lt;col name="a_float"/&gt;
      &lt;col name="a_char"/&gt;
    &lt;/table&gt;
  &lt;/database&gt;
&lt;/iq&gt;

      SQL Syntax:
        select a_int, a_float, a_char
        from tbl_one
        </pre></div>
      
       <p class="" style="">It is also possible to specify a limit on the number of rows 
       returned in the result set by specifying a value for the limit 
       attribute.</p>
     
       <p class="caption"><a name="example-6" id="example-6"></a>Example 6. Basic select with limit</p><div class="indent"><pre>
&lt;iq id="003" type="get" to="db.host"&gt;
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;table name="tbl_one"  limit="2"&gt;
      &lt;col name="a_int"/&gt;
      &lt;col name="a_float"/&gt;
      &lt;col name="a_char"/&gt;
      &lt;/table&gt;
  &lt;/database&gt;
&lt;/iq&gt;
       </pre></div>

       <p class="" style="">In this case a limit of two rows will be returned in the result set.</p>
    
       <p class="" style=""> The result set which is returned will contain all the rows
       that met the criteria of the select. There is no schema
       information beyond the column names included in the result set. 
       Each 'row' in the result set is scoped within the corresponding 
       &lt;table&gt; element. This allows for queries on multiple
       tables to be used in one &lt;iq&gt; packet.</p>

       <p class="caption"><a name="example-7" id="example-7"></a>Example 7. Response to basic select</p><div class="indent"><pre>
&lt;iq id="003" type="result" from="db.host"&gt;
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;table  name="tbl_one"&gt;
      &lt;col name="a_int"&gt;1234&lt;/col&gt;
      &lt;col name="a_float"&gt;123.45&lt;/col&gt;
      &lt;col name="a_char"&gt;onetwothre&lt;/col&gt;
    &lt;/table&gt;
    &lt;table  name="tbl_one"&gt;
      &lt;col name="a_int"&gt;2345&lt;/col&gt;
      &lt;col name="a_float"&gt;234.56&lt;/col&gt;
      &lt;col name="a_char"&gt;twothreefo&lt;/col&gt;
    &lt;/table&gt;
  &lt;/database&gt;
&lt;/iq&gt;
       </pre></div>
     </div>

     <div class="indent"><h3>3.2.2 <a name="sect-id2261418" id="sect-id2261418">Constraining Result Sets</a></h3>
       <p class="" style="">It would be impractical to request the entire contents of the 
       table every time you needed one row or a subset of the data. You 
       can constrain the result set by specifying a where clause.</p>

       <p class="caption"><a name="example-8" id="example-8"></a>Example 8. Select with constraints</p><div class="indent"><pre>
&lt;iq id="004" type="get" to="db.host"&gt;
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;table  name="tbl_one"&gt;
      &lt;col name="a_int"/&gt;
      &lt;col name="a_float"/&gt;
      &lt;col name="a_char"/&gt;
      &lt;where&gt;
        &lt;col name="a_int" op="eq"&gt;1234&lt;/col&gt;
        &lt;col name="a_float" op="lt" conj="and"&gt;200.00&lt;/col&gt;
      &lt;/where&gt;
    &lt;/table&gt;
  &lt;/database&gt;
&lt;/iq&gt;

         SQL Syntax:
         select a_int, a_float, a_char from tbl_one
         where   a_int = 1234 and a_float &lt; 200.00
       </pre></div>
      
       <p class="" style="">Attributes only used in the &lt;col&gt; element within a 
       &lt;where&gt; element are the op (for operator) and conj for 
       (conjunction). The op is used for comparison operators such 
       as &lt;, &gt;, =, &lt;&gt;, &lt;=, &gt;=</p>

       <ul class="" style="">
     <li class="" style="">eq - equivalent =</li>
     <li class="" style="">neq - not-equivalent &lt;&gt;</li>
     <li class="" style="">lt - less than &lt;</li>
     <li class="" style="">gt - greater than &gt;</li>
     <li class="" style="">let - less than or equivalent &lt;=</li>
     <li class="" style="">get - greater than or equivalent &gt;=</li>
     <li class="" style="">null - IS NULL (the column is null in  the   database  sense of the word)</li>
       </ul>

      <p class="" style="">The conjuction attribute is used to combined constraints in the where clause</p>

      <ul class="" style="">
        <li class="" style="">not - to negate a result</li>
    <li class="" style="">or - logical OR ||</li>
    <li class="" style="">and - logical AND &amp;&amp;</li>
      </ul>      

      <p class="" style=""><span class="strong">Result</span></p>

      <p class="caption"><a name="example-9" id="example-9"></a>Example 9. Response to select with constraints</p><div class="indent"><pre>
&lt;iq id="003" type="result" to="db.host"&gt;
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;table  name="tbl_one"&gt;
      &lt;col name="a_int"&gt;1234&lt;/col&gt;
      &lt;col name="a_float"&gt;123.45&lt;/col&gt;
      &lt;col name="a_char"&gt;onetwothre&lt;/col&gt;
    &lt;/table&gt;
  &lt;/database&gt;
&lt;/iq&gt;
      </pre></div>
    </div>

    <div class="indent"><h3>3.2.3 <a name="sect-id2261593" id="sect-id2261593">Inserts</a></h3>
      <p class="" style="">Inserting or altering the stored data in anyway requires
      setting the type attribute to a value of set. This indicates 
      that the user wants to perform a 'insert/update'. The
      differentiating factor between an insert and an update operation 
      is whether a &lt;where&gt; element is used. If there is no
&lt;where&gt; element then it must be interpreted as an insert. 
      If a &lt;where&gt; element does exist, then it must be
      interpreted as an update.</p>

      <p class="caption"><a name="example-10" id="example-10"></a>Example 10. Inserting data</p><div class="indent"><pre>
&lt;iq id="004" type="set" to="db.host"&gt;
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;table  name="tbl_one"&gt;
      &lt;col name="a_int"&gt;3456&lt;/col&gt;
      &lt;col name="a_float"&gt;345.67&lt;/col&gt;
      &lt;col name="a_char"&gt;threefour&lt;/col&gt;
    &lt;/table&gt;
    &lt;table  name="tbl_two"&gt;
      &lt;col name="a_date"&gt;02/16/2002&lt;/col&gt;
      &lt;col name="a_numeric"&gt;123456789123.123&lt;/col&gt;
    &lt;/table&gt;
  &lt;/database&gt;
&lt;/iq&gt;

SQL syntax:
insert tbl_one (a_int, a_float,a_char)VALUES(3456,   345.67, 'threefour')
insert tbl_two (a_date, a_numeric) VALUES('02/16/2002', 123456789123.123)
      </pre></div>

      <p class="" style=""><span class="strong">Result</span></p>

      <p class="" style=""> If there is no result set for the query, as in an update,
      insert, delete, then the response must indicate success or 
      failure within the &lt;table&gt; element scope. An empty
&lt;table&gt; element indicates success, and a &lt;table&gt; 
      element containing an &lt;error&gt; element indicates a failure.</p>

      <p class="caption"><a name="example-11" id="example-11"></a>Example 11. Response to data insert</p><div class="indent"><pre>
&lt;iq id="004" type="result" from="db.host"&gt;
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;table name="tbl_one"/&gt;
    &lt;table name="tbl_two"&gt;
      &lt;error code="380"&gt;permission denied on table&lt;/error&gt;
    &lt;/table&gt;
  &lt;/database&gt;
&lt;/iq&gt;
      </pre></div>
      
      <p class="" style=""> The insert into tbl_one succeeded since the response has an 
      empty &lt;table&gt; element. However, the insert into tbl_two 
      failed with a permission denied error. Which is indicated with a 
      non-empty &lt;table&gt; element.</p>
    </div>

    <div class="indent"><h3>3.2.4 <a name="sect-id2261684" id="sect-id2261684">Updates</a></h3>

      <p class="" style=""> As stated previously, if the type attribute has a value of
      set and a &lt;where&gt; element exists, then it must be interpreted as an update.</p>

      <p class="caption"><a name="example-12" id="example-12"></a>Example 12. Updating</p><div class="indent"><pre>
&lt;iq id="005" type="set" to="db.host"&gt;
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;table  name="tbl_one"&gt;
      &lt;col name="a_char"&gt;aaaaaaaaaa&lt;/col&gt;
      &lt;where&gt;
        &lt;col name=c"a_int"&gt;1234&lt;/col&gt;
      &lt;/where&gt;
    &lt;/table&gt;
  &lt;/database&gt;
&lt;/iq&gt;

        SQL Syntax:
    update tbl_one 
    set a_char = 'aaaaaaaaaa'
    where a_int = 1234
      </pre></div>

      <p class="" style=""><span class="strong">Result</span></p>

      <p class="" style=""> Again, if there is no result set returned by the query, then
      success or failure must be indicated.</p>

      <p class="caption"><a name="example-13" id="example-13"></a>Example 13. Response to update</p><div class="indent"><pre>
&lt;iq id="005" type="result" to="db.host"&gt;
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;table name="tbl_one"/&gt;
  &lt;/database&gt;
&lt;/iq&gt;
      </pre></div>
    </div>

    <div class="indent"><h3>3.2.5 <a name="sect-id2261751" id="sect-id2261751">Deletes</a></h3>

    <p class="" style=""> If the type attribute has a value of set and there are no
    &lt;col&gt; elements scoped within the &lt;table&gt; element, 
    then the query must be interpreted as a delete.</p>

    <p class="caption"><a name="example-14" id="example-14"></a>Example 14. Simple delete</p><div class="indent"><pre>
&lt;iq id="006" type="set"  to="db.host"&gt;
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;table name="tbl_one"&gt;
      &lt;where&gt;
        &lt;col name="a_int" op="eq"&gt;1234&lt;/col&gt;
      &lt;/where&gt;
    &lt;/table&gt;
    &lt;/database&gt;
&lt;/iq&gt;

      SQL Syntax:
      delete from tbl_one where a_int = 1234
    </pre></div>

    <p class="" style=""><span class="strong">Result</span></p>
    
    <p class="" style="">Again, if a result set is not generated by a query, then
    success or failure must be indicated by the &lt;table&gt; element</p>

    <p class="caption"><a name="example-15" id="example-15"></a>Example 15. Response to delete</p><div class="indent"><pre>
&lt;iq id="006" type="result"    to="db.host"&gt;
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;table name="tbl_one"/&gt;
  &lt;/database&gt;
&lt;/iq&gt;
    </pre></div>
    </div>
  </div>
  <div class="indent"><h3>3.3 <a name="sect-id2261817" id="sect-id2261817">Procedures</a></h3>

  <p class="" style=""> Procedures, or stored procedures  [<a href="#nt-id2261830">1</a>]  
, are often handy to make frequently used sql queries execute faster. 
  These are simply queries stored in a precompiled form and given a 
  name with a list of parameters. Each RDBMS handles procedures 
  differently, but the common characteristics are that they are 
  stored server side and have in/out parameters.</p>

  <p class="" style=""> The &lt;proc&gt; element will be used to indicate a procedure. 
  It has similar characteristics to the &lt;table&gt; element. The 
  core differences are that the &lt;col&gt; elements have permissions 
  and a &lt;result&gt; element can be used to indicate the value 
  returned by the procedure.</p>

  <p class="" style=""> The permission attribute on a &lt;col&gt; element is used to 
  indicate whether the parameter is in (read), out (write) or in/out (both). </p>
  
  <p class="" style=""> The only result set acceptable from a procedure is that of the 
  parameters or &lt;col&gt; element. If the procedure produces a
  result set outside of the parameters this should be ignored.</p>

  </div>
  <div class="indent"><h3>3.4 <a name="sect-id2261890" id="sect-id2261890">Errors</a></h3>

  <p class="" style=""> The server must be able to let the client know when an error 
  occurs, instead of just being silent.</p>
  
  <p class="caption"><a name="table-1" id="table-1"></a>Table 1: Error Codes</p><table border="1" cellpadding="3" cellspacing="0">
    <tr class="body">
      <th colspan="" rowspan="">Code</th>
      <th colspan="" rowspan="">Message</th>
      <th colspan="" rowspan="">Description</th>
    </tr>
    <tr class="body">
      <td colspan="" rowspan="">399</td>
      <td colspan="" rowspan="">Invalid Database Name</td>
      <td colspan="" rowspan="">Returned when the client has requested information from a
      database which does not exist according to the component.</td>
    </tr>
    <tr class="body">
      <td colspan="" rowspan="">398</td>
      <td colspan="" rowspan="">Invalid Table Name</td>
      <td colspan="" rowspan="">Returned when the client has requested information from a 
      table/procedure which does not exist according to the component.</td>
    </tr>
    <tr class="body">
      <td colspan="" rowspan="">397</td>
      <td colspan="" rowspan="">Invalid Column Name</td>
      <td colspan="" rowspan="">Returned when the client has requested information from a 
      column which does not exist according to the component.</td>
    </tr>
    <tr class="body">
      <td colspan="" rowspan="">380</td>
      <td colspan="" rowspan="">Permission Denied on Table</td>
      <td colspan="" rowspan="">Returned when the requested action is not allowed for the 
      user on the table</td>
    </tr>
    <tr class="body">
      <td colspan="" rowspan="">401</td>
      <td colspan="" rowspan="">Access Denied</td>
      <td colspan="" rowspan="">Returned when the user does not have permission to use the 
      component.</td>
    </tr>
  </table>

  <p class="" style="">If the user requests an action on a table which they do not have 
  permission to do the following should be returned</p>
  
  <p class="caption"><a name="example-16" id="example-16"></a>Example 16. Permission denied error</p><div class="indent"><pre>
&lt;iq id="004" type="error" from="db.host"&gt;
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;table name="tbl_two"&gt;
      &lt;error code="380"&gt;permission denied on table&lt;/error&gt;
    &lt;/table&gt;
&lt;/database&gt;
    &lt;/iq&gt;  
  </pre></div>

  <p class="" style="">If the user is not allowed to access the component the following should be returned</p>

  <p class="caption"><a name="example-17" id="example-17"></a>Example 17. General access denied</p><div class="indent"><pre>
&lt;iq id="004" type="error" from="db.host"&gt;
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;error code="401"&gt;Access Denied&lt;/error&gt;
  &lt;/database&gt;
&lt;/iq&gt;
  </pre></div>

  </div>
  <div class="indent"><h3>3.5 <a name="sect-id2262117" id="sect-id2262117">Optional Features</a></h3>
  <p class="" style=""> There are requirements which can be provided by other jabber 
  components/namespaces, namely the jabber:iq:browse namespace 
  in-place of Version Negotiation. Due to the inherent limitations 
  of the above data retrieval mechanisms more sophisticated querying 
  techniques might be desired. The &lt;query&gt; element will extend 
  the functionality </p>

  <div class="indent"><h3>3.5.1 <a name="sect-id2262142" id="sect-id2262142">Embedded SQL</a></h3>
    <p class="" style=""> The abilities described in the Basics section are just that, 
    basic. To provide more flexibility and allow for the full power 
    of SQL without xmlifying everything, a &lt;sql&gt; element may 
    be implemented to provide this feature.</p>
    
    <p class="" style=""> The &lt;sql&gt; element must be scoped within the &lt;database&gt; element.</p>

    <p class="caption"><a name="example-18" id="example-18"></a>Example 18. Embedded sql query</p><div class="indent"><pre>
&lt;iq id="007" type="get" to="db.host"&gt;
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;sql&gt; select a_int, a_float from tbl_one &lt;/sql&gt;
  &lt;/database&gt;
&lt;/iq&gt;
    </pre></div>

    <p class="" style=""><span class="strong">Result</span></p>

    <p class="caption"><a name="example-19" id="example-19"></a>Example 19. Response to embedded query</p><div class="indent"><pre>
&lt;iq id="007" type="result" to="db.host"&gt;
  &lt;database 
      name="testdb"
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
    &lt;table name="tbl_one" permission="both"&gt;
      &lt;col name="a_int" type="integer"/&gt;
      &lt;col name="a_float" type="float"/&gt;
    &lt;/table&gt;
    &lt;table name="tbl_one"&gt;
      &lt;col name="a_int"&gt;1234&lt;/col&gt;
      &lt;col name="a_float"&gt;123.45&lt;/col&gt;
    &lt;/table&gt;
    &lt;table name="tbl_one"&gt;
      &lt;col name="a_int"&gt;2345&lt;/col&gt;
      &lt;col name="a_float"&gt;234.56&lt;/col&gt;
    &lt;/table&gt;
  &lt;/database&gt;
&lt;/iq&gt;
    </pre></div>

    <p class="" style=""> Since SQL is so flexible, the result set schema is not known 
    until it is returned as a result of the query. Consequently, it 
    must be sent as the first 'row' of the returned result. Each 
    following row will be the actual data queried for.</p>

    <p class="" style=""> If multiple tables are used within one SQL statement, then 
    then name attribute within the &lt;table&gt; element can not be 
    accurately denoted with a single table name. The best way to deal 
    with this situation is to simply use a unique identifier within 
    the scope of the &lt;database&gt; element. This will allow for 
    multiple &lt;sql&gt; results to be scoped within the same result.</p>

    </div>  
    <div class="indent"><h3>3.5.2 <a name="sect-id2262245" id="sect-id2262245">Version Negotiation</a></h3>

    <p class="" style="">It is expected that this protocol will grow and be extended 
    to meet various demands. Therefore, version
    negotiation [<a href="#nt-id2262261">2</a>] will be 
    incorporated up front.</p>
    
    <p class="" style="">When the connection initiator, client end-user or
    server/transport, starts a session, it must first send 
    the version number it expects to use, otherwise, behavior 
    is undefined.</p>

    <p class="caption"></p><div class="indent"><pre>
&lt;iq id="000" type="get" to="db.host"&gt;
  &lt;database 
      xmlns="http://openaether.org/projects/jabber_database.html"&gt;
      &lt;version&gt;0.1&lt;/version&gt;
    &lt;/database&gt;
&lt;/iq&gt;
    </pre></div>

    <p class="" style="">Three responses are possible from the server.</p>
    <ol start="" class="" style="">    
      <li class="" style="">
      <p class="" style="">It supports that version number and responds with:</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;iq id="000" type="result" from="db.host"&gt;
  &lt;database 
      xmlns="http://openaether.org/projects/jabber_database.html"&gt;
    &lt;version&gt;0.1&lt;/version&gt;
    &lt;/database&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">The type of 'result' indicates that the version request was
      successful and if the client is satisfied with the version number, 
      may continue with schema requests or whatever.</p></li>
    
      <li class="" style=""><p class="" style="">It does not support that version number and responds with:</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;iq id="000" type="error" from="db.host"&gt;
  &lt;database 
      xmlns="http://openaether.org/projects/jabber_database.html"/&gt;
&lt;/iq&gt;
      </pre></div>
      <p class="" style="">The type of 'error' indicates a failure in conforming to the
      desired version number. The server may optionally send an
      alternative option.</p>
      <p class="caption"></p><div class="indent"><pre>
&lt;iq id="000" type="error" from="db.host"&gt;
  &lt;database 
      xmlns="http://openaether.org/projects/jabber_database.html"&gt;
      &lt;version&gt;0.2&lt;/version&gt;
    &lt;/database&gt;
&lt;/iq&gt;
      </pre></div></li>
      <li class="" style="">If the server has no idea what the client is talking
      about it should send the appropriate Jabber error code.</li>
    </ol>
    </div>
  </div>
<h2>4.
       <a name="sect-id2262409" id="sect-id2262409">Limitations</a></h2>
  <ol start="" class="" style="">
    <li class="" style="">No joins, roll ups, cubes</li>
    <li class="" style="">Views are not differentiated from tables</li>
    <li class="" style="">provides basic sql-like functionality only</li>
    <li class="" style="">Utilizes <span class="em">lowest common denominator</span> approach</li>
  </ol>
<h2>5.
       <a name="sect-id2262464" id="sect-id2262464">Todos</a></h2>
  <ul class="" style="">
    <li class="" style="">define procedures; what they are and how they work</li>
    <li class="" style="">determine value of adding administration features</li>
  </ul>
<h2>6.
       <a name="sect-id2262497" id="sect-id2262497">Thanks</a></h2>
  <p class="" style="">Thanks to Russell Davis (ukscone) for fine tuning the layout and wording of this jep. It would probably have been unreadable if it wasn't for him.</p>
<h2>7.
       <a name="sect-id2262515" id="sect-id2262515">DTD and Schema</a></h2>
  <div class="indent"><h3>7.1 <a name="sect-id2262522" id="sect-id2262522">DTD</a></h3>
    <p class="caption"></p><div class="indent"><pre>
&lt;!ELEMENT version (#PCDATA)&gt;
&lt;!ELEMENT error (#PCDATA)&gt;
&lt;!ELEMENT sql(#PCDATA)&gt;
&lt;!ELEMENT database (table | sproc | sql | error)*&gt;
&lt;!ELEMENT table (col | where | error)*&gt;
&lt;!ELEMENT where (col+)&gt;
&lt;!ELEMENT col (#PCDATA)&gt;
&lt;!ELEMENT proc(col | result | error)*&gt;
&lt;!ELEMENT result (#PCDATA)&gt;
&lt;!ATTLIST error code CDATA #IMPLIED&gt;
&lt;!ATTLIST database name CDATA #IMPLIED&gt;
&lt;!ATTLIST table 
name CDATA #IMPLIED 
    permission (read | write | both) #IMPLIED 
    limit CDATA #IMPLIED
&gt;
&lt;!ATTLIST proc name CDATA #IMPLIED&gt;
&lt;!ATTLIST col 
    name CDATA #IMPLIED 
    size CDATA #IMPLIED 
    op (eq | neq | lt | gt | let | get | null) #IMPLIED 
    conj (not | or | and ) #IMPLIED 
    permission (read | write | both) #IMPLIED 
    type (bit | tinyint | integer | utinyint | uinteger | 
          float | numeric | date | datetime | timestamp | 
          time | char | vchar | text | blob) #IMPLIED 
&gt;
    </pre></div>
  </div>
  <div class="indent"><h3>7.2 <a name="sect-id2262552" id="sect-id2262552">Schema</a></h3>
    <p class="" style=""><span class="strong">Anyone care to do this?</span></p>
  </div>
<hr /><h2><a name="notes" id="notes"></a>Notes</h2><div class="indent"><p><a name="nt-id2261830" id="nt-id2261830">1</a>. Apparently procedures 
  are not as common in RDBMS as I thought. Postgres and MySQL have 
  functions, but not procedures. So until I, or someone else, 
  researches this issue this feature is on hold.</p><p><a name="nt-id2262261" id="nt-id2262261">2</a>. Version Negotiation is being killed since browsing, feature 
    negotiation, or disco will be able to perform this function, 
    however it might be useful as an optional feature for clients 
    that don't implement these yet, especially considering none 
    of these have been standardized.</p></div><hr /><h2><a name="revs" id="revs"></a>Revision History</h2><div class="indent"><h4>Version 0.2 (2003-10-20)</h4><div class="indent">At the request of the author, changed status to Retracted; interested parties should refer to &lt;<a href="http://www.openaether.org/projects/jabber_database.html">http://www.openaether.org/projects/jabber_database.html</a>&gt; for further information. (psa)
    </div><h4>Version 0.1 (2002-08-21)</h4><div class="indent">Initial public release (jk)
    </div></div><hr /><p>END</p></body></html>
