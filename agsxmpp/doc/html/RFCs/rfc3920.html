<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Extensible Messaging and Presence Protocol (XMPP): Core</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Extensible Messaging and Presence Protocol (XMPP): Core">
<meta name="keywords" content="RFC, Request for Comments, I-D, Internet-Draft, XMPP, Extensible Messaging and Presence Protocol, Jabber, IM, Instant Messaging, Presence, XML, Extensible Markup Language">
<meta name="generator" content="xml2rfc v1.32 (http://xml.resource.org/)">
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: small; color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: small; font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: small; font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: small; text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>

<table border="0" cellpadding="0" cellspacing="2" width="30" align="right">
    <tr>
        <td class="RFCbug">
                <span class="RFC">&nbsp;RFC&nbsp;</span><br /><span class="hotText">&nbsp;3920&nbsp;</span>
        </td>
    </tr>
    <tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a><br /></td></tr>
</table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">P. Saint-Andre, Ed.</td></tr>
<tr><td class="header">Request for Comments: 3920</td><td class="header">Jabber Software Foundation</td></tr>
<tr><td class="header">Category: Standards Track</td><td class="header">October 2004</td></tr>
</table></td></tr></table>
<h1><br />Extensible Messaging and Presence Protocol (XMPP): Core</h1>

<h3>Status of this Memo</h3>
<p>
This document specifies an Internet standards track protocol for the Internet
community, and requests discussion and suggestions for improvements.
Please refer to the current edition of the &ldquo;Internet Official Protocol
Standards&rdquo; (STD&nbsp;1) for the standardization state and status of this
protocol.
Distribution of this memo is unlimited.</p>

<h3>Copyright Notice</h3>
<p>
Copyright &copy; The Internet Society (2004).</p>

<h3>Abstract</h3>

<p>This memo defines the core features of the Extensible Messaging and Presence Protocol (XMPP), a protocol for streaming Extensible Markup Language (XML) elements in order to exchange structured information in close to real time between any two network endpoints.  While XMPP provides a generalized, extensible framework for exchanging XML data, it is used mainly for the purpose of building instant messaging and presence applications that meet the requirements of RFC 2779.
</p><a name="toc"></a><hr />

<table border="0" cellpadding="0" cellspacing="2" width="30" align="right">
    <tr>
        <td class="RFCbug">
                <span class="RFC">&nbsp;RFC&nbsp;</span><br /><span class="hotText">&nbsp;3920&nbsp;</span>
        </td>
    </tr>
    <tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a><br /></td></tr>
</table>
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#arch">2.</a>&nbsp;
Generalized Architecture<br />
<a href="#addressing">3.</a>&nbsp;
Addressing Scheme<br />
<a href="#streams">4.</a>&nbsp;
XML Streams<br />
<a href="#tls">5.</a>&nbsp;
Use of TLS<br />
<a href="#sasl">6.</a>&nbsp;
Use of SASL<br />
<a href="#bind">7.</a>&nbsp;
Resource Binding<br />
<a href="#dialback">8.</a>&nbsp;
Server Dialback<br />
<a href="#stanzas">9.</a>&nbsp;
XML Stanzas<br />
<a href="#rules">10.</a>&nbsp;
Server Rules for Handling XML Stanzas<br />
<a href="#xml">11.</a>&nbsp;
XML Usage within XMPP<br />
<a href="#compliance">12.</a>&nbsp;
Core Compliance Requirements<br />
<a href="#i18n">13.</a>&nbsp;
Internationalization Considerations<br />
<a href="#security">14.</a>&nbsp;
Security Considerations<br />
<a href="#iana">15.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">16.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">16.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">16.2.</a>&nbsp;
Informative References<br />
<a href="#nodeprep">Appendix&nbsp;A.</a>&nbsp;
Nodeprep<br />
<a href="#resourceprep">Appendix&nbsp;B.</a>&nbsp;
Resourceprep<br />
<a href="#def">Appendix&nbsp;C.</a>&nbsp;
XML Schemas<br />
<a href="#diffs">Appendix&nbsp;D.</a>&nbsp;
Differences Between Core Jabber Protocols and XMPP<br />
<a href="#contributors">Appendix&nbsp;E.</a>&nbsp;
Contributors<br />
<a href="#acknowledgements">Appendix&nbsp;F.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<a name="intro-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Overview</h3>

<p>The Extensible Messaging and Presence Protocol (XMPP) is an open Extensible Markup Language <a class='info' href='#XML'>XML<span> (</span><span class='info'>Bray, T., Paoli, J., Sperberg-McQueen, C., and E. Maler, &ldquo;Extensible Markup Language (XML) 1.0 (2nd ed),&rdquo; October&nbsp;2000.</span><span>)</span></a> [XML] protocol for near-real-time messaging, presence, and request-response services.  The basic syntax and semantics were developed originally within the Jabber open-source community, mainly in 1999.  In 2002, the XMPP WG was chartered with developing an adaptation of the Jabber protocol that would be suitable as an IETF instant messaging (IM) and presence technology.  As a result of work by the XMPP WG, the current memo defines the core features of XMPP 1.0; the extensions required to provide the instant messaging and presence functionality defined in <a class='info' href='#IMP-REQS'>RFC 2779<span> (</span><span class='info'>Day, M., Aggarwal, S., and J. Vincent, &ldquo;Instant Messaging / Presence Protocol Requirements,&rdquo; February&nbsp;2000.</span><span>)</span></a> [IMP&#8209;REQS] are specified in Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>.
</p>
<a name="intro-terms"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Terminology</h3>

<p>The capitalized key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a class='info' href='#TERMS'>BCP 14, RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [TERMS].
</p>
<a name="arch"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Generalized Architecture</h3>

<a name="arch-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Overview</h3>

<p>Although XMPP is not wedded to any specific network architecture, to date it usually has been implemented via a client-server architecture wherein a client utilizing XMPP accesses a server over a <a class='info' href='#TCP'>[TCP]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> connection, and servers also communicate with each other over TCP connections.
</p>
<p>The following diagram provides a high-level overview of this architecture (where "-" represents communications that use XMPP and "=" represents communications that use any other protocol).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C1----S1---S2---C3
      |
C2----+--G1===FN1===FC1
</pre></div>
<p>The symbols are as follows:
</p>
<p></p>
<ul class="text">
<li>C1, C2, C3 = XMPP clients
</li>
<li>S1, S2 = XMPP servers
</li>
<li>G1 = A gateway that translates between XMPP and the protocol(s) used on a foreign (non-XMPP) messaging network
</li>
<li>FN1 = A foreign messaging network
</li>
<li>FC1 = A client on a foreign messaging network
</li>
</ul>

<a name="arch-server"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Server</h3>

<p>A server acts as an intelligent abstraction layer for XMPP communications.  Its primary responsibilities are:
</p>
<p></p>
<ul class="text">
<li>to manage connections from or sessions for other entities, in the form of <a class='info' href='#streams'>XML streams<span> (</span><span class='info'>XML Streams</span><span>)</span></a> to and from authorized clients, servers, and other entities
</li>
<li>to route appropriately-addressed <a class='info' href='#stanzas'>XML stanzas<span> (</span><span class='info'>XML Stanzas</span><span>)</span></a> among such entities over XML streams
</li>
</ul>

<p>Most XMPP-compliant servers also assume responsibility for the storage of data that is used by clients (e.g., contact lists for users of XMPP-based instant messaging and presence applications); in this case, the XML data is processed directly by the server itself on behalf of the client and is not routed to another entity.
</p>
<a name="arch-client"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Client</h3>

<p>Most clients connect directly to a server over a <a class='info' href='#TCP'>[TCP]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> connection and use XMPP to take full advantage of the functionality provided by a server and any associated services.  Multiple resources (e.g., devices or locations) MAY connect simultaneously to a server on behalf of each authorized client, with each resource differentiated by the resource identifier of an XMPP address (e.g., &lt;node@domain/home&gt; vs. &lt;node@domain/work&gt;) as defined under <a class='info' href='#addressing'>Addressing Scheme<span> (</span><span class='info'>Addressing Scheme</span><span>)</span></a>.  The RECOMMENDED port for connections between a client and a server is 5222, as registered with the IANA (see <a class='info' href='#iana-ports'>Port Numbers<span> (</span><span class='info'>Port Numbers</span><span>)</span></a>).
</p>
<a name="arch-gateway"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Gateway</h3>

<p>A gateway is a special-purpose server-side service whose primary function is to translate XMPP into the protocol used by a foreign (non-XMPP) messaging system, as well as to translate the return data back into XMPP.  Examples are gateways to email (see <a class='info' href='#SMTP'>[SMTP]<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; April&nbsp;2001.</span><span>)</span></a>), Internet Relay Chat (see <a class='info' href='#IRC'>[IRC]<span> (</span><span class='info'>Oikarinen, J. and D. Reed, &ldquo;Internet Relay Chat Protocol,&rdquo; May&nbsp;1993.</span><span>)</span></a>), SIMPLE (see <a class='info' href='#SIMPLE'>[SIMPLE]<span> (</span><span class='info'>SIMPLE Working Group, &ldquo;SIMPLE WG,&rdquo; .</span><span>)</span></a>), Short Message Service (SMS), and legacy instant messaging services such as AIM, ICQ, MSN Messenger, and Yahoo! Instant Messenger.  Communications between gateways and servers, and between gateways and the foreign messaging system, are not defined in this document.
</p>
<a name="arch-network"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Network</h3>

<p>Because each server is identified by a network address and because server-to-server communications are a straightforward extension of the client-to-server protocol, in practice, the system consists of a network of servers that inter-communicate.  Thus, for example, &lt;juliet@example.com&gt; is able to exchange messages, presence, and other information with &lt;romeo@example.net&gt;.  This pattern is familiar from messaging protocols (such as <a class='info' href='#SMTP'>[SMTP]<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; April&nbsp;2001.</span><span>)</span></a>) that make use of network addressing standards.  Communications between any two servers are OPTIONAL.  If enabled, such communications SHOULD occur over XML streams that are bound to <a class='info' href='#TCP'>[TCP]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> connections.  The RECOMMENDED port for connections between servers is 5269, as registered with the IANA (see <a class='info' href='#iana-ports'>Port Numbers<span> (</span><span class='info'>Port Numbers</span><span>)</span></a>).
</p>
<a name="addressing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Addressing Scheme</h3>

<a name="addressing-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Overview</h3>

<p>An entity is anything that can be considered a network endpoint (i.e., an ID on the network) and that can communicate using XMPP.  All such entities are uniquely addressable in a form that is consistent with RFC 2396 <a class='info' href='#URI'>[URI]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifiers (URI): Generic Syntax,&rdquo; August&nbsp;1998.</span><span>)</span></a>.  For historical reasons, the address of an XMPP entity is called a Jabber Identifier or JID.  A valid JID contains a set of ordered elements formed of a domain identifier, node identifier, and resource identifier.
</p>
<p>The syntax for a JID is defined below using the Augmented Backus-Naur Form as defined in <a class='info' href='#ABNF'>[ABNF]<span> (</span><span class='info'>Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; November&nbsp;1997.</span><span>)</span></a>.  (The IPv4address and IPv6address rules are defined in Appendix B of <a class='info' href='#IPv6'>[IPv6]<span> (</span><span class='info'>Hinden, R. and S. Deering, &ldquo;Internet Protocol Version 6 (IPv6) Addressing Architecture,&rdquo; April&nbsp;2003.</span><span>)</span></a>; the allowable character sequences that conform to the node rule are defined by the Nodeprep profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> as documented in Appendix A of this memo; the allowable character sequences that conform to the resource rule are defined by the Resourceprep profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> as documented in Appendix B of this memo; and the sub-domain rule makes reference to the concept of an internationalized domain label as described in <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a>.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   jid             = [ node "@" ] domain [ "/" resource ]
   domain          = fqdn / address-literal
   fqdn            = (sub-domain 1*("." sub-domain))
   sub-domain      = (internationalized domain label)
   address-literal = IPv4address / IPv6address
</pre></div>
<p>All JIDs are based on the foregoing structure.  The most common use of this structure is to identify an instant messaging user, the server to which the user connects, and the user's connected resource (e.g., a specific client) in the form of &lt;user@host/resource&gt;.  However, node types other than clients are possible; for example, a specific chat room offered by a multi-user chat service could be addressed as &lt;room@service&gt; (where "room" is the name of the chat room and "service" is the hostname of the multi-user chat service) and a specific occupant of such a room could be addressed as &lt;room@service/nick&gt; (where "nick" is the occupant's room nickname).  Many other JID types are possible (e.g., &lt;domain/resource&gt; could be a server-side script or service).
</p>
<p>Each allowable portion of a JID (node identifier, domain identifier, and resource identifier) MUST NOT be more than 1023 bytes in length, resulting in a maximum total size (including the '@' and '/' separators) of 3071 bytes.
</p>
<a name="addressing-domain"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Domain Identifier</h3>

<p>The domain identifier is the primary identifier and is the only REQUIRED element of a JID (a mere domain identifier is a valid JID).  It usually represents the network gateway or "primary" server to which other entities connect for XML routing and data management capabilities.  However, the entity referenced by a domain identifier is not always a server, and may be a service that is addressed as a subdomain of a server that provides functionality above and beyond the capabilities of a server (e.g., a multi-user chat service, a user directory, or a gateway to a foreign messaging system).
</p>
<p>The domain identifier for every server or service that will communicate over a network MAY be an IP address but SHOULD be a fully qualified domain name (see <a class='info' href='#DNS'>[DNS]<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a>).  A domain identifier MUST be an "internationalized domain name" as defined in <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a>, to which the <a class='info' href='#NAMEPREP'>Nameprep<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN),&rdquo; March&nbsp;2003.</span><span>)</span></a> [NAMEPREP] profile of <a class='info' href='#STRINGPREP'>stringprep<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> [STRINGPREP] can be applied without failing.  Before comparing two domain identifiers, a server MUST (and a client SHOULD) first apply the Nameprep profile to the labels (as defined in <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a>) that make up each identifier.
</p>
<a name="addressing-node"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Node Identifier</h3>

<p>The node identifier is an optional secondary identifier placed before the domain identifier and separated from the latter by the '@' character.  It usually represents the entity requesting and using network access provided by the server or gateway (i.e., a client), although it can also represent other kinds of entities (e.g., a chat room associated with a multi-user chat service).  The entity represented by a node identifier is addressed within the context of a specific domain; within instant messaging and presence applications of XMPP, this address is called a "bare JID" and is of the form &lt;node@domain&gt;.
</p>
<p>A node identifier MUST be formatted such that the Nodeprep profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> can be applied without failing.  Before comparing two node identifiers, a server MUST (and a client SHOULD) first apply the Nodeprep profile to each identifier.
</p>
<a name="addressing-resource"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Resource Identifier</h3>

<p>The resource identifier is an optional tertiary identifier placed after the domain identifier and separated from the latter by the '/' character.  A resource identifier may modify either a &lt;node@domain&gt; or a mere &lt;domain&gt; address.  It usually represents a specific session, connection (e.g., a device or location), or object (e.g., a participant in a multi-user chat room) belonging to the entity associated with a node identifier.  A resource identifier is opaque to both servers and other clients, and is typically defined by a client implementation when it provides the information necessary to complete <a class='info' href='#bind'>Resource Binding<span> (</span><span class='info'>Resource Binding</span><span>)</span></a> (although it may be generated by a server on behalf of a client), after which it is referred to as a "connected resource".  An entity MAY maintain multiple connected resources simultaneously, with each connected resource differentiated by a distinct resource identifier.
</p>
<p>A resource identifier MUST be formatted such that the Resourceprep profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> can be applied without failing.  Before comparing two resource identifiers, a server MUST (and a client SHOULD) first apply the Resourceprep profile to each identifier.
</p>
<a name="addressing-determination"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5"></a><h3>3.5.&nbsp;
Determination of Addresses</h3>

<p>After <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>Use of SASL</span><span>)</span></a> and, if appropriate, <a class='info' href='#bind'>Resource Binding<span> (</span><span class='info'>Resource Binding</span><span>)</span></a>, the receiving entity for a stream MUST determine the initiating entity's JID.
</p>
<p>For server-to-server communications, the initiating entity's JID SHOULD be the authorization identity, derived from the authentication identity, as defined by the <a class='info' href='#SASL'>Simple Authentication and Security Layer (SASL) specification<span> (</span><span class='info'>Myers, J., &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; October&nbsp;1997.</span><span>)</span></a> [SASL], if no authorization identity was specified during <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>Use of SASL</span><span>)</span></a>.
</p>
<p>For client-to-server communications, the "bare JID" (&lt;node@domain&gt;) SHOULD be the authorization identity, derived from the authentication identity, as defined in <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Myers, J., &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; October&nbsp;1997.</span><span>)</span></a>, if no authorization identity was specified during <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>Use of SASL</span><span>)</span></a>; the resource identifier portion of the "full JID" (&lt;node@domain/resource&gt;) SHOULD be the resource identifier negotiated by the client and server during <a class='info' href='#bind'>Resource Binding<span> (</span><span class='info'>Resource Binding</span><span>)</span></a>.
</p>
<p>The receiving entity MUST ensure that the resulting JID (including node identifier, domain identifier, resource identifier, and separator characters) conforms to the rules and formats defined earlier in this section; to meet this restriction, the receiving entity may need to replace the JID sent by the initiating entity with the canonicalized JID as determined by the receiving entity.
</p>
<a name="streams"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
XML Streams</h3>

<a name="streams-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Overview</h3>

<p>Two fundamental concepts make possible the rapid, asynchronous exchange of relatively small payloads of structured information between presence-aware entities: XML streams and XML stanzas.  These terms are defined as follows:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Definition of XML Stream:</dt>
<dd>An XML stream is a container for the exchange of XML elements between any two entities over a network.  The start of an XML stream is denoted unambiguously by an opening XML &lt;stream&gt; tag (with appropriate attributes and namespace declarations), while the end of the XML stream is denoted unambiguously by a closing XML &lt;/stream&gt; tag.  During the life of the stream, the entity that initiated it can send an unbounded number of XML elements over the stream, either elements used to negotiate the stream (e.g., to negotiate <a class='info' href='#tls'>Use of TLS<span> (</span><span class='info'>Use of TLS</span><span>)</span></a> or <a class='info' href='#sasl'>Use of SASL<span> (</span><span class='info'>Use of SASL</span><span>)</span></a>) or XML stanzas (as defined herein, &lt;message/&gt;, &lt;presence/&gt;, or &lt;iq/&gt; elements qualified by the default namespace).  The "initial stream" is negotiated from the initiating entity (usually a client or server) to the receiving entity (usually a server), and can be seen as corresponding to the initiating entity's "session" with the receiving entity.  The initial stream enables unidirectional communication from the initiating entity to the receiving entity; in order to enable information exchange from the receiving entity to the initiating entity, the receiving entity MUST negotiate a stream in the opposite direction (the "response stream").
</dd>
<dt>Definition of XML Stanza:</dt>
<dd>An XML stanza is a discrete semantic unit of structured information that is sent from one entity to another over an XML stream.  An XML stanza exists at the direct child level of the root &lt;stream/&gt; element and is said to be well-balanced if it matches the production [43] content of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Bray, T., Paoli, J., Sperberg-McQueen, C., and E. Maler, &ldquo;Extensible Markup Language (XML) 1.0 (2nd ed),&rdquo; October&nbsp;2000.</span><span>)</span></a>.  The start of any XML stanza is denoted unambiguously by the element start tag at depth=1 of the XML stream (e.g., &lt;presence&gt;), and the end of any XML stanza is denoted unambiguously by the corresponding close tag at depth=1 (e.g., &lt;/presence&gt;).  An XML stanza MAY contain child elements (with accompanying attributes, elements, and XML character data) as necessary in order to convey the desired information.  The only XML stanzas defined herein are the &lt;message/&gt;, &lt;presence/&gt;, and &lt;iq/&gt; elements qualified by the default namespace for the stream, as described under <a class='info' href='#stanzas'>XML Stanzas<span> (</span><span class='info'>XML Stanzas</span><span>)</span></a>; an XML element sent for the purpose of <a class='info' href='#tls'>Transport Layer Security (TLS) negotiation<span> (</span><span class='info'>Use of TLS</span><span>)</span></a>, <a class='info' href='#sasl'>Simple Authentication and Security Layer (SASL) negotiation<span> (</span><span class='info'>Use of SASL</span><span>)</span></a>, or <a class='info' href='#dialback'>server dialback<span> (</span><span class='info'>Server Dialback</span><span>)</span></a> is not considered to be an XML stanza.
</dd>
</dl></blockquote>

<p>Consider the example of a client's session with a server.  In order to connect to a server, a client MUST initiate an XML stream by sending an opening &lt;stream&gt; tag to the server, optionally preceded by a text declaration specifying the XML version and the character encoding supported (see <a class='info' href='#xml-declaration'>Inclusion of Text Declaration<span> (</span><span class='info'>Inclusion of Text Declaration</span><span>)</span></a>; see also <a class='info' href='#xml-encoding'>Character Encoding<span> (</span><span class='info'>Character Encoding</span><span>)</span></a>).  Subject to local policies and service provisioning, the server SHOULD then reply with a second XML stream back to the client, again optionally preceded by a text declaration.  Once the client has completed <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>Use of SASL</span><span>)</span></a>, the client MAY send an unbounded number of XML stanzas over the stream to any recipient on the network.  When the client desires to close the stream, it simply sends a closing &lt;/stream&gt; tag to the server (alternatively, the stream may be closed by the server), after which both the client and server SHOULD terminate the underlying connection (usually a TCP connection) as well.
</p>
<p>Those who are accustomed to thinking of XML in a document-centric manner may wish to view a client's session with a server as consisting of two open-ended XML documents: one from the client to the server and one from the server to the client.  From this perspective, the root &lt;stream/&gt; element can be considered the document entity for each "document", and the two "documents" are built up through the accumulation of XML stanzas sent over the two XML streams.  However, this perspective is a convenience only; XMPP does not deal in documents but in XML streams and XML stanzas.
</p>
<p>In essence, then, an XML stream acts as an envelope for all the XML stanzas sent during a session.  We can represent this in a simplistic fashion as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|--------------------|
| &lt;stream&gt;           |
|--------------------|
| &lt;presence&gt;         |
|   &lt;show/&gt;          |
| &lt;/presence&gt;        |
|--------------------|
| &lt;message to='foo'&gt; |
|   &lt;body/&gt;          |
| &lt;/message&gt;         |
|--------------------|
| &lt;iq to='bar'&gt;      |
|   &lt;query/&gt;         |
| &lt;/iq&gt;              |
|--------------------|
| ...                |
|--------------------|
| &lt;/stream&gt;          |
|--------------------|
</pre></div>
<a name="streams-tcp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Binding to TCP</h3>

<p>Although there is no necessary coupling of an XML stream to a <a class='info' href='#TCP'>[TCP]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> connection (e.g., two entities could connect to each other via another mechanism such as polling over <a class='info' href='#HTTP'>[HTTP]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>), this specification defines a binding of XMPP to TCP only.  In the context of client-to-server communications, a server MUST allow a client to share a single TCP connection for XML stanzas sent from client to server and from server to client.  In the context of server-to-server communications, a server MUST use one TCP connection for XML stanzas sent from the server to the peer and another TCP connection (initiated by the peer) for stanzas from the peer to the server, for a total of two TCP connections.
</p>
<a name="streams-security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Stream Security</h3>

<p>When negotiating XML streams in XMPP 1.0, TLS SHOULD be used as defined under <a class='info' href='#tls'>Use of TLS<span> (</span><span class='info'>Use of TLS</span><span>)</span></a> and SASL MUST be used as defined under <a class='info' href='#sasl'>Use of SASL<span> (</span><span class='info'>Use of SASL</span><span>)</span></a>.  The "initial stream" (i.e., the stream from the initiating entity to the receiving entity) and the "response stream" (i.e., the stream from the receiving entity to the initiating entity) MUST be secured separately, although security in both directions MAY be established via mechanisms that provide mutual authentication.  An entity SHOULD NOT attempt to send <a class='info' href='#stanzas'>XML Stanzas<span> (</span><span class='info'>XML Stanzas</span><span>)</span></a> over the stream before the stream has been authenticated, but if it does, then the other entity MUST NOT accept such stanzas and SHOULD return a &lt;not-authorized/&gt; stream error and then terminate both the XML stream and the underlying TCP connection; note well that this applies to XML stanzas only (i.e., &lt;message/&gt;, &lt;presence/&gt;, and &lt;iq/&gt; elements scoped by the default namespace) and not to XML elements used for stream negotiation (e.g., elements used to negotiate <a class='info' href='#tls'>Use of TLS<span> (</span><span class='info'>Use of TLS</span><span>)</span></a> or <a class='info' href='#sasl'>Use of SASL<span> (</span><span class='info'>Use of SASL</span><span>)</span></a>).
</p>
<a name="streams-attr"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Stream Attributes</h3>

<p>The attributes of the stream element are as follows:
</p>
<p></p>
<ul class="text">
<li>to -- The 'to' attribute SHOULD be used only in the XML stream header from the initiating entity to the receiving entity, and MUST be set to a hostname serviced by the receiving entity.  There SHOULD NOT be a 'to' attribute set in the XML stream header by which the receiving entity replies to the initiating entity; however, if a 'to' attribute is included, it SHOULD be silently ignored by the initiating entity.
</li>
<li>from -- The 'from' attribute SHOULD be used only in the XML stream header from the receiving entity to the initiating entity, and MUST be set to a hostname serviced by the receiving entity that is granting access to the initiating entity.  There SHOULD NOT be a 'from' attribute on the XML stream header sent from the initiating entity to the receiving entity; however, if a 'from' attribute is included, it SHOULD be silently ignored by the receiving entity.
</li>
<li>id -- The 'id' attribute SHOULD be used only in the XML stream header from the receiving entity to the initiating entity.  This attribute is a unique identifier created by the receiving entity to function as a session key for the initiating entity's streams with the receiving entity, and MUST be unique within the receiving application (normally a server).  Note well that the stream ID may be security-critical and therefore MUST be both unpredictable and nonrepeating (see <a class='info' href='#RANDOM'>[RANDOM]<span> (</span><span class='info'>Eastlake, D., Crocker, S., and J. Schiller, &ldquo;Randomness Recommendations for Security,&rdquo; December&nbsp;1994.</span><span>)</span></a> for recommendations regarding randomness for security purposes).  There SHOULD NOT be an 'id' attribute on the XML stream header sent from the initiating entity to the receiving entity; however, if an 'id' attribute is included, it SHOULD be silently ignored by the receiving entity.
</li>
<li>xml:lang -- An 'xml:lang' attribute (as defined in Section 2.12 of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Bray, T., Paoli, J., Sperberg-McQueen, C., and E. Maler, &ldquo;Extensible Markup Language (XML) 1.0 (2nd ed),&rdquo; October&nbsp;2000.</span><span>)</span></a>) SHOULD be included by the initiating entity on the header for the initial stream to specify the default language of any human-readable XML character data it sends over that stream.  If the attribute is included, the receiving entity SHOULD remember that value as the default for both the initial stream and the response stream; if the attribute is not included, the receiving entity SHOULD use a configurable default value for both streams, which it MUST communicate in the header for the response stream.  For all stanzas sent over the initial stream, if the initiating entity does not include an 'xml:lang' attribute, the receiving entity SHOULD apply the default value; if the initiating entity does include an 'xml:lang' attribute, the receiving entity MUST NOT modify or delete it (see also <a class='info' href='#stanzas-attributes-lang'>xml:lang<span> (</span><span class='info'>xml:lang</span><span>)</span></a>).  The value of the 'xml:lang' attribute MUST be an NMTOKEN (as defined in Section 2.3 of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Bray, T., Paoli, J., Sperberg-McQueen, C., and E. Maler, &ldquo;Extensible Markup Language (XML) 1.0 (2nd ed),&rdquo; October&nbsp;2000.</span><span>)</span></a>) and MUST conform to the format defined in <a class='info' href='#LANGTAGS'>RFC 3066<span> (</span><span class='info'>Alvestrand, H., &ldquo;Tags for the Identification of Languages,&rdquo; January&nbsp;2001.</span><span>)</span></a> [LANGTAGS].
</li>
<li>version -- The presence of the version attribute set to a value of at least "1.0" signals support for the stream-related protocols (including stream features) defined in this specification.  Detailed rules regarding the generation and handling of this attribute are defined below.
</li>
</ul>

<p>We can summarize as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
         |  initiating to receiving  |  receiving to initiating
---------+---------------------------+-----------------------
to       |  hostname of receiver     |  silently ignored
from     |  silently ignored         |  hostname of receiver
id       |  silently ignored         |  session key
xml:lang |  default language         |  default language
version  |  signals XMPP 1.0 support |  signals XMPP 1.0 support
</pre></div>
<a name="streams-attr-version"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.1"></a><h3>4.4.1.&nbsp;
Version Support</h3>

<p>The version of XMPP specified herein is "1.0"; in particular, this encapsulates the stream-related protocols (<a class='info' href='#tls'>Use of TLS<span> (</span><span class='info'>Use of TLS</span><span>)</span></a>, <a class='info' href='#sasl'>Use of SASL<span> (</span><span class='info'>Use of SASL</span><span>)</span></a>, and <a class='info' href='#streams-error'>Stream Errors<span> (</span><span class='info'>Stream Errors</span><span>)</span></a>), as well as the semantics of the three defined XML stanza types (&lt;message/&gt;, &lt;presence/&gt;, and &lt;iq/&gt;).  The numbering scheme for XMPP versions is "&lt;major&gt;.&lt;minor&gt;".  The major and minor numbers MUST be treated as separate integers and each number MAY be incremented higher than a single digit.  Thus, "XMPP 2.4" would be a lower version than "XMPP 2.13", which in turn would be lower than "XMPP 12.3".  Leading zeros (e.g., "XMPP 6.01") MUST be ignored by recipients and MUST NOT be sent.
</p>
<p>The major version number should be incremented only if the stream and stanza formats or required actions have changed so dramatically that an older version entity would not be able to interoperate with a newer version entity if it simply ignored the elements and attributes it did not understand and took the actions specified in the older specification.  The minor version number indicates new capabilities, and MUST be ignored by an entity with a smaller minor version number, but used for informational purposes by the entity with the larger minor version number.  For example, a minor version number might indicate the ability to process a newly defined value of the 'type' attribute for message, presence, or IQ stanzas; the entity with the larger minor version number would simply note that its correspondent would not be able to understand that value of the 'type' attribute and therefore would not send it.
</p>
<p>The following rules apply to the generation and handling of the 'version' attribute within stream headers by implementations:
</p>
<p></p>
<ol class="text">
<li>The initiating entity MUST set the value of the 'version' attribute on the initial stream header to the highest version number it supports (e.g., if the highest version number it supports is that defined in this specification, it MUST set the value to "1.0").
</li>
<li>The receiving entity MUST set the value of the 'version' attribute on the response stream header to either the value supplied by the initiating entity or the highest version number supported by the receiving entity, whichever is lower.  The receiving entity MUST perform a numeric comparison on the major and minor version numbers, not a string match on "&lt;major&gt;.&lt;minor&gt;".
</li>
<li>If the version number included in the response stream header is at least one major version lower than the version number included in the initial stream header and newer version entities cannot interoperate with older version entities as described above, the initiating entity SHOULD generate an &lt;unsupported-version/&gt; stream error and terminate the XML stream and underlying TCP connection.
</li>
<li>If either entity receives a stream header with no 'version' attribute, the entity MUST consider the version supported by the other entity to be "0.0" and SHOULD NOT include a 'version' attribute in the stream header it sends in reply.
</li>
</ol>

<a name="streams-ns"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
Namespace Declarations</h3>

<p>The stream element MUST possess both a streams namespace declaration and a default namespace declaration (as "namespace declaration" is defined in the <a class='info' href='#XML-NAMES'>XML namespaces specification<span> (</span><span class='info'>Bray, T., Hollander, D., and A. Layman, &ldquo;Namespaces in XML,&rdquo; January&nbsp;1999.</span><span>)</span></a> [XML&#8209;NAMES]).  For detailed information regarding the streams namespace and default namespace, see <a class='info' href='#xml-ns'>Namespace Names and Prefixes<span> (</span><span class='info'>XML Namespace Names and Prefixes</span><span>)</span></a>.
</p>
<a name="streams-features"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6"></a><h3>4.6.&nbsp;
Stream Features</h3>

<p>If the initiating entity includes the 'version' attribute set to a value of at least "1.0" in the initial stream header, the receiving entity MUST send a &lt;features/&gt; child element (prefixed by the streams namespace prefix) to the initiating entity in order to announce any stream-level features that can be negotiated (or capabilities that otherwise need to be advertised).  Currently, this is used only to advertise <a class='info' href='#tls'>Use of TLS<span> (</span><span class='info'>Use of TLS</span><span>)</span></a>, <a class='info' href='#sasl'>Use of SASL<span> (</span><span class='info'>Use of SASL</span><span>)</span></a>, and <a class='info' href='#bind'>Resource Binding<span> (</span><span class='info'>Resource Binding</span><span>)</span></a> as defined herein, and for Session Establishment as defined in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>; however, the stream features functionality could be used to advertise other negotiable features in the future.  If an entity does not understand or support some features, it SHOULD silently ignore them.  If one or more security features (e.g., TLS and SASL) need to be successfully negotiated before a non-security-related feature (e.g., Resource Binding) can be offered, the non-security-related feature SHOULD NOT be included in the stream features that are advertised before the relevant security features have been negotiated.
</p>
<a name="streams-error"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7"></a><h3>4.7.&nbsp;
Stream Errors</h3>

<p>The root stream element MAY contain an &lt;error/&gt; child element that is prefixed by the streams namespace prefix.  The error child MUST be sent by a compliant entity (usually a server rather than a client) if it perceives that a stream-level error has occurred.
</p>
<a name="streams-error-rules"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7.1"></a><h3>4.7.1.&nbsp;
Rules</h3>

<p>The following rules apply to stream-level errors:
</p>
<p></p>
<ul class="text">
<li>It is assumed that all stream-level errors are unrecoverable; therefore, if an error occurs at the level of the stream, the entity that detects the error MUST send a stream error to the other entity, send a closing &lt;/stream&gt; tag, and terminate the underlying TCP connection.
</li>
<li>If the error occurs while the stream is being set up, the receiving entity MUST still send the opening &lt;stream&gt; tag, include the &lt;error/&gt; element as a child of the stream element, send the closing &lt;/stream&gt; tag, and terminate the underlying TCP connection.  In this case, if the initiating entity provides an unknown host in the 'to' attribute (or provides no 'to' attribute at all), the server SHOULD provide the server's authoritative hostname in the 'from' attribute of the stream header sent before termination.
</li>
</ul>

<a name="streams-error-syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7.2"></a><h3>4.7.2.&nbsp;
Syntax</h3>

<p>The syntax for stream errors is as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:error&gt;
  &lt;defined-condition xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
  &lt;text xmlns='urn:ietf:params:xml:ns:xmpp-streams'
        xml:lang='langcode'&gt;
    OPTIONAL descriptive text
  &lt;/text&gt;
  [OPTIONAL application-specific condition element]
&lt;/stream:error&gt;
</pre></div>
<p>The &lt;error/&gt; element:
</p>
<p></p>
<ul class="text">
<li>MUST contain a child element corresponding to one of the defined stanza error conditions defined below; this element MUST be qualified by the 'urn:ietf:params:xml:ns:xmpp-streams' namespace
</li>
<li>MAY contain a &lt;text/&gt; child containing XML character data that describes the error in more detail; this element MUST be qualified by the 'urn:ietf:params:xml:ns:xmpp-streams' namespace and SHOULD possess an 'xml:lang' attribute specifying the natural language of the XML character data
</li>
<li>MAY contain a child element for an application-specific error condition; this element MUST be qualified by an application-defined namespace, and its structure is defined by that namespace
</li>
</ul>

<p>The &lt;text/&gt; element is OPTIONAL.  If included, it SHOULD be used only to provide descriptive or diagnostic information that supplements the meaning of a defined condition or application-specific condition.  It SHOULD NOT be interpreted programmatically by an application.  It SHOULD NOT be used as the error message presented to a user, but MAY be shown in addition to the error message associated with the included condition element (or elements).
</p>
<a name="streams-error-conditions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7.3"></a><h3>4.7.3.&nbsp;
Defined Conditions</h3>

<p>The following stream-level error conditions are defined:
</p>
<p></p>
<ul class="text">
<li>&lt;bad-format/&gt; -- the entity has sent XML that cannot be processed; this error MAY be used instead of the more specific XML-related errors, such as &lt;bad-namespace-prefix/&gt;, &lt;invalid-xml/&gt;, &lt;restricted-xml/&gt;, &lt;unsupported-encoding/&gt;, and &lt;xml-not-well-formed/&gt;, although the more specific errors are preferred.
</li>
<li>&lt;bad-namespace-prefix/&gt; -- the entity has sent a namespace prefix that is unsupported, or has sent no namespace prefix on an element that requires such a prefix (see <a class='info' href='#xml-ns'>XML Namespace Names and Prefixes<span> (</span><span class='info'>XML Namespace Names and Prefixes</span><span>)</span></a>).
</li>
<li>&lt;conflict/&gt; -- the server is closing the active stream for this entity because a new stream has been initiated that conflicts with the existing stream.
</li>
<li>&lt;connection-timeout/&gt; -- the entity has not generated any traffic over the stream for some period of time (configurable according to a local service policy).
</li>
<li>&lt;host-gone/&gt; -- the value of the 'to' attribute provided by the initiating entity in the stream header corresponds to a hostname that is no longer hosted by the server.
</li>
<li>&lt;host-unknown/&gt; -- the value of the 'to' attribute provided by the initiating entity in the stream header does not correspond to a hostname that is hosted by the server.
</li>
<li>&lt;improper-addressing/&gt; -- a stanza sent between two servers lacks a 'to' or 'from' attribute (or the attribute has no value).
</li>
<li>&lt;internal-server-error/&gt; -- the server has experienced a misconfiguration or an otherwise-undefined internal error that prevents it from servicing the stream.
</li>
<li>&lt;invalid-from/&gt; -- the JID or hostname provided in a 'from' address does not match an authorized JID or validated domain negotiated between servers via SASL or dialback, or between a client and a server via authentication and resource binding.
</li>
<li>&lt;invalid-id/&gt; -- the stream ID or dialback ID is invalid or does not match an ID previously provided.
</li>
<li>&lt;invalid-namespace/&gt; -- the streams namespace name is something other than "http://etherx.jabber.org/streams" or the dialback namespace name is something other than "jabber:server:dialback" (see <a class='info' href='#xml-ns'>XML Namespace Names and Prefixes<span> (</span><span class='info'>XML Namespace Names and Prefixes</span><span>)</span></a>).
</li>
<li>&lt;invalid-xml/&gt; -- the entity has sent invalid XML over the stream to a server that performs validation (see <a class='info' href='#xml-validation'>Validation<span> (</span><span class='info'>Validation</span><span>)</span></a>).
</li>
<li>&lt;not-authorized/&gt; -- the entity has attempted to send data before the stream has been authenticated, or otherwise is not authorized to perform an action related to stream negotiation; the receiving entity MUST NOT process the offending stanza before sending the stream error.
</li>
<li>&lt;policy-violation/&gt; -- the entity has violated some local service policy; the server MAY choose to specify the policy in the &lt;text/&gt; element or an application-specific condition element.
</li>
<li>&lt;remote-connection-failed/&gt; -- the server is unable to properly connect to a remote entity that is required for authentication or authorization.
</li>
<li>&lt;resource-constraint/&gt; -- the server lacks the system resources necessary to service the stream.
</li>
<li>&lt;restricted-xml/&gt; -- the entity has attempted to send restricted XML features such as a comment, processing instruction, DTD, entity reference, or unescaped character (see <a class='info' href='#xml-restrictions'>Restrictions<span> (</span><span class='info'>Restrictions</span><span>)</span></a>).
</li>
<li>&lt;see-other-host/&gt; -- the server will not provide service to the initiating entity but is redirecting traffic to another host; the server SHOULD specify the alternate hostname or IP address (which MUST be a valid domain identifier) as the XML character data of the &lt;see-other-host/&gt; element.
</li>
<li>&lt;system-shutdown/&gt; -- the server is being shut down and all active streams are being closed.
</li>
<li>&lt;undefined-condition/&gt; -- the error condition is not one of those defined by the other conditions in this list; this error condition SHOULD be used only in conjunction with an application-specific condition.
</li>
<li>&lt;unsupported-encoding/&gt; -- the initiating entity has encoded the stream in an encoding that is not supported by the server (see <a class='info' href='#xml-encoding'>Character Encoding<span> (</span><span class='info'>Character Encoding</span><span>)</span></a>).
</li>
<li>&lt;unsupported-stanza-type/&gt; -- the initiating entity has sent a first-level child of the stream that is not supported by the server.
</li>
<li>&lt;unsupported-version/&gt; -- the value of the 'version' attribute provided by the initiating entity in the stream header specifies a version of XMPP that is not supported by the server; the server MAY specify the version(s) it supports in the &lt;text/&gt; element.
</li>
<li>&lt;xml-not-well-formed/&gt; -- the initiating entity has sent XML that is not well-formed as defined by <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Bray, T., Paoli, J., Sperberg-McQueen, C., and E. Maler, &ldquo;Extensible Markup Language (XML) 1.0 (2nd ed),&rdquo; October&nbsp;2000.</span><span>)</span></a>.
</li>
</ul>

<a name="streams-error-app"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7.4"></a><h3>4.7.4.&nbsp;
Application-Specific Conditions</h3>

<p>As noted, an application MAY provide application-specific stream error information by including a properly-namespaced child in the error element.  The application-specific element SHOULD supplement or further qualify a defined element.  Thus the &lt;error/&gt; element will contain two or three child elements:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:error&gt;
  &lt;xml-not-well-formed
      xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
  &lt;text xml:lang='en' xmlns='urn:ietf:params:xml:ns:xmpp-streams'&gt;
    Some special application diagnostic information!
  &lt;/text&gt;
  &lt;escape-your-data xmlns='application-ns'/&gt;
&lt;/stream:error&gt;
&lt;/stream:stream&gt;
</pre></div>
<a name="streams-example"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.8"></a><h3>4.8.&nbsp;
Simplified Stream Examples</h3>

<p>This section contains two simplified examples of a stream-based "session" of a client on a server (where the "C" lines are sent from the client to the server, and the "S" lines are sent from the server to the client); these examples are included for the purpose of illustrating the concepts introduced thus far.
</p>
<p>A basic "session":
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       to='example.com'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'
       version='1.0'&gt;
S: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='example.com'
       id='someid'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'
       version='1.0'&gt;
...  encryption, authentication, and resource binding ...
C:   &lt;message from='juliet@example.com'
              to='romeo@example.net'
              xml:lang='en'&gt;
C:     &lt;body&gt;Art thou not Romeo, and a Montague?&lt;/body&gt;
C:   &lt;/message&gt;
S:   &lt;message from='romeo@example.net'
              to='juliet@example.com'
              xml:lang='en'&gt;
S:     &lt;body&gt;Neither, fair saint, if either thee dislike.&lt;/body&gt;
S:   &lt;/message&gt;
C: &lt;/stream:stream&gt;
S: &lt;/stream:stream&gt;
</pre></div>
<p>A "session" gone bad:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       to='example.com'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'
       version='1.0'&gt;
S: &lt;?xml version='1.0'?&gt;
   &lt;stream:stream
       from='example.com'
       id='someid'
       xmlns='jabber:client'
       xmlns:stream='http://etherx.jabber.org/streams'
       version='1.0'&gt;
...  encryption, authentication, and resource binding ...
C: &lt;message xml:lang='en'&gt;
     &lt;body&gt;Bad XML, no closing body tag!
   &lt;/message&gt;
S: &lt;stream:error&gt;
    &lt;xml-not-well-formed
        xmlns='urn:ietf:params:xml:ns:xmpp-streams'/&gt;
   &lt;/stream:error&gt;
S: &lt;/stream:stream&gt;
</pre></div>
<a name="tls"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Use of TLS</h3>

<a name="tls-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Overview</h3>

<p>XMPP includes a method for securing the stream from tampering and eavesdropping.  This channel encryption method makes use of the <a class='info' href='#TLS'>Transport Layer Security (TLS) protocol<span> (</span><span class='info'>Dierks, T., Allen, C., Treese, W., Karlton, P., Freier, A., and P. Kocher, &ldquo;The TLS Protocol Version 1.0,&rdquo; January&nbsp;1999.</span><span>)</span></a> [TLS], along with a "STARTTLS" extension that is modelled after similar extensions for the <a class='info' href='#IMAP'>IMAP<span> (</span><span class='info'>Crispin, M., &ldquo;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1,&rdquo; March&nbsp;2003.</span><span>)</span></a> [IMAP], <a class='info' href='#POP3'>POP3<span> (</span><span class='info'>Myers, J. and M. Rose, &ldquo;Post Office Protocol - Version 3,&rdquo; May&nbsp;1996.</span><span>)</span></a> [POP3], and <a class='info' href='#ACAP'>ACAP<span> (</span><span class='info'>Newman, C. and J. Myers, &ldquo;ACAP -- Application Configuration Access Protocol,&rdquo; November&nbsp;1997.</span><span>)</span></a> [ACAP] protocols as described in <a class='info' href='#USINGTLS'>RFC 2595<span> (</span><span class='info'>Newman, C., &ldquo;Using TLS with IMAP, POP3 and ACAP,&rdquo; June&nbsp;1999.</span><span>)</span></a> [USINGTLS].  The namespace name for the STARTTLS extension is 'urn:ietf:params:xml:ns:xmpp-tls'.
</p>
<p>An administrator of a given domain MAY require the use of TLS for client-to-server communications, server-to-server communications, or both.  Clients SHOULD use TLS to secure the streams prior to attempting the completion of <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>Use of SASL</span><span>)</span></a>, and servers SHOULD use TLS between two domains for the purpose of securing server-to-server communications.
</p>
<p>The following rules apply:
</p>
<p></p>
<ol class="text">
<li>An initiating entity that complies with this specification MUST include the 'version' attribute set to a value of "1.0" in the initial stream header.
</li>
<li>If the TLS negotiation occurs between two servers, communications MUST NOT proceed until the Domain Name System (DNS) hostnames asserted by the servers have been resolved (see <a class='info' href='#security-server'>Server-to-Server Communications<span> (</span><span class='info'>Server-to-Server Communications</span><span>)</span></a>).
</li>
<li>When a receiving entity that complies with this specification receives an initial stream header that includes the 'version' attribute set to a value of at least "1.0", after sending a stream header in reply (including the version flag), it MUST include a &lt;starttls/&gt; element (qualified by the 'urn:ietf:params:xml:ns:xmpp-tls' namespace) along with the list of other stream features it supports.
</li>
<li>If the initiating entity chooses to use TLS, TLS negotiation MUST be completed before proceeding to SASL negotiation; this order of negotiation is required to help safeguard authentication information sent during SASL negotiation, as well as to make it possible to base the use of the SASL EXTERNAL mechanism on a certificate provided during prior TLS negotiation.
</li>
<li>During TLS negotiation, an entity MUST NOT send any white space characters (matching production [3] content of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Bray, T., Paoli, J., Sperberg-McQueen, C., and E. Maler, &ldquo;Extensible Markup Language (XML) 1.0 (2nd ed),&rdquo; October&nbsp;2000.</span><span>)</span></a>) within the root stream element as separators between elements (any white space characters shown in the TLS examples below are included for the sake of readability only); this prohibition helps to ensure proper security layer byte precision.
</li>
<li>The receiving entity MUST consider the TLS negotiation to have begun immediately after sending the closing "&gt;" character of the &lt;proceed/&gt; element.  The initiating entity MUST consider the TLS negotiation to have begun immediately after receiving the closing "&gt;" character of the &lt;proceed/&gt; element from the receiving entity.
</li>
<li>The initiating entity MUST validate the certificate presented by the receiving entity; see <a class='info' href='#security-validation'>Certificate Validation<span> (</span><span class='info'>Certificate Validation</span><span>)</span></a> regarding certificate validation procedures.
</li>
<li>Certificates MUST be checked against the hostname as provided by the initiating entity (e.g., a user), not the hostname as resolved via the Domain Name System; e.g., if the user specifies a hostname of "example.com" but a <a class='info' href='#SRV'>DNS SRV<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> [SRV] lookup returned "im.example.com", the certificate MUST be checked as "example.com".  If a JID for any kind of XMPP entity (e.g., client or server) is represented in a certificate, it MUST be represented as a UTF8String within an otherName entity inside the subjectAltName, using the <a class='info' href='#ASN.1'>[ASN.1]<span> (</span><span class='info'>CCITT, &ldquo;Recommendation X.208: Specification of Abstract Syntax Notation One (ASN.1),&rdquo; 1988.</span><span>)</span></a> Object Identifier "id-on-xmppAddr" specified in <a class='info' href='#tls-overview-oid'>Section&nbsp;5.1.1<span> (</span><span class='info'>ASN.1 Object Identifier for XMPP Address</span><span>)</span></a> of this document.
</li>
<li>If the TLS negotiation is successful, the receiving entity MUST discard any knowledge obtained in an insecure manner from the initiating entity before TLS takes effect.
</li>
<li>If the TLS negotiation is successful, the initiating entity MUST discard any knowledge obtained in an insecure manner from the receiving entity before TLS takes effect.
</li>
<li>If the TLS negotiation is successful, the receiving entity MUST NOT offer the STARTTLS extension to the initiating entity along with the other stream features that are offered when the stream is restarted.
</li>
<li>If the TLS negotiation is successful, the initiating entity MUST continue with SASL negotiation.
</li>
<li>If the TLS negotiation results in failure, the receiving entity MUST terminate both the XML stream and the underlying TCP connection.
</li>
<li>See <a class='info' href='#security-mandatory'>Mandatory-to-Implement Technologies<span> (</span><span class='info'>Mandatory-to-Implement Technologies</span><span>)</span></a> regarding mechanisms that MUST be supported.
</li>
</ol>

<a name="tls-overview-oid"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1"></a><h3>5.1.1.&nbsp;
ASN.1 Object Identifier for XMPP Address</h3>

<p>The <a class='info' href='#ASN.1'>[ASN.1]<span> (</span><span class='info'>CCITT, &ldquo;Recommendation X.208: Specification of Abstract Syntax Notation One (ASN.1),&rdquo; 1988.</span><span>)</span></a> Object Identifier "id-on-xmppAddr" described above is defined as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
id-pkix OBJECT IDENTIFIER ::= { iso(1) identified-organization(3)
        dod(6) internet(1) security(5) mechanisms(5) pkix(7) }

id-on  OBJECT IDENTIFIER ::= { id-pkix 8 }  -- other name forms

id-on-xmppAddr  OBJECT IDENTIFIER ::= { id-on 5 }

XmppAddr ::= UTF8String
</pre></div>
<p>This Object Identifier MAY also be represented in dotted display format as "1.3.6.1.5.5.7.8.5".
</p>
<a name="tls-narr"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Narrative</h3>

<p>When an initiating entity secures a stream with a receiving entity using TLS, the steps involved are as follows:
</p>
<p></p>
<ol class="text">
<li>The initiating entity opens a TCP connection and initiates the stream by sending the opening XML stream header to the receiving entity, including the 'version' attribute set to a value of at least "1.0".
</li>
<li>The receiving entity responds by opening a TCP connection and sending an XML stream header to the initiating entity, including the 'version' attribute set to a value of at least "1.0".
</li>
<li>The receiving entity offers the STARTTLS extension to the initiating entity by including it with the list of other supported stream features (if TLS is required for interaction with the receiving entity, it SHOULD signal that fact by including a &lt;required/&gt; element as a child of the &lt;starttls/&gt; element).
</li>
<li>The initiating entity issues the STARTTLS command (i.e., a &lt;starttls/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-tls' namespace) to instruct the receiving entity that it wishes to begin a TLS negotiation to secure the stream.
</li>
<li>The receiving entity MUST reply with either a &lt;proceed/&gt; element or a &lt;failure/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-tls' namespace.  If the failure case occurs, the receiving entity MUST terminate both the XML stream and the underlying TCP connection.  If the proceed case occurs, the entities MUST attempt to complete the TLS negotiation over the TCP connection and MUST NOT send any further XML data until the TLS negotiation is complete.
</li>
<li>The initiating entity and receiving entity attempt to complete a TLS negotiation in accordance with <a class='info' href='#TLS'>[TLS]<span> (</span><span class='info'>Dierks, T., Allen, C., Treese, W., Karlton, P., Freier, A., and P. Kocher, &ldquo;The TLS Protocol Version 1.0,&rdquo; January&nbsp;1999.</span><span>)</span></a>.
</li>
<li>If the TLS negotiation is unsuccessful, the receiving entity MUST terminate the TCP connection.  If the TLS negotiation is successful, the initiating entity MUST initiate a new stream by sending an opening XML stream header to the receiving entity (it is not necessary to send a closing &lt;/stream&gt; tag first, since the receiving entity and initiating entity MUST consider the original stream to be closed upon successful TLS negotiation).
</li>
<li>Upon receiving the new stream header from the initiating entity, the receiving entity MUST respond by sending a new XML stream header to the initiating entity along with the available features (but not including the STARTTLS feature).
</li>
</ol>

<a name="tls-client"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Client-to-Server Example</h3>

<p>The following example shows the data flow for a client securing a stream using STARTTLS (note: the alternate steps shown below are provided to illustrate the protocol for failure cases; they are not exhaustive and would not necessarily be triggered by the data sent in the example).
</p>
<p>Step 1: Client initiates stream to server:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns='jabber:client'
    xmlns:stream='http://etherx.jabber.org/streams'
    to='example.com'
    version='1.0'&gt;
</pre></div>
<p>Step 2: Server responds by sending a stream tag to client:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns='jabber:client'
    xmlns:stream='http://etherx.jabber.org/streams'
    id='c2s_123'
    from='example.com'
    version='1.0'&gt;
</pre></div>
<p>Step 3: Server sends the STARTTLS extension to client along with authentication mechanisms and any other stream features:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:features&gt;
  &lt;starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'&gt;
    &lt;required/&gt;
  &lt;/starttls&gt;
  &lt;mechanisms xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
    &lt;mechanism&gt;DIGEST-MD5&lt;/mechanism&gt;
    &lt;mechanism&gt;PLAIN&lt;/mechanism&gt;
  &lt;/mechanisms&gt;
&lt;/stream:features&gt;
</pre></div>
<p>Step 4: Client sends the STARTTLS command to server:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'/&gt;
</pre></div>
<p>Step 5: Server informs client that it is allowed to proceed:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;proceed xmlns='urn:ietf:params:xml:ns:xmpp-tls'/&gt;
</pre></div>
<p>Step 5 (alt): Server informs client that TLS negotiation has failed and closes both stream and TCP connection:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-tls'/&gt;
&lt;/stream:stream&gt;
</pre></div>
<p>Step 6: Client and server attempt to complete TLS negotiation over the existing TCP connection.
</p>
<p>Step 7: If TLS negotiation is successful, client initiates a new stream to server:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns='jabber:client'
    xmlns:stream='http://etherx.jabber.org/streams'
    to='example.com'
    version='1.0'&gt;
</pre></div>
<p>Step 7 (alt): If TLS negotiation is unsuccessful, server closes TCP connection.
</p>
<p>Step 8: Server responds by sending a stream header to client along with any available stream features:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns='jabber:client'
    xmlns:stream='http://etherx.jabber.org/streams'
    from='example.com'
    id='c2s_234'
    version='1.0'&gt;
&lt;stream:features&gt;
  &lt;mechanisms xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
    &lt;mechanism&gt;DIGEST-MD5&lt;/mechanism&gt;
    &lt;mechanism&gt;PLAIN&lt;/mechanism&gt;
    &lt;mechanism&gt;EXTERNAL&lt;/mechanism&gt;
  &lt;/mechanisms&gt;
&lt;/stream:features&gt;
</pre></div>
<p>Step 9: Client continues with <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>Use of SASL</span><span>)</span></a>.
</p>
<a name="tls-server"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Server-to-Server Example</h3>

<p>The following example shows the data flow for two servers securing a stream using STARTTLS (note: the alternate steps shown below are provided to illustrate the protocol for failure cases; they are not exhaustive and would not necessarily be triggered by the data sent in the example).
</p>
<p>Step 1: Server1 initiates stream to Server2:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns='jabber:server'
    xmlns:stream='http://etherx.jabber.org/streams'
    to='example.com'
    version='1.0'&gt;
</pre></div>
<p>Step 2: Server2 responds by sending a stream tag to Server1:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns='jabber:server'
    xmlns:stream='http://etherx.jabber.org/streams'
    from='example.com'
    id='s2s_123'
    version='1.0'&gt;
</pre></div>
<p>Step 3: Server2 sends the STARTTLS extension to Server1 along with authentication mechanisms and any other stream features:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:features&gt;
  &lt;starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'&gt;
    &lt;required/&gt;
  &lt;/starttls&gt;
  &lt;mechanisms xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
    &lt;mechanism&gt;DIGEST-MD5&lt;/mechanism&gt;
    &lt;mechanism&gt;KERBEROS_V4&lt;/mechanism&gt;
  &lt;/mechanisms&gt;
&lt;/stream:features&gt;
</pre></div>
<p>Step 4: Server1 sends the STARTTLS command to Server2:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'/&gt;
</pre></div>
<p>Step 5: Server2 informs Server1 that it is allowed to proceed:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;proceed xmlns='urn:ietf:params:xml:ns:xmpp-tls'/&gt;
</pre></div>
<p>Step 5 (alt): Server2 informs Server1 that TLS negotiation has failed and closes stream:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-tls'/&gt;
&lt;/stream:stream&gt;
</pre></div>
<p>Step 6: Server1 and Server2 attempt to complete TLS negotiation via TCP.
</p>
<p>Step 7: If TLS negotiation is successful, Server1 initiates a new stream to Server2:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns='jabber:server'
    xmlns:stream='http://etherx.jabber.org/streams'
    to='example.com'
    version='1.0'&gt;
</pre></div>
<p>Step 7 (alt): If TLS negotiation is unsuccessful, Server2 closes TCP connection.
</p>
<p>Step 8: Server2 responds by sending a stream header to Server1 along with any available stream features:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns='jabber:server'
    xmlns:stream='http://etherx.jabber.org/streams'
    from='example.com'
    id='s2s_234'
    version='1.0'&gt;
&lt;stream:features&gt;
  &lt;mechanisms xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
    &lt;mechanism&gt;DIGEST-MD5&lt;/mechanism&gt;
    &lt;mechanism&gt;KERBEROS_V4&lt;/mechanism&gt;
    &lt;mechanism&gt;EXTERNAL&lt;/mechanism&gt;
  &lt;/mechanisms&gt;
&lt;/stream:features&gt;
</pre></div>
<p>Step 9: Server1 continues with <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>Use of SASL</span><span>)</span></a>.
</p>
<a name="sasl"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Use of SASL</h3>

<a name="sasl-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Overview</h3>

<p>XMPP includes a method for authenticating a stream by means of an XMPP-specific profile of the <a class='info' href='#SASL'>Simple Authentication and Security Layer (SASL) protocol<span> (</span><span class='info'>Myers, J., &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; October&nbsp;1997.</span><span>)</span></a> [SASL].  SASL provides a generalized method for adding authentication support to connection-based protocols, and XMPP uses a generic XML namespace profile for SASL that conforms to the profiling requirements of <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Myers, J., &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; October&nbsp;1997.</span><span>)</span></a>.
</p>
<p>The following rules apply:
</p>
<p></p>
<ol class="text">
<li>If the SASL negotiation occurs between two servers, communications MUST NOT proceed until the Domain Name System (DNS) hostnames asserted by the servers have been resolved (see <a class='info' href='#security-server'>Server-to-Server Communications<span> (</span><span class='info'>Server-to-Server Communications</span><span>)</span></a>).
</li>
<li>If the initiating entity is capable of SASL negotiation, it MUST include the 'version' attribute set to a value of at least "1.0" in the initial stream header.
</li>
<li>If the receiving entity is capable of SASL negotiation, it MUST advertise one or more authentication mechanisms within a &lt;mechanisms/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace in reply to the opening stream tag received from the initiating entity (if the opening stream tag included the 'version' attribute set to a value of at least "1.0").
</li>
<li>During SASL negotiation, an entity MUST NOT send any white space characters (matching production [3] content of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Bray, T., Paoli, J., Sperberg-McQueen, C., and E. Maler, &ldquo;Extensible Markup Language (XML) 1.0 (2nd ed),&rdquo; October&nbsp;2000.</span><span>)</span></a>) within the root stream element as separators between elements (any white space characters shown in the SASL examples below are included for the sake of readability only); this prohibition helps to ensure proper security layer byte precision.
</li>
<li>Any XML character data contained within the XML elements used during SASL negotiation MUST be encoded using base64, where the encoding adheres to the definition in Section 3 of <a class='info' href='#BASE64'>RFC 3548<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; July&nbsp;2003.</span><span>)</span></a> [BASE64].
</li>
<li>If provision of a "simple username" is supported by the selected SASL mechanism (e.g., this is supported by the DIGEST-MD5 and CRAM-MD5 mechanisms but not by the EXTERNAL and GSSAPI mechanisms), during authentication the initiating entity SHOULD provide as the simple username its sending domain (IP address or fully qualified domain name as contained in a domain identifier) in the case of server-to-server communications or its registered account name (user or node name as contained in an XMPP node identifier) in the case of client-to-server communications.
</li>
<li>If the initiating entity wishes to act on behalf of another entity and the selected SASL mechanism supports transmission of an authorization identity, the initiating entity MUST provide an authorization identity during SASL negotiation.  If the initiating entity does not wish to act on behalf of another entity, it MUST NOT provide an authorization identity.  As specified in <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Myers, J., &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; October&nbsp;1997.</span><span>)</span></a>, the initiating entity MUST NOT provide an authorization identity unless the authorization identity is different from the default authorization identity derived from the authentication identity, as described in <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Myers, J., &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; October&nbsp;1997.</span><span>)</span></a>.  If provided, the value of the authorization identity MUST be of the form &lt;domain&gt; (i.e., a domain identifier only) for servers and of the form &lt;node@domain&gt; (i.e., node identifier and domain identifier) for clients.
</li>
<li>Upon successful SASL negotiation that involves negotiation of a security layer, the receiving entity MUST discard any knowledge obtained from the initiating entity which was not obtained from the SASL negotiation itself.
</li>
<li>Upon successful SASL negotiation that involves negotiation of a security layer, the initiating entity MUST discard any knowledge obtained from the receiving entity which was not obtained from the SASL negotiation itself.
</li>
<li>See <a class='info' href='#security-mandatory'>Mandatory-to-Implement Technologies<span> (</span><span class='info'>Mandatory-to-Implement Technologies</span><span>)</span></a> regarding mechanisms that MUST be supported.
</li>
</ol>

<a name="sasl-narr"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Narrative</h3>

<p>When an initiating entity authenticates with a receiving entity using SASL, the steps involved are as follows:
</p>
<p></p>
<ol class="text">
<li>The initiating entity requests SASL authentication by including the 'version' attribute in the opening XML stream header sent to the receiving entity, with the value set to "1.0".
</li>
<li>After sending an XML stream header in reply, the receiving entity advertises a list of available SASL authentication mechanisms; each of these is a &lt;mechanism/&gt; element included as a child within a &lt;mechanisms/&gt; container element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace, which in turn is a child of a &lt;features/&gt; element in the streams namespace.  If <a class='info' href='#tls'>Use of TLS<span> (</span><span class='info'>Use of TLS</span><span>)</span></a> needs to be established before a particular authentication mechanism may be used, the receiving entity MUST NOT provide that mechanism in the list of available SASL authentication mechanisms prior to TLS negotiation.  If the initiating entity presents a valid certificate during prior TLS negotiation, the receiving entity SHOULD offer the SASL EXTERNAL mechanism to the initiating entity during SASL negotiation (refer to <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Myers, J., &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; October&nbsp;1997.</span><span>)</span></a>), although the EXTERNAL mechanism MAY be offered under other circumstances as well.
</li>
<li>The initiating entity selects a mechanism by sending an &lt;auth/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace to the receiving entity and including an appropriate value for the 'mechanism' attribute.  This element MAY contain XML character data (in SASL terminology, the "initial response") if the mechanism supports or requires it; if the initiating entity needs to send a zero-length initial response, it MUST transmit the response as a single equals sign ("="), which indicates that the response is present but contains no data.
</li>
<li>If necessary, the receiving entity challenges the initiating entity by sending a &lt;challenge/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace to the initiating entity; this element MAY contain XML character data (which MUST be computed in accordance with the definition of the SASL mechanism chosen by the initiating entity).
</li>
<li>The initiating entity responds to the challenge by sending a &lt;response/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace to the receiving entity; this element MAY contain XML character data (which MUST be computed in accordance with the definition of the SASL mechanism chosen by the initiating entity).
</li>
<li>If necessary, the receiving entity sends more challenges and the initiating entity sends more responses.
</li>
</ol>

<p>This series of challenge/response pairs continues until one of three things happens:
</p>
<p></p>
<ol class="text">
<li>The initiating entity aborts the handshake by sending an &lt;abort/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace to the receiving entity.  Upon receiving an &lt;abort/&gt; element, the receiving entity SHOULD allow a configurable but reasonable number of retries (at least 2), after which it MUST terminate the TCP connection; this enables the initiating entity (e.g., an end-user client) to tolerate incorrectly-provided credentials (e.g., a mistyped password) without being forced to reconnect.
</li>
<li>The receiving entity reports failure of the handshake by sending a &lt;failure/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace to the initiating entity (the particular cause of failure SHOULD be communicated in an appropriate child element of the &lt;failure/&gt; element as defined under <a class='info' href='#sasl-errors'>SASL Errors<span> (</span><span class='info'>SASL Errors</span><span>)</span></a>).  If the failure case occurs, the receiving entity SHOULD allow a configurable but reasonable number of retries (at least 2), after which it MUST terminate the TCP connection; this enables the initiating entity (e.g., an end-user client) to tolerate incorrectly-provided credentials (e.g., a mistyped password) without being forced to reconnect.
</li>
<li>The receiving entity reports success of the handshake by sending a &lt;success/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-sasl' namespace to the initiating entity; this element MAY contain XML character data (in SASL terminology, "additional data with success") if required by the chosen SASL mechanism.  Upon receiving the &lt;success/&gt; element, the initiating entity MUST initiate a new stream by sending an opening XML stream header to the receiving entity (it is not necessary to send a closing &lt;/stream&gt; tag first, since the receiving entity and initiating entity MUST consider the original stream to be closed upon sending or receiving the &lt;success/&gt; element).  Upon receiving the new stream header from the initiating entity, the receiving entity MUST respond by sending a new XML stream header to the initiating entity, along with any available features (but not including the STARTTLS and SASL features) or an empty &lt;features/&gt; element (to signify that no additional features are available); any such additional features not defined herein MUST be defined by the relevant extension to XMPP.
</li>
</ol>

<a name="sasl-def"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
SASL Definition</h3>

<p>The profiling requirements of <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Myers, J., &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; October&nbsp;1997.</span><span>)</span></a> require that the following information be supplied by a protocol definition:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>service name:</dt>
<dd>"xmpp"
</dd>
<dt>initiation sequence:</dt>
<dd>After the initiating entity provides an opening XML stream header and the receiving entity replies in kind, the receiving entity provides a list of acceptable authentication methods.  The initiating entity chooses one method from the list and sends it to the receiving entity as the value of the 'mechanism' attribute possessed by an &lt;auth/&gt; element, optionally including an initial response to avoid a round trip.
</dd>
<dt>exchange sequence:</dt>
<dd>Challenges and responses are carried through the exchange of &lt;challenge/&gt; elements from receiving entity to initiating entity and &lt;response/&gt; elements from initiating entity to receiving entity.  The receiving entity reports failure by sending a &lt;failure/&gt; element and success by sending a &lt;success/&gt; element; the initiating entity aborts the exchange by sending an &lt;abort/&gt; element.  Upon successful negotiation, both sides consider the original XML stream to be closed and new stream headers are sent by both entities.
</dd>
<dt>security layer negotiation:</dt>
<dd>The security layer takes effect immediately after sending the closing "&gt;" character of the &lt;success/&gt; element for the receiving entity, and immediately after receiving the closing "&gt;" character of the &lt;success/&gt; element for the initiating entity.  The order of layers is first <a class='info' href='#TCP'>[TCP]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>, then <a class='info' href='#TLS'>[TLS]<span> (</span><span class='info'>Dierks, T., Allen, C., Treese, W., Karlton, P., Freier, A., and P. Kocher, &ldquo;The TLS Protocol Version 1.0,&rdquo; January&nbsp;1999.</span><span>)</span></a>, then <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Myers, J., &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; October&nbsp;1997.</span><span>)</span></a>, then XMPP.
</dd>
<dt>use of the authorization identity:</dt>
<dd>The authorization identity may be used by xmpp to denote the non-default &lt;node@domain&gt; of a client or the sending &lt;domain&gt; of a server.
</dd>
</dl></blockquote>

<a name="sasl-errors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
SASL Errors</h3>

<p>The following SASL-related error conditions are defined:
</p>
<p></p>
<ul class="text">
<li>&lt;aborted/&gt; -- The receiving entity acknowledges an &lt;abort/&gt; element sent by the initiating entity; sent in reply to the &lt;abort/&gt; element.
</li>
<li>&lt;incorrect-encoding/&gt; -- The data provided by the initiating entity could not be processed because the <a class='info' href='#BASE64'>[BASE64]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; July&nbsp;2003.</span><span>)</span></a> encoding is incorrect (e.g., because the encoding does not adhere to the definition in Section 3 of <a class='info' href='#BASE64'>[BASE64]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; July&nbsp;2003.</span><span>)</span></a>); sent in reply to a &lt;response/&gt; element or an &lt;auth/&gt; element with initial response data.
</li>
<li>&lt;invalid-authzid/&gt; -- The authzid provided by the initiating entity is invalid, either because it is incorrectly formatted or because the initiating entity does not have permissions to authorize that ID; sent in reply to a &lt;response/&gt; element or an &lt;auth/&gt; element with initial response data.
</li>
<li>&lt;invalid-mechanism/&gt; -- The initiating entity did not provide a mechanism or requested a mechanism that is not supported by the receiving entity; sent in reply to an &lt;auth/&gt; element.
</li>
<li>&lt;mechanism-too-weak/&gt; -- The mechanism requested by the initiating entity is weaker than server policy permits for that initiating entity; sent in reply to a &lt;response/&gt; element or an &lt;auth/&gt; element with initial response data.
</li>
<li>&lt;not-authorized/&gt; -- The authentication failed because the initiating entity did not provide valid credentials (this includes but is not limited to the case of an unknown username); sent in reply to a &lt;response/&gt; element or an &lt;auth/&gt; element with initial response data.
</li>
<li>&lt;temporary-auth-failure/&gt; -- The authentication failed because of a temporary error condition within the receiving entity; sent in reply to an &lt;auth/&gt; element or &lt;response/&gt; element.
</li>
</ul>

<a name="sasl-client"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.5"></a><h3>6.5.&nbsp;
Client-to-Server Example</h3>

<p>The following example shows the data flow for a client authenticating with a server using SASL, normally after successful TLS negotiation (note: the alternate steps shown below are provided to illustrate the protocol for failure cases; they are not exhaustive and would not necessarily be triggered by the data sent in the example).
</p>
<p>Step 1: Client initiates stream to server:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns='jabber:client'
    xmlns:stream='http://etherx.jabber.org/streams'
    to='example.com'
    version='1.0'&gt;
</pre></div>
<p>Step 2: Server responds with a stream tag sent to client:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns='jabber:client'
    xmlns:stream='http://etherx.jabber.org/streams'
    id='c2s_234'
    from='example.com'
    version='1.0'&gt;
</pre></div>
<p>Step 3: Server informs client of available authentication mechanisms:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:features&gt;
  &lt;mechanisms xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
    &lt;mechanism&gt;DIGEST-MD5&lt;/mechanism&gt;
    &lt;mechanism&gt;PLAIN&lt;/mechanism&gt;
  &lt;/mechanisms&gt;
&lt;/stream:features&gt;
</pre></div>
<p>Step 4: Client selects an authentication mechanism:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl'
      mechanism='DIGEST-MD5'/&gt;
</pre></div>
<p>Step 5: Server sends a <a class='info' href='#BASE64'>[BASE64]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; July&nbsp;2003.</span><span>)</span></a> encoded challenge to client:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;challenge xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
cmVhbG09InNvbWVyZWFsbSIsbm9uY2U9Ik9BNk1HOXRFUUdtMmhoIixxb3A9ImF1dGgi
LGNoYXJzZXQ9dXRmLTgsYWxnb3JpdGhtPW1kNS1zZXNzCg==
&lt;/challenge&gt;</pre></div>
<p>The decoded challenge is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
realm="somerealm",nonce="OA6MG9tEQGm2hh",\
qop="auth",charset=utf-8,algorithm=md5-sess
</pre></div>
<p>Step 5 (alt): Server returns error to client:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
  &lt;incorrect-encoding/&gt;
&lt;/failure&gt;
&lt;/stream:stream&gt;
</pre></div>
<p>Step 6: Client sends a <a class='info' href='#BASE64'>[BASE64]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; July&nbsp;2003.</span><span>)</span></a> encoded response to the challenge:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
dXNlcm5hbWU9InNvbWVub2RlIixyZWFsbT0ic29tZXJlYWxtIixub25jZT0i
T0E2TUc5dEVRR20yaGgiLGNub25jZT0iT0E2TUhYaDZWcVRyUmsiLG5jPTAw
MDAwMDAxLHFvcD1hdXRoLGRpZ2VzdC11cmk9InhtcHAvZXhhbXBsZS5jb20i
LHJlc3BvbnNlPWQzODhkYWQ5MGQ0YmJkNzYwYTE1MjMyMWYyMTQzYWY3LGNo
YXJzZXQ9dXRmLTgK
&lt;/response&gt;</pre></div>
<p>The decoded response is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
username="somenode",realm="somerealm",\
nonce="OA6MG9tEQGm2hh",cnonce="OA6MHXh6VqTrRk",\
nc=00000001,qop=auth,digest-uri="xmpp/example.com",\
response=d388dad90d4bbd760a152321f2143af7,charset=utf-8
</pre></div>
<p>Step 7: Server sends another <a class='info' href='#BASE64'>[BASE64]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; July&nbsp;2003.</span><span>)</span></a> encoded challenge to client:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;challenge xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
cnNwYXV0aD1lYTQwZjYwMzM1YzQyN2I1NTI3Yjg0ZGJhYmNkZmZmZAo=
&lt;/challenge&gt;</pre></div>
<p>The decoded challenge is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
rspauth=ea40f60335c427b5527b84dbabcdfffd
</pre></div>
<p>Step 7 (alt): Server returns error to client:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
  &lt;temporary-auth-failure/&gt;
&lt;/failure&gt;
&lt;/stream:stream&gt;
</pre></div>
<p>Step 8: Client responds to the challenge:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/&gt;
</pre></div>
<p>Step 9: Server informs client of successful authentication:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;success xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/&gt;
</pre></div>
<p>Step 9 (alt): Server informs client of failed authentication:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
  &lt;temporary-auth-failure/&gt;
&lt;/failure&gt;
&lt;/stream:stream&gt;
</pre></div>
<p>Step 10: Client initiates a new stream to server:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns='jabber:client'
    xmlns:stream='http://etherx.jabber.org/streams'
    to='example.com'
    version='1.0'&gt;
</pre></div>
<p>Step 11: Server responds by sending a stream header to client along with any additional features (or an empty features element):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns='jabber:client'
    xmlns:stream='http://etherx.jabber.org/streams'
    id='c2s_345'
    from='example.com'
    version='1.0'&gt;
&lt;stream:features&gt;
  &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'/&gt;
  &lt;session xmlns='urn:ietf:params:xml:ns:xmpp-session'/&gt;
&lt;/stream:features&gt;
</pre></div>
<a name="sasl-server"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.6"></a><h3>6.6.&nbsp;
Server-to-Server Example</h3>

<p>The following example shows the data flow for a server authenticating with another server using SASL, normally after successful TLS negotiation (note: the alternate steps shown below are provided to illustrate the protocol for failure cases; they are not exhaustive and would not necessarily be triggered by the data sent in the example).
</p>
<p>Step 1: Server1 initiates stream to Server2:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns='jabber:server'
    xmlns:stream='http://etherx.jabber.org/streams'
    to='example.com'
    version='1.0'&gt;
</pre></div>
<p>Step 2: Server2 responds with a stream tag sent to Server1:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns='jabber:server'
    xmlns:stream='http://etherx.jabber.org/streams'
    from='example.com'
    id='s2s_234'
    version='1.0'&gt;
</pre></div>
<p>Step 3: Server2 informs Server1 of available authentication mechanisms:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:features&gt;
  &lt;mechanisms xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
    &lt;mechanism&gt;DIGEST-MD5&lt;/mechanism&gt;
    &lt;mechanism&gt;KERBEROS_V4&lt;/mechanism&gt;
  &lt;/mechanisms&gt;
&lt;/stream:features&gt;
</pre></div>
<p>Step 4: Server1 selects an authentication mechanism:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl'
      mechanism='DIGEST-MD5'/&gt;
</pre></div>
<p>Step 5: Server2 sends a <a class='info' href='#BASE64'>[BASE64]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; July&nbsp;2003.</span><span>)</span></a> encoded challenge to Server1:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;challenge xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
cmVhbG09InNvbWVyZWFsbSIsbm9uY2U9Ik9BNk1HOXRFUUdtMmhoIixxb3A9
ImF1dGgiLGNoYXJzZXQ9dXRmLTgsYWxnb3JpdGhtPW1kNS1zZXNz
&lt;/challenge&gt;</pre></div>
<p>The decoded challenge is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
realm="somerealm",nonce="OA6MG9tEQGm2hh",\
qop="auth",charset=utf-8,algorithm=md5-sess
</pre></div>
<p>Step 5 (alt): Server2 returns error to Server1:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
  &lt;incorrect-encoding/&gt;
&lt;/failure&gt;
&lt;/stream:stream&gt;
</pre></div>
<p>Step 6: Server1 sends a <a class='info' href='#BASE64'>[BASE64]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; July&nbsp;2003.</span><span>)</span></a> encoded response to the challenge:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
dXNlcm5hbWU9ImV4YW1wbGUub3JnIixyZWFsbT0ic29tZXJlYWxtIixub25j
ZT0iT0E2TUc5dEVRR20yaGgiLGNub25jZT0iT0E2TUhYaDZWcVRyUmsiLG5j
PTAwMDAwMDAxLHFvcD1hdXRoLGRpZ2VzdC11cmk9InhtcHAvZXhhbXBsZS5v
cmciLHJlc3BvbnNlPWQzODhkYWQ5MGQ0YmJkNzYwYTE1MjMyMWYyMTQzYWY3
LGNoYXJzZXQ9dXRmLTgK
&lt;/response&gt;</pre></div>
<p>The decoded response is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
username="example.org",realm="somerealm",\
nonce="OA6MG9tEQGm2hh",cnonce="OA6MHXh6VqTrRk",\
nc=00000001,qop=auth,digest-uri="xmpp/example.org",\
response=d388dad90d4bbd760a152321f2143af7,charset=utf-8
</pre></div>
<p>Step 7: Server2 sends another <a class='info' href='#BASE64'>[BASE64]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; July&nbsp;2003.</span><span>)</span></a> encoded challenge to Server1:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;challenge xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
cnNwYXV0aD1lYTQwZjYwMzM1YzQyN2I1NTI3Yjg0ZGJhYmNkZmZmZAo=
&lt;/challenge&gt;</pre></div>
<p>The decoded challenge is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
rspauth=ea40f60335c427b5527b84dbabcdfffd
</pre></div>
<p>Step 7 (alt): Server2 returns error to Server1:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
  &lt;invalid-authzid/&gt;
&lt;/failure&gt;
&lt;/stream:stream&gt;
</pre></div>
<p>Step 8: Server1 responds to the challenge:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/&gt;
</pre></div>
<p>Step 8 (alt): Server1 aborts negotiation:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;abort xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/&gt;
</pre></div>
<p>Step 9: Server2 informs Server1 of successful authentication:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;success xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/&gt;
</pre></div>
<p>Step 9 (alt): Server2 informs Server1 of failed authentication:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
  &lt;aborted/&gt;
&lt;/failure&gt;
&lt;/stream:stream&gt;
</pre></div>
<p>Step 10: Server1 initiates a new stream to Server2:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns='jabber:server'
    xmlns:stream='http://etherx.jabber.org/streams'
    to='example.com'
    version='1.0'&gt;
</pre></div>
<p>Step 11: Server2 responds by sending a stream header to Server1 along with any additional features (or an empty features element):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns='jabber:server'
    xmlns:stream='http://etherx.jabber.org/streams'
    from='example.com'
    id='s2s_345'
    version='1.0'&gt;
&lt;stream:features/&gt;
</pre></div>
<a name="bind"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Resource Binding</h3>

<p>After <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>Use of SASL</span><span>)</span></a> with the receiving entity, the initiating entity MAY want or need to bind a specific resource to that stream.  In general this applies only to clients: in order to conform to the <a class='info' href='#addressing'>addressing format<span> (</span><span class='info'>Addressing Scheme</span><span>)</span></a> and <a class='info' href='#rules'>stanza delivery rules<span> (</span><span class='info'>Server Rules for Handling XML Stanzas</span><span>)</span></a> specified herein, there MUST be a resource identifier associated with the &lt;node@domain&gt; of the client (which is either generated by the server or provided by the client application); this ensures that the address for use over that stream is a "full JID" of the form &lt;node@domain/resource&gt;.
</p>
<p>Upon receiving a success indication within the SASL negotiation, the client MUST send a new stream header to the server, to which the server MUST respond with a stream header as well as a list of available stream features.  Specifically, if the server requires the client to bind a resource to the stream after successful SASL negotiation, it MUST include an empty &lt;bind/&gt; element qualified by the 'urn:ietf:params:xml:ns:xmpp-bind' namespace in the stream features list it presents to the client upon sending the header for the response stream sent after successful SASL negotiation (but not before):
</p>
<p>Server advertises resource binding feature to client:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns='jabber:client'
    xmlns:stream='http://etherx.jabber.org/streams'
    id='c2s_345'
    from='example.com'
    version='1.0'&gt;
&lt;stream:features&gt;
  &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'/&gt;
&lt;/stream:features&gt;
</pre></div>
<p>Upon being so informed that resource binding is required, the client MUST bind a resource to the stream by sending to the server an IQ stanza of type "set" (see <a class='info' href='#stanzas-semantics-iq'>IQ Semantics<span> (</span><span class='info'>IQ Semantics</span><span>)</span></a>) containing data qualified by the 'urn:ietf:params:xml:ns:xmpp-bind' namespace.
</p>
<p>If the client wishes to allow the server to generate the resource identifier on its behalf, it sends an IQ stanza of type "set" that contains an empty &lt;bind/&gt; element:
</p>
<p>Client asks server to bind a resource:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;iq type='set' id='bind_1'&gt;
  &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'/&gt;
&lt;/iq&gt;
</pre></div>
<p>A server that supports resource binding MUST be able to generate a resource identifier on behalf of a client.  A resource identifier generated by the server MUST be unique for that &lt;node@domain&gt;.
</p>
<p>If the client wishes to specify the resource identifier, it sends an IQ stanza of type "set" that contains the desired resource identifier as the XML character data of a &lt;resource/&gt; element that is a child of the &lt;bind/&gt; element:
</p>
<p>Client binds a resource:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;iq type='set' id='bind_2'&gt;
  &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
    &lt;resource&gt;someresource&lt;/resource&gt;
  &lt;/bind&gt;
&lt;/iq&gt;
</pre></div>
<p>Once the server has generated a resource identifier for the client or accepted the resource identifier provided by the client, it MUST return an IQ stanza of type "result" to the client, which MUST include a &lt;jid/&gt; child element that specifies the full JID for the connected resource as determined by the server:
</p>
<p>Server informs client of successful resource binding:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;iq type='result' id='bind_2'&gt;
  &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
    &lt;jid&gt;somenode@example.com/someresource&lt;/jid&gt;
  &lt;/bind&gt;
&lt;/iq&gt;
</pre></div>
<p>A server SHOULD accept the resource identifier provided by the client, but MAY override it with a resource identifier that the server generates; in this case, the server SHOULD NOT return a stanza error (e.g., &lt;forbidden/&gt;) to the client but instead SHOULD communicate the generated resource identifier to the client in the IQ result as shown above.
</p>
<p>When a client supplies a resource identifier, the following stanza error conditions are possible (see <a class='info' href='#stanzas-error'>Stanza Errors<span> (</span><span class='info'>Stanza Errors</span><span>)</span></a>):
</p>
<p></p>
<ul class="text">
<li>The provided resource identifier cannot be processed by the server in accordance with <a class='info' href='#resourceprep'>Resourceprep<span> (</span><span class='info'>Resourceprep</span><span>)</span></a>.
</li>
<li>The client is not allowed to bind a resource to the stream (e.g., because the node or user has reached a limit on the number of connected resources allowed).
</li>
<li>The provided resource identifier is already in use but the server does not allow binding of multiple connected resources with the same identifier.
</li>
</ul>

<p>The protocol for these error conditions is shown below.
</p>
<p>Resource identifier cannot be processed:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;iq type='error' id='bind_2'&gt;
  &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
    &lt;resource&gt;someresource&lt;/resource&gt;
  &lt;/bind&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>
<p>Client is not allowed to bind a resource:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;iq type='error' id='bind_2'&gt;
  &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
    &lt;resource&gt;someresource&lt;/resource&gt;
  &lt;/bind&gt;
  &lt;error type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>
<p>Resource identifier is in use:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;iq type='error' id='bind_2'&gt;
  &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
    &lt;resource&gt;someresource&lt;/resource&gt;
  &lt;/bind&gt;
  &lt;error type='cancel'&gt;
    &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>
<p>If, before completing the resource binding step, the client attempts to send an XML stanza other than an IQ stanza with a &lt;bind/&gt; child qualified by the 'urn:ietf:params:xml:ns:xmpp-bind' namespace, the server MUST NOT process the stanza and SHOULD return a &lt;not-authorized/&gt; stanza error to the client.
</p>
<a name="dialback"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Server Dialback</h3>

<a name="dialback-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Overview</h3>

<p>The Jabber protocols from which XMPP was adapted include a "server dialback" method for protecting against domain spoofing, thus making it more difficult to spoof XML stanzas.  Server dialback is not a security mechanism, and results in weak verification of server identities only (see <a class='info' href='#security-server'>Server-to-Server Communications<span> (</span><span class='info'>Server-to-Server Communications</span><span>)</span></a> regarding this method's security characteristics).  Domains requiring robust security SHOULD use TLS and SASL; see <a class='info' href='#security-server'>Server-to-Server Communications<span> (</span><span class='info'>Server-to-Server Communications</span><span>)</span></a> for details.  If SASL is used for server-to-server authentication, dialback SHOULD NOT be used since it is unnecessary.  Documentation of dialback is included mainly for the sake of backward-compatibility with existing implementations and deployments.
</p>
<p>The server dialback method is made possible by the existence of the Domain Name System (DNS), since one server can (normally) discover the authoritative server for a given domain.  Because dialback depends on DNS, inter-domain communications MUST NOT proceed until the Domain Name System (DNS) hostnames asserted by the servers have been resolved (see <a class='info' href='#security-server'>Server-to-Server Communications<span> (</span><span class='info'>Server-to-Server Communications</span><span>)</span></a>).
</p>
<p>Server dialback is uni-directional, and results in (weak) verification of identities for one stream in one direction.  Because server dialback is not an authentication mechanism, mutual authentication is not possible via dialback.  Therefore, server dialback MUST be completed in each direction in order to enable bi-directional communications between two domains.
</p>
<p>The method for generating and verifying the keys used in server dialback MUST take into account the hostnames being used, the stream ID generated by the receiving server, and a secret known by the authoritative server's network.  The stream ID is security-critical in server dialback and therefore MUST be both unpredictable and non-repeating (see <a class='info' href='#RANDOM'>[RANDOM]<span> (</span><span class='info'>Eastlake, D., Crocker, S., and J. Schiller, &ldquo;Randomness Recommendations for Security,&rdquo; December&nbsp;1994.</span><span>)</span></a> for recommendations regarding randomness for security purposes).
</p>
<p>Any error that occurs during dialback negotiation MUST be considered a stream error, resulting in termination of the stream and of the underlying TCP connection.  The possible error conditions are specified in the protocol description below.
</p>
<p>The following terminology applies:
</p>
<p></p>
<ul class="text">
<li>Originating Server -- the server that is attempting to establish a connection between two domains.
</li>
<li>Receiving Server -- the server that is trying to authenticate that the Originating Server represents the domain which it claims to be.
</li>
<li>Authoritative Server -- the server that answers to the DNS hostname asserted by the Originating Server; for basic environments this will be the Originating Server, but it could be a separate machine in the Originating Server's network.
</li>
</ul>

<a name="dialback-order"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Order of Events</h3>

<p>The following is a brief summary of the order of events in dialback:
</p>
<p></p>
<ol class="text">
<li>The Originating Server establishes a connection to the Receiving Server.
</li>
<li>The Originating Server sends a 'key' value over the connection to the Receiving Server.
</li>
<li>The Receiving Server establishes a connection to the Authoritative Server.
</li>
<li>The Receiving Server sends the same 'key' value to the Authoritative Server.
</li>
<li>The Authoritative Server replies that key is valid or invalid.
</li>
<li>The Receiving Server informs the Originating Server whether it is authenticated or not.
</li>
</ol>

<p>We can represent this flow of events graphically as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Originating               Receiving
  Server                    Server
-----------               ---------
    |                         |
    |   establish connection  |
    | ----------------------&gt; |
    |                         |
    |   send stream header    |
    | ----------------------&gt; |
    |                         |
    |   send stream header    |
    | &lt;---------------------- |
    |                         |                   Authoritative
    |   send dialback key     |                       Server
    | ----------------------&gt; |                   -------------
    |                         |                         |
                              |   establish connection  |
                              | ----------------------&gt; |
                              |                         |
                              |   send stream header    |
                              | ----------------------&gt; |
                              |                         |
                              |   send stream header    |
                              | &lt;---------------------- |
                              |                         |
                              |   send verify request   |
                              | ----------------------&gt; |
                              |                         |
                              |   send verify response  |
                              | &lt;---------------------- |
                              |
    |  report dialback result |
    | &lt;---------------------- |
    |                         |
</pre></div>
<a name="dialback-protocol"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
Protocol</h3>

<p>The detailed protocol interaction between the servers is as follows:
</p>
<p></p>
<ol class="text">
<li>The Originating Server establishes TCP connection to the Receiving Server.
</li>
<li>The Originating Server sends a stream header to the Receiving Server:
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns:stream='http://etherx.jabber.org/streams'
    xmlns='jabber:server'
    xmlns:db='jabber:server:dialback'&gt;
</pre></div>
<p>Note: The 'to' and 'from' attributes are OPTIONAL on the root stream element.  The inclusion of the xmlns:db namespace declaration with the name shown indicates to the Receiving Server that the Originating Server supports dialback.  If the namespace name is incorrect, then the Receiving Server MUST generate an &lt;invalid-namespace/&gt; stream error condition and terminate both the XML stream and the underlying TCP connection.
</p>
            
</li>
<li>The Receiving Server SHOULD send a stream header back to the Originating Server, including a unique ID for this interaction:
              <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns:stream='http://etherx.jabber.org/streams'
    xmlns='jabber:server'
    xmlns:db='jabber:server:dialback'
    id='457F9224A0...'&gt;
</pre></div>
<p>Note: The 'to' and 'from' attributes are OPTIONAL on the root stream element.  If the namespace name is incorrect, then the Originating Server MUST generate an &lt;invalid-namespace/&gt; stream error condition and terminate both the XML stream and the underlying TCP connection.  Note well that the Receiving Server SHOULD reply but MAY silently terminate the XML stream and underlying TCP connection depending on security policies in place; however, if the Receiving Server desires to proceed, it MUST send a stream header back to the Originating Server.
</p>
          
</li>
<li>The Originating Server sends a dialback key to the Receiving Server:
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;db:result
    to='Receiving Server'
    from='Originating Server'&gt;
  98AF014EDC0...
&lt;/db:result&gt;
</pre></div>
<p>Note: This key is not examined by the Receiving Server, since the Receiving Server does not keep information about the Originating Server between sessions.  The key generated by the Originating Server MUST be based in part on the value of the ID provided by the Receiving Server in the previous step, and in part on a secret shared by the Originating Server and the Authoritative Server.  If the value of the 'to' address does not match a hostname recognized by the Receiving Server, then the Receiving Server MUST generate a &lt;host-unknown/&gt; stream error condition and terminate both the XML stream and the underlying TCP connection.  If the value of the 'from' address matches a domain with which the Receiving Server already has an established connection, then the Receiving Server MUST maintain the existing connection until it validates whether the new connection is legitimate; additionally, the Receiving Server MAY choose to generate a &lt;not-authorized/&gt; stream error condition for the new connection and then terminate both the XML stream and the underlying TCP connection related to the new request.
</p>
          
</li>
<li>The Receiving Server establishes a TCP connection back to the domain name asserted by the Originating Server, as a result of which it connects to the Authoritative Server.  (Note: As an optimization, an implementation MAY reuse an existing connection here.)
</li>
<li>The Receiving Server sends the Authoritative Server a stream header:
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns:stream='http://etherx.jabber.org/streams'
    xmlns='jabber:server'
    xmlns:db='jabber:server:dialback'&gt;
</pre></div>
<p>Note: The 'to' and 'from' attributes are OPTIONAL on the root stream element.  If the namespace name is incorrect, then the Authoritative Server MUST generate an &lt;invalid-namespace/&gt; stream error condition and terminate both the XML stream and the underlying TCP connection.
</p>
          
</li>
<li>The Authoritative Server sends the Receiving Server a stream header:
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stream:stream
    xmlns:stream='http://etherx.jabber.org/streams'
    xmlns='jabber:server'
    xmlns:db='jabber:server:dialback'
    id='1251A342B...'&gt;
</pre></div>
<p>Note: If the namespace name is incorrect, then the Receiving Server MUST generate an &lt;invalid-namespace/&gt; stream error condition and terminate both the XML stream and the underlying TCP connection between it and the Authoritative Server.  If a stream error occurs between the Receiving Server and the Authoritative Server, then the Receiving Server MUST generate a &lt;remote-connection-failed/&gt; stream error condition and terminate both the XML stream and the underlying TCP connection between it and the Originating Server.
</p>
          
</li>
<li>The Receiving Server sends the Authoritative Server a request for verification of a key:
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;db:verify
    from='Receiving Server'
    to='Originating Server'
    id='457F9224A0...'&gt;
  98AF014EDC0...
&lt;/db:verify&gt;
</pre></div>
<p>Note: Passed here are the hostnames, the original identifier from the Receiving Server's stream header to the Originating Server in Step 3, and the key that the Originating Server sent to the Receiving Server in Step 4.  Based on this information, as well as shared secret information within the Authoritative Server's network, the key is verified.  Any verifiable method MAY be used to generate the key.  If the value of the 'to' address does not match a hostname recognized by the Authoritative Server, then the Authoritative Server MUST generate a &lt;host-unknown/&gt; stream error condition and terminate both the XML stream and the underlying TCP connection.  If the value of the 'from' address does not match the hostname represented by the Receiving Server when opening the TCP connection (or any validated domain thereof, such as a validated subdomain of the Receiving Server's hostname or another validated domain hosted by the Receiving Server), then the Authoritative Server MUST generate an &lt;invalid-from/&gt; stream error condition and terminate both the XML stream and the underlying TCP connection.
</p>
          
</li>
<li>The Authoritative Server verifies whether the key was valid or invalid:
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;db:verify
    from='Originating Server'
    to='Receiving Server'
    type='valid'
    id='457F9224A0...'/&gt;
</pre></div>
            or
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;db:verify
    from='Originating Server'
    to='Receiving Server'
    type='invalid'
    id='457F9224A0...'/&gt;
</pre></div>
<p>Note: If the ID does not match that provided by the Receiving Server in Step 3, then the Receiving Server MUST generate an &lt;invalid-id/&gt; stream error condition and terminate both the XML stream and the underlying TCP connection.  If the value of the 'to' address does not match a hostname recognized by the Receiving Server, then the Receiving Server MUST generate a &lt;host-unknown/&gt; stream error condition and terminate both the XML stream and the underlying TCP connection.  If the value of the 'from' address does not match the hostname represented by the Originating Server when opening the TCP connection (or any validated domain thereof, such as a validated subdomain of the Originating Server's hostname or another validated domain hosted by the Originating Server), then the Receiving Server MUST generate an &lt;invalid-from/&gt; stream error condition and terminate both the XML stream and the underlying TCP connection.  After returning the verification to the Receiving Server, the Authoritative Server SHOULD terminate the stream between them.
</p>
          
</li>
<li>The Receiving Server informs the Originating Server of the result:
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;db:result
    from='Receiving Server'
    to='Originating Server'
    type='valid'/&gt;
</pre></div>
<p>Note: At this point, the connection has either been validated via a type='valid', or reported as invalid.  If the connection is invalid, then the Receiving Server MUST terminate both the XML stream and the underlying TCP connection.  If the connection is validated, data can be sent by the Originating Server and read by the Receiving Server; before that, all XML stanzas sent to the Receiving Server SHOULD be silently dropped.
</p>
          
</li>
</ol>

<p>The result of the foregoing is that the Receiving Server has verified the identity of the Originating Server, so that the Originating Server can send, and the Receiving Server can accept, XML stanzas over the "initial stream" (i.e., the stream from the Originating Server to the Receiving Server).  In order to verify the identities of the entities using the "response stream" (i.e., the stream from the Receiving Server to the Originating Server), dialback MUST be completed in the opposite direction as well.
</p>
<p>After successful dialback negotiation, the Receiving Server SHOULD accept subsequent &lt;db:result/&gt; packets (e.g., validation requests sent to a subdomain or other hostname serviced by the Receiving Server) from the Originating Server over the existing validated connection; this enables "piggybacking" of the original validated connection in one direction.
</p>
<p>Even if dialback negotiation is successful, a server MUST verify that all XML stanzas received from the other server include a 'from' attribute and a 'to' attribute; if a stanza does not meet this restriction, the server that receives the stanza MUST generate an &lt;improper-addressing/&gt; stream error condition and terminate both the XML stream and the underlying TCP connection.  Furthermore, a server MUST verify that the 'from' attribute of stanzas received from the other server includes a validated domain for the stream; if a stanza does not meet this restriction, the server that receives the stanza MUST generate an &lt;invalid-from/&gt; stream error condition and terminate both the XML stream and the underlying TCP connection.  Both of these checks help to prevent spoofing related to particular stanzas.
</p>
<a name="stanzas"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
XML Stanzas</h3>

<p>After <a class='info' href='#tls'>TLS negotiation<span> (</span><span class='info'>Use of TLS</span><span>)</span></a> if desired, <a class='info' href='#sasl'>SASL negotiation<span> (</span><span class='info'>Use of SASL</span><span>)</span></a>, and <a class='info' href='#bind'>Resource Binding<span> (</span><span class='info'>Resource Binding</span><span>)</span></a> if necessary, XML stanzas can be sent over the streams.  Three kinds of XML stanza are defined for the 'jabber:client' and 'jabber:server' namespaces: &lt;message/&gt;, &lt;presence/&gt;, and &lt;iq/&gt;.  In addition, there are five common attributes for these kinds of stanza.  These common attributes, as well as the basic semantics of the three stanza kinds, are defined herein; more detailed information regarding the syntax of XML stanzas in relation to instant messaging and presence applications is provided in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>.
</p>
<a name="stanzas-attributes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
Common Attributes</h3>

<p>The following five attributes are common to message, presence, and IQ stanzas:
</p>
<a name="stanzas-attributes-to"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.1"></a><h3>9.1.1.&nbsp;
to</h3>

<p>The 'to' attribute specifies the JID of the intended recipient for the stanza.
</p>
<p>In the 'jabber:client' namespace, a stanza SHOULD possess a 'to' attribute, although a stanza sent from a client to a server for handling by that server (e.g., presence sent to the server for broadcasting to other entities) SHOULD NOT possess a 'to' attribute.
</p>
<p>In the 'jabber:server' namespace, a stanza MUST possess a 'to' attribute; if a server receives a stanza that does not meet this restriction, it MUST generate an &lt;improper-addressing/&gt; stream error condition and terminate both the XML stream and the underlying TCP connection with the offending server.
</p>
<p>If the value of the 'to' attribute is invalid or cannot be contacted, the entity discovering that fact (usually the sender's or recipient's server) MUST return an appropriate error to the sender, setting the 'from' attribute of the error stanza to the value provided in the 'to' attribute of the offending stanza.
</p>
<a name="stanzas-attributes-from"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.2"></a><h3>9.1.2.&nbsp;
from</h3>

<p>The 'from' attribute specifies the JID of the sender.
</p>
<p>When a server receives an XML stanza within the context of an authenticated stream qualified by the 'jabber:client' namespace, it MUST do one of the following:
          </p>
<ol class="text">
<li>validate that the value of the 'from' attribute provided by the client is that of a connected resource for the associated entity
</li>
<li>add a 'from' address to the stanza whose value is the bare JID (&lt;node@domain&gt;) or the full JID (&lt;node@domain/resource&gt;) determined by the server for the connected resource that generated the stanza (see <a class='info' href='#addressing-determination'>Determination of Addresses<span> (</span><span class='info'>Determination of Addresses</span><span>)</span></a>)
</li>
</ol><p>
        
</p>
<p>If a client attempts to send an XML stanza for which the value of the 'from' attribute does not match one of the connected resources for that entity, the server SHOULD return an &lt;invalid-from/&gt; stream error to the client.  If a client attempts to send an XML stanza over a stream that is not yet authenticated, the server SHOULD return a &lt;not-authorized/&gt; stream error to the client.  If generated, both of these conditions MUST result in closure of the stream and termination of the underlying TCP connection; this helps to prevent a denial of service attack launched from a rogue client.
</p>
<p>When a server generates a stanza from the server itself for delivery to a connected client (e.g., in the context of data storage services provided by the server on behalf of the client), the stanza MUST either (1) not include a 'from' attribute or (2) include a 'from' attribute whose value is the account's bare JID (&lt;node@domain&gt;) or client's full JID (&lt;node@domain/resource&gt;).  A server MUST NOT send to the client a stanza without a 'from' attribute if the stanza was not generated by the server itself.  When a client receives a stanza that does not include a 'from' attribute, it MUST assume that the stanza is from the server to which the client is connected.
</p>
<p>In the 'jabber:server' namespace, a stanza MUST possess a 'from' attribute; if a server receives a stanza that does not meet this restriction, it MUST generate an &lt;improper-addressing/&gt; stream error condition.  Furthermore, the domain identifier portion of the JID contained in the 'from' attribute MUST match the hostname of the sending server (or any validated domain thereof, such as a validated subdomain of the sending server's hostname or another validated domain hosted by the sending server) as communicated in the SASL negotiation or dialback negotiation; if a server receives a stanza that does not meet this restriction, it MUST generate an &lt;invalid-from/&gt; stream error condition.  Both of these conditions MUST result in closure of the stream and termination of the underlying TCP connection; this helps to prevent a denial of service attack launched from a rogue server.
</p>
<a name="stanzas-attributes-id"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.3"></a><h3>9.1.3.&nbsp;
id</h3>

<p>The optional 'id' attribute MAY be used by a sending entity for internal tracking of stanzas that it sends and receives (especially for tracking the request-response interaction inherent in the semantics of IQ stanzas).  It is OPTIONAL for the value of the 'id' attribute to be unique globally, within a domain, or within a stream.  The semantics of IQ stanzas impose additional restrictions; see <a class='info' href='#stanzas-semantics-iq'>IQ Semantics<span> (</span><span class='info'>IQ Semantics</span><span>)</span></a>.
</p>
<a name="stanzas-attributes-type"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.4"></a><h3>9.1.4.&nbsp;
type</h3>

<p>The 'type' attribute specifies detailed information about the purpose or context of the message, presence, or IQ stanza.  The particular allowable values for the 'type' attribute vary depending on whether the stanza is a message, presence, or IQ; the values for message and presence stanzas are specific to instant messaging and presence applications and therefore are defined in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>, whereas the values for IQ stanzas specify the role of an IQ stanza in a structured request-response "conversation" and thus are defined under <a class='info' href='#stanzas-semantics-iq'>IQ Semantics<span> (</span><span class='info'>IQ Semantics</span><span>)</span></a> below.  The only 'type' value common to all three stanzas is "error"; see <a class='info' href='#stanzas-error'>Stanza Errors<span> (</span><span class='info'>Stanza Errors</span><span>)</span></a>.
</p>
<a name="stanzas-attributes-lang"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.5"></a><h3>9.1.5.&nbsp;
xml:lang</h3>

<p>A stanza SHOULD possess an 'xml:lang' attribute (as defined in Section 2.12 of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Bray, T., Paoli, J., Sperberg-McQueen, C., and E. Maler, &ldquo;Extensible Markup Language (XML) 1.0 (2nd ed),&rdquo; October&nbsp;2000.</span><span>)</span></a>) if the stanza contains XML character data that is intended to be presented to a human user (as explained in <a class='info' href='#CHARSET'>RFC 2277<span> (</span><span class='info'>Alvestrand, H., &ldquo;IETF Policy on Character Sets and Languages,&rdquo; January&nbsp;1998.</span><span>)</span></a> [CHARSET], "internationalization is for humans").  The value of the 'xml:lang' attribute specifies the default language of any such human-readable XML character data, which MAY be overridden by the 'xml:lang' attribute of a specific child element.  If a stanza does not possess an 'xml:lang' attribute, an implementation MUST assume that the default language is that specified for the stream as defined under <a class='info' href='#streams-attr'>Stream Attributes<span> (</span><span class='info'>Stream Attributes</span><span>)</span></a> above.  The value of the 'xml:lang' attribute MUST be an NMTOKEN and MUST conform to the format defined in <a class='info' href='#LANGTAGS'>RFC 3066<span> (</span><span class='info'>Alvestrand, H., &ldquo;Tags for the Identification of Languages,&rdquo; January&nbsp;2001.</span><span>)</span></a> [LANGTAGS].
</p>
<a name="stanzas-semantics"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
Basic Semantics</h3>

<a name="stanzas-semantics-message"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2.1"></a><h3>9.2.1.&nbsp;
Message Semantics</h3>

<p>The &lt;message/&gt; stanza kind can be seen as a "push" mechanism whereby one entity pushes information to another entity, similar to the communications that occur in a system such as email.  All message stanzas SHOULD possess a 'to' attribute that specifies the intended recipient of the message; upon receiving such a stanza, a server SHOULD route or deliver it to the intended recipient (see <a class='info' href='#rules'>Server Rules for Handling XML Stanzas<span> (</span><span class='info'>Server Rules for Handling XML Stanzas</span><span>)</span></a> for general routing and delivery rules related to XML stanzas).
</p>
<a name="stanzas-semantics-presence"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2.2"></a><h3>9.2.2.&nbsp;
Presence Semantics</h3>

<p>The &lt;presence/&gt; element can be seen as a basic broadcast or "publish-subscribe" mechanism, whereby multiple entities receive information about an entity to which they have subscribed (in this case, network availability information).  In general, a publishing entity SHOULD send a presence stanza with no 'to' attribute, in which case the server to which the entity is connected SHOULD broadcast or multiplex that stanza to all subscribing entities.  However, a publishing entity MAY also send a presence stanza with a 'to' attribute, in which case the server SHOULD route or deliver that stanza to the intended recipient.  See <a class='info' href='#rules'>Server Rules for Handling XML Stanzas<span> (</span><span class='info'>Server Rules for Handling XML Stanzas</span><span>)</span></a> for general routing and delivery rules related to XML stanzas, and <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a> for presence-specific rules in the context of an instant messaging and presence application.
</p>
<a name="stanzas-semantics-iq"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2.3"></a><h3>9.2.3.&nbsp;
IQ Semantics</h3>

<p>Info/Query, or IQ, is a request-response mechanism, similar in some ways to <a class='info' href='#HTTP'>[HTTP]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>.  The semantics of IQ enable an entity to make a request of, and receive a response from, another entity.  The data content of the request and response is defined by the namespace declaration of a direct child element of the IQ element, and the interaction is tracked by the requesting entity through use of the 'id' attribute.  Thus, IQ interactions follow a common pattern of structured data exchange such as get/result or set/result (although an error may be returned in reply to a request if appropriate):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Requesting                 Responding
  Entity                     Entity
----------                 ----------
    |                           |
    | &lt;iq type='get' id='1'&gt;    |
    | ------------------------&gt; |
    |                           |
    | &lt;iq type='result' id='1'&gt; |
    | &lt;------------------------ |
    |                           |
    | &lt;iq type='set' id='2'&gt;    |
    | ------------------------&gt; |
    |                           |
    | &lt;iq type='error' id='2'&gt;  |
    | &lt;------------------------ |
    |                           |
</pre></div>
<p>In order to enforce these semantics, the following rules apply:
</p>
<p></p>
<ol class="text">
<li>The 'id' attribute is REQUIRED for IQ stanzas.
</li>
<li>The 'type' attribute is REQUIRED for IQ stanzas.  The value MUST be one of the following:
            
<ul class="text">
<li>get -- The stanza is a request for information or requirements.
</li>
<li>set -- The stanza provides required data, sets new values, or replaces existing values.
</li>
<li>result -- The stanza is a response to a successful get or set request.
</li>
<li>error -- An error has occurred regarding processing or delivery of a previously-sent get or set (see <a class='info' href='#stanzas-error'>Stanza Errors<span> (</span><span class='info'>Stanza Errors</span><span>)</span></a>).
</li>
</ul>
          
</li>
<li>An entity that receives an IQ request of type "get" or "set" MUST reply with an IQ response of type "result" or "error" (the response MUST preserve the 'id' attribute of the request).
</li>
<li>An entity that receives a stanza of type "result" or "error" MUST NOT respond to the stanza by sending a further IQ response of type "result" or "error"; however, as shown above, the requesting entity MAY send another request (e.g., an IQ of type "set" in order to provide required information discovered through a get/result pair).
</li>
<li>An IQ stanza of type "get" or "set" MUST contain one and only one child element that specifies the semantics of the particular request or response.
</li>
<li>An IQ stanza of type "result" MUST include zero or one child elements.
</li>
<li>An IQ stanza of type "error" SHOULD include the child element contained in the associated "get" or "set" and MUST include an &lt;error/&gt; child; for details, see <a class='info' href='#stanzas-error'>Stanza Errors<span> (</span><span class='info'>Stanza Errors</span><span>)</span></a>.
</li>
</ol>

<a name="stanzas-error"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3"></a><h3>9.3.&nbsp;
Stanza Errors</h3>

<p>Stanza-related errors are handled in a manner similar to <a class='info' href='#streams-error'>stream errors<span> (</span><span class='info'>Stream Errors</span><span>)</span></a>.  However, unlike stream errors, stanza errors are recoverable; therefore error stanzas include hints regarding actions that the original sender can take in order to remedy the error.
</p>
<a name="stanzas-error-rules"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.1"></a><h3>9.3.1.&nbsp;
Rules</h3>

<p>The following rules apply to stanza-related errors:
</p>
<p></p>
<ul class="text">
<li>The receiving or processing entity that detects an error condition in relation to a stanza MUST return to the sending entity a stanza of the same kind (message, presence, or IQ), whose 'type' attribute is set to a value of "error" (such a stanza is called an "error stanza" herein).
</li>
<li>The entity that generates an error stanza SHOULD include the original XML sent so that the sender can inspect and, if necessary, correct the XML before attempting to resend.
</li>
<li>An error stanza MUST contain an &lt;error/&gt; child element.
</li>
<li>An &lt;error/&gt; child MUST NOT be included if the 'type' attribute has a value other than "error" (or if there is no 'type' attribute).
</li>
<li>An entity that receives an error stanza MUST NOT respond to the stanza with a further error stanza; this helps to prevent looping.
</li>
</ul>

<a name="stanzas-error-syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.2"></a><h3>9.3.2.&nbsp;
Syntax</h3>

<p>The syntax for stanza-related errors is as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;stanza-kind to='sender' type='error'&gt;
  [RECOMMENDED to include sender XML here]
  &lt;error type='error-type'&gt;
    &lt;defined-condition xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;text xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'
          xml:lang='langcode'&gt;
      OPTIONAL descriptive text
    &lt;/text&gt;
    [OPTIONAL application-specific condition element]
  &lt;/error&gt;
&lt;/stanza-kind&gt;
</pre></div>
<p>The stanza-kind is one of message, presence, or iq.
</p>
<p>The value of the &lt;error/&gt; element's 'type' attribute MUST be one of the following:
</p>
<p></p>
<ul class="text">
<li>cancel -- do not retry (the error is unrecoverable)
</li>
<li>continue -- proceed (the condition was only a warning)
</li>
<li>modify -- retry after changing the data sent
</li>
<li>auth -- retry after providing credentials
</li>
<li>wait -- retry after waiting (the error is temporary)
</li>
</ul>

<p>The &lt;error/&gt; element:
</p>
<p></p>
<ul class="text">
<li>MUST contain a child element corresponding to one of the defined stanza error conditions specified below; this element MUST be qualified by the 'urn:ietf:params:xml:ns:xmpp-stanzas' namespace.
</li>
<li>MAY contain a &lt;text/&gt; child containing XML character data that describes the error in more detail; this element MUST be qualified by the 'urn:ietf:params:xml:ns:xmpp-stanzas' namespace and SHOULD possess an 'xml:lang' attribute.
</li>
<li>MAY contain a child element for an application-specific error condition; this element MUST be qualified by an application-defined namespace, and its structure is defined by that namespace.
</li>
</ul>

<p>The &lt;text/&gt; element is OPTIONAL.  If included, it SHOULD be used only to provide descriptive or diagnostic information that supplements the meaning of a defined condition or application-specific condition.  It SHOULD NOT be interpreted programmatically by an application.  It SHOULD NOT be used as the error message presented to a user, but MAY be shown in addition to the error message associated with the included condition element (or elements).
</p>
<p>Finally, to maintain backward compatibility, the schema (specified in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>) allows the optional inclusion of a 'code' attribute on the &lt;error/&gt; element.
</p>
<a name="stanzas-error-conditions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.3"></a><h3>9.3.3.&nbsp;
Defined Conditions</h3>

<p>The following conditions are defined for use in stanza errors.
</p>
<p></p>
<ul class="text">
<li>&lt;bad-request/&gt; -- the sender has sent XML that is malformed or that cannot be processed (e.g., an IQ stanza that includes an unrecognized value of the 'type' attribute); the associated error type SHOULD be "modify".
</li>
<li>&lt;conflict/&gt; -- access cannot be granted because an existing resource or session exists with the same name or address; the associated error type SHOULD be "cancel".
</li>
<li>&lt;feature-not-implemented/&gt; -- the feature requested is not implemented by the recipient or server and therefore cannot be processed; the associated error type SHOULD be "cancel".
</li>
<li>&lt;forbidden/&gt; -- the requesting entity does not possess the required permissions to perform the action; the associated error type SHOULD be "auth".
</li>
<li>&lt;gone/&gt; -- the recipient or server can no longer be contacted at this address (the error stanza MAY contain a new address in the XML character data of the &lt;gone/&gt; element); the associated error type SHOULD be "modify".
</li>
<li>&lt;internal-server-error/&gt; -- the server could not process the stanza because of a misconfiguration or an otherwise-undefined internal server error; the associated error type SHOULD be "wait".
</li>
<li>&lt;item-not-found/&gt; -- the addressed JID or item requested cannot be found; the associated error type SHOULD be "cancel".
</li>
<li>&lt;jid-malformed/&gt; -- the sending entity has provided or communicated an XMPP address (e.g., a value of the 'to' attribute) or aspect thereof (e.g., a resource identifier) that does not adhere to the syntax defined in <a class='info' href='#addressing'>Addressing Scheme<span> (</span><span class='info'>Addressing Scheme</span><span>)</span></a>; the associated error type SHOULD be "modify".
</li>
<li>&lt;not-acceptable/&gt; -- the recipient or server understands the request but is refusing to process it because it does not meet criteria defined by the recipient or server (e.g., a local policy regarding acceptable words in messages); the associated error type SHOULD be "modify".
</li>
<li>&lt;not-allowed/&gt; -- the recipient or server does not allow any entity to perform the action; the associated error type SHOULD be "cancel".
</li>
<li>&lt;not-authorized/&gt; -- the sender must provide proper credentials before being allowed to perform the action, or has provided improper credentials; the associated error type SHOULD be "auth".
</li>
<li>&lt;payment-required/&gt; -- the requesting entity is not authorized to access the requested service because payment is required; the associated error type SHOULD be "auth".
</li>
<li>&lt;recipient-unavailable/&gt; -- the intended recipient is temporarily unavailable; the associated error type SHOULD be "wait" (note: an application MUST NOT return this error if doing so would provide information about the intended recipient's network availability to an entity that is not authorized to know such information).
</li>
<li>&lt;redirect/&gt; -- the recipient or server is redirecting requests for this information to another entity, usually temporarily (the error stanza SHOULD contain the alternate address, which MUST be a valid JID, in the XML character data of the &lt;redirect/&gt; element); the associated error type SHOULD be "modify".
</li>
<li>&lt;registration-required/&gt; -- the requesting entity is not authorized to access the requested service because registration is required; the associated error type SHOULD be "auth".
</li>
<li>&lt;remote-server-not-found/&gt; -- a remote server or service specified as part or all of the JID of the intended recipient does not exist; the associated error type SHOULD be "cancel".
</li>
<li>&lt;remote-server-timeout/&gt; -- a remote server or service specified as part or all of the JID of the intended recipient (or required to fulfill a request) could not be contacted within a reasonable amount of time; the associated error type SHOULD be "wait".
</li>
<li>&lt;resource-constraint/&gt; -- the server or recipient lacks the system resources necessary to service the request; the associated error type SHOULD be "wait".
</li>
<li>&lt;service-unavailable/&gt; -- the server or recipient does not currently provide the requested service; the associated error type SHOULD be "cancel".
</li>
<li>&lt;subscription-required/&gt; -- the requesting entity is not authorized to access the requested service because a subscription is required; the associated error type SHOULD be "auth".
</li>
<li>&lt;undefined-condition/&gt; -- the error condition is not one of those defined by the other conditions in this list; any error type may be associated with this condition, and it SHOULD be used only in conjunction with an application-specific condition.
</li>
<li>&lt;unexpected-request/&gt; -- the recipient or server understood the request but was not expecting it at this time (e.g., the request was out of order); the associated error type SHOULD be "wait".
</li>
</ul>

<a name="stanzas-error-app"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3.4"></a><h3>9.3.4.&nbsp;
Application-Specific Conditions</h3>

<p>As noted, an application MAY provide application-specific stanza error information by including a properly-namespaced child in the error element.  The application-specific element SHOULD supplement or further qualify a defined element.  Thus, the &lt;error/&gt; element will contain two or three child elements:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;iq type='error' id='some-id'&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;too-many-parameters xmlns='application-ns'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;message type='error' id='another-id'&gt;
  &lt;error type='modify'&gt;
    &lt;undefined-condition
          xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;text xml:lang='en'
          xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'&gt;
      Some special application diagnostic information...
    &lt;/text&gt;
    &lt;special-application-condition xmlns='application-ns'/&gt;
  &lt;/error&gt;
&lt;/message&gt;
</pre></div>
<a name="rules"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Server Rules for Handling XML Stanzas</h3>

<p>Compliant server implementations MUST ensure in-order processing of XML stanzas between any two entities.
</p>
<p>Beyond the requirement for in-order processing, each server implementation will contain its own "delivery tree" for handling stanzas it receives.  Such a tree determines whether a stanza needs to be routed to another domain, processed internally, or delivered to a resource associated with a connected node.  The following rules apply:
</p>
<a name="rules-noto"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.1"></a><h3>10.1.&nbsp;
No 'to' Address</h3>

<p>If the stanza possesses no 'to' attribute, the server SHOULD process it on behalf of the entity that sent it.  Because all stanzas received from other servers MUST possess a 'to' attribute, this rule applies only to stanzas received from a registered entity (such as a client) that is connected to the server.  If the server receives a presence stanza with no 'to' attribute, the server SHOULD broadcast it to the entities that are subscribed to the sending entity's presence, if applicable (the semantics of presence broadcast for instant messaging and presence applications are defined in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>).  If the server receives an IQ stanza of type "get" or "set" with no 'to' attribute and it understands the namespace that qualifies the content of the stanza, it MUST either process the stanza on behalf of sending entity (where the meaning of "process" is determined by the semantics of the qualifying namespace) or return an error to the sending entity.
</p>
<a name="rules-foreign"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.2"></a><h3>10.2.&nbsp;
Foreign Domain</h3>

<p>If the hostname of the domain identifier portion of the JID contained in the 'to' attribute does not match one of the configured hostnames of the server itself or a subdomain thereof, the server SHOULD route the stanza to the foreign domain (subject to local service provisioning and security policies regarding inter-domain communication).  There are two possible cases:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>A server-to-server stream already exists between the two domains:</dt>
<dd>The sender's server routes the stanza to the authoritative server for the foreign domain over the existing stream
</dd>
<dt>There exists no server-to-server stream between the two domains:</dt>
<dd>The sender's server (1) resolves the hostname of the foreign domain (as defined under <a class='info' href='#security-server'>Server-to-Server Communications<span> (</span><span class='info'>Server-to-Server Communications</span><span>)</span></a>), (2) negotiates a server-to-server stream between the two domains (as defined under <a class='info' href='#tls'>Use of TLS<span> (</span><span class='info'>Use of TLS</span><span>)</span></a> and <a class='info' href='#sasl'>Use of SASL<span> (</span><span class='info'>Use of SASL</span><span>)</span></a>), and (3) routes the stanza to the authoritative server for the foreign domain over the newly-established stream
</dd>
</dl></blockquote>

<p>If routing to the recipient's server is unsuccessful, the sender's server MUST return an error to the sender; if the recipient's server can be contacted but delivery by the recipient's server to the recipient is unsuccessful, the recipient's server MUST return an error to the sender by way of the sender's server.
</p>
<a name="rules-subdomain"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.3"></a><h3>10.3.&nbsp;
Subdomain</h3>

<p>If the hostname of the domain identifier portion of the JID contained in the 'to' attribute matches a subdomain of one of the configured hostnames of the server itself, the server MUST either process the stanza itself or route the stanza to a specialized service that is responsible for that subdomain (if the subdomain is configured), or return an error to the sender (if the subdomain is not configured).
</p>
<a name="rules-domain"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.4"></a><h3>10.4.&nbsp;
Mere Domain or Specific Resource</h3>

<p>If the hostname of the domain identifier portion of the JID contained in the 'to' attribute matches a configured hostname of the server itself and the JID contained in the 'to' attribute is of the form &lt;domain&gt; or &lt;domain/resource&gt;, the server (or a defined resource thereof) MUST either process the stanza as appropriate for the stanza kind or return an error stanza to the sender.
</p>
<a name="rules-node"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.5"></a><h3>10.5.&nbsp;
Node in Same Domain</h3>

<p>If the hostname of the domain identifier portion of the JID contained in the 'to' attribute matches a configured hostname of the server itself and the JID contained in the 'to' attribute is of the form &lt;node@domain&gt; or &lt;node@domain/resource&gt;, the server SHOULD deliver the stanza to the intended recipient of the stanza as represented by the JID contained in the 'to' attribute.  The following rules apply:
</p>
<p></p>
<ol class="text">
<li>If the JID contains a resource identifier (i.e., is of the form &lt;node@domain/resource&gt;) and there exists a connected resource that matches the full JID, the recipient's server SHOULD deliver the stanza to the stream or session that exactly matches the resource identifier.
</li>
<li>If the JID contains a resource identifier and there exists no connected resource that matches the full JID, the recipient's server SHOULD return a &lt;service-unavailable/&gt; stanza error to the sender.
</li>
<li>If the JID is of the form &lt;node@domain&gt; and there exists at least one connected resource for the node, the recipient's server SHOULD deliver the stanza to at least one of the connected resources, according to application-specific rules (a set of delivery rules for instant messaging and presence applications is defined in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>).
</li>
</ol>

<a name="xml"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
XML Usage within XMPP</h3>

<a name="xml-restrictions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1"></a><h3>11.1.&nbsp;
Restrictions</h3>

<p>XMPP is a simplified and specialized protocol for streaming XML elements in order to exchange structured information in close to real time.  Because XMPP does not require the parsing of arbitrary and complete XML documents, there is no requirement that XMPP needs to support the full feature set of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Bray, T., Paoli, J., Sperberg-McQueen, C., and E. Maler, &ldquo;Extensible Markup Language (XML) 1.0 (2nd ed),&rdquo; October&nbsp;2000.</span><span>)</span></a>.  In particular, the following restrictions apply.
</p>
<p>With regard to XML generation, an XMPP implementation MUST NOT inject into an XML stream any of the following:
</p>
<p></p>
<ul class="text">
<li>comments (as defined in Section 2.5 of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Bray, T., Paoli, J., Sperberg-McQueen, C., and E. Maler, &ldquo;Extensible Markup Language (XML) 1.0 (2nd ed),&rdquo; October&nbsp;2000.</span><span>)</span></a>)
</li>
<li>processing instructions (Section 2.6 therein)
</li>
<li>internal or external DTD subsets (Section 2.8 therein)
</li>
<li>internal or external entity references (Section 4.2 therein) with the exception of predefined entities (Section 4.6 therein)
</li>
<li>character data or attribute values containing unescaped characters that map to the predefined entities (Section 4.6 therein); such characters MUST be escaped
</li>
</ul>

<p>With regard to XML processing, if an XMPP implementation receives such restricted XML data, it MUST ignore the data.
</p>
<a name="xml-ns"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2"></a><h3>11.2.&nbsp;
XML Namespace Names and Prefixes</h3>

<p><a class='info' href='#XML-NAMES'>XML Namespaces<span> (</span><span class='info'>Bray, T., Hollander, D., and A. Layman, &ldquo;Namespaces in XML,&rdquo; January&nbsp;1999.</span><span>)</span></a> [XML&#8209;NAMES] are used within all XMPP-compliant XML to create strict boundaries of data ownership.  The basic function of namespaces is to separate different vocabularies of XML elements that are structurally mixed together.  Ensuring that XMPP-compliant XML is namespace-aware enables any allowable XML to be structurally mixed with any data element within XMPP.  Rules for XML namespace names and prefixes are defined in the following subsections.
</p>
<a name="xml-ns-stream"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2.1"></a><h3>11.2.1.&nbsp;
Streams Namespace</h3>

<p>A streams namespace declaration is REQUIRED in all XML stream headers.  The name of the streams namespace MUST be 'http://etherx.jabber.org/streams'.  The element names of the &lt;stream/&gt; element and its &lt;features/&gt; and &lt;error/&gt; children MUST be qualified by the streams namespace prefix in all instances.  An implementation SHOULD generate only the 'stream:' prefix for these elements, and for historical reasons MAY accept only the 'stream:' prefix.
</p>
<a name="xml-ns-default"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2.2"></a><h3>11.2.2.&nbsp;
Default Namespace</h3>

<p>A default namespace declaration is REQUIRED and is used in all XML streams in order to define the allowable first-level children of the root stream element.  This namespace declaration MUST be the same for the initial stream and the response stream so that both streams are qualified consistently.  The default namespace declaration applies to the stream and all stanzas sent within a stream (unless explicitly qualified by another namespace, or by the prefix of the streams namespace or the dialback namespace).
</p>
<p>A server implementation MUST support the following two default namespaces (for historical reasons, some implementations MAY support only these two default namespaces):
</p>
<p></p>
<ul class="text">
<li>jabber:client -- this default namespace is declared when the stream is used for communications between a client and a server
</li>
<li>jabber:server -- this default namespace is declared when the stream is used for communications between two servers
</li>
</ul>

<p>A client implementation MUST support the 'jabber:client' default namespace, and for historical reasons MAY support only that default namespace.
</p>
<p>An implementation MUST NOT generate namespace prefixes for elements in the default namespace if the default namespace is 'jabber:client' or 'jabber:server'.  An implementation SHOULD NOT generate namespace prefixes for elements qualified by content (as opposed to stream) namespaces other than 'jabber:client' and 'jabber:server'.
</p>
<p>Note: The 'jabber:client' and 'jabber:server' namespaces are nearly identical but are used in different contexts (client-to-server communications for 'jabber:client' and server-to-server communications for 'jabber:server').  The only difference between the two is that the 'to' and 'from' attributes are OPTIONAL on stanzas sent within 'jabber:client', whereas they are REQUIRED on stanzas sent within 'jabber:server'.  If a compliant implementation accepts a stream that is qualified by the 'jabber:client' or 'jabber:server' namespace, it MUST support the <a class='info' href='#stanzas-attributes'>common attributes<span> (</span><span class='info'>Common Attributes</span><span>)</span></a> and <a class='info' href='#stanzas-semantics'>basic semantics<span> (</span><span class='info'>Basic Semantics</span><span>)</span></a> of all three core stanza kinds (message, presence, and IQ).
</p>
<a name="xml-ns-db"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2.3"></a><h3>11.2.3.&nbsp;
Dialback Namespace</h3>

<p>A dialback namespace declaration is REQUIRED for all elements used in <a class='info' href='#dialback'>server dialback<span> (</span><span class='info'>Server Dialback</span><span>)</span></a>.  The name of the dialback namespace MUST be 'jabber:server:dialback'.  All elements qualified by this namespace MUST be prefixed.  An implementation SHOULD generate only the 'db:' prefix for such elements and MAY accept only the 'db:' prefix.
</p>
<a name="xml-validation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.3"></a><h3>11.3.&nbsp;
Validation</h3>

<p>Except as noted with regard to 'to' and 'from' addresses for stanzas within the 'jabber:server' namespace, a server is not responsible for validating the XML elements forwarded to a client or another server; an implementation MAY choose to provide only validated data elements but this is OPTIONAL (although an implementation MUST NOT accept XML that is not well-formed).  Clients SHOULD NOT rely on the ability to send data which does not conform to the schemas, and SHOULD ignore any non-conformant elements or attributes on the incoming XML stream.  Validation of XML streams and stanzas is OPTIONAL, and schemas are included herein for descriptive purposes only.
</p>
<a name="xml-declaration"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.4"></a><h3>11.4.&nbsp;
Inclusion of Text Declaration</h3>

<p>Implementations SHOULD send a text declaration before sending a stream header.  Applications MUST follow the rules in <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Bray, T., Paoli, J., Sperberg-McQueen, C., and E. Maler, &ldquo;Extensible Markup Language (XML) 1.0 (2nd ed),&rdquo; October&nbsp;2000.</span><span>)</span></a> regarding the circumstances under which a text declaration is included.
</p>
<a name="xml-encoding"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.5"></a><h3>11.5.&nbsp;
Character Encoding</h3>

<p>Implementations MUST support the UTF-8 (<a class='info' href='#UTF-8'>RFC 3629<span> (</span><span class='info'>Yergeau, F., &ldquo;UTF-8, a transformation format of ISO 10646,&rdquo; November&nbsp;2003.</span><span>)</span></a> [UTF&#8209;8]) transformation of Universal Character Set (<a class='info' href='#UCS2'>ISO/IEC 10646-1<span> (</span><span class='info'>International Organization for Standardization, &ldquo;Information Technology - Universal Multiple-octet coded Character Set (UCS) - Amendment 2: UCS Transformation Format 8 (UTF-8),&rdquo; October&nbsp;1996.</span><span>)</span></a> [UCS2]) characters, as required by <a class='info' href='#CHARSET'>RFC 2277<span> (</span><span class='info'>Alvestrand, H., &ldquo;IETF Policy on Character Sets and Languages,&rdquo; January&nbsp;1998.</span><span>)</span></a> [CHARSET].  Implementations MUST NOT attempt to use any other encoding.
</p>
<a name="compliance"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Core Compliance Requirements</h3>

<p>This section summarizes the specific aspects of the Extensible Messaging and Presence Protocol that MUST be supported by servers and clients in order to be considered compliant implementations, as well as additional protocol aspects that SHOULD be supported.  For compliance purposes, we draw a distinction between core protocols (which MUST be supported by any server or client, regardless of the specific application) and instant messaging protocols (which MUST be supported only by instant messaging and presence applications built on top of the core protocols).  Compliance requirements that apply to all servers and clients are specified in this section; compliance requirements for instant messaging servers and clients are specified in the corresponding section of <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>.
</p>
<a name="compliance-server"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1"></a><h3>12.1.&nbsp;
Servers</h3>

<p>In addition to all defined requirements with regard to security, XML usage, and internationalization, a server MUST support the following core protocols in order to be considered compliant:
</p>
<p></p>
<ul class="text">
<li>Application of the <a class='info' href='#NAMEPREP'>[NAMEPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN),&rdquo; March&nbsp;2003.</span><span>)</span></a>, <a class='info' href='#nodeprep'>Nodeprep<span> (</span><span class='info'>Nodeprep</span><span>)</span></a>, and <a class='info' href='#resourceprep'>Resourceprep<span> (</span><span class='info'>Resourceprep</span><span>)</span></a> profiles of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> to addresses (including ensuring that domain identifiers are internationalized domain names as defined in <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a>)
</li>
<li><a class='info' href='#streams'>XML streams<span> (</span><span class='info'>XML Streams</span><span>)</span></a>, including <a class='info' href='#tls'>Use of TLS<span> (</span><span class='info'>Use of TLS</span><span>)</span></a>, <a class='info' href='#sasl'>Use of SASL<span> (</span><span class='info'>Use of SASL</span><span>)</span></a>, and <a class='info' href='#bind'>Resource Binding<span> (</span><span class='info'>Resource Binding</span><span>)</span></a>
</li>
<li>The basic semantics of the three defined stanza kinds (i.e., &lt;message/&gt;, &lt;presence/&gt;, and &lt;iq/&gt;) as specified in <a class='info' href='#stanzas-semantics'>stanza semantics<span> (</span><span class='info'>Basic Semantics</span><span>)</span></a>
</li>
<li>Generation (and, where appropriate, handling) of error syntax and semantics related to streams, TLS, SASL, and XML stanzas
</li>
</ul>

<p>In addition, a server MAY support the following core protocol:
</p>
<p></p>
<ul class="text">
<li><a class='info' href='#dialback'>Server dialback<span> (</span><span class='info'>Server Dialback</span><span>)</span></a>
</li>
</ul>

<a name="compliance-client"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2"></a><h3>12.2.&nbsp;
Clients</h3>

<p>A client MUST support the following core protocols in order to be considered compliant:
</p>
<p></p>
<ul class="text">
<li><a class='info' href='#streams'>XML streams<span> (</span><span class='info'>XML Streams</span><span>)</span></a>, including <a class='info' href='#tls'>Use of TLS<span> (</span><span class='info'>Use of TLS</span><span>)</span></a>, <a class='info' href='#sasl'>Use of SASL<span> (</span><span class='info'>Use of SASL</span><span>)</span></a>, and <a class='info' href='#bind'>Resource Binding<span> (</span><span class='info'>Resource Binding</span><span>)</span></a>
</li>
<li>The basic semantics of the three defined stanza kinds (i.e., &lt;message/&gt;, &lt;presence/&gt;, and &lt;iq/&gt;) as specified in <a class='info' href='#stanzas-semantics'>stanza semantics<span> (</span><span class='info'>Basic Semantics</span><span>)</span></a>
</li>
<li>Handling (and, where appropriate, generation) of error syntax and semantics related to streams, TLS, SASL, and XML stanzas
</li>
</ul>

<p>In addition, a client SHOULD support the following core protocols:
</p>
<p></p>
<ul class="text">
<li>Generation of addresses to which the <a class='info' href='#NAMEPREP'>[NAMEPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN),&rdquo; March&nbsp;2003.</span><span>)</span></a>, <a class='info' href='#nodeprep'>Nodeprep<span> (</span><span class='info'>Nodeprep</span><span>)</span></a>, and <a class='info' href='#resourceprep'>Resourceprep<span> (</span><span class='info'>Resourceprep</span><span>)</span></a> profiles of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> can be applied without failing
</li>
</ul>

<a name="i18n"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
Internationalization Considerations</h3>

<p>XML streams MUST be encoded in UTF-8 as specified under <a class='info' href='#xml-encoding'>Character Encoding<span> (</span><span class='info'>Character Encoding</span><span>)</span></a>.  As specified under <a class='info' href='#streams-attr'>Stream Attributes<span> (</span><span class='info'>Stream Attributes</span><span>)</span></a>, an XML stream SHOULD include an 'xml:lang' attribute that is treated as the default language for any XML character data sent over the stream that is intended to be presented to a human user.  As specified under <a class='info' href='#stanzas-attributes-lang'>xml:lang<span> (</span><span class='info'>xml:lang</span><span>)</span></a>, an XML stanza SHOULD include an 'xml:lang' attribute if the stanza contains XML character data that is intended to be presented to a human user.  A server SHOULD apply the default 'xml:lang' attribute to stanzas it routes or delivers on behalf of connected entities, and MUST NOT modify or delete 'xml:lang' attributes from stanzas it receives from other entities.
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
Security Considerations</h3>

<a name="security-high"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.1"></a><h3>14.1.&nbsp;
High Security</h3>

<p>For the purposes of XMPP communications (client-to-server and server-to-server), the term "high security" refers to the use of security technologies that provide both mutual authentication and integrity-checking; in particular, when using certificate-based authentication to provide high security, a chain-of-trust SHOULD be established out-of-band, although a shared certificate authority signing certificates could allow a previously unknown certificate to establish trust in-band.  See <a class='info' href='#security-validation'>Section&nbsp;14.2<span> (</span><span class='info'>Certificate Validation</span><span>)</span></a> below regarding certificate validation procedures.
</p>
<p>Implementations MUST support high security.  Service provisioning SHOULD use high security, subject to local security policies.
</p>
<a name="security-validation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.2"></a><h3>14.2.&nbsp;
Certificate Validation</h3>

<p>When an XMPP peer communicates with another peer securely, it MUST validate the peer's certificate.  There are three possible cases:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Case #1:</dt>
<dd>The peer contains an End Entity certificate which appears to be certified by a chain of certificates terminating in a trust anchor (as described in Section 6.1 of <a class='info' href='#X509'>[X509]<span> (</span><span class='info'>Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a>).
</dd>
<dt>Case #2:</dt>
<dd>The peer certificate is certified by a Certificate Authority not known to the validating peer.
</dd>
<dt>Case #3:</dt>
<dd>The peer certificate is self-signed.
</dd>
</dl></blockquote>

<p>In Case #1, the validating peer MUST do one of two things:
        </p>
<ol class="text">
<li>Verify the peer certificate according to the rules of <a class='info' href='#X509'>[X509]<span> (</span><span class='info'>Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a>.  The certificate SHOULD then be checked against the expected identity of the peer following the rules described in <a class='info' href='#HTTP-TLS'>[HTTP&#8209;TLS]<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a>, except that a subjectAltName extension of type "xmpp" MUST be used as the identity if present.  If one of these checks fails, user-oriented clients MUST either notify the user (clients MAY give the user the opportunity to continue with the connection in any case) or terminate the connection with a bad certificate error.  Automated clients SHOULD terminate the connection (with a bad certificate error) and log the error to an appropriate audit log.  Automated clients MAY provide a configuration setting that disables this check, but MUST provide a setting that enables it.
</li>
<li>The peer SHOULD show the certificate to a user for approval, including the entire certificate chain.  The peer MUST cache the certificate (or some non-forgeable representation such as a hash).  In future connections, the peer MUST verify that the same certificate was presented and MUST notify the user if it has changed.
</li>
</ol><p>
      
</p>
<p>In Case #2 and Case #3, implementations SHOULD act as in (2) above.
</p>
<a name="security-client"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.3"></a><h3>14.3.&nbsp;
Client-to-Server Communications</h3>

<p>A compliant client implementation MUST support both TLS and SASL for connections to a server.
</p>
<p>The TLS protocol for encrypting XML streams (defined under <a class='info' href='#tls'>Use of TLS<span> (</span><span class='info'>Use of TLS</span><span>)</span></a>) provides a reliable mechanism for helping to ensure the confidentiality and data integrity of data exchanged between two entities.
</p>
<p>The SASL protocol for authenticating XML streams (defined under <a class='info' href='#sasl'>Use of SASL<span> (</span><span class='info'>Use of SASL</span><span>)</span></a>) provides a reliable mechanism for validating that a client connecting to a server is who it claims to be.
</p>
<p>Client-to-server communications MUST NOT proceed until the DNS hostname asserted by the server has been resolved.  Such resolutions SHOULD first attempt to resolve the hostname using an <a class='info' href='#SRV'>[SRV]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> Service of "xmpp-client" and Proto of "tcp", resulting in resource records such as "_xmpp-client._tcp.example.com." (the use of the string "xmpp-client" for the service identifier is consistent with the IANA registration).  If the SRV lookup fails, the fallback is a normal IPv4/IPv6 address record resolution to determine the IP address, using the "xmpp-client" port 5222, registered with the IANA.
</p>
<p>The IP address and method of access of clients MUST NOT be made public by a server, nor are any connections other than the original server connection required.  This helps to protect the client's server from direct attack or identification by third parties.
</p>
<a name="security-server"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.4"></a><h3>14.4.&nbsp;
Server-to-Server Communications</h3>

<p>A compliant server implementation MUST support both TLS and SASL for inter-domain communications.  For historical reasons, a compliant implementation SHOULD also support <a class='info' href='#dialback'>Server Dialback<span> (</span><span class='info'>Server Dialback</span><span>)</span></a>.
</p>
<p>Because service provisioning is a matter of policy, it is OPTIONAL for any given domain to communicate with other domains, and server-to-server communications MAY be disabled by the administrator of any given deployment.  If a particular domain enables inter-domain communications, it SHOULD enable high security.
</p>
<p>Administrators may want to require use of SASL for server-to-server communications in order to ensure both authentication and confidentiality (e.g., on an organization's private network).  Compliant implementations SHOULD support SASL for this purpose.
</p>
<p>Inter-domain connections MUST NOT proceed until the DNS hostnames asserted by the servers have been resolved.  Such resolutions MUST first attempt to resolve the hostname using an <a class='info' href='#SRV'>[SRV]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> Service of "xmpp-server" and Proto of "tcp", resulting in resource records such as "_xmpp-server._tcp.example.com." (the use of the string "xmpp-server" for the service identifier is consistent with the IANA registration; note well that the "xmpp-server" service identifier supersedes the earlier use of a "jabber" service identifier, since the earlier usage did not conform to <a class='info' href='#SRV'>[SRV]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a>; implementations desiring to be backward compatible should continue to look for or answer to the "jabber" service identifier as well).  If the SRV lookup fails, the fallback is a normal IPv4/IPv6 address record resolution to determine the IP address, using the "xmpp-server" port 5269, registered with the IANA.
</p>
<p>Server dialback helps protect against domain spoofing, thus making it more difficult to spoof XML stanzas.  It is not a mechanism for authenticating, securing, or encrypting streams between servers as is done via SASL and TLS, and results in weak verification of server identities only.  Furthermore, it is susceptible to DNS poisoning attacks unless <a class='info' href='#DNSSEC'>DNSSec<span> (</span><span class='info'>Eastlake, D., &ldquo;Domain Name System Security Extensions,&rdquo; March&nbsp;1999.</span><span>)</span></a> [DNSSEC] is used, and even if the DNS information is accurate, dialback cannot protect from attacks where the attacker is capable of hijacking the IP address of the remote domain.  Domains requiring robust security SHOULD use TLS and SASL.  If SASL is used for server-to-server authentication, dialback SHOULD NOT be used since it is unnecessary.
</p>
<a name="security-layers"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.5"></a><h3>14.5.&nbsp;
Order of Layers</h3>

<p>The order of layers in which protocols MUST be stacked is as follows:
</p>
<p></p>
<ol class="text">
<li>TCP
</li>
<li>TLS
</li>
<li>SASL
</li>
<li>XMPP
</li>
</ol>

<p>The rationale for this order is that <a class='info' href='#TCP'>[TCP]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> is the base connection layer used by all of the protocols stacked on top of TCP, <a class='info' href='#TLS'>[TLS]<span> (</span><span class='info'>Dierks, T., Allen, C., Treese, W., Karlton, P., Freier, A., and P. Kocher, &ldquo;The TLS Protocol Version 1.0,&rdquo; January&nbsp;1999.</span><span>)</span></a> is often provided at the operating system layer, <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Myers, J., &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; October&nbsp;1997.</span><span>)</span></a> is often provided at the application layer, and XMPP is the application itself.
</p>
<a name="security-channel"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.6"></a><h3>14.6.&nbsp;
Lack of SASL Channel Binding to TLS</h3>

<p>The SASL framework does not provide a mechanism to bind SASL authentication to a security layer providing confidentiality and integrity protection that was negotiated at a lower layer.  This lack of a "channel binding" prevents SASL from being able to verify that the source and destination end points to which the lower layer's security is bound are equivalent to the end points that SASL is authenticating.  If the end points are not identical, the lower layer's security cannot be trusted to protect data transmitted between the SASL authenticated entities.  In such a situation, a SASL security layer should be negotiated that effectively ignores the presence of the lower layer security.
</p>
<a name="security-mandatory"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.7"></a><h3>14.7.&nbsp;
Mandatory-to-Implement Technologies</h3>

<p>At a minimum, all implementations MUST support the following mechanisms:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>for authentication:</dt>
<dd>the SASL <a class='info' href='#DIGEST-MD5'>[DIGEST&#8209;MD5]<span> (</span><span class='info'>Leach, P. and C. Newman, &ldquo;Using Digest Authentication as a SASL Mechanism,&rdquo; May&nbsp;2000.</span><span>)</span></a> mechanism
</dd>
<dt>for confidentiality:</dt>
<dd>TLS (using the TLS_RSA_WITH_3DES_EDE_CBC_SHA cipher)
</dd>
<dt>for both:</dt>
<dd>TLS plus SASL EXTERNAL(using the TLS_RSA_WITH_3DES_EDE_CBC_SHA cipher supporting client-side certificates)
</dd>
</dl></blockquote>

<a name="security-firewalls"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.8"></a><h3>14.8.&nbsp;
Firewalls</h3>

<p>Communications using XMPP normally occur over <a class='info' href='#TCP'>[TCP]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> connections on port 5222 (client-to-server) or port 5269 (server-to-server), as registered with the IANA (see <a class='info' href='#iana'>IANA Considerations<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>).  Use of these well-known ports allows administrators to easily enable or disable XMPP activity through existing and commonly-deployed firewalls.
</p>
<a name="security-base64"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.9"></a><h3>14.9.&nbsp;
Use of base64 in SASL</h3>

<p>Both the client and the server MUST verify any <a class='info' href='#BASE64'>[BASE64]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; July&nbsp;2003.</span><span>)</span></a> data received during SASL negotiation.  An implementation MUST reject (not ignore) any characters that are not explicitly allowed by the base64 alphabet; this helps to guard against creation of a covert channel that could be used to "leak" information.  An implementation MUST NOT break on invalid input and MUST reject any sequence of base64 characters containing the pad ('=') character if that character is included as something other than the last character of the data (e.g., "=AAA" or "BBBB=CCC"); this helps to guard against buffer overflow attacks and other attacks on the implementation.  Base 64 encoding visually hides otherwise easily recognized information, such as passwords, but does not provide any computational confidentiality.  Base 64 encoding MUST follow the definition in Section 3 of <a class='info' href='#BASE64'>RFC 3548<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; July&nbsp;2003.</span><span>)</span></a> [BASE64].
</p>
<a name="security-stringprep"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.10"></a><h3>14.10.&nbsp;
Stringprep Profiles</h3>

<p>XMPP makes use of the <a class='info' href='#NAMEPREP'>[NAMEPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN),&rdquo; March&nbsp;2003.</span><span>)</span></a> profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> for processing of domain identifiers; for security considerations related to Nameprep, refer to the appropriate section of <a class='info' href='#NAMEPREP'>[NAMEPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN),&rdquo; March&nbsp;2003.</span><span>)</span></a>.
</p>
<p>In addition, XMPP defines two profiles of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>: <a class='info' href='#nodeprep'>Nodeprep<span> (</span><span class='info'>Nodeprep</span><span>)</span></a> for node identifiers and <a class='info' href='#resourceprep'>Resourceprep<span> (</span><span class='info'>Resourceprep</span><span>)</span></a> for resource identifiers.
</p>
<p>The Unicode and ISO/IEC 10646 repertoires have many characters that look similar.  In many cases, users of security protocols might do visual matching, such as when comparing the names of trusted third parties.  Because it is impossible to map similar-looking characters without a great deal of context, such as knowing the fonts used, stringprep does nothing to map similar-looking characters together, nor to prohibit some characters because they look like others.
</p>
<p>A node identifier can be employed as one part of an entity's address in XMPP.  One common usage is as the username of an instant messaging user; another is as the name of a multi-user chat room; many other kinds of entities could use node identifiers as part of their addresses.  The security of such services could be compromised based on different interpretations of the internationalized node identifier; for example, a user entering a single internationalized node identifier could access another user's account information, or a user could gain access to an otherwise restricted chat room or service.
</p>
<p>A resource identifier can be employed as one part of an entity's address in XMPP.  One common usage is as the name for an instant messaging user's connected resource (active session); another is as the nickname of a user in a multi-user chat room; many other kinds of entities could use resource identifiers as part of their addresses.  The security of such services could be compromised based on different interpretations of the internationalized resource identifier; for example, a user could attempt to initiate multiple sessions with the same name, or a user could send a message to someone other than the intended recipient in a multi-user chat room.
</p>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15"></a><h3>15.&nbsp;
IANA Considerations</h3>

<a name="iana-ns-tls"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.1"></a><h3>15.1.&nbsp;
XML Namespace Name for TLS Data</h3>

<p>A URN sub-namespace for TLS-related data in the Extensible Messaging and Presence Protocol (XMPP) is defined as follows.  (This namespace name adheres to the format defined in <a class='info' href='#XML-REG'>The IETF XML Registry<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a> [XML&#8209;REG].)
</p>
<p></p>
<blockquote class="text"><dl>
<dt>URI:</dt>
<dd>urn:ietf:params:xml:ns:xmpp-tls
</dd>
<dt>Specification:</dt>
<dd>RFC 3920
</dd>
<dt>Description:</dt>
<dd>This is the XML namespace name for TLS-related data in the Extensible Messaging and Presence Protocol (XMPP) as defined by RFC 3920.
</dd>
<dt>Registrant Contact:</dt>
<dd>IETF, XMPP Working Group, &lt;xmppwg@jabber.org&gt;
</dd>
</dl></blockquote>

<a name="iana-ns-sasl"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2"></a><h3>15.2.&nbsp;
XML Namespace Name for SASL Data</h3>

<p>A URN sub-namespace for SASL-related data in the Extensible Messaging and Presence Protocol (XMPP) is defined as follows.  (This namespace name adheres to the format defined in <a class='info' href='#XML-REG'>[XML&#8209;REG]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>.)
</p>
<p></p>
<blockquote class="text"><dl>
<dt>URI:</dt>
<dd>urn:ietf:params:xml:ns:xmpp-sasl
</dd>
<dt>Specification:</dt>
<dd>RFC 3920
</dd>
<dt>Description:</dt>
<dd>This is the XML namespace name for SASL-related data in the Extensible Messaging and Presence Protocol (XMPP) as defined by RFC 3920.
</dd>
<dt>Registrant Contact:</dt>
<dd>IETF, XMPP Working Group, &lt;xmppwg@jabber.org&gt;
</dd>
</dl></blockquote>

<a name="iana-ns-streams"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.3"></a><h3>15.3.&nbsp;
XML Namespace Name for Stream Errors</h3>

<p>A URN sub-namespace for stream-related error data in the Extensible Messaging and Presence Protocol (XMPP) is defined as follows.  (This namespace name adheres to the format defined in <a class='info' href='#XML-REG'>[XML&#8209;REG]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>.)
</p>
<p></p>
<blockquote class="text"><dl>
<dt>URI:</dt>
<dd>urn:ietf:params:xml:ns:xmpp-streams
</dd>
<dt>Specification:</dt>
<dd>RFC 3920
</dd>
<dt>Description:</dt>
<dd>This is the XML namespace name for stream-related error data in the Extensible Messaging and Presence Protocol (XMPP) as defined by RFC 3920.
</dd>
<dt>Registrant Contact:</dt>
<dd>IETF, XMPP Working Group, &lt;xmppwg@jabber.org&gt;
</dd>
</dl></blockquote>

<a name="iana-ns-bind"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.4"></a><h3>15.4.&nbsp;
XML Namespace Name for Resource Binding</h3>

<p>A URN sub-namespace for resource binding in the Extensible Messaging and Presence Protocol (XMPP) is defined as follows.  (This namespace name adheres to the format defined in <a class='info' href='#XML-REG'>[XML&#8209;REG]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>.)
</p>
<p></p>
<blockquote class="text"><dl>
<dt>URI:</dt>
<dd>urn:ietf:params:xml:ns:xmpp-bind
</dd>
<dt>Specification:</dt>
<dd>RFC 3920
</dd>
<dt>Description:</dt>
<dd>This is the XML namespace name for resource binding in the Extensible Messaging and Presence Protocol (XMPP) as defined by RFC 3920.
</dd>
<dt>Registrant Contact:</dt>
<dd>IETF, XMPP Working Group, &lt;xmppwg@jabber.org&gt;
</dd>
</dl></blockquote>

<a name="iana-ns-stanzas"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.5"></a><h3>15.5.&nbsp;
XML Namespace Name for Stanza Errors</h3>

<p>A URN sub-namespace for stanza-related error data in the Extensible Messaging and Presence Protocol (XMPP) is defined as follows.  (This namespace name adheres to the format defined in <a class='info' href='#XML-REG'>[XML&#8209;REG]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>.)
</p>
<p></p>
<blockquote class="text"><dl>
<dt>URI:</dt>
<dd>urn:ietf:params:xml:ns:xmpp-stanzas
</dd>
<dt>Specification:</dt>
<dd>RFC 3920
</dd>
<dt>Description:</dt>
<dd>This is the XML namespace name for stanza-related error data in the Extensible Messaging and Presence Protocol (XMPP) as defined by RFC 3920.
</dd>
<dt>Registrant Contact:</dt>
<dd>IETF, XMPP Working Group, &lt;xmppwg@jabber.org&gt;
</dd>
</dl></blockquote>

<a name="iana-nodeprep"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.6"></a><h3>15.6.&nbsp;
Nodeprep Profile of Stringprep</h3>

<p>The Nodeprep profile of stringprep is defined under <a class='info' href='#nodeprep'>Nodeprep<span> (</span><span class='info'>Nodeprep</span><span>)</span></a>.  The IANA has registered Nodeprep in the stringprep profile registry.
</p>
<p>Name of this profile:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Nodeprep
</dd>
</dl></blockquote>

<p>RFC in which the profile is defined:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>RFC 3920
</dd>
</dl></blockquote>

<p>Indicator whether or not this is the newest version of the profile:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>This is the first version of Nodeprep
</dd>
</dl></blockquote>

<a name="iana-resourceprep"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.7"></a><h3>15.7.&nbsp;
Resourceprep Profile of Stringprep</h3>

<p>The Resourceprep profile of stringprep is defined under <a class='info' href='#resourceprep'>Resourceprep<span> (</span><span class='info'>Resourceprep</span><span>)</span></a>.  The IANA has registered Resourceprep in the stringprep profile registry.
</p>
<p>Name of this profile:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Resourceprep
</dd>
</dl></blockquote>

<p>RFC in which the profile is defined:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>RFC 3920
</dd>
</dl></blockquote>

<p>Indicator whether or not this is the newest version of the profile:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>This is the first version of Resourceprep
</dd>
</dl></blockquote>

<a name="iana-gssapi"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.8"></a><h3>15.8.&nbsp;
GSSAPI Service Name</h3>

<p>The IANA has registered "xmpp" as a <a class='info' href='#GSS-API'>GSSAPI<span> (</span><span class='info'>Linn, J., &ldquo;Generic Security Service Application Program Interface Version 2, Update 1,&rdquo; January&nbsp;2000.</span><span>)</span></a> [GSS&#8209;API] service name, as defined under <a class='info' href='#sasl-def'>SASL Definition<span> (</span><span class='info'>SASL Definition</span><span>)</span></a>.
</p>
<a name="iana-ports"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.9"></a><h3>15.9.&nbsp;
Port Numbers</h3>

<p>The IANA has registered "xmpp-client" and "xmpp-server" as keywords for <a class='info' href='#TCP'>[TCP]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> ports 5222 and 5269 respectively.
</p>
<p>These ports SHOULD be used for client-to-server and server-to-server communications respectively, but their use is OPTIONAL.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16"></a><h3>16.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>16.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ABNF">[ABNF]</a></td>
<td class="author-text"><a href="mailto:dcrocker@imc.org">Crocker, D.</a> and <a href="mailto:paulo@turnpike.com">P. Overell</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2234.txt">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; RFC&nbsp;2234, November&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="BASE64">[BASE64]</a></td>
<td class="author-text">Josefsson, S., &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc3548.txt">The Base16, Base32, and Base64 Data Encodings</a>,&rdquo; RFC&nbsp;3548, July&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="CHARSET">[CHARSET]</a></td>
<td class="author-text"><a href="mailto:Harald.T.Alvestrand@uninett.no">Alvestrand, H.</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2277.txt">IETF Policy on Character Sets and Languages</a>,&rdquo; BCP&nbsp;18, RFC&nbsp;2277, January&nbsp;1998 (<a href="ftp://ftp.isi.edu/in-notes/rfc2277.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2277.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2277.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="DIGEST-MD5">[DIGEST-MD5]</a></td>
<td class="author-text">Leach, P. and C. Newman, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2831.txt">Using Digest Authentication as a SASL Mechanism</a>,&rdquo; RFC&nbsp;2831, May&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="DNS">[DNS]</a></td>
<td class="author-text">Mockapetris, P., &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc1035.txt">Domain names - implementation and specification</a>,&rdquo; STD&nbsp;13, RFC&nbsp;1035, November&nbsp;1987.</td></tr>
<tr><td class="author-text" valign="top"><a name="GSS-API">[GSS-API]</a></td>
<td class="author-text"><a href="mailto:jlinn@rsasecurity.com">Linn, J.</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2743.txt">Generic Security Service Application Program Interface Version 2, Update 1</a>,&rdquo; RFC&nbsp;2743, January&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="HTTP-TLS">[HTTP-TLS]</a></td>
<td class="author-text">Rescorla, E., &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2818.txt">HTTP Over TLS</a>,&rdquo; RFC&nbsp;2818, May&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="IDNA">[IDNA]</a></td>
<td class="author-text">Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc3490.txt">Internationalizing Domain Names in Applications (IDNA)</a>,&rdquo; RFC&nbsp;3490, March&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="IPv6">[IPv6]</a></td>
<td class="author-text">Hinden, R. and S. Deering, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc3513.txt">Internet Protocol Version 6 (IPv6) Addressing Architecture</a>,&rdquo; RFC&nbsp;3513, April&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="LANGTAGS">[LANGTAGS]</a></td>
<td class="author-text">Alvestrand, H., &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc3066.txt">Tags for the Identification of Languages</a>,&rdquo; BCP&nbsp;47, RFC&nbsp;3066, January&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="NAMEPREP">[NAMEPREP]</a></td>
<td class="author-text">Hoffman, P. and M. Blanchet, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc3491.txt">Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN)</a>,&rdquo; RFC&nbsp;3491, March&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="RANDOM">[RANDOM]</a></td>
<td class="author-text"><a href="mailto:dee@lkg.dec.com">Eastlake, D.</a>, <a href="mailto:crocker@cybercash.com">Crocker, S.</a>, and <a href="mailto:jis@mit.edu">J. Schiller</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc1750.txt">Randomness Recommendations for Security</a>,&rdquo; RFC&nbsp;1750, December&nbsp;1994.</td></tr>
<tr><td class="author-text" valign="top"><a name="SASL">[SASL]</a></td>
<td class="author-text"><a href="mailto:jgmyers@netscape.com">Myers, J.</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2222.txt">Simple Authentication and Security Layer (SASL)</a>,&rdquo; RFC&nbsp;2222, October&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2222.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2222.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2222.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SRV">[SRV]</a></td>
<td class="author-text"><a href="mailto:arnt@troll.no">Gulbrandsen, A.</a>, Vixie, P., and <a href="mailto:levone@microsoft.com">L. Esibov</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2782.txt">A DNS RR for specifying the location of services (DNS SRV)</a>,&rdquo; RFC&nbsp;2782, February&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="STRINGPREP">[STRINGPREP]</a></td>
<td class="author-text">Hoffman, P. and M. Blanchet, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc3454.txt">Preparation of Internationalized Strings ("stringprep")</a>,&rdquo; RFC&nbsp;3454, December&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="TCP">[TCP]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc793.txt">Transmission Control Protocol</a>,&rdquo; STD&nbsp;7, RFC&nbsp;793, September&nbsp;1981.</td></tr>
<tr><td class="author-text" valign="top"><a name="TERMS">[TERMS]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="TLS">[TLS]</a></td>
<td class="author-text"><a href="mailto:tdierks@certicom.com">Dierks, T.</a>, <a href="mailto:callen@certicom.com">Allen, C.</a>, <a href="mailto:treese@openmarket.com">Treese, W.</a>, Karlton, P., <a href="mailto:freier@netscape.com">Freier, A.</a>, and <a href="mailto:pck@netcom.com">P. Kocher</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2246.txt">The TLS Protocol Version 1.0</a>,&rdquo; RFC&nbsp;2246, January&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="UCS2">[UCS2]</a></td>
<td class="author-text">International Organization for Standardization, &ldquo;Information Technology - Universal Multiple-octet coded Character Set (UCS) - Amendment 2: UCS Transformation Format 8 (UTF-8),&rdquo; ISO&nbsp;Standard 10646-1 Addendum 2, October&nbsp;1996.</td></tr>
<tr><td class="author-text" valign="top"><a name="UTF-8">[UTF-8]</a></td>
<td class="author-text">Yergeau, F., &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc3629.txt">UTF-8, a transformation format of ISO 10646</a>,&rdquo; STD&nbsp;63, RFC&nbsp;3629, November&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="X509">[X509]</a></td>
<td class="author-text">Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc3280.txt">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>,&rdquo; RFC&nbsp;3280, April&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="XML">[XML]</a></td>
<td class="author-text"><a href="mailto:tbray@textuality.com">Bray, T.</a>, <a href="mailto:jeanpa@microsoft.com">Paoli, J.</a>, <a href="mailto:cmsmcq@uic.edu">Sperberg-McQueen, C.</a>, and <a href="mailto:eve.maler@east.sun.com">E. Maler</a>, &ldquo;<a href="http://www.w3.org/TR/REC-xml">Extensible Markup Language (XML) 1.0 (2nd ed)</a>,&rdquo; W3C&nbsp;REC-xml, October&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="XML-NAMES">[XML-NAMES]</a></td>
<td class="author-text"><a href="mailto:tbray@textuality.com">Bray, T.</a>, <a href="mailto:dmh@corp.hp.com">Hollander, D.</a>, and <a href="mailto:andrewl@microsoft.com">A. Layman</a>, &ldquo;<a href="http://www.w3.org/TR/REC-xml-names">Namespaces in XML</a>,&rdquo; W3C&nbsp;REC-xml-names, January&nbsp;1999.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>16.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ACAP">[ACAP]</a></td>
<td class="author-text"><a href="mailto:chris.newman@innosoft.com">Newman, C.</a> and <a href="mailto:jgmyers@netscape.com">J. Myers</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2244.txt">ACAP -- Application Configuration Access Protocol</a>,&rdquo; RFC&nbsp;2244, November&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="ASN.1">[ASN.1]</a></td>
<td class="author-text">CCITT, &ldquo;Recommendation X.208: Specification of Abstract Syntax Notation One (ASN.1),&rdquo; 1988.</td></tr>
<tr><td class="author-text" valign="top"><a name="DNSSEC">[DNSSEC]</a></td>
<td class="author-text"><a href="mailto:dee3@us.ibm.com">Eastlake, D.</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2535.txt">Domain Name System Security Extensions</a>,&rdquo; RFC&nbsp;2535, March&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="HTTP">[HTTP]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2616.txt">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999 (<a href="ftp://ftp.isi.edu/in-notes/rfc2616.txt">TXT</a>, <a href="ftp://ftp.isi.edu/in-notes/rfc2616.ps">PS</a>, <a href="ftp://ftp.isi.edu/in-notes/rfc2616.pdf">PDF</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2616.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2616.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IMAP">[IMAP]</a></td>
<td class="author-text">Crispin, M., &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc3501.txt">INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1</a>,&rdquo; RFC&nbsp;3501, March&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="IMP-REQS">[IMP-REQS]</a></td>
<td class="author-text"><a href="mailto:mday@alum.mit.edu">Day, M.</a>, <a href="mailto:sonuag@microsoft.com">Aggarwal, S.</a>, and <a href="mailto:jesse@intonet.com">J. Vincent</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2779.txt">Instant Messaging / Presence Protocol Requirements</a>,&rdquo; RFC&nbsp;2779, February&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="IRC">[IRC]</a></td>
<td class="author-text"><a href="mailto:jto@tolsun.oulu.fi">Oikarinen, J.</a> and <a href="mailto:avalon@coombs.anu.edu.au">D. Reed</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc1459.txt">Internet Relay Chat Protocol</a>,&rdquo; RFC&nbsp;1459, May&nbsp;1993.</td></tr>
<tr><td class="author-text" valign="top"><a name="JEP-0029">[JEP-0029]</a></td>
<td class="author-text"><a href="mailto:craigk@jabber.com">Kaes, C.</a>, &ldquo;<a href="http://www.jabber.org/jeps/jep-0029.html">Definition of Jabber Identifiers (JIDs)</a>,&rdquo; JSF JEP&nbsp;0029, October&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="JEP-0078">[JEP-0078]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, &ldquo;<a href="http://www.jabber.org/jeps/jep-0078.html">Non-SASL Authentication</a>,&rdquo; JSF JEP&nbsp;0078, July&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="JEP-0086">[JEP-0086]</a></td>
<td class="author-text"><a href="mailto:rob@cataclysm.cx">Norris, R.</a> and <a href="mailto:stpeter@jabber.org">P. Saint-Andre</a>, &ldquo;<a href="http://www.jabber.org/jeps/jep-0086.html">Error Condition Mappings</a>,&rdquo; JSF JEP&nbsp;0086, February&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="JSF">[JSF]</a></td>
<td class="author-text"><a href="http://www.jabber.org/">Jabber Software Foundation</a>, &ldquo;<a href="http://www.jabber.org/">Jabber Software Foundation</a>.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="POP3">[POP3]</a></td>
<td class="author-text"><a href="mailto:jgm+@cmu.edu">Myers, J.</a> and <a href="mailto:mrose@dbc.mtview.ca.us">M. Rose</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc1939.txt">Post Office Protocol - Version 3</a>,&rdquo; STD&nbsp;53, RFC&nbsp;1939, May&nbsp;1996.</td></tr>
<tr><td class="author-text" valign="top"><a name="SIMPLE">[SIMPLE]</a></td>
<td class="author-text"><a href="mailto:simple@ieft.org">SIMPLE Working Group</a>, &ldquo;<a href="http://www.ietf.org/html.charters/simple-charter.html">SIMPLE WG</a>.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="SMTP">[SMTP]</a></td>
<td class="author-text">Klensin, J., &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2821.txt">Simple Mail Transfer Protocol</a>,&rdquo; RFC&nbsp;2821, April&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="URI">[URI]</a></td>
<td class="author-text"><a href="mailto:timbl@w3.org">Berners-Lee, T.</a>, <a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, and <a href="mailto:masinter@parc.xerox.com">L. Masinter</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2396.txt">Uniform Resource Identifiers (URI): Generic Syntax</a>,&rdquo; RFC&nbsp;2396, August&nbsp;1998 (<a href="ftp://ftp.isi.edu/in-notes/rfc2396.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2396.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2396.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="USINGTLS">[USINGTLS]</a></td>
<td class="author-text"><a href="mailto:chris.newman@innosoft.com">Newman, C.</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2595.txt">Using TLS with IMAP, POP3 and ACAP</a>,&rdquo; RFC&nbsp;2595, June&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="XML-REG">[XML-REG]</a></td>
<td class="author-text">Mealling, M., &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc3688.txt">The IETF XML Registry</a>,&rdquo; BCP&nbsp;81, RFC&nbsp;3688, January&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="XMPP-IM">[XMPP-IM]</a></td>
<td class="author-text">Saint-Andre, P., &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc3921.txt">Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence</a>,&rdquo; RFC&nbsp;3921, October&nbsp;2004.</td></tr>
</table>

<a name="nodeprep"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Nodeprep</h3>

<a name="nodeprep-intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Introduction</h3>

<p>This appendix defines the "Nodeprep" profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.  As such, it specifies processing rules that will enable users to enter internationalized node identifiers in the Extensible Messaging and Presence Protocol (XMPP) and have the highest chance of getting the content of the strings correct.  (An XMPP node identifier is the optional portion of an XMPP address that precedes a domain identifier and the '@' separator; it is often but not exclusively associated with an instant messaging username.)  These processing rules are intended only for XMPP node identifiers and are not intended for arbitrary text or any other aspect of an XMPP address.
</p>
<p>This profile defines the following, as required by <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>:
</p>
<p></p>
<ul class="text">
<li>The intended applicability of the profile: internationalized node identifiers within XMPP
</li>
<li>The character repertoire that is the input and output to stringprep: Unicode 3.2, specified in Section 2 of this Appendix
</li>
<li>The mappings used: specified in Section 3
</li>
<li>The Unicode normalization used: specified in Section 4
</li>
<li>The characters that are prohibited as output: specified in Section 5
</li>
<li>Bidirectional character handling: specified in Section 6
</li>
</ul>

<a name="nodeprep-character"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Character Repertoire</h3>

<p>This profile uses Unicode 3.2 with the list of unassigned code points being Table A.1, both defined in Appendix A of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<a name="nodeprep-mapping"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
Mapping</h3>

<p>This profile specifies mapping using the following tables from <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Table B.1
</dd>
<dt></dt>
<dd>Table B.2
</dd>
</dl></blockquote>

<a name="nodeprep-normalization"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.4"></a><h3>A.4.&nbsp;
Normalization</h3>

<p>This profile specifies the use of Unicode normalization form KC, as described in <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<a name="nodeprep-prohibited"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.5"></a><h3>A.5.&nbsp;
Prohibited Output</h3>

<p>This profile specifies the prohibition of using the following tables from <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Table C.1.1
</dd>
<dt></dt>
<dd>Table C.1.2
</dd>
<dt></dt>
<dd>Table C.2.1
</dd>
<dt></dt>
<dd>Table C.2.2
</dd>
<dt></dt>
<dd>Table C.3
</dd>
<dt></dt>
<dd>Table C.4
</dd>
<dt></dt>
<dd>Table C.5
</dd>
<dt></dt>
<dd>Table C.6
</dd>
<dt></dt>
<dd>Table C.7
</dd>
<dt></dt>
<dd>Table C.8
</dd>
<dt></dt>
<dd>Table C.9
</dd>
</dl></blockquote>

<p>In addition, the following Unicode characters are also prohibited:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>#x22 (")
</dd>
<dt></dt>
<dd>#x26 (&amp;)
</dd>
<dt></dt>
<dd>#x27 (')
</dd>
<dt></dt>
<dd>#x2F (/)
</dd>
<dt></dt>
<dd>#x3A (:)
</dd>
<dt></dt>
<dd>#x3C (&lt;)
</dd>
<dt></dt>
<dd>#x3E (&gt;)
</dd>
<dt></dt>
<dd>#x40 (@)
</dd>
</dl></blockquote>

<a name="nodeprep-bidirectional"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.6"></a><h3>A.6.&nbsp;
Bidirectional Characters</h3>

<p>This profile specifies checking bidirectional strings, as described in Section 6 of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<a name="resourceprep"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Resourceprep</h3>

<a name="resourceprep-introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1"></a><h3>B.1.&nbsp;
Introduction</h3>

<p>This appendix defines the "Resourceprep" profile of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.  As such, it specifies processing rules that will enable users to enter internationalized resource identifiers in the Extensible Messaging and Presence Protocol (XMPP) and have the highest chance of getting the content of the strings correct.  (An XMPP resource identifier is the optional portion of an XMPP address that follows a domain identifier and the '/' separator; it is often but not exclusively associated with an instant messaging session name.)  These processing rules are intended only for XMPP resource identifiers and are not intended for arbitrary text or any other aspect of an XMPP address.
</p>
<p>This profile defines the following, as required by <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>:
</p>
<p></p>
<ul class="text">
<li>The intended applicability of the profile: internationalized resource identifiers within XMPP
</li>
<li>The character repertoire that is the input and output to stringprep: Unicode 3.2, specified in Section 2 of this Appendix
</li>
<li>The mappings used: specified in Section 3
</li>
<li>The Unicode normalization used: specified in Section 4
</li>
<li>The characters that are prohibited as output: specified in Section 5
</li>
<li>Bidirectional character handling: specified in Section 6
</li>
</ul>

<a name="resourceprep-character"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.2"></a><h3>B.2.&nbsp;
Character Repertoire</h3>

<p>This profile uses Unicode 3.2 with the list of unassigned code points being Table A.1, both defined in Appendix A of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<a name="resourceprep-mapping"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.3"></a><h3>B.3.&nbsp;
Mapping</h3>

<p>This profile specifies mapping using the following tables from <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Table B.1
</dd>
</dl></blockquote>

<a name="resourceprep-normalization"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.4"></a><h3>B.4.&nbsp;
Normalization</h3>

<p>This profile specifies the use of Unicode normalization form KC, as described in <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<a name="resourceprep-prohibited"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.5"></a><h3>B.5.&nbsp;
Prohibited Output</h3>

<p>This profile specifies the prohibition of using the following tables from <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Table C.1.2
</dd>
<dt></dt>
<dd>Table C.2.1
</dd>
<dt></dt>
<dd>Table C.2.2
</dd>
<dt></dt>
<dd>Table C.3
</dd>
<dt></dt>
<dd>Table C.4
</dd>
<dt></dt>
<dd>Table C.5
</dd>
<dt></dt>
<dd>Table C.6
</dd>
<dt></dt>
<dd>Table C.7
</dd>
<dt></dt>
<dd>Table C.8
</dd>
<dt></dt>
<dd>Table C.9
</dd>
</dl></blockquote>

<a name="resourceprep-bidirectional"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.6"></a><h3>B.6.&nbsp;
Bidirectional Characters</h3>

<p>This profile specifies checking bidirectional strings, as described in Section 6 of <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<a name="def"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
XML Schemas</h3>

<p>The following XML schemas are descriptive, not normative.  For schemas defining the 'jabber:client' and 'jabber:server' namespaces, refer to <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>.
</p>
<a name="def-streams"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.1"></a><h3>C.1.&nbsp;
Streams namespace</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://etherx.jabber.org/streams'
    xmlns='http://etherx.jabber.org/streams'
    elementFormDefault='unqualified'&gt;

  &lt;xs:element name='stream'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence xmlns:client='jabber:client'
                   xmlns:server='jabber:server'
                   xmlns:db='jabber:server:dialback'&gt;
        &lt;xs:element ref='features' minOccurs='0' maxOccurs='1'/&gt;
        &lt;xs:any namespace='urn:ietf:params:xml:ns:xmpp-tls'
                minOccurs='0'
                maxOccurs='unbounded'/&gt;
        &lt;xs:any namespace='urn:ietf:params:xml:ns:xmpp-sasl'
                minOccurs='0'
                maxOccurs='unbounded'/&gt;
        &lt;xs:choice minOccurs='0' maxOccurs='1'&gt;
          &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
            &lt;xs:element ref='client:message'/&gt;
            &lt;xs:element ref='client:presence'/&gt;
            &lt;xs:element ref='client:iq'/&gt;
          &lt;/xs:choice&gt;
          &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
            &lt;xs:element ref='server:message'/&gt;
            &lt;xs:element ref='server:presence'/&gt;
            &lt;xs:element ref='server:iq'/&gt;
            &lt;xs:element ref='db:result'/&gt;
            &lt;xs:element ref='db:verify'/&gt;
          &lt;/xs:choice&gt;
        &lt;/xs:choice&gt;
        &lt;xs:element ref='error' minOccurs='0' maxOccurs='1'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='from' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='id' type='xs:NMTOKEN' use='optional'/&gt;
      &lt;xs:attribute name='to' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='version' type='xs:decimal' use='optional'/&gt;
      &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='features'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:all xmlns:tls='urn:ietf:params:xml:ns:xmpp-tls'
              xmlns:sasl='urn:ietf:params:xml:ns:xmpp-sasl'
              xmlns:bind='urn:ietf:params:xml:ns:xmpp-bind'
              xmlns:sess='urn:ietf:params:xml:ns:xmpp-session'&gt;
        &lt;xs:element ref='tls:starttls' minOccurs='0'/&gt;
        &lt;xs:element ref='sasl:mechanisms' minOccurs='0'/&gt;
        &lt;xs:element ref='bind:bind' minOccurs='0'/&gt;
        &lt;xs:element ref='sess:session' minOccurs='0'/&gt;
      &lt;/xs:all&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='error'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence  xmlns:err='urn:ietf:params:xml:ns:xmpp-streams'&gt;
        &lt;xs:group   ref='err:streamErrorGroup'/&gt;
        &lt;xs:element ref='err:text'
                    minOccurs='0'
                    maxOccurs='1'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="def-streamerror"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.2"></a><h3>C.2.&nbsp;
Stream error namespace</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='urn:ietf:params:xml:ns:xmpp-streams'
    xmlns='urn:ietf:params:xml:ns:xmpp-streams'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='bad-format' type='empty'/&gt;
  &lt;xs:element name='bad-namespace-prefix' type='empty'/&gt;
  &lt;xs:element name='conflict' type='empty'/&gt;
  &lt;xs:element name='connection-timeout' type='empty'/&gt;
  &lt;xs:element name='host-gone' type='empty'/&gt;
  &lt;xs:element name='host-unknown' type='empty'/&gt;
  &lt;xs:element name='improper-addressing' type='empty'/&gt;
  &lt;xs:element name='internal-server-error' type='empty'/&gt;
  &lt;xs:element name='invalid-from' type='empty'/&gt;
  &lt;xs:element name='invalid-id' type='empty'/&gt;
  &lt;xs:element name='invalid-namespace' type='empty'/&gt;
  &lt;xs:element name='invalid-xml' type='empty'/&gt;
  &lt;xs:element name='not-authorized' type='empty'/&gt;
  &lt;xs:element name='policy-violation' type='empty'/&gt;
  &lt;xs:element name='remote-connection-failed' type='empty'/&gt;
  &lt;xs:element name='resource-constraint' type='empty'/&gt;
  &lt;xs:element name='restricted-xml' type='empty'/&gt;
  &lt;xs:element name='see-other-host' type='xs:string'/&gt;
  &lt;xs:element name='system-shutdown' type='empty'/&gt;
  &lt;xs:element name='undefined-condition' type='empty'/&gt;
  &lt;xs:element name='unsupported-encoding' type='empty'/&gt;
  &lt;xs:element name='unsupported-stanza-type' type='empty'/&gt;
  &lt;xs:element name='unsupported-version' type='empty'/&gt;
  &lt;xs:element name='xml-not-well-formed' type='empty'/&gt;

  &lt;xs:group name='streamErrorGroup'&gt;
    &lt;xs:choice&gt;
      &lt;xs:element ref='bad-format'/&gt;
      &lt;xs:element ref='bad-namespace-prefix'/&gt;
      &lt;xs:element ref='conflict'/&gt;
      &lt;xs:element ref='connection-timeout'/&gt;
      &lt;xs:element ref='host-gone'/&gt;
      &lt;xs:element ref='host-unknown'/&gt;
      &lt;xs:element ref='improper-addressing'/&gt;
      &lt;xs:element ref='internal-server-error'/&gt;
      &lt;xs:element ref='invalid-from'/&gt;
      &lt;xs:element ref='invalid-id'/&gt;
      &lt;xs:element ref='invalid-namespace'/&gt;
      &lt;xs:element ref='invalid-xml'/&gt;
      &lt;xs:element ref='not-authorized'/&gt;
      &lt;xs:element ref='policy-violation'/&gt;
      &lt;xs:element ref='remote-connection-failed'/&gt;
      &lt;xs:element ref='resource-constraint'/&gt;
      &lt;xs:element ref='restricted-xml'/&gt;
      &lt;xs:element ref='see-other-host'/&gt;
      &lt;xs:element ref='system-shutdown'/&gt;
      &lt;xs:element ref='undefined-condition'/&gt;
      &lt;xs:element ref='unsupported-encoding'/&gt;
      &lt;xs:element ref='unsupported-stanza-type'/&gt;
      &lt;xs:element ref='unsupported-version'/&gt;
      &lt;xs:element ref='xml-not-well-formed'/&gt;
    &lt;/xs:choice&gt;
  &lt;/xs:group&gt;

  &lt;xs:element name='text'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='xs:string'&gt;
          &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="def-tls"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.3"></a><h3>C.3.&nbsp;
TLS namespace</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='urn:ietf:params:xml:ns:xmpp-tls'
    xmlns='urn:ietf:params:xml:ns:xmpp-tls'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='starttls'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element
            name='required'
            minOccurs='0'
            maxOccurs='1'
            type='empty'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='proceed' type='empty'/&gt;
  &lt;xs:element name='failure' type='empty'/&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="def-sasl"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.4"></a><h3>C.4.&nbsp;
SASL namespace</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='urn:ietf:params:xml:ns:xmpp-sasl'
    xmlns='urn:ietf:params:xml:ns:xmpp-sasl'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='mechanisms'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name='mechanism'
                    maxOccurs='unbounded'
                    type='xs:string'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='auth'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='mechanism'
                        type='xs:string'
                        use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='challenge' type='xs:string'/&gt;
  &lt;xs:element name='response' type='xs:string'/&gt;
  &lt;xs:element name='abort' type='empty'/&gt;
  &lt;xs:element name='success' type='empty'/&gt;

  &lt;xs:element name='failure'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0'&gt;
        &lt;xs:element name='aborted' type='empty'/&gt;
        &lt;xs:element name='incorrect-encoding' type='empty'/&gt;
        &lt;xs:element name='invalid-authzid' type='empty'/&gt;
        &lt;xs:element name='invalid-mechanism' type='empty'/&gt;
        &lt;xs:element name='mechanism-too-weak' type='empty'/&gt;
        &lt;xs:element name='not-authorized' type='empty'/&gt;
        &lt;xs:element name='temporary-auth-failure' type='empty'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="def-bind"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.5"></a><h3>C.5.&nbsp;
Resource binding namespace</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='urn:ietf:params:xml:ns:xmpp-bind'
    xmlns='urn:ietf:params:xml:ns:xmpp-bind'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='bind'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0' maxOccurs='1'&gt;
        &lt;xs:element name='resource' type='xs:string'/&gt;
        &lt;xs:element name='jid' type='xs:string'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="def-dialback"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.6"></a><h3>C.6.&nbsp;
Dialback namespace</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='jabber:server:dialback'
    xmlns='jabber:server:dialback'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='result'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='xs:token'&gt;
          &lt;xs:attribute name='from' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='to' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='type' use='optional'&gt;
            &lt;xs:simpleType&gt;
              &lt;xs:restriction base='xs:NCName'&gt;
                &lt;xs:enumeration value='invalid'/&gt;
                &lt;xs:enumeration value='valid'/&gt;
              &lt;/xs:restriction&gt;
            &lt;/xs:simpleType&gt;
          &lt;/xs:attribute&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='verify'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='xs:token'&gt;
          &lt;xs:attribute name='from' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='id' type='xs:NMTOKEN' use='required'/&gt;
          &lt;xs:attribute name='to' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='type' use='optional'&gt;
            &lt;xs:simpleType&gt;
              &lt;xs:restriction base='xs:NCName'&gt;
                &lt;xs:enumeration value='invalid'/&gt;
                &lt;xs:enumeration value='valid'/&gt;
              &lt;/xs:restriction&gt;
            &lt;/xs:simpleType&gt;
          &lt;/xs:attribute&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="def-stanzaerror"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.7"></a><h3>C.7.&nbsp;
Stanza error namespace</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='urn:ietf:params:xml:ns:xmpp-stanzas'
    xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='bad-request' type='empty'/&gt;
  &lt;xs:element name='conflict' type='empty'/&gt;
  &lt;xs:element name='feature-not-implemented' type='empty'/&gt;
  &lt;xs:element name='forbidden' type='empty'/&gt;
  &lt;xs:element name='gone' type='xs:string'/&gt;
  &lt;xs:element name='internal-server-error' type='empty'/&gt;
  &lt;xs:element name='item-not-found' type='empty'/&gt;
  &lt;xs:element name='jid-malformed' type='empty'/&gt;
  &lt;xs:element name='not-acceptable' type='empty'/&gt;
  &lt;xs:element name='not-allowed' type='empty'/&gt;
  &lt;xs:element name='payment-required' type='empty'/&gt;
  &lt;xs:element name='recipient-unavailable' type='empty'/&gt;
  &lt;xs:element name='redirect' type='xs:string'/&gt;
  &lt;xs:element name='registration-required' type='empty'/&gt;
  &lt;xs:element name='remote-server-not-found' type='empty'/&gt;
  &lt;xs:element name='remote-server-timeout' type='empty'/&gt;
  &lt;xs:element name='resource-constraint' type='empty'/&gt;
  &lt;xs:element name='service-unavailable' type='empty'/&gt;
  &lt;xs:element name='subscription-required' type='empty'/&gt;
  &lt;xs:element name='undefined-condition' type='empty'/&gt;
  &lt;xs:element name='unexpected-request' type='empty'/&gt;

  &lt;xs:group name='stanzaErrorGroup'&gt;
    &lt;xs:choice&gt;
      &lt;xs:element ref='bad-request'/&gt;
      &lt;xs:element ref='conflict'/&gt;
      &lt;xs:element ref='feature-not-implemented'/&gt;
      &lt;xs:element ref='forbidden'/&gt;
      &lt;xs:element ref='gone'/&gt;
      &lt;xs:element ref='internal-server-error'/&gt;
      &lt;xs:element ref='item-not-found'/&gt;
      &lt;xs:element ref='jid-malformed'/&gt;
      &lt;xs:element ref='not-acceptable'/&gt;
      &lt;xs:element ref='not-allowed'/&gt;
      &lt;xs:element ref='payment-required'/&gt;
      &lt;xs:element ref='recipient-unavailable'/&gt;
      &lt;xs:element ref='redirect'/&gt;
      &lt;xs:element ref='registration-required'/&gt;
      &lt;xs:element ref='remote-server-not-found'/&gt;
      &lt;xs:element ref='remote-server-timeout'/&gt;
      &lt;xs:element ref='resource-constraint'/&gt;
      &lt;xs:element ref='service-unavailable'/&gt;
      &lt;xs:element ref='subscription-required'/&gt;
      &lt;xs:element ref='undefined-condition'/&gt;
      &lt;xs:element ref='unexpected-request'/&gt;
    &lt;/xs:choice&gt;
  &lt;/xs:group&gt;

  &lt;xs:element name='text'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='xs:string'&gt;
          &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="diffs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D"></a><h3>Appendix D.&nbsp;
Differences Between Core Jabber Protocols and XMPP</h3>

<p>This section is non-normative.
</p>
<p>XMPP has been adapted from the protocols originally developed in the Jabber open-source community, which can be thought of as "XMPP 0.9".  Because there exists a large installed base of Jabber implementations and deployments, it may be helpful to specify the key differences between the relevant Jabber protocols and XMPP in order to expedite and encourage upgrades of those implementations and deployments to XMPP.  This section summarizes the core differences, while the corresponding section of <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a> summarizes the differences that relate specifically to instant messaging and presence applications.
</p>
<a name="diffs-channel"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D.1"></a><h3>D.1.&nbsp;
Channel Encryption</h3>

<p>It was common practice in the Jabber community to use SSL for channel encryption on ports other than 5222 and 5269 (the convention is to use ports 5223 and 5270).  XMPP uses TLS over the IANA-registered ports for channel encryption, as defined under <a class='info' href='#tls'>Use of TLS<span> (</span><span class='info'>Use of TLS</span><span>)</span></a> herein.
</p>
<a name="diffs-auth"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D.2"></a><h3>D.2.&nbsp;
Authentication</h3>

<p>The client-server authentication protocol developed in the Jabber community used a basic IQ interaction qualified by the 'jabber:iq:auth' namespace (documentation of this protocol is contained in <a class='info' href='#JEP-0078'>[JEP&#8209;0078]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Non-SASL Authentication,&rdquo; July&nbsp;2004.</span><span>)</span></a>, published by the <a class='info' href='#JSF'>Jabber Software Foundation<span> (</span><span class='info'>Jabber Software Foundation, &ldquo;Jabber Software Foundation,&rdquo; .</span><span>)</span></a> [JSF]).  XMPP uses SASL for authentication, as defined under <a class='info' href='#sasl'>Use of SASL<span> (</span><span class='info'>Use of SASL</span><span>)</span></a> herein.
</p>
<p>The Jabber community did not develop an authentication protocol for server-to-server communications, only the <a class='info' href='#dialback'>Server Dialback<span> (</span><span class='info'>Server Dialback</span><span>)</span></a> protocol to prevent server spoofing.  XMPP supersedes Server Dialback with a true server-to-server authentication protocol, as defined under <a class='info' href='#sasl'>Use of SASL<span> (</span><span class='info'>Use of SASL</span><span>)</span></a> herein.
</p>
<a name="diffs-bind"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D.3"></a><h3>D.3.&nbsp;
Resource Binding</h3>

<p>Resource binding in the Jabber community was handled via the 'jabber:iq:auth' namespace (which was also used for client authentication with a server).  XMPP defines a dedicated namespace for resource binding as well as the ability for a server to generate a resource identifier on behalf of a client, as defined under <a class='info' href='#bind'>Resource Binding<span> (</span><span class='info'>Resource Binding</span><span>)</span></a>.
</p>
<a name="diffs-jids"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D.4"></a><h3>D.4.&nbsp;
JID Processing</h3>

<p>JID processing was somewhat loosely defined by the Jabber community (documentation of forbidden characters and case handling is contained in <a class='info' href='#JEP-0029'>[JEP&#8209;0029]<span> (</span><span class='info'>Kaes, C., &ldquo;Definition of Jabber Identifiers (JIDs),&rdquo; October&nbsp;2003.</span><span>)</span></a>, published by the <a class='info' href='#JSF'>Jabber Software Foundation<span> (</span><span class='info'>Jabber Software Foundation, &ldquo;Jabber Software Foundation,&rdquo; .</span><span>)</span></a> [JSF]).  XMPP specifies the use of <a class='info' href='#NAMEPREP'>[NAMEPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN),&rdquo; March&nbsp;2003.</span><span>)</span></a> for domain identifiers and supplements Nameprep with two additional <a class='info' href='#STRINGPREP'>[STRINGPREP]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Preparation of Internationalized Strings (&quot;stringprep&quot;),&rdquo; December&nbsp;2002.</span><span>)</span></a> profiles for JID processing: <a class='info' href='#nodeprep'>Nodeprep<span> (</span><span class='info'>Nodeprep</span><span>)</span></a> for node identifiers and <a class='info' href='#resourceprep'>Resourceprep<span> (</span><span class='info'>Resourceprep</span><span>)</span></a> for resource identifiers.
</p>
<a name="diffs-error"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D.5"></a><h3>D.5.&nbsp;
Error Handling</h3>

<p>Stream-related errors were handled in the Jabber community via XML character data text in a &lt;stream:error/&gt; element.  In XMPP, stream-related errors are handled via an extensible mechanism defined under <a class='info' href='#streams-error'>Stream Errors<span> (</span><span class='info'>Stream Errors</span><span>)</span></a> herein.
</p>
<p>Stanza-related errors were handled in the Jabber community via HTTP-style error codes.  In XMPP, stanza-related errors are handled via an extensible mechanism defined under <a class='info' href='#stanzas-error'>Stanza Errors<span> (</span><span class='info'>Stanza Errors</span><span>)</span></a> herein.  (Documentation of a mapping between Jabber and XMPP error handling mechanisms is contained in <a class='info' href='#JEP-0086'>[JEP&#8209;0086]<span> (</span><span class='info'>Norris, R. and P. Saint-Andre, &ldquo;Error Condition Mappings,&rdquo; February&nbsp;2004.</span><span>)</span></a>, published by the <a class='info' href='#JSF'>Jabber Software Foundation<span> (</span><span class='info'>Jabber Software Foundation, &ldquo;Jabber Software Foundation,&rdquo; .</span><span>)</span></a> [JSF].)
</p>
<a name="diffs-i18n"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D.6"></a><h3>D.6.&nbsp;
Internationalization</h3>

<p>Although use of UTF-8 has always been standard practice within the Jabber community, the community did not define mechanisms for specifying the language of human-readable text provided in XML character data.  XMPP specifies the use of the 'xml:lang' attribute in such contexts, as defined under <a class='info' href='#streams-attr'>Stream Attributes<span> (</span><span class='info'>Stream Attributes</span><span>)</span></a> and <a class='info' href='#stanzas-attributes-lang'>xml:lang<span> (</span><span class='info'>xml:lang</span><span>)</span></a> herein.
</p>
<a name="diffs-version"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D.7"></a><h3>D.7.&nbsp;
Stream Version Attribute</h3>

<p>The Jabber community did not include a 'version' attribute in stream headers.  XMPP specifies inclusion of that attribute as a way to signal support for the stream features (authentication, encryption, etc.) defined under <a class='info' href='#streams-attr-version'>Version Support<span> (</span><span class='info'>Version Support</span><span>)</span></a> herein.
</p>
<a name="contributors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.E"></a><h3>Appendix E.&nbsp;
Contributors</h3>

<p>Most of the core aspects of the Extensible Messaging and Presence Protocol were developed originally within the Jabber open-source community in 1999.  This community was founded by Jeremie Miller, who released source code for the initial version of the jabberd server in January 1999.  Major early contributors to the base protocol also included Ryan Eatmon, Peter Millard, Thomas Muldowney, and Dave Smith.  Work by the XMPP Working Group has concentrated especially on security and internationalization; in these areas, protocols for the use of TLS and SASL were originally contributed by Rob Norris, and stringprep profiles were originally contributed by Joe Hildebrand.  The error code syntax was suggested by Lisa Dusseault.
</p>
<a name="acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.F"></a><h3>Appendix F.&nbsp;
Acknowledgements</h3>

<p>Thanks are due to a number of individuals in addition to the contributors listed.  Although it is difficult to provide a complete list, the following individuals were particularly helpful in defining the protocols or in commenting on the specifications in this memo: Thomas Charron, Richard Dobson, Sam Hartman, Schuyler Heath, Jonathan Hogg, Cullen Jennings, Craig Kaes, Jacek Konieczny, Alexey Melnikov, Keith Minkler, Julian Missig, Pete Resnick, Marshall Rose, Alexey Shchepin, Jean-Louis Seguineau, Iain Shigeoka, Greg Troxel, and David Waite.  Thanks also to members of the XMPP Working Group and the IETF community for comments and feedback provided throughout the life of this memo.
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Peter Saint-Andre (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jabber Software Foundation</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">stpeter@jabber.org</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The Internet Society (2004).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS OR IS SPONSORED BY (IF ANY),
THE INTERNET SOCIETY AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM
ALL WARRANTIES,
EXPRESS OR IMPLIED,
INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
<h3>Acknowledgment</h3>
<p class='copyright'>
Funding for the RFC Editor function is provided by
the IETF Administrative Support Activity (IASA).</p>
</body></html>
